

==================================================
SECTION: automated_actions.rst
PATH: applications/studio/automated_actions.rst
==================================================

:show-content:

================
Automation rules
================

Automation rules allow the execution of one or more predefined actions in response to a specific
trigger, e.g., create an activity when a field is set to a specific value, or archive a record 7
days after its last update.

When creating an automation rule, it is possible to :ref:`add conditions that must be met
<studio/automated-actions/conditions>` for the automation rule to run, e.g., the opportunity must be
assigned to a specific salesperson, or the state of the record must not be :guilabel:`Draft`.

To create an automation rule with **Odoo Studio**:

#. :ref:`Open Studio <studio/access>` and click :guilabel:`Automations`, then :guilabel:`New`.
#. Give the automation rule a clear, meaningful name that identifies its purpose.
#. Select the :ref:`Trigger <studio/automated-actions/trigger>` and, if necessary, fill in the
   fields that appear on the screen based on the chosen trigger.
#. Click :ref:`Add an action <studio/automated-actions/action>` in the :guilabel:`Actions To Do`
   tab.
#. Select the :guilabel:`Type` of action and complete the relevant fields based on the chosen
   action.
#. Click :guilabel:`Save & Close` or, to define additional actions, :guilabel:`Save & New`.

.. example::

   To ensure follow-up on less satisfied clients, this automation rule creates an activity 3 months
   after a sales order is created for clients with a satisfaction percentage lower than 30%.

   .. image:: automated_actions/trigger-timing-conditions.png
      :alt: Example of an automation rule on the Subscription model
      :scale: 90%

.. tip::
   - Use the :guilabel:`Notes` tab to document the purpose and functioning of automation rules. This
     makes rules easier to maintain and facilitates collaboration between users.
   - To modify the :doc:`model <models_modules_apps>` targeted by the automation rule, switch models
     before clicking :guilabel:`Automations` in Studio, or :ref:`activate developer mode
     <developer-mode>`, create or edit an automation rule, and select the :guilabel:`Model` in the
     :guilabel:`Automation Rules` form.
   - Automation rules can be created from any kanban stage by clicking the :icon:`fa-cog`
     :guilabel:`(Settings)` icon that appears when hovering over the kanban stage name, then
     selecting :guilabel:`Automations`. In this case, the :guilabel:`Trigger` is set to
     :guilabel:`Stage is set to` by default, but it can be changed if necessary.

     .. image:: automated_actions/automations-kanban.png
        :alt: Create automations from a kanban stage

.. _studio/automated-actions/trigger:

Trigger
=======

The :guilabel:`Trigger` is used to define what kind of event needs to occur for the automation rule
to run. The available triggers depend on the :doc:`model <models_modules_apps>`. Five trigger
categories are available overall:

- :ref:`studio/automated-actions/trigger-values-updated`
- :ref:`studio/automated-actions/trigger-email-events`
- :ref:`studio/automated-actions/trigger-timing-conditions`
- :ref:`studio/automated-actions/trigger-custom`
- :ref:`studio/automated-actions/trigger-external`

.. _studio/automated-actions/conditions:

Adding conditions
-----------------

Domain filters allow you to determine the records an automation rule should target or exclude.
Efficient filtering enhances overall performance as it avoids unnecessary processing on records that
are not impacted by the rule.

.. tip::
   :ref:`Activate developer mode <developer-mode>` before creating an automation rule to have the
   most flexibility in adding domain filters.

Depending on the trigger chosen, it is possible to define one or more conditions a record must meet
*before* and/or *after* a trigger occurs.

- The :guilabel:`Before Update Domain` defines the conditions a record must meet *before* the
  trigger event occurs, e.g., the record must have `Type = Customer Invoice` and `Status = Posted`.

  With developer mode activated, click :guilabel:`Edit Domain`, if available, then
  :guilabel:`New Rule`.

- The :guilabel:`Apply on` domain defines the conditions a record must meet *after* the trigger
  event occurs, e.g., the customer invoice must have `Payment Status = Partially Paid`.

  With developer mode activated, click :guilabel:`Edit Domain` then :guilabel:`New Rule`.

  .. tip::
     If developer mode is not activated, to define an :guilabel:`Apply on` domain, click
     :icon:`fa-plus` :guilabel:`Add condition`. Complete or delete the suggested condition. To add a
     condition, click :guilabel:`New Rule`.

When a :ref:`trigger <studio/automated-actions/trigger>` occurs, e.g., the payment status of a
posted customer invoice is updated, the automation rule checks the defined conditions and only
executes the :ref:`action <studio/automated-actions/action>` if the record matches those conditions.

.. example::
   If the automated action should be executed when an email address is set for the first time (in
   contrast to modifying an email address) on an existing contact that is an individual rather than
   a company, use `Email is not set` and `Is a Company is not set` as the :guilabel:`Before Update
   Domain` and `Email is set` as the :guilabel:`Apply on` domain.

   .. image:: automated_actions/before-update-domain.png
      :alt: Example of a trigger with a Before Update Domain
      :scale: 80%

.. note::
   The :guilabel:`Before Update Domain` is not checked upon the creation of a record.

.. _studio/automated-actions/trigger-values-updated:

Values Updated
--------------

Trigger automated actions when specific changes happen in the database. The triggers available in
this category depend on the model and are based on common changes, such as adding a specific tag
(e.g., to a task) or setting a field's value (e.g., setting the :guilabel:`User` field).

Select the trigger, then select a value if required.

.. _studio/automated-actions/trigger-email-events:

Email Events
------------

Trigger automated actions upon receiving or sending emails.

.. _studio/automated-actions/trigger-timing-conditions:

Timing Conditions
-----------------

Trigger automated actions at a point in time relative to a date field or to the creation or update
of a record. The following triggers are available:

- :guilabel:`Based on date field`: The action is triggered a defined period of time *before or
  after* the date of the selected date field, e.g., 30 days before the contract end date.
- :guilabel:`After creation`: The action is triggered a defined period of time after a record is
  created and saved.
- :guilabel:`After last update`: The action is triggered a defined period of time after an existing
  record is edited and saved.

To configure a :guilabel:`Timing Conditions` trigger, with :ref:`developer mode activated
<developer-mode>`:

#. Select the appropriate :guilabel:`Trigger` from the :guilabel:`Timing Conditions` category.
   If you select the :guilabel:`Based on date field` trigger, select the relevant date field.
#. Configure the :guilabel:`Delay` to determine the *execution date time* of the action(s). To
   do so, enter the number of :guilabel:`Minutes`, :guilabel:`Hours`, :guilabel:`Days`, or
   :guilabel:`Months` after which the action should be triggered. If you selected the
   :guilabel:`Based on date field` trigger, the action can be triggered :guilabel:`After` or
   :guilabel:`Before` the selected date field.
#. Optionally, :ref:`add conditions <studio/automated-actions/conditions>` that the record must meet
   before and/or after the rule is triggered.
#. Click :icon:`fa-cloud-upload` :guilabel:`Save manually`.
#. Click :icon:`fa-arrow-right` :guilabel:`Scheduled action` to open the :guilabel:`Automation
   Rules: check and execute` scheduled action.

   .. note::
      This scheduled action checks for execution date times that have been reached since its
      previous run, and executes the related action(s), if relevant. By default, the scheduled
      action is set to :guilabel:`Execute Every` 4 hours, which is generally sufficient for delays
      such as 3 months after the order date or 7 days after the last update.

      If any automation rule has a time-based trigger with a delay of less than the equivalent of 40
      hours, e.g., 3 hours before the event start date time, the frequency of the scheduled action
      is automatically increased, e.g., to :guilabel:`Execute Every` 18 minutes. This allows the
      action to be executed closer to its scheduled execution date time.

#. Click :guilabel:`Run manually` at the top left.

   .. warning::
      This step is critical to prevent the rule from running retroactively on historical records.
      Running the scheduled action manually initializes the timestamp of its *last run* in the
      automation rule, which is a key element of the rule's :ref:`execution logic
      <studio/automated-actions/trigger-timing-conditions-logic>`.

#. Click the automation rule name in the breadcrumbs to return to the automation rule setup.
#. Add the :ref:`action(s) to be executed <studio/automated-actions/action>` then, when all actions
   have been defined, click :icon:`fa-cloud-upload` :guilabel:`Save manually`.

The action is executed the first time the :guilabel:`Automation Rules: check and execute` scheduled
action runs after the execution date time is reached, and when the conditions are met.

.. _studio/automated-actions/trigger-timing-conditions-logic:

Execution logic
~~~~~~~~~~~~~~~

When using a time-based trigger, an action is only executed when the execution date time falls
*between* the last run of the scheduled action and the current run (whether scheduled or run
manually), i.e.:

**last run --> execution date and time --> current run**

.. note::
   Running the :guilabel:`Automation Rules: check and execute` scheduled action manually does not
   necessarily result in a rule's action being executed. When testing an automation rule with a
   time-based trigger, ensure that this sequence is true, then check if the action has been
   executed.

.. example::
   On the morning of October 15, you create an automation rule that triggers the sending of an email
   30 days before the :guilabel:`Contract end date`; contracts end at 11:59 pm on their contract end
   date. During the creating of the rule, the :guilabel:`Automation Rules: check and execute`
   scheduled action was run manually at 11:00 am and is set to run every four hours thereafter.

   This new automation rule will apply for contracts whose end date is at least 30 days *after* the
   creation of the rule, i.e., an end date of November 14 or later.

   For a contract with an end date of November 14, the execution date time of the action is 11:59 pm
   on October 15. The action will therefore be executed the first time the :guilabel:`Automation
   Rules: check and execute` scheduled action runs after that date and time has passed, i.e.,:

   - last run of the scheduled action: 11:00 pm on October 15
   - execution date time: 11:59 pm on October 15
   - current run of the scheduled action: 3:00 am on October 16

.. _studio/automated-actions/trigger-custom:

Custom
------

Trigger automated actions:

- :guilabel:`On create`: when a record is saved for the first time.
- :guilabel:`On create and edit`: when a record is saved for the first time and any subsequent time.
- :guilabel:`On deletion`: when a record is deleted.
- :guilabel:`On UI change`: when a field's value is changed on the :ref:`Form view
  <studio/views/general/form>`, even before the record is saved.

For the :guilabel:`On create and edit` and :guilabel:`On UI change` triggers, you **must** then
select the field(s) to be used to trigger the automation rule in the :guilabel:`When updating`
field.

.. warning::
   If no field is selected in the :guilabel:`When updating` field, the automated action may be
   executed multiple times per record.

Optionally, you can also define additional conditions to be met to trigger the automation rule in
the :guilabel:`Apply on` field.

.. note::
   The :guilabel:`On UI change` trigger can only be used with the :ref:`Execute Code
   <studio/automated-actions/action-execute-code>` action and only works when a modification is made
   manually. The action is not executed if the field is changed through another automation rule.

.. _studio/automated-actions/trigger-external:

External
--------

Trigger automated actions based on a specific event in an external system or application using a
:doc:`webhook <automated_actions/webhooks>`.

After the webhook is configured in Odoo, where the webhook's URL is generated and the target record
defined, it needs to be implemented in the external system.

.. warning::
  It is *highly recommended* to consult with a developer, solution architect, or another technical
  role when deciding to use webhooks and throughout the implementation process. If not properly
  configured, webhooks may disrupt the Odoo database and can take time to revert.

.. image:: automated_actions/webhook-update-record.png
   :alt: Example of a Based on date field trigger
   :scale: 80%

.. note::
   It is also possible to set up an automated action that :ref:`sends data to a external system's
   webhook <studio/automated-actions/action-webhook>` when an event occurs in your Odoo database.

.. seealso::
   :doc:`Webhook documentation <automated_actions/webhooks>`

.. _studio/automated-actions/action:

Actions
=======

Once you have defined the automation rule's :ref:`trigger <studio/automated-actions/trigger>`,
click :guilabel:`Add an action` in the :guilabel:`Actions To Do` tab to define the action(s) to be
executed.

.. tip::
   - If no explicit name is entered, the name of the action will be automatically generated based
     on the action you define; the name can be updated at any time.
   - You can define multiple actions for the same automation rule. By default, actions are executed
     in the order in which they were defined.

     This means, for example, that if you define an :guilabel:`Update record` action and then a
     :guilabel:`Send email` action where the email references the field that was updated, the email
     uses the updated values. However, if the :guilabel:`Send email` action is defined before the
     :guilabel:`Update record` action, the email uses the values set *before* the record is updated.

     To change the order of defined actions, click the :icon:`oi-draggable` :guilabel:`(drag handle)`
     icon beside an action and drag it to the desired position.

.. _studio/automated-actions/action-update-record:

Update Record
-------------

This action is used to update one of the record's (related) fields. The following options are
available:

- :guilabel:`Update`: updates the selected field with the specified value.
- :guilabel:`Update with AI`: updates the selected field dynamically based on the AI prompt
  provided. This option requires the **Odoo AI** app to be installed.
- :guilabel:`Sequence`: update the selected field with a defined sequence.
- :guilabel:`Compute`: updates the selected field dynamically using Python code.

To define the action:

#. With the :guilabel:`Update`, :guilabel:`Update with AI`, :guilabel:`Sequence` or
   :guilabel:`Compute` option selected, as relevant, select or search for the field to be updated or
   computed. If needed, click the :icon:`oi-chevron-right` :guilabel:`(right arrow)` next to the
   field name to access the list of related fields.
#. Provide the relevant information based on the option selected.

Update
~~~~~~

Select or enter the updated value for the field.

If a :ref:`many2many field <studio/fields/relational-fields-many2many>` is being updated, choose
whether the field must be updated by :guilabel:`Adding`, :guilabel:`Removing`, or :guilabel:`Setting
it to` the selected value or by :guilabel:`Clearing it`.

.. example::
   If you want the automated action to remove a tag from the customer record, set the
   :guilabel:`Update` field to :guilabel:`Customer > Tags`, select :guilabel:`by Removing`, then
   select the tag to be removed.

   .. image:: automated_actions/update-record-tags.png
      :alt: Example of an Update Record action
      :scale: 80%

Update with AI
~~~~~~~~~~~~~~

Enter a prompt to instruct Odoo AI how to update the field. Type `/` to open the :guilabel:`AI
prompt tools`; use :guilabel:`Field Selector` to tell Odoo AI which related fields to check for
context, and :guilabel:`Records Selector` to provide possible values for the updated field.

.. example::
   If you want the automation rule to update the :guilabel:`Assignees` field of a newly created
   task based on the employees' expertise, you can write a prompt to instruct Odoo AI to check
   the :guilabel:`Display Name` field of the task for the context, then to assign the most suitable
   employee.

   .. image:: automated_actions/update-record-ai.png
      :alt: Example of updating a record using AI
      :scale: 80%

Sequence
~~~~~~~~

Select an existing sequence or, to create a new sequence:

#. Click :guilabel:`Search more`, then click :guilabel:`New`.
#. In the window that opens, enter the :guilabel:`Name` of the sequence.
#. In the :guilabel:`Sequence` tab, configure the sequence:

   - :guilabel:`Prefix`: characters added *before* the next number in the sequence.
   - :guilabel:`Suffix`: characters added *after* the next number in the sequence.
   - :guilabel:`Sequence Size`: determines the number of digits in every number in the sequence. If
     needed, leading zeros are added before the number to achieve the indicated sequence size, e.g.,
     for a sequence size of `5`, the first number in the sequence is `00001`.
   - :guilabel:`Step`: determines the increments between the numbers in the sequence.
   - :guilabel:`Next Number`: the next number that will be used in the sequence, without leading
     zeros.

   .. tip::
      - Use dynamic placeholders like `%(year)s` or `%(month)s` as a :guilabel:`Prefix` and/or
        :guilabel:`Suffix` to create sequences with elements like current year, month, etc. Possible
        placeholders are shown at the bottom of the window.
      - To use sub-sequences, e.g., to have the sequence restart each year or each month, enable
        :guilabel:`Use subsequences per date_range`, then :guilabel:`Add a line` for each date
        range and indicate the :guilabel:`Next Number` for the range.

#. Click :guilabel:`Save`.

.. example::
   If you want the automated action to create a sequential customer reference each time a new
   customer is created, set the :guilabel:`Sequence` field to :guilabel:`Reference`, then, in the
   dropdown, click :guilabel:`Search more`. Click :guilabel:`New` to create a new sequence.

   In the example, each new customer receives a sequential reference with the prefix
   `#-REF-%(year)s-`, where `%(year)s` is the current year including the century, and the suffix
   `/CL`, e.g., `#-REF-2025-00001/CL`, `#-REF-2025-00002/CL`, etc.

   .. image:: automated_actions/update-record-sequence.png
      :alt: Example of an Update Record action using a sequence
      :scale: 80%

Compute
~~~~~~~

Enter the code to be used for computing the field's value.

.. example::
   If you want the automation rule to compute a custom :ref:`datetime field
   <studio/fields/simple-fields-date-time>`, :guilabel:`Escalated on`, when a task's priority is set
   to `Very high` (three stars), you can define the trigger :guilabel:`Priority is set to` to `Very
   High` and define the :guilabel:`Update Record` action as follows:

   .. image:: automated_actions/update-record-compute.png
      :alt: Compute a custom datetime field using a Python expression
      :scale: 80%

.. _studio/automated-actions/action-create-record:

Create Record and Duplicate Record
----------------------------------

These actions are used to create a new or duplicated record on any model.

To define the action:

#. With :guilabel:`Create Record` or :guilabel:`Duplicate Record` selected as the :guilabel:`Type`
   of action, as relevant, select the required model in the :guilabel:`Record to Create` field; the
   field contains the current model by default.
#. Specify a :guilabel:`Name` for the record, or, if the action duplicates a record, indicate the
   record being duplicated in the :guilabel:`Duplicate from` field.
#. If the new or duplicated record is being created on another model, select a field in the
   :guilabel:`Link Field` field to link the record that triggered the creation of the new or
   duplicated record.

.. tip::
   The :guilabel:`Link Field` dropdown menu only contains :ref:`one2many fields
   <studio/fields/relational-fields-one2many>` existing on the current model that are linked to a
   :ref:`many2one field <studio/fields/relational-fields-many2one>` on the target model.

.. example::
   If you want the automation rule to duplicate a project, e.g. a project template with predefined
   tasks, when an opportunity is set to `Won`, add a custom `Related opportunity` :ref:`many2one
   field <studio/fields/relational-fields-many2one>` field on the *Project* model and a custom
   `Related project` :ref:`one2many field <studio/fields/relational-fields-one2many>` field on the
   *Lead* model, then provide the following details about the record being duplicated:

   .. image:: automated_actions/duplicate-record.png
      :alt: Duplicate a record in a different model
      :scale: 80%

.. tip::
   You can create another automation rule with :ref:`studio/automated-actions/action-update-record`
   actions to update the fields of the new or duplicated record if necessary. For example, you can
   use a :guilabel:`Create Record` action to create a new project task and then assign it to a
   specific user using an :guilabel:`Update Record` action.

.. _studio/automated-actions/action-create-activity:

Create Activity
---------------

This action is used to schedule a new activity linked to the record.

To define the action:

#. With :guilabel:`Create Activity` selected as the :guilabel:`Type` of action, select the
   appropriate :guilabel:`Activity Type` from the dropdown menu.
#. Enter a :guilabel:`Title`.
#. Indicate by when the activity should be completed by specifying a number of :guilabel:`Days`,
   :guilabel:`Weeks`, or :guilabel:`Months` in the :guilabel:`Due Date In` field.
#. Select a :guilabel:`User type`:

   - To always assign the activity to the same user, select :guilabel:`Specific User`, then add the
     user in the :guilabel:`Responsible` field.
   - To target a user linked to the record dynamically, select :guilabel:`Dynamic User (based on
     record)`. If needed, change the :guilabel:`User Field` by clicking on the placeholder field
     name then selecting or searching for the user field in the list that appears. Clicking the
     :icon:`oi-chevron-right` :guilabel:`(right arrow)` next to the field name allows you to access
     related fields if needed.
#. Optionally, add a :guilabel:`Note` to provide more information about the activity.

.. example::
   After a proposition is sent to a opportunity with a high expected revenue, you want to create an
   activity for the salesperson's team leader to call the potential client to increase the chances
   of closing the deal.

   To do so, set the :guilabel:`Activity Type` to :guilabel:`Call` and the :guilabel:`User Type` to
   :guilabel:`Dynamic User (based on record)`. Click on the placeholder field and select
   :guilabel:`Sales Team`, then click the :icon:`oi-chevron-right` :guilabel:`(right arrow)` and
   select :guilabel:`Team Leader`.

   .. image:: automated_actions/create-activity-action.png
      :alt: Example of a Create Activity action
      :scale: 80%

.. _studio/automated-actions/action-send-email-sms:

Send Email and Send SMS
-----------------------

These actions are used to send an email or a text message to a contact linked to a specific record.

To define the action:

#. With :guilabel:`Send Email` or :guilabel:`Send SMS` selected as the :guilabel:`Type` of action,
   as relevant, select or create an :guilabel:`Email Template` or :guilabel:`SMS Template`.
#. In the :guilabel:`Send Email As` or :guilabel:`Send SMS As` field, choose how you want to send the
   email or text message.

   For an email, select:

   - :guilabel:`Email`: to send the message as an email to the recipients of the :guilabel:`Email
     Template`.
   - :guilabel:`Message`: to post the message on the record and notify the record's followers.
   - :guilabel:`Note`: to send the message as an internal note visible to internal users in the
     chatter.

   For a text message, select:

   - :guilabel:`SMS (without note)`: to send the message as a text message to the recipients of the
     :guilabel:`SMS template`.
   - :guilabel:`SMS (with note)`: to send the message as a text message to the recipients of the
     :guilabel:`SMS template` and post it as an internal note in the chatter.
   - :guilabel:`Note only`: to only post the message as an internal note in the chatter.

.. _studio/automated-actions/action-send-whatsapp:

Send WhatsApp
-------------

.. important::
   To automate the sending of WhatsApp messages, one or more
   :ref:`WhatsApp templates <productivity/whatsapp/templates>` must be created.

This action is used to send a WhatsApp message to a contact linked to a specific record.

With :guilabel:`Send WhatsApp` selected as the :guilabel:`Type` of action, select the appropriate
:guilabel:`WhatsApp Template` from the dropdown menu.

.. _studio/automated-actions/action-add-remove-followers:

Add Followers and Remove Followers
----------------------------------

This action is used to subscribe/unsubscribe existing contacts as followers of the record.

With :guilabel:`Add Followers` or :guilabel:`Remove Followers` selected as the :guilabel:`Type` of
action, as relevant, select a :guilabel:`Followers Type`:

- To always add/remove the same contact(s), select :guilabel:`Specific Followers` then select the
  contact(s) from the dropdown menu. Multiple contacts can be added/removed.

- To add/remove a contact linked to the record dynamically, select :guilabel:`Dynamic Followers`. If
  needed, change the :guilabel:`Followers Field` by clicking on the placeholder field name then
  selecting or searching for the partner field in the list that appears. Clicking the
  :icon:`oi-chevron-right` :guilabel:`(right arrow)` next to the field name allows you to access
  related fields if needed.

.. example::
   To keep customers informed of progress on a project, this automated action adds the relevant
   customer as a follower when a project task is set to `In progress`.

   .. image:: automated_actions/add-followers-action.png
      :alt: Adding the customer as a follower when project task set to in progress
      :scale: 80%

.. _studio/automated-actions/action-execute-code:

Execute Code
------------

.. important::
   For automation rules that require the execution of :ref:`custom code
   <studio/automated-actions/action-execute-code>`, note that maintenance of custom code is not
   included in the *Standard* or *Custom* pricing plans and incurs :ref:`additional fees
   <charges_standard>`.

This action is used to execute Python code. You can write your code into the :guilabel:`Code` tab
using the following variables:

- `env`: environment on which the action is triggered
- `model`: model of the record on which the action is triggered; is a void recordset
- `record`: record on which the action is triggered; may be void
- `records`: recordset of all records on which the action is triggered in multi-mode; this may be
  left empty
- `time`, `datetime`, `dateutil`, `timezone`: useful Python libraries
- `float_compare`: utility function to compare floats based on specific precision
- `log(message, level='info')`: logging function to record debug information in ir.logging
  table
- `_logger.info(message)`: logger to emit messages in server logs
- `UserError`: exception class for raising user-facing warning messages
- `Command`: x2many commands namespace
- `action = {...}`: to return an action

.. tip::
   The available variables are described both in the :guilabel:`Code` and :guilabel:`Help` tabs.

.. seealso::
   :doc:`Odoo's ORM capabilities <../../developer/reference/backend/orm>`

.. _studio/automated-actions/action-webhook:

Send Webhook Notification
-------------------------

This action is used to send a `POST` API request with the values of the selected :guilabel:`Fields`
to the webhook URL specified in the :guilabel:`URL` field.

The :guilabel:`Sample Payload` provides a preview of the data included in the request using a random
record's data or dummy data if no record is available.

.. note::
   It is also possible to set up an automated action that :doc:`uses a webhook to receive data from
   an external system <automated_actions/webhooks>` when a predefined event occurs in that system.

.. _studio/automated-actions/action-existing-actions:

Multi Actions
-------------

This action is used to trigger multiple actions (linked to the current model) at the same time.

To define the actions:

#. With :guilabel:`Multi Actions` selected as the :guilabel:`Type` of action, click :guilabel:`Add
   an action`.
#. In the :guilabel:`Add: Child Actions` pop-up:

   - select one or more existing actions and click :guilabel:`Select`; or
   - click :guilabel:`New`, define the action to be executed, then click :guilabel:`Save & Close`
     or, to create additional actions, :guilabel:`Save & New` .
#. Repeat as many times as needed.

.. image:: automated_actions/multi-actions.png
   :alt: Define multiple actions to be executed

.. toctree::
   :titlesonly:

   automated_actions/webhooks


==================================================
SECTION: webhooks.rst
PATH: applications/studio/automated_actions/webhooks.rst
==================================================

========
Webhooks
========

.. warning::
  It is *highly recommended* to consult with a developer, solution architect, or another technical
  role when deciding to use webhooks and throughout the implementation process. If not properly
  configured, webhooks may disrupt the Odoo database and can take time to revert.

Webhooks, which can be created in **Odoo Studio**, allow you to automate an action in your Odoo
database when a specific event occurs in another, external system.

In practice, this works as follows: when the event occurs in the external system, a data file (the
"payload") is sent to the Odoo webhook's URL via a `POST` API request, and a predefined action is
performed in your Odoo database.

Unlike scheduled actions, which run at predefined intervals, or manual API requests, which need to
be explicitly invoked, webhooks enable real-time, event-driven communication and automation. For
example, you can set up a webhook to have your Odoo inventory data updated automatically when a
sales order is confirmed in an external point-of-sale system.

Setting up a webhook in Odoo requires no coding when connecting two Odoo databases, but
:ref:`testing a webhook <studio/webhooks/test-webhook>` requires an external tool.
:ref:`Custom target records or actions <studio/webhooks/webhook-example>` may require programming
skills.

.. note::
   This article covers creating a webhook that *receives* data from an external source. However,
   it is also possible to create an automated action that :ref:`sends data to an external webhook
   <studio/automated-actions/action-webhook>` when a change occurs in your Odoo database.

.. _studio/webhooks/create-webhook:

Create a webhook in Odoo
========================

.. important::
   Before implementing a webhook in a live database, configure and test it using a :ref:`duplicate
   database <odoo-online/duplicate>` to ensure the webhook performs as intended.

.. tip::
   :ref:`Activating developer mode <developer-mode>` before creating up a webhook gives greater
   flexibility in selecting the :doc:`model <../models_modules_apps>` the automation rule
   targets. It also allows you to find the technical name of the model and fields, which may be
   needed to configure the payload.

   To find a model's technical name, with developer mode activated, hover over the model name and
   then click :icon:`fa-arrow-right` :guilabel:`(Internal link)`. The technical name can be found in
   the :guilabel:`Model` field. For example, a sales order webhook uses the *Sales
   Order* model, but the technical name `sale.order` is used in the payload.

To create a webhook in **Studio**, proceed as follows:

#. :ref:`Open Studio <studio/access>` and click :guilabel:`Webhooks`, then :guilabel:`New`.
#. Give the webhook a clear, meaningful name that identifies its purpose.
#. If needed, and provided developer mode is activated, select the appropriate :guilabel:`Model`
   from the dropdown. If developer mode is not activated, the automation rule targets the current
   model by default.

#. The webhook's URL is automatically generated, but can be changed if needed by clicking
   :guilabel:`Rotate Secret`. This is the URL that should be used when implementing the webhook in
   the external system that will send updates to the database.

   .. warning::
      The URL is **confidential** and should be treated with care. Sharing it online or without
      caution can provide unintended access to the Odoo database. If the URL is updated after the
      initial implementation, make sure to update it in the external system.

#. If desired, enable :guilabel:`Log Calls` to track the history of API requests made to the
   webhook's URL, e.g., for troubleshooting purposes.

#. If the system sending the webhook is not Odoo, adjust the :guilabel:`Target Record` code to look
   for the JSON record included in the payload when the API request is made to the webhook's URL. If
   the system sending the webhook is an Odoo database, ensure that the `id` and `model` appear in
   the payload.

   If the webhook is used to create records in the Odoo database, use `model.browse(i)` or
   `model.search(i)` instead of the default :guilabel:`Target Record` format.

#. Click :guilabel:`Add an action` in the :guilabel:`Actions To Do` tab to define the :ref:`actions
   <studio/automated-actions/action>` to be executed.
#. Before implementing the webhook in the external system, :ref:`test
   <studio/webhooks/test-webhook>` it to ensure it works as intended.

.. tip::
   - Webhooks can also be created via the :guilabel:`Automations` menu in **Studio** by selecting
     the trigger :guilabel:`On webhook`.
   - To access the history of API requests if :guilabel:`Log Calls` has been enabled, click the
     :guilabel:`Logs` smart button at the top of the :guilabel:`Automation rules` form.
   - If the purpose of the webhook is anything other than to update an existing record, e.g., to
     create a new record, the :guilabel:`Execute Code` action must be chosen.

.. _studio/webhooks/test-webhook:

Test a webhook
==============

Testing a webhook requires a test payload and an external tool or system, like
`Postman <https://www.postman.com/>`_, to send the payload via a `POST` API request. This section
presents the steps to test a webhook in Postman.

.. tip::
   - See the :ref:`webhook use cases section <studio/webhooks/webhook-examples>` for step-by-step
     explanations of how to test webhooks using test payloads.
   - To get specific help with testing a webhook with Postman, contact their support team.

#. In Postman, create a new HTTP request and set its method to :guilabel:`POST`.
#. Copy the webhook's URL from your Odoo database using the :icon:`fa-link` :guilabel:`(link)` icon
   and paste it into the URL field in Postman.
#. Click the :guilabel:`Body` tab and select :guilabel:`raw`.
#. Set the file type to :guilabel:`JSON`, then copy the code from the test payload and paste it into
   the code editor.
#. Click :guilabel:`Send`.

.. _studio/webhooks/test-webhook-response:

In the :guilabel:`Response` viewer at the bottom of the screen in Postman, details, including a HTTP
response code, indicate whether or not the webhook is functioning correctly.

- A `200 OK` or `status: ok` message indicates that the webhook is functioning properly on Odoo's
  side. From here, implementation can begin with the other system to automatically send the API
  requests to the Odoo webhook's URL.

- If any other response is returned, the number associated with it helps to identify the problem.
  For example, a `500 Internal Server Error` message means that Odoo could not interpret the call
  properly. In this case, ensure the fields found in the JSON file are properly mapped in the
  webhook's configuration and in the system sending the test call.

.. tip::
   Turning on call logging in the webhook's configuration in Odoo provides error logs if the webhook
   is not functioning as intended.

Implement a webhook in an external system
=========================================

When the webhook has been successfully created in Odoo and tested, implement it in the system that
sends data to the Odoo database, making sure the `POST` API requests are sent to the webhook's URL.

.. _studio/webhooks/webhook-examples:

Webhook use cases
=================

Below are two examples of how to use webhooks in Odoo. A test payload is provided for each example,
and can be found in the section on testing the webhook. `Postman <https://www.postman.com/>`_ is
used to send the test payload.

Update a sales order's currency
-------------------------------

This webhook updates a sales order in the **Sales** app to `USD` when the external system sends a
`POST` API request to the webhook's URL that includes that sales order number (which is identified
by the payload's `id` record).

This could be useful for subsidiaries outside the United States with a mother company located inside
the United States or during mergers when consolidating data into one Odoo database.

Create the webhook
~~~~~~~~~~~~~~~~~~

To create this webhook, proceed as follows:

#. Open the **Sales** app, then :ref:`open Studio <studio/access>` and click :guilabel:`Webhooks`.
   The *Sales Order* model is selected by default.
#. Click :guilabel:`New`. The :guilabel:`Trigger` is set to :guilabel:`On webhook` by default.
#. Set the :guilabel:`Target Record` to
   `model.env[payload.get('_model')].browse(int(payload.get('_id')))`, where:

   - `payload.get('_model')` retrieves the value associated with the `model` key in the payload,
     i.e., `sale.order`, which is the technical name of the *Sales Order* model.
   - `payload.get('_id')` retrieves the value associated with the `id` key in the payload, i.e.,
     the number of the target sales order in your Odoo database with the `S` and leading
     zeros removed.
   - `int` converts the retrieved id to an integer (i.e., a whole number) because the method
     `browse()` can only be used with an integer.

#. Click :guilabel:`Add an action`.
#. In the :guilabel:`Type` section, click :guilabel:`Update Record`.
#. In the :guilabel:`Action details` section, select :guilabel:`Update`, choose the field
   :guilabel:`Currency`, and select :guilabel:`USD`.
#. Click :guilabel:`Save & Close`.

Test the webhook
~~~~~~~~~~~~~~~~

To test this webhook, proceed as follows:

#. With `Postman <https://www.postman.com/>`_ open, create a new HTTP request and set its method to
   :guilabel:`POST`.
#. Copy the URL of the Odoo webhook using the :icon:`fa-link` :guilabel:`(link)` icon and paste it
   into the URL field in Postman.
#. Click the :guilabel:`Body` tab and select :guilabel:`raw`.
#. Set the file type to :guilabel:`JSON`, then copy this code, i.e., the payload, and paste it into
   the code editor:

   .. code-block:: json

      {
          "_model": "sale.order",
          "_id": "SALES ORDER NUMBER"
      }

#. In your Odoo database, choose a sales order to test the webhook on. In the pasted code, replace
   `SALES ORDER NUMBER` with the sales order's number without the `S` or any zeros before the
   number. For example, a sales order with the number `S00007` should be entered as `7` in Postman.
#. Click :guilabel:`Send`.
#. Consult the :ref:`Response viewer <studio/webhooks/test-webhook-response>` in Postman to
   determine whether or not the webhook is functioning properly. If a message other than `200 OK` or
   `status: ok` is returned, the number associated with the message helps to identify the problem.

.. _studio/webhooks/webhook-example:

Create a new contact
--------------------

This webhook uses custom code to create a new contact in an Odoo database when the external system
sends a `POST` API request to the webhook's URL that includes the contact's information. This could
be helpful for automatically creating new vendors or customers.

Create the webhook
~~~~~~~~~~~~~~~~~~

To create this webhook, proceed as follows:

#. Open the **Contacts** app, then :ref:`open Studio <studio/access>` and click :guilabel:`Webhooks`.
   The *Contact* model is selected by default.
#. Click :guilabel:`New`. The :guilabel:`Trigger` is set to :guilabel:`On webhook` by default.
#. Set the :guilabel:`Target Record` to `model.browse([2])`. This is essentially a placeholder as
   the code in the automated action tells the webhook what needs to be retrieved from the payload
   and in which model the record needs to be created.
#. Click :guilabel:`Add an action`.
#. In the :guilabel:`Type` section, click :guilabel:`Execute Code`.
#. Copy this code and paste it into the code editor in the :guilabel:`Code` tab of the
   :guilabel:`Action details` section:

   .. code-block:: python

      # variables to retrieve and hold data from the payload
      contact_name = payload.get('name')
      contact_email = payload.get('email')
      contact_phone = payload.get('phone')

      # a Python function to turn the variables into a contact in Odoo
      if contact_name and contact_email:
          new_partner = env['res.partner'].create({
              'name': contact_name,
              'email': contact_email,
              'phone': contact_phone,
              'company_type':'person',
              'customer_rank': 1,
          })
      # an error message for missing required data in the payload
      else:
          raise ValueError("Missing required fields: 'name' and 'email'")

#. Click :guilabel:`Save & Close`.

Test the webhook
~~~~~~~~~~~~~~~~

To test this webhook, proceed as follows:

#. In `Postman <https://www.postman.com/>`_, create a new HTTP request and set its method to
   :guilabel:`POST`.
#. Copy the URL of the Odoo webhook using the :icon:`fa-link` :guilabel:`(link)` icon and paste it
   into the URL field in Postman.
#. Click the :guilabel:`Body` tab and select :guilabel:`raw`.
#. Set the file type to :guilabel:`JSON`, then copy this code, i.e., the payload, and paste it into
   the code editor:

   .. code-block:: json

      {
          "name": "CONTACT NAME",
          "email": "CONTACTEMAIL@EMAIL.COM",
          "phone": "CONTACT PHONE NUMBER"
      }

#. In the pasted code, replace the `CONTACT NAME`, `CONTACTEMAIL@EMAIL.COM`, and `CONTACT PHONE
   NUMBER` with a new contact's information.
#. Click :guilabel:`Send`.
#. Consult the :ref:`Response viewer <studio/webhooks/test-webhook-response>` in Postman to
   determine whether or not the webhook is functioning properly. If a message other than `200 OK` or
   `status: ok` is returned, the number associated with the message helps to identify the problem.
