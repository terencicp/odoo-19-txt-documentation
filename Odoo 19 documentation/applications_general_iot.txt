

==================================================
SECTION: iot.rst
PATH: applications/general/iot.rst
==================================================

:show-content:
:hide-page-toc:
:nosearch:

========================
Internet of Things (IoT)
========================

Odoo Internet of Things (IoT) allows to connect physical devices such as barcode scanners, receipt
printers, payment terminals, measurement tools, etc. to an Odoo database using an IoT system.

The following IoT systems are supported:

- :doc:`IoT box <iot/iot_box>`: micro-computer, plug-and-play device (i.e., the Odoo IoT program is
  pre-installed);
- :doc:`Windows virtual IoT <iot/windows_iot>`: Odoo IoT program for Windows that can be installed
  on a Windows computer.

.. note::
   - :abbr:`MRP (Material Requirement Planning)` devices, including cameras and measurement tools,
     are not compatible with the Windows virtual IoT.
   - Multiple IoT systems can be used at the same time.
   - It is also possible to create a Windows Virtual Machine on a MacOS/Linux computer. However,
     this option is not supported by Odoo, and no troubleshooting assistance will be provided.

.. _iot/iot/iot-subscription:

IoT box subscription
====================

An IoT box subscription is required for production use of IoT systems and generating the
:ref:`HTTPS certificate <iot/connect/https_certificate>`. It is created automatically
when an IoT system is :doc:`connected to the database <iot/connect>`. If you have issues related to
your subscription, contact the database's account manager or Odoo partner for assistance.

.. seealso::
   - `Odoo's compatible IoT devices <https://www.odoo.com/app/iot-hardware>`_
   - `Odoo Tutorials: Internet of Things (IoT) Tutorials
     <https://www.odoo.com/slides/internet-of-things-iot-175>`_
   - `IoT system FAQ <https://www.odoo.com/app/iot-faq>`_
   - `Magic Sheet - Odoo Internet of Things [PDF]
     <https://drive.google.com/file/d/18D0VqlGvW6kUg-xKmyELrQqJ6J3bHKGy/view>`_

.. cards::

   .. card:: IoT box
      :target: iot/iot_box
      :large:

      Set up an IoT box.

   .. card:: Windows virtual IoT
      :target: iot/windows_iot
      :large:

      Set up a Windows virtual IoT.

   .. card:: IoT system connection to Odoo
      :target: iot/connect

      Connect the IoT system to your Odoo database and troubleshoot potential connection issues.

   .. card:: Devices
      :target: iot/devices

      Connect devices such as printers, screens, measurement tools, etc., to the IoT system.

   .. card:: Troubleshooting
      :target: iot/iot_advanced/troubleshooting

      Diagnose and resolve common IoT system connection and configuration issues.

   .. card:: IoT system updates
      :target: iot/iot_advanced/updating_iot

      Update your IoT system's image, core code, and handlers to benefit from the latest IoT fixes
      and features or reset the IoT system if needed.

.. toctree::
   :titlesonly:

   iot/iot_box
   iot/windows_iot
   iot/connect
   iot/iot_advanced
   iot/devices


==================================================
SECTION: camera.rst
PATH: applications/general/iot/devices/camera.rst
==================================================

================
Connect a camera
================

A camera can be connected to an :abbr:`IoT (Internet of Things)` box with an Odoo database in just a
few steps. Once a camera is connected to an :abbr:`IoT (Internet of Things)` box, it can be used in
a manufacturing process, or it can be linked to a quality control point/quality check. Doing so
allows for the taking of pictures when a chosen quality control point/check has been reached, or
when a specific key is pressed during manufacturing.

Connection
==========

To connect a camera to an :abbr:`IoT (Internet of Things)` box, simply connect the two via cable.
This is usually done with a :abbr:`USB (Universal Serial Bus)` cable of some sort.

If the camera is `supported <https://www.odoo.com/page/iot-hardware>`_, there is no need to set up
anything, as it'll be detected as soon as it's connected.

.. image:: camera/camera-dropdown.png
   :align: center
   :alt: Camera recognized on the IoT box.

Link camera to quality control point in manufacturing process
=============================================================

In the :menuselection:`Quality app`, a device can be set up on a :guilabel:`Quality Control Point`.
To do that, navigate to the :menuselection:`Quality app --> Quality Control --> Control Points` and
open the desired :guilabel:`Control Point` that'll be linked to the camera.

On the control point form, edit the control point by selecting the :guilabel:`Type` field, and
clicking on :guilabel:`Take a Picture` from the drop-down menu. Doing so reveals a field called
:guilabel:`Device`, wherein the attached *device* can be selected. :guilabel:`Save` the changes, if
required.

.. image:: camera/control-point-device.png
   :align: center
   :alt: Setting up the device on the quality control point.

The camera is now useable with the selected quality control point. When the quality control point
is reached during the manufacturing process, the database prompts the operator to take a picture.

.. image:: camera/serial-number-picture.png
   :align: center
   :alt: Graphic user interface of the device on the quality control point.

.. note::
   Quality control points can also be accessed by navigating to :menuselection:`IoT App -->
   Devices`. From here, select the device. There is a :guilabel:`Quality Control Points` tab, where
   they can be added with the device.

.. tip::
   On a quality check form, the :guilabel:`Type` of check can also be specified to :guilabel:`Take a
   Picture`. Navigate to :menuselection:`Quality app --> Quality Control --> Quality Checks --> New`
   to create a new quality check from the :guilabel:`Quality Checks` page.

.. seealso::
   - :doc:`/applications/inventory_and_mrp/quality/quality_management/quality_control_points`
   - :doc:`/applications/inventory_and_mrp/quality/quality_management/quality_alerts`

Link camera to a work center in the Manufacturing app
=====================================================

To link a camera to an action, it first needs to be configured on a work center. Navigate to
:menuselection:`Manufacturing app --> Configuration --> Work Centers`. Next, go to the desired
:guilabel:`Work Center` in which a camera will be used to reveal that specific work center's detail
form. From here, add the device in the :guilabel:`IoT Triggers` tab, in the :guilabel:`Device`
column, by clicking :guilabel:`Add a Line`.

Now, the camera device can be linked to the :guilabel:`Action` column drop-down option labeled
:guilabel:`Take a Picture`. A key can also be added to trigger the action.

.. important::
   The first trigger listed is chosen first. The order of triggers matters, and they can be dragged
   into any desired order.

.. note::
   On the :guilabel:`Work Order` screen, a status graphic indicates whether the database is
   correctly connected to the camera.

.. seealso::
   :ref:`workcenter_iot`


==================================================
SECTION: connect.rst
PATH: applications/general/iot/connect.rst
==================================================

=============================
IoT system connection to Odoo
=============================

Prerequisites
=============

To connect the IoT system to an Odoo database, the following prerequisites must be met:

- The Internet of Things (IoT) app must be :ref:`installed <general/install>`.
- The IoT system must be connected to the network.
- The device connecting to Odoo must be on the same network as the IoT system.

.. note::
   It is recommended to connect the IoT system to a **production** instance, as other types of
   environments may cause issues (e.g., with :ref:`HTTPS certificate generation
   <iot/https_certificate_iot/iot-eligibility>`).

.. seealso::
   - :doc:`iot_box`
   - :doc:`windows_iot`

Connection
==========

To connect the IoT system to an Odoo database, open the IoT app and click :guilabel:`Connect`.

The browser then scans the network to which the computer is connected for available IoT systems. If
an IoT system is detected, it is connected automatically. If multiple IoT systems are found, select
the appropriate one in the popup that opens, then click :guilabel:`Connect`. If no IoT system is
detected automatically, try connecting it to the database using a :ref:`pairing code
<iot/connect/pairing-code>` or a :ref:`connection token <iot/connect/token>`.

.. tip::
   The IoT system’s name is composed of either the :doc:`IoT box <iot_box>` or the
   :doc:`Windows computer <windows_iot>`’s motherboard serial number, followed by its :ref:`pairing
   code <iot/connect/pairing-code>`.

.. _iot/connect/pairing-code:

Connection using a pairing code
-------------------------------

.. note::
   - The pairing code is valid for up to 2 hours after the IoT system powers on. If the code is
     no longer valid, restart the IoT box or :ref:`restart the Windows virtual IoT service
     <iot/windows_iot/restart>` to display another pairing code. Alternatively, connect the IoT
     system to the database using a :ref:`connection token <iot/connect/token>`.
   - The pairing code is not displayed if the IoT system is already connected to a database (e.g.,
     a test database). If necessary, :ref:`disconnect the IoT system from the database
     <iot/connect/disconnect>`.

#. Retrieve the IoT system's pairing code:

   .. tabs::

      .. group-tab:: IoT box

         Connect the IoT box to an external monitor or a USB printer. If the IoT box was already plugged
         prior to this, :ref:`restart <iot/iot-box/restart>` it.

         - External monitor: The pairing code will be displayed on the screen after (re)starting the
           IoT box.
         - USB-connected printer: The pairing code should be printed automatically.

         .. tip::
            If no external monitor or printer is connected to the IoT box, access the :ref:`IoT
            box's homepage <iot/iot-box/homepage>`; the code is displayed in the :guilabel:`Pairing
            Code` section.

      .. group-tab:: Windows virtual IoT

         On the computer with the Windows virtual IoT installed, open the IoT system's homepage
         in a web browser by navigating to the URL `http://localhost:8069`. Then, scroll to the
         :guilabel:`Pairing Code` section.

#. In Odoo, open the IoT app and click :guilabel:`Connect`.
#. In the :guilabel:`Searching for an IoT Box` popup that opens, click :guilabel:`Use Pairing Code`.
#. Enter the :guilabel:`Pairing code` and click :guilabel:`Connect`.

.. _iot/connect/token:

Connection using a connection token
-----------------------------------

#. :ref:`Enable the developer mode <developer-mode>`.
#. In Odoo, open the IoT app and click :guilabel:`Connect`.
#. In the :guilabel:`Searching for an IoT Box` popup that opens, click :guilabel:`Offline pairing`.
#. In the :guilabel:`Pair an IoT Box offline` popup that opens, copy the :guilabel:`Token`.
#. Access the :ref:`IoT box's <iot/iot-box/homepage>` or :ref:`Windows virtual IoT's
   <iot/windows-iot/homepage>` homepage.
#. In the :icon:`fa-link` :guilabel:`Odoo database connected` section, click :guilabel:`Configure`.
#. Paste the token into the :guilabel:`Server Token` field and click :guilabel:`Connect`.

.. note::
   Once the IoT system is connected to a database:

   - If the :doc:`Point of Sale app </applications/sales/point_of_sale>` is installed, a popup
     appears to select the :doc:`POS the IoT system should be associated with
     </applications/sales/point_of_sale/configuration/pos_iot>`.
   - If using an :doc:`IoT box <iot_box>`, wait a few minutes for it to update before using the
     connected :doc:`devices <devices>`.
   - The IoT system automatically requests an :ref:`HTTPS certificate
     <iot/connect/https_certificate>` and its homepage is updated to a new HTTPS URL ending with
     `.odoo-iot.com` when it becomes available.

.. seealso::
   :doc:`iot_advanced/troubleshooting`

.. _iot/connect/IoT-form:

IoT system form
===============

Once the IoT system is connected to the Odoo database, it is displayed as a card in the IoT app.
Click the card to access the IoT system's form, which allows to access the :ref:`IoT box's
<iot/iot-box/homepage>` or :ref:`Windows virtual IoT's <iot/windows-iot/homepage>` homepage and
view the list of :doc:`devices <devices>` connected to the IoT system.

.. tip::
   Enable the :ref:`developer mode <developer-mode>` to access the IoT system's :guilabel:`Technical
   Information`, such as its :guilabel:`Domain Address`, :guilabel:`Image Version`, and
   :ref:`SSL Certificate <iot/connect/https_certificate>` :guilabel:`End Date`.
   By default, drivers are automatically :ref:`updated <iot_updating_iot/handlers>` every time the
   IoT system is restarted. To disable automatic updates, uncheck the :guilabel:`Automatic drivers
   update` option.

.. _iot/connect/disconnect:

Disconnecting an IoT system from a database
===========================================

To disconnect the IoT system from a database, follow these steps:

#. Open the IoT app and click the relevant IoT system's card.
#. Click the :icon:`fa-cog` :guilabel:`(Actions)` icon, and select :guilabel:`Delete`.

.. tip::
   Alternatively:

   #. Access the :ref:`IoT box's <iot/iot-box/homepage>` or :ref:`Windows virtual IoT's
      <iot/windows-iot/homepage>` homepage.
   #. Click :guilabel:`Configure` in the :icon:`fa-link` :guilabel:`Odoo database connected`
      section.
   #. Click :guilabel:`Disconnect` in the popup that opens.

.. _iot/connect/https_certificate:

HTTPS certificate
=================

:abbr:`HTTPS (Hypertext Transfer Protocol Secure)` is the secure, encrypted version of :abbr:`HTTP
(Hypertext Transfer Protocol)`. It uses :abbr:`TLS (Transport Layer Security)` (previously
:abbr:`SSL (Secure Sockets Layer)`) certificates to authenticate the server and protect the data
exchanged between a browser and a website. Some network devices, such as payment terminals, require
a valid HTTPS certificate to communicate with the IoT system; without it, they cannot interact
properly.

.. note::
   In this documentation and throughout Odoo, the term *HTTPS certificate*  refers to a valid
   SSL certificate that allows an HTTPS connection.

When the IoT system is (re-)started and connected to a database, it automatically downloads the
HTTPS certificate if the database meets the following eligibility criteria:

.. _iot/https_certificate_iot/iot-eligibility:

- The database must be a **production** instance. The database instance should not be a copy, a
  duplicate, a staging, or a development environment.
- The Odoo subscription must be ongoing (:guilabel:`In Progress` status).

When the certificate has been received:

- The IoT system's homepage address is updated to a new HTTPS URL ending with `.odoo-iot.com`.
- The :guilabel:`HTTPS certificate` banner displays the certificate's validity period. To view this
  information, click the :icon:`fa-cogs` (:guilabel:`cogs`) button at the top-right of the IoT
  system's homepage.

  .. image:: connect/https-valid.png
     :alt: IoT box homepage with HTTPS certificate validity date.

.. seealso::
   :ref:`iot/troubleshooting/https_certificate`


==================================================
SECTION: devices.rst
PATH: applications/general/iot/devices.rst
==================================================

:nosearch:
:show-content:
:show-toc:

=======
Devices
=======

.. toctree::
   :titlesonly:
   :glob:

   devices/printer
   devices/scale
   devices/screen
   devices/measurement_tool
   devices/camera
   devices/footswitch

.. seealso::
   - :doc:`Connect a Worldline payment terminal
     <../../sales/point_of_sale/payment_methods/terminals/worldline>`
   - :doc:`Connect an Ingenico payment terminal
     <../../sales/point_of_sale/payment_methods/terminals/ingenico>`
   - :doc:`Connect a SIX payment terminal
     <../../sales/point_of_sale/payment_methods/terminals/six>`


==================================================
SECTION: footswitch.rst
PATH: applications/general/iot/devices/footswitch.rst
==================================================

====================
Connect a footswitch
====================

When working in a manufacturing environment, it's always better for an operator to have both hands
available at all times. Odoo's :abbr:`IoT (Internet of Things)` box makes this possible when using a
footswitch.

In fact, with a footswitch, the operator is able to go from one screen to another, and perform
actions using their foot. This can be configured in just a few steps on the work center in the
*Manufacturing* app.

Connection
==========

To connect a footswitch to the :abbr:`IoT (Internet of Things)` box, connect the two devices via
cable. More often than not, this is done with a :abbr:`USB (Universal Serial Bus)` cable.

If the footswitch is a `supported device <https://www.odoo.com/page/iot-hardware>`_, there is no
need to take further action, since it'll be automatically detected when connected.

.. image:: footswitch/footswitch-dropdown.png
   :alt: Footswitch recognized on the IoT box.

Link a footswitch to a work center in the Odoo Manufacturing app
================================================================

To link a footswitch to an action, it first needs to be configured on a work center. Navigate to
:menuselection:`Manufacturing --> Configuration --> Work Centers`. From here, go to the desired
:guilabel:`Work Center` in which the footswitch will be used, and add the device in the
:guilabel:`IoT Triggers` tab, under the :guilabel:`Device` column, by selecting :guilabel:`Add a
Line`. Doing so means the footswitch can be linked to an option in the :guilabel:`Action` column
drop-down, and optionally, a key can be added to trigger it. An example of an :guilabel:`Action` in
the *Manufacturing app* could be the :guilabel:`Validate` or :guilabel:`Mark as Done` buttons on a
manufacturing work order.

.. important::
   Triggers are executed in the order they appear, with the first one taking priority. To reorder
   the triggers, click the :icon:`oi-draggable` :guilabel:`(draggable)` icon to the left of each
   trigger, and drag it to the desired position.

.. tip::
   - To identify the key assigned to each pedal, connect the footswitch to any computer and press
     the pedals as if typing. Usually, the pedals are mapped by default to the keyboard keys `a`,
     `b`, and `c`.
   - The :guilabel:`Work Order` list includes a status indicator that shows whether the database is
     successfully connected to the footswitch.

.. seealso::
   :ref:`workcenter_iot`


==================================================
SECTION: iot_advanced.rst
PATH: applications/general/iot/iot_advanced.rst
==================================================

:nosearch:

========
Advanced
========

.. toctree::

   iot_advanced/troubleshooting
   iot_advanced/updating_iot
   iot_advanced/ssh_connect


==================================================
SECTION: iot_box.rst
PATH: applications/general/iot/iot_box.rst
==================================================

=======
IoT box
=======

To start using an IoT box:

#. Connect your :doc:`devices <devices>` to the IoT box.
#. :ref:`Connect the IoT box to the network <iot/iot_box/network>`.
#. :doc:`Connect the IoT box to your Odoo database <connect>`.

.. seealso::
   - `Video: How to Set Up and Use the Odoo IoT Box: A Beginner's Guide <https://www.youtube.com/watch?v=w2_Dcm3r_7o&ab_channel=Odoo>`_
   - :doc:`iot_advanced/troubleshooting`

.. _iot/iot_box/network:

Network connection
==================

The IoT box can be connected to the network via :ref:`Ethernet <iot/iot_box/network-ethernet>` or
:ref:`Wi-Fi <iot/iot_box/network-wifi>`.

.. note::
   It is recommended to connect the IoT box to the same network as the :doc:`devices <devices>`
   connecting to it.

.. important::
   Never make the IoT box accessible from the public Internet.
   IoT systems are designed to provide your database with access to devices on your local network.
   Exposing them to the public Internet would create a **security risk**.

.. _iot/iot_box/network-ethernet:

Ethernet
--------

Plug the Ethernet cable into the IoT box's Ethernet port and an available port on your router, then
connect the IoT box to a power source.

.. _iot/iot_box/network-wifi:

Wi-Fi
-----

Make sure no Ethernet cable is connected to the IoT box and follow these steps:

  #. Connect the IoT box to a power source and wait a few minutes for it to power on.
  #. Access your computer's Wi-Fi settings and select the IoT box's network. The network name is in
     the format `IoTBox-xxxxxxxxxxxx` (where `xxxxxxxxxxxx` is a unique identifier).
  #. Connect to the IoT box's Wi-Fi network and sign into it; your browser should automatically
     open and redirect to the :ref:`IoT box's homepage <iot/iot-box/homepage>`.

     .. note::
        Depending on your operating system, the browser might not open and redirect to the IoT box's
        homepage. In this case, open your browser manually and navigate to `http://10.11.12.1`
        or any URL starting with **http** (e.g., `http://odoo.com`).

  #. On the IoT box's homepage, click :guilabel:`Configure` next to the :guilabel:`Internet Status`
     section.

     .. image:: iot_box/iot-wifi.png
        :scale: 75%
        :alt: IoT box's WiFi hotspot

  #. Wait a few minutes for the available networks to be scanned, select the network, enter the
     Wi-Fi's password, and click :guilabel:`Connect`.

.. note::
   Once connected to the Wi-Fi network, the IoT box stops emitting its Wi-Fi signal, and the
   computer should automatically reconnect to its original network. If it does not, reconnect to it
   manually.

.. tip::
   If the IoT box is connected to an :doc:`external monitor <devices/screen>`, you can also scan the
   first QR code displayed on the screen to connect to the network, then scan the second QR code to
   access the IoT box's :ref:`homepage <iot/iot-box/homepage>`. On the homepage, click
   :guilabel:`Configure` in the :guilabel:`Internet Status` section, select the relevant Wi-Fi
   network, enter the password, and click :guilabel:`Connect`.

.. _iot/iot-box/led-status:

LED status
==========

The IoT box features two LEDs, located to the right of the SD card slot, which show its status and
help with troubleshooting when no display is connected. The LEDs can be interpreted as follows:

- **Red LED lit**: The IoT box has no Internet connection. Ensure the Ethernet cable is properly
  connected or :ref:`connect the IoT box via Wi-Fi <iot/iot_box/network-wifi>`.
- **Green LED flashing**: The IoT box is awaiting :doc:`connection to a database <connect>`.
- **Green LED constantly lit**: The IoT box is connected to a database; no further action is
  required.

.. _iot/iot-box/homepage:

IoT box homepage
================

To access the IoT box's homepage, open a web browser **on the same network as the IoT box** and
navigate to the IoT box's IP address.

.. image:: iot_box/iot-homepage.png
   :scale: 75%
   :alt: IoT box's homepage

The IoT box's IP address can be retrieved by:

- connecting the IoT box to an :doc:`external monitor <devices/screen>`: the IP address is displayed
  on the screen.

  .. image:: iot_box/iot-status-display.png
     :scale: 75%
     :alt: Status display with IoT box's IP address

- connecting the IoT box to a `supported receipt or label printer <https://www.odoo.com/app/iot-hardware>`_
  with a USB cable: the IP address is automatically printed.
- accessing the administrator interface of the router to which the IoT box is connected or using
  third-party software to scan the network.

.. tip::
   If the IoT box is connected to an :doc:`external monitor <devices/screen>` or a :doc:`printer
   <devices/printer>`, its homepage can also be accessed by scanning the displayed or printed QR
   code with a device connected to the same network as the IoT box.

Once the IoT box is :doc:`connected to the Odoo database <connect>`, its homepage can be accessed
from the IoT app: click the relevant IoT box's card, then click :guilabel:`Homepage`.

.. _iot/iot-box/restart:

IoT box restart
===============

To manually restart the IoT box, access its :ref:`homepage <iot/iot-box/homepage>`, then click the
:icon:`fa-power-off` :guilabel:`(power off)` button in the top-right corner.

.. tip::
   You can also fully reboot the IoT box by unplugging and plugging it back in.


==================================================
SECTION: measurement_tool.rst
PATH: applications/general/iot/devices/measurement_tool.rst
==================================================

==========================
Connect a measurement tool
==========================

.. _iot/devices/measurement-tool:

With Odoo's :abbr:`IoT (Internet of Things)` box, it is possible to connect measurement tools to the
Odoo database for use in the *Quality app* on a quality control point/quality check, or for use in a
work center during the manufacturing process.

Find the list of supported devices here: `Supported devices
<https://www.odoo.com/page/iot-hardware>`_.

Connect with universal serial bus (USB)
=======================================

To add a device connected by :abbr:`USB (Universal Serial Bus)`, plug the :abbr:`USB (Universal
Serial Bus)` cable into the :abbr:`IoT (Internet of Things)` box, and the device appears in the Odoo
database.

.. image:: measurement_tool/device-dropdown.png
   :align: center
   :alt: Measurement tool recognized on the IoT box.

Connect with bluetooth
======================

Activate the Bluetooth functionality on the device (see the device manual for further explanation),
and the :abbr:`IoT (Internet of Things)` box automatically connects to the device.

.. image:: measurement_tool/measurement-tool.png
   :align: center
   :alt: Bluetooth indicator on measurement tool.


Link a measurement tool to a quality control point in the manufacturing process
===============================================================================

In the *Quality app*, a device can be set up on a quality control point. To do that, navigate to
:menuselection:`Quality app --> Quality Control --> Control Points`, and open the desired control
point to which the measurement tool should be linked.

From here, edit the control point, by selecting the :guilabel:`Type` field, and clicking
:guilabel:`Measure` from the drop-down menu. Doing so reveals a field called :guilabel:`Device`,
where the attached device can be selected.

Additionally, :guilabel:`Norm` and :guilabel:`Tolerance` can be configured. :guilabel:`Save` the
changes, if required.

At this point, the measurement tool is linked to the chosen quality control point. The value, which
usually needs to be changed manually, is automatically updated while the tool is being used.

.. image:: measurement_tool/measurement-control-point.png
   :align: center
   :alt: Measurement tool input in the Odoo database.

.. tip::
   Quality control points can also be accessed by navigating to :menuselection:`IoT App -->
   Devices`, then select the device. There is a :guilabel:`Quality Control Points` tab, where they
   can be added with the device.

.. note::
   On a quality check detail form, the :guilabel:`Type` of check can also be specified to
   :guilabel:`Measure`. Access a new quality check detail page, by navigating to
   :menuselection:`Quality app --> Quality Control --> Quality Checks --> New`.

.. seealso::
   - :doc:`../../../inventory_and_mrp/quality/quality_management/quality_control_points`
   - :doc:`../../../inventory_and_mrp/quality/quality_management/quality_alerts`

Link a measurement tool to a work center in the Manufacturing app
=================================================================

To link a measurement tool to an action, it first needs to be configured on a work center. To do
that, navigate to :menuselection:`Manufacturing app --> Configuration --> Work Centers`. Then,
select the desired work center in which the measurement tool will be used.

On the work center page, add the device in the :guilabel:`IoT Triggers` tab, under the
:guilabel:`Device` column, by selecting :guilabel:`Add a Line`. Then, the measurement tool can be
linked to the :guilabel:`Action` drop-down menu option labeled :guilabel:`Take Measure`. A key can
be added to trigger the action.

.. important::
   It should be noted that the first listed trigger is chosen first. The order matters, and these
   triggers can be dragged into any order.

.. note::
   On the :guilabel:`Work Order` screen, a status graphic indicates whether the database is
   correctly connected to the measurement tool.

.. seealso::
   :ref:`workcenter_iot`


==================================================
SECTION: printer.rst
PATH: applications/general/iot/devices/printer.rst
==================================================

=================
Connect a printer
=================

Printer installation can be done in a few easy steps. The printer can be used to print receipts,
labels, orders, or even reports from the different Odoo apps. In addition, printer actions can be
assigned as an *action on a trigger* during the manufacturing process, or added onto a quality
control point or a quality check.

.. warning::
   The **only** way to connect a printer directly to an Odoo database is through the use of an IoT
   system. Without an IoT system, printing can still occur, but it is managed through the printer
   itself, which is not the recommended process.

Connection
==========

IoT systems support printers connected through USB, network connection, or Bluetooth.
`Supported printers <https://www.odoo.com/page/iot-hardware>`_ are detected automatically, and
appear in the :guilabel:`Devices` list of the IoT app.

.. image:: printer/printer-detected.png
   :alt: The printer as it would appear in the IoT app devices list.

.. important::
   Printers connecting to the IoT system via the network must be on the **same network** as the IoT
   system.

.. note::
   Printers can take up to two minutes to appear in the IoT app's :guilabel:`Devices` list.

Link a printer
==============

Link work orders to a printer
-----------------------------

Work orders can be linked to printers, via a quality control point, to print labels for
manufactured products.

In the :doc:`Quality app </applications/inventory_and_mrp/quality>`, a device can be set up on a
quality control point. To do so, go to the :menuselection:`Quality --> Quality Control --> Control
Points`, and open the desired control point.

.. important::
   A manufacturing operation and work order operation need to be attached to a quality control
   point before the :guilabel:`Type` field allows for the :guilabel:`Print Label` option to be
   selected.

From here, edit the control point by selecting the :guilabel:`Type` field, and selecting
:guilabel:`Print Label` from the dropdown menu of options. Doing so reveals the :guilabel:`Device`
field, where the attached device can be selected.

The printer can now be used with the selected quality control point. When the quality control point
is reached during the manufacturing process, the database presents the option to print labels for a
specific product.

.. tip::
   Quality control points can also be accessed by navigating to :menuselection:`IoT -->
   Devices`, then selecting the device. Go to the :guilabel:`Quality Control Points` tab to add them
   to the device.

.. note::
   On a :doc:`quality check form
   </applications/inventory_and_mrp/quality/quality_management/quality_checks>`, the
   :guilabel:`Type` of check can also be set to :guilabel:`Print Label`.

.. seealso::
   - :doc:`/applications/inventory_and_mrp/quality/quality_management/quality_control_points`
   - :doc:`/applications/inventory_and_mrp/quality/quality_management/quality_alerts`

.. _iot/link-printer:

Link reports to a printer
-------------------------

It is possible to link report types to a specific printer. To do so:

#. Go to :menuselection:`IoT --> Devices` and select the desired printer.
#. Go to the :guilabel:`Printer Reports` tab and click :guilabel:`Add a line`.
#. In the pop-up that opens, select the types of reports to be linked to the printer and click
   :guilabel:`Select`.

.. image:: printer/printer-reports.png
   :alt: The list of reports assigned to a printer in the IoT app.

.. tip::
   Reports can also be configured by :ref:`enabling the developer mode <developer-mode>` and going
   to :menuselection:`Settings --> Technical --> Reports`. Select the desired report from the list
   and set an :guilabel:`IoT Device`.

The first time a linked report is selected to print, a :guilabel:`Select Printers` pop-up window
appears. Tick the checkbox next to the correct printer for the report, and click :guilabel:`Print`.
At that point, the report is linked to the printer.

Clear device printer cache
~~~~~~~~~~~~~~~~~~~~~~~~~~

After a printer is linked to print a report, the setting is saved in a browser's cache. This means
a user can have different devices saved in their cache for different reports, based on the device
they use to access Odoo. It also means different users can have a report automatically printed from
different printers, based on their preferences.

To unlink a report from a printer, navigate to :menuselection:`IoT --> Configuration --> Reset
Linked Printers`. This generates a list of reports that are linked to a printer on the current
device. Click the :guilabel:`Unlink` button next to each report to remove the link.

.. important::
   This step **only** prevents the report from automatically printing to the listed printer from
   the current browser. The report is still :ref:`linked <iot/link-printer>` on the device, under
   the :guilabel:`Printer Reports` tab.

.. image:: printer/clear-reports.png
   :alt: A list of reports currently linked to a printer in the IoT app.

.. seealso::
   :ref:`POS Order Printing <pos/restaurant/orders-printing>`

Potential issues
================

The printer is not detected
---------------------------

If a printer does not appear in the devices list, go to the :ref:`IoT box's <iot/iot-box/homepage>`
or :ref:`Windows virtual IoT's <iot/windows-iot/homepage>` homepage, click :guilabel:`Show` in
the :guilabel:`Devices` section, and make sure the printer is listed.

If the printer does not appear on the IoT system's homepage, click :guilabel:`Printer Server`, then
:guilabel:`Administration`, and :guilabel:`Add Printer`. If the printer is not in the list, it is
likely not connected properly.

The printer outputs random text
-------------------------------

For most printers, the correct driver should be automatically detected and selected. However, in
some cases, the automatic detection mechanism might not be enough, and if no driver is found, the
printer might print random characters.

The solution is to manually select the corresponding driver. On the IoT system's homepage, click
:guilabel:`Printer Server`, then :guilabel:`Printers`, and select the printer in the list.
In the :guilabel:`Administration` dropdown menu, click :guilabel:`Modify Printer`. Follow the steps
and select the printer's *make* and *model*.

.. image:: printer/modify-printer.png
   :scale: 75%
   :alt: Edit the printer connected to the IoT system.

.. note::
   Epson receipt printers and Zebra label printers do not need a driver to work. Make sure that no
   driver is selected for those printers.

The printer is detected but is not recognized correctly
-------------------------------------------------------

If Odoo and the IoT system do not recognize the printer correctly, go to :menuselection:`IoT
--> Devices`, click the device's card to access its form, and set the :guilabel:`Subtype` field to
the appropriate option: :guilabel:`Receipt Printer`, :guilabel:`Label Printer`, or :guilabel:`Office
Printer`.

Epson configuration special case
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Most Epson printers support printing receipts in Odoo Point of Sale using the `GS v 0` command.
However, the following Epson printer models do not support this command:

- TM-U220
- TM-U230
- TM-P60
- TMP-P60II

To bypass this issue, you can configure the printer to use the `ESC *` command.

First, review Epson's website for compatibility for both the `GS v 0
<https://download4.epson.biz/sec_pubs/pos/reference_en/escpos/gs_lv_0.html>`_ and `ESC *
<https://download4.epson.biz/sec_pubs/pos/reference_en/escpos/esc_asterisk.html>`_ commands.

If the printer is incompatible with `GS v 0` but supports `ESC *`, configure the IoT system to use
the `ESC *` command as follows:

#. Access the :ref:`IoT box's <iot/iot-box/homepage>` or :ref:`Windows virtual IoT's
   <iot/windows-iot/homepage>` homepage.
#. Click the :guilabel:`Printer server` button, then click :guilabel:`Administration` on the CUPS
   page.
#. Click :guilabel:`Add Printer` in the :guilabel:`Printers` section, select the printer, and click
   :guilabel:`Continue`.

   .. tip::
      If the printer's name is still uncertain, take the following steps:

      #. Take note of the listed printers on the CUPS page.
      #. Turn the printer off and refresh the page.
      #. Compare the difference with the first list to see which printer disappeared.
      #. Turn the printer back on and refresh the page again.
      #. Double-check the list again to see if the printer re-appears.
      #. The printer that disappeared and reappears again on the listed printers is the name of the
         printer in question. It can be :guilabel:`Unknown` under :guilabel:`Local printers`.

#. On the :guilabel:`Add Printer` page, specify the printer's :guilabel:`Name` using the following
   convention: `<printer_name>__IMC_<param_1>_<param_2>_..._<param_n>__`, where:

   - `printer_name` is the printer's name. It can contain any character except `_`, `/`, `#`, or ` `
     (space character).
   - `IMC`: This stands for *Image Mode Column* (the simplified name for `ESC *`).
   - `param_1`: This stands for the specific parameter:

     - `SCALE<X>`: Scale of the picture (with the same aspect ratio). `X` should be an integer
       describing the scale percentage that should be used. For example, `100` is the original size,
       `50` is half the size, and `200` is twice the size.
     - `LDV`: *Low Density Vertical* (will be set to *High Density Vertical* if not specified).
     - `LDH`: *Low Density Horizontal* (will be set to *High Density Horizontal* if not specified).

     .. note::
        - *Density* parameters might need to be configured in a particular way, depending on the
          printer model.
        - Refer to `Epson's ESC * documentation <https://download4.epson.biz/sec_pubs/pos/reference_en/escpos/esc_asterisk.html>`_
          to determine if the printer requires these parameters to be set.

    .. example::
       The following are examples of proper and improper name formatting:

       Proper name formatting:

       - `EPSONTMm30II__IMC__`
       - `EPSON_TM_U220__IMC_LDV_LDH_SCALE80__`

       Improper name formatting (this will not prevent printing, but the result might not have the
       expected printed output):

       - `EPSON TMm 30II`: The name cannot contain spaces.
       - `EPSONTMm30II`: The name itself is correct, but it will not use `ESC *`.
       - `EPSONTMm30II__IMC`: This name is missing the end `__`.
       - `EPSONTMm30II__IMC_XDV__`: The parameter `XDV` does not match any existing parameters.
       - `EPSONTMm30II__IMC_SCALE__`: The parameter `SCALE` is missing the scale value.

#. Once the printer's name has been defined using the appropriate naming convention, click
   :guilabel:`Continue`.
#. Set the :guilabel:`Make` value to :guilabel:`Raw` and the :guilabel:`Model` value to
   :guilabel:`Raw Queue (en)`.
#. Click :guilabel:`Add Printer`. If everything was done correctly, the page should redirect to the
   :guilabel:`Banners` page.
#. Wait a few minutes for the IoT system to detect the printer and sync to Odoo's server.
#. :ref:`Access the POS settings <configuration/settings>` and select your POS, or click the
   vertical ellipsis button (:guilabel:`⋮`) on a POS card and click :guilabel:`Edit`. Scroll down
   to the :guilabel:`Connected Devices` section, enable :guilabel:`IoT Box`, and select the printer
   in the :guilabel:`Receipt Printer` field. Click :guilabel:`Save`.

.. note::
   If the printer was set up incorrectly (e.g., it continues to print random text, or the printed
   receipt is too large or too small), it cannot be modified via the printer's name in CUPS.
   Instead, configure a new printer from scratch with modified parameters, following the steps
   above.

.. spoiler::
   Example

   The following is an example of the troubleshooting process for a TM-U220B printer model using the
   `ESC *` command. The receipt pictured below is an example of a receipt that is printing correctly
   due to proper formatting (in theory):

   .. image:: printer/receipt-example.png
      :scale: 60%
      :alt: Properly formatted receipt picture from a demo database.

   Printing this receipt immediately without proper formatting will not work, as the TM-U220B
   printer model does not support the `GS v 0` command. Instead, random characters will be printed:

   .. image:: printer/receipt-print-random-letters.png
      :scale: 60%
      :alt: Printer paper with seemingly random characters.

   To properly configure formatting for the Epson TM-U220B printer model, follow these steps:

   #. After checking Epson's website for compatibility with both the `GS v 0
      <https://download4.epson.biz/sec_pubs/pos/reference_en/escpos/gs_lv_0.html>`_ and `ESC *
      <https://download4.epson.biz/sec_pubs/pos/reference_en/escpos/esc_asterisk.html>`_ commands,
      the TM-U220B printer is indeed incompatible with `GS v 0` but supports `ESC *`.

      .. image:: printer/epson-compatibility-compare.png
         :alt: Epson compatibility evaluation from Epson website.

   #. When adding the printer, CUPS displays the list of available printers:

      .. image:: printer/add-printer.png
         :scale: 75%
         :alt: Administration menu, add printer selection.

      In this case, the printer is connected via USB, so it is not part of the
      :guilabel:`Discovered Network Printers`. Instead, it is likely part of the :guilabel:`Unknown`
      selection under :guilabel:`Local Printers`. By unplugging the printer's USB cable from the IoT
      system and refreshing the page, the :guilabel:`Unknown` printer disappears. By plugging it
      back in, the printer reappears.

   #. For the naming convention, since the printer must print using the `ESC *` command, it is
      imperative to add `__IMC`.

      .. image:: printer/epson-tm-u220-specification.png
         :alt: Epson TM-U220 specifications on manufacturer's website.

      For this particular model (TM-U220) `m` should be equal to 0 or 1. While referencing the
      :guilabel:`Description` table on `Epson's ESC * website
      <https://download4.epson.biz/sec_pubs/pos/reference_en/escpos/esc_asterisk.html>`_, the `m`
      values could be 0, 1, 32, or 33. So, in this case, the `m` value **cannot** be 32 or 33
      (otherwise, random characters will be printed).

      The table includes the numeric values 32 and 33; they both occur if the :guilabel:`Number of
      bits for vertical data` is set to 24, i.e. it has a *High Vertical Density*. In the case of
      configuring the Epson TM-U220, the *Low Vertical Density* will need to be forced, as
      this printer model does not support *High Vertical Density* for this command `ESC *`.

      To add a *Low Vertical Density*, add the `LDV` parameter to the naming convention.

      .. image:: printer/add-printer-filled.png
         :alt: Add a *Low Vertical Density* (the `LDV` parameter) to the naming convention.

   #. Click :guilabel:`Continue` to proceed. Next, set the :guilabel:`Make` value to :guilabel:`Raw`
      and the :guilabel:`Model` value to :guilabel:`Raw Queue (en)`.

      .. image:: printer/add-printer-add.png
         :alt: Epson TM-U220 specifications on manufacturers website.

      However, when trying to print with the naming convention `EpsonTMU220B__IMC_LDV__`, the
      receipt is printed, but it is too large and outside the margin. To resolve this, add a new
      printer (and naming convention) with the `SCALE<X>` parameter to adapt to the receipt's size.

      Here are some examples:

      .. list-table::
         :header-rows: 1

         * - Printer Naming Convention
           - `EpsonTMU220B__IMC_LDV__`
           - `EpsonTMU220B__IMC_LDV_SCALE75__`
           - `EpsonTMU220B__IMC_LDV_LDH__`
           - `EpsonTMU220B__IMC_LDV_LDH_SCALE35__`
         * - .. image:: printer/receipt-example.png
                :alt: Receipt example format.
           - .. image:: printer/tm-u220-ldv.png
                :alt: Receipt format using naming convention: EpsonTMU220B__IMC_LDV__.
           - .. image:: printer/tm-u220-ldv-scale75.png
                :alt: Receipt format using naming convention: EpsonTMU220B__IMC_LDV_SCALE75__.
           - .. image:: printer/tm-u220-ldv-hdv.png
                :alt: Receipt format using naming convention: EpsonTMU220B__IMC_LDV_LDH__.
           - .. image:: printer/tm-u220-ldv-hdv-scale35.png
                :alt: Receipt format using naming convention: EpsonTMU220B__IMC_LDV_LDH_SCALE35__.

DYMO LabelWriter print issue
----------------------------

The DYMO LabelWriter has a known issue in printing with IoT systems. The OpenPrinting CUPS server
installs the printer using :guilabel:`Local RAW Printer` drivers. In order to print anything, the
correct :guilabel:`Make and Model` needs to be set to reference the correct driver when using the
device.

Additionally, a new printer needs to be added to reduce the print delay that occurs after updating
the driver.

.. important::
   The DYMO LabelWriter 450 DUO printer is the recommended DYMO printer for use with Odoo and IoT
   systems. This device combines two printers: a label printer and a tape printer. When configuring
   the following processes, it is essential to select the correct model (either DYMO LabelWriter 450
   DUO Label (en) or DYMO LabelWriter 450 DUO Tape (en)). For consistency, the following processes
   outline configuration steps for the DYMO LabelWriter 450 DUO Label (en) model. Adjust the model
   selections as needed.

.. _printer/dymo/update_drivers:

DYMO LabelWriter not printing
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

If the DYMO LabelWriter fails to print, install a new driver:

#. Access the IoT system's homepage and click :menuselection:`Printer server` to open the
   OpenPrinting CUPS console.
#. Click :menuselection:`Printers` in the top menu, then click the printer in the list.
#. Select :guilabel:`Maintenance` in the first dropdown menu.
#. Select :guilabel:`Modify Printer` in the second dropdown menu.

   .. image:: printer/main-modify.png
      :alt: Modify the make and model of the DYMO LabelWriter. Maintenance and Modify dropdown
            menus highlighted.

#. Select the specific network connection/printer on which the modification should be made and
   click :guilabel:`Continue`.
#. On the next page, click :guilabel:`Continue`, then select :guilabel:`DYMO` from the
   :guilabel:`Make` dropdown list.
#. Click on :guilabel:`Continue` and set the :guilabel:`Model` to :guilabel:`DYMO LabelWriter 450
   DUO Label (en)` (or whichever DYMO printer model is being used).
#. Click :guilabel:`Modify Printer` to set the new driver; a confirmation page appears.
#. Click :menuselection:`Printers` in the top menu; all printers installed on the OpenPrinting CUPS
   server appear, including the newly updated :guilabel:`DYMO LabelWriter 450 DUO Label` (or
   whichever DYMO printer model is being used).
#. Click the newly updated printer, then click the :guilabel:`Maintenance` dropdown menu and
   select :guilabel:`Print Test Page` to print a test label. The test label is printed after a few
   seconds if the driver update was successful.

To reduce this delay, add a new printer using the steps below.

DYMO LabelWriter print delay
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. tip::
   If the DYMO LabelWriter 450 DUO printer is not printing at all, or is not recognized (i.e., it
   has a :guilabel:`RAW` driver type), then :ref:`update the drivers on the device
   <printer/dymo/update_drivers>`.

To resolve the delay issue after modifying the driver, reinstall the printer:

#. Access the IoT system's homepage and click :menuselection:`Printer server` to open the
   OpenPrinting CUPS console.
#. Click :menuselection:`Administration` in the top menu, then click :guilabel:`Add a Printer`.
#. On the next page, in the :guilabel:`Local Printers` section, select :guilabel:`DYMO
   LabelWriter 450 DUO Label (DYMO LabelWriter 450 DUO Label)` (or whichever DYMO printer model is
   being used) pre-installed printer. Click :guilabel:`Continue`.

   .. image:: printer/local-printer.png
      :alt: Add a printer screen on OpenPrinting CUPS with DYMO LabelWriter 450 DUO Label
            highlighted.

#. On the following screen, update the :guilabel:`Name` to something easily identifiable, as the
   original printer will remain in the list. Then, click :guilabel:`Continue`.

   .. image:: printer/rename-printer.png
      :alt: Rename printer page in the 'Add a Printer' flow, with the name field highlighted.

#. Set the :guilabel:`Model` field to :guilabel:`DYMO LabelWriter 450 DUO Label (en)` (or
   whichever DYMO printer model is being used), then click :guilabel:`Add Printer` to complete
   the installation.

   .. image:: printer/choose-printer.png
      :alt: Choose model screen on the OpenPrinting CUPS console with model and add a printer
            highlighted.

#. Click :menuselection:`Printers` in the top menu and click the newly installed printer
   :guilabel:`DYMO LabelWriter 450 DUO Label` (or whichever DYMO printer model is being used) from
   in the list.

   .. image:: printer/printer-page.png
      :alt: Printer page with newly installed printer highlighted.

#. Click the :guilabel:`Maintenance` dropdown list and select :guilabel:`Print Test Page` to print
   a test label. The test label should print out immediately, or after one or two seconds.

The Zebra printer does not print anything
-----------------------------------------

Zebra printers are quite sensitive to the format of the printed Zebra Programming Language (ZPL)
code. If nothing comes out of the printer or blank labels are printed, try changing the format
of the report sent to the printer. To do so, activate the :ref:`developer mode <developer-mode>`, go
to :menuselection:`Settings --> Technical --> User Interface --> Views`, and search for the
corresponding template.

.. seealso::
   `Zebra's instructions on printing ZPL files
   <https://supportcommunity.zebra.com/s/article/Print-a-zpl-file-using-the-Generic-Text-Printer>`_

Barcode scanner issues
======================

The characters read by the barcode scanner do not match the barcode
-------------------------------------------------------------------

By default, most barcode scanners are configured in the US QWERTY format. If the barcode scanner
uses a different layout, go to :menuselection:`IoT --> Devices` and click the barcode device's card.
Then, select the correct language in the :guilabel:`Keyboard Layout` field.

.. note::
   The :guilabel:`Keyboard Layout` is language-specific, with available options varying based on
   the device and the language of the database (e.g., :guilabel:`English (UK)`, :guilabel:`English
   (US)`, etc.).

Nothing happens when a barcode is scanned
-----------------------------------------

Make sure the correct device is selected in the :doc:`Point of Sale settings
</applications/sales/point_of_sale/configuration/pos_iot>` (when applicable) and the barcode is
configured to send an `ENTER` character (keycode 28) at the end of every barcode.

The barcode scanner is detected as a keyboard
---------------------------------------------

.. important::
   Some barcode scanners are identified as USB keyboards rather than barcode scanners and are not
   recognized by IoT systems.

To change the device type manually, go to :menuselection:`IoT --> Devices` and click the barcode
device's card. Then, enable :guilabel:`Is scanner`.

The barcode scanner processes barcode characters individually
-------------------------------------------------------------

When accessing the mobile version of Odoo from a mobile device or tablet paired with a barcode
scanner via the IoT system, the scanner might interpret each character in a barcode as a separate
scan. To resolve this, go to :menuselection:`IoT --> Devices` and click the barcode device's
card. Then, select the correct language in the :guilabel:`Keyboard Layout` field.

.. note::
   The :guilabel:`Keyboard Layout` is language-specific, with available options varying based on
   the device and the language of the database (e.g., :guilabel:`English (UK)`, :guilabel:`English
   (US)`, etc.).


==================================================
SECTION: scale.rst
PATH: applications/general/iot/devices/scale.rst
==================================================

===============
Connect a scale
===============

.. important::
   In EU member states, `certification is legally required
   <https://eur-lex.europa.eu/legal-content/EN/TXT/?uri=uriserv%3AOJ.L_.2014.096.01.0107.01.ENG>`_
   to use a scale as an integrated device.

To connect a scale to the IoT system, use a USB cable. In some cases, you may need a serial-to-USB
adapter to complete the connection. If the scale is `compatible with an IoT system
<https://www.odoo.com/page/iot-hardware>`_, no additional setup is required; the scale is
automatically detected as soon as it is connected. If the scale is not detected, reboot the IoT box
or :ref:`restart the Windows virtual IoT service <iot/windows_iot/restart>` and :ref:`update the
scale's drivers <iot_updating_iot/handlers>`.

.. note::
   If the scale still does not function after updating the drivers, it might not be `compatible with
   the Odoo IoT system <https://www.odoo.com/page/iot-hardware>`_. In such cases, a different scale
   must be used.

Once the scale is connected to the IoT system, :ref:`configure it in the POS settings
<pos/hardware/scale>`.

.. seealso::
   :doc:`Connect an IoT system to a POS </applications/sales/point_of_sale/configuration/pos_iot>`

Ariva S scales
==============

For Ariva S series scales (manufactured by Mettler-Toledo, LLC.) to function with IoT systems, a
specific setting must be modified, and a dedicated Mettler USB-to-proprietary RJ45 cable is required.

.. important::
   The official Mettler USB-to-RJ45 cable (Mettler part number 72256236) must be used. Contact
   Mettler or a partner to purchase an authentic cable. **No other** cable works for this
   configuration.

To configure the Ariva S scale for IoT system recognition, refer to page 17 of `Mettler's Setup
Guide for Ariva S series scales <https://www.mt.com/dam/RET_DOCS/Ariv.pdf>`_ and follow these steps:

#. Hold the **>T<** button for eight seconds, or until :guilabel:`CONF` appears.
#. Press **>T<** until :guilabel:`GRP 3` appears, then press **>0<** to confirm.
#. At step :guilabel:`3.1`, make sure the value is set to :guilabel:`1` (USB Virtual COM ports) by
   pressing **>T<** to cycle through the options.
#. Press **>0<** until :guilabel:`3.6` (if available, otherwise skip the next step).
#. At step :guilabel:`3.6`, make sure the value is set to :guilabel:`3` (8217 Mettler-Toledo (WO))
   by pressing **>T<** to cycle through the options.
#. Press **>0<** (multiple times if necessary) until :guilabel:`GRP 4` appears.
#. Press **>T<** until :guilabel:`EXIT` appears.

   .. important::
      Do **not** make any other changes unless otherwise needed.

#. Press **>0<**.
#. Press **>0<** again to :guilabel:`SAVE`; the scale restarts.
#. Reboot the IoT box or :ref:`restart the Windows virtual IoT service <iot/windows_iot/restart>`.
   The scale should then appear as `Toledo 8217`.


==================================================
SECTION: screen.rst
PATH: applications/general/iot/devices/screen.rst
==================================================

================
Connect a screen
================

The :doc:`IoT box <../iot_box>` can be connected to a screen, e.g. to ease the IoT box's setup
and/or serve as a :ref:`customer display <pos/hardware/display>` to show customers their :doc:`Point
of Sale </applications/sales/point_of_sale>` orders.

Connection
==========

Connect the screen to the IoT box using a micro-HDMI cable. If the connection was successful, the
external monitor displays the :guilabel:`Status display` screen.

.. image:: screen/screen-status-display.png
   :alt: Default Status Display screen

The screen also appears in the IoT box's list of devices:

- on the :ref:`IoT box's form <iot/connect/IoT-form>`;
- on the :ref:`IoT box's homepage <iot/iot-box/homepage>`;
- in the IoT app, under the menu :menuselection:`IoT --> Devices`.

Customer display
================

To use the screen as a :ref:`customer display <pos/hardware/display>`, :ref:`configure the POS
accordingly <pos/hardware/display-configuration>`.

To display a specific website on the screen instead of the POS customer display, go to
:menuselection:`IoT --> Devices`, click the screen's card, then enter the desired website's URL in
the :guilabel:`Display URL` field.


==================================================
SECTION: ssh_connect.rst
PATH: applications/general/iot/iot_advanced/ssh_connect.rst
==================================================

======================
IoT box SSH connection
======================

.. note::
   SSH connections are only available for :doc:`IoT boxes <../iot_box>`, not the :doc:`Windows
   virtual IoT <../windows_iot>`.

.. warning::
   - This feature should **only** be used with trusted parties, as it provides administrative
     access to the IoT box, which can create security issues.
   - Managing an SSH connection is **not** covered under the standard Odoo support scope. Visit
     the `Odoo Support <https://www.odoo.com/help>`_ page for additional information about what is
     covered.

To provide an :abbr:`SSH (secure shell protocol)` connection to an IoT box, you must generate a
password:

#. Open the IoT app, click the relevant IoT box's card, and click :guilabel:`Homepage`.
#. On the IoT system's homepage, click the :icon:`fa-cogs` (:guilabel:`cogs`) button at the
   top-right, then :guilabel:`Remote Debug`.
#. In the :guilabel:`Remote Debugging` popup that opens, click :guilabel:`Generate` and save the
   password securely. Once you close the popup, the password will no longer be available.

   .. image:: ssh_connect/ssh-generate-password.png
      :alt: The Remote Debugging password generation window.

#. Enter the :guilabel:`Authentication Token` provided by the user attempting to connect to the IoT
   box.
#. Click :guilabel:`Enable Remote Debugging`.

.. seealso::
   - :doc:`../iot_box`
   - :doc:`../connect`


==================================================
SECTION: troubleshooting.rst
PATH: applications/general/iot/iot_advanced/troubleshooting.rst
==================================================

:hide-page-toc:

===============
Troubleshooting
===============

The pairing code does not appear or does not work
=================================================

The :ref:`pairing code <iot/connect/pairing-code>` might not be displayed or printed under the
following circumstances:

- The IoT system is not connected to the network.
- The IoT system is already connected to an Odoo database. :ref:`Disconnect it from the database
  <iot/connect/disconnect>`.
- The :ref:`pairing code <iot/connect/pairing-code>` display time has expired. Restart the :ref:`IoT
  box <iot/iot-box/restart>` or the :ref:`Windows virtual IoT service <iot/windows_iot/restart>` to
  generate and display the pairing code.

The IoT system does not connect to the database
===============================================

The IoT system might take a few minutes to restart when it connects to a database. If it still does
not appear after a few minutes:

- Verify that the IoT system can reach the database and the server does not use a multi-database
  environment.
- Restart the :ref:`IoT box <iot/iot-box/restart>` or the :ref:`Windows virtual IoT service
  <iot/windows_iot/restart>`.

The IoT system is connected to the Odoo database but cannot be reached
======================================================================

Verify that the IoT system and the computer running the Odoo database are connected to the same
network and :ref:`update the DNS settings <iot/troubleshooting/dns>` if necessary.

The Windows virtual IoT's homepage cannot be accessed from another device
=========================================================================

- Ensure the device is connected to the same network as the Windows virtual IoT.
- Check the :ref:`iot/windows-iot/firewall`.

The IoT system does not work after an Odoo upgrade
==================================================

Restart the :ref:`IoT box <iot/iot-box/restart>` or the :ref:`Windows virtual IoT service
<iot/windows_iot/restart>`.

If the issue persists, :ref:`update its image <iot/updating_iot/image-code>` by flashing the IoT
box's card or :ref:`uninstalling the Windows virtual IoT program <iot/windows_iot/uninstall>` and
:ref:`reinstalling the virtual IoT package <iot/windows-iot/installation>`.

.. _iot/troubleshooting/dns:

The IoT system's homepage can be accessed using its IP address but not the `xxx.odoo-iot.com` URL
=================================================================================================

Contact your system or network administrator to address the issue. Network-related problems are
beyond the scope of Odoo support services.

- If the router allows manual :abbr:`DNS (Domain Name System)` configuration, update the settings to
  use `Google DNS <https://developers.google.com/speed/public-dns>`_.
- If the router does not support this, you need to update the DNS settings directly on each device
  that interacts with the IoT system to use `Google DNS
  <https://developers.google.com/speed/public-dns>`_. Instructions for configuring DNS on individual
  devices can be found on the respective manufacturer's website.

.. note::
   - Some IoT devices, such as payment terminals, likely do not require DNS changes, as they are
     typically pre-configured with custom DNS settings.
   - On some browsers, an error code mentioning the DNS (such as `DNS_PROBE_FINISHED_NXDOMAIN`) is
     displayed.

.. _iot/troubleshooting/https_certificate:

HTTPS certificate generation issues and errors
==============================================

The HTTPS certificate does not generate
---------------------------------------

Potential causes include the following:

- The database doesn't meet the :ref:`eligibility requirements
  <iot/https_certificate_iot/iot-eligibility>` for generating an :ref:`HTTPS certificate
  <iot/connect/https_certificate>`.
- The firewall is preventing the HTTPS certificate from generating correctly. In this case,
  deactivate the firewall until the certificate is successfully generated.

  .. note::
     Some devices, such as routers with a built-in firewall, can prevent the HTTPS certificate from
     generating.

Errors
------

A specific error code is displayed on the IoT system's homepage if any issues occur during the
generation or reception of the ref:`HTTPS certificate <iot/connect/https_certificate>`.

.. tip::
   When you access the IoT system's homepage, it automatically checks for an HTTPS certificate and
   attempts to generate one if it is missing. If an error appears, refresh the page to see if the
   issue is resolved.

`ERR_IOT_HTTPS_CHECK_NO_SERVER`
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The server configuration is missing, i.e., the database is not :doc:`connected <../connect>` to
the IoT system.

`ERR_IOT_HTTPS_CHECK_CERT_READ_EXCEPTION`
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

An error occurred while attempting to read the existing ref:`HTTPS certificate
<iot/connect/https_certificate>`.
Verify that the HTTPS certificate file is readable.

`ERR_IOT_HTTPS_LOAD_NO_CREDENTIAL`
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The contract and/or database :abbr:`UUID (Universal Unique Identifier)` is missing from the IoT.

Verify that both values are correctly configured. To update them, :ref:`access the IoT box's
<iot/iot-box/homepage>` or :ref:`Windows virtual IoT's homepage <iot/windows-iot/homepage>`,
click the :icon:`fa-cogs` (:guilabel:`cogs`) button, then click :guilabel:`Credentials`.

`ERR_IOT_HTTPS_LOAD_REQUEST_EXCEPTION`
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

An unexpected error occurred while the IoT system tried to reach `<https://www.odoo.com>`_. This is
likely due to network-related issues, such as:

- The IoT system does not have Internet access.
- Network restrictions (e.g., firewalls or VPNs) are preventing communication with
  https://www.odoo.com.

.. note::
   - To access the full request exception details with information regarding the error, :ref:`enable
     the developer mode <developer-mode>`, click the IoT system's card in the IoT app, and click
     :guilabel:`Download logs` on the :ref:`IoT system's form <iot/connect/IoT-form>`.
     To define the log levels recorded in the IoT system's log file, :ref:`access the IoT box's
     <iot/windows-iot/homepage>` or :ref:`Windows virtual IoT's <iot/iot-box/homepage>` homepage,
     click the :icon:`fa-cogs` (:guilabel:`cogs`) button, then :guilabel:`Log level` at the
     bottom of the page.
   - To address network-related issues, contact your system or network administrator; these issues
     are beyond the scope of Odoo support services.

`ERR_IOT_HTTPS_LOAD_REQUEST_STATUS`
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The IoT system successfully reached `<https://www.odoo.com>`_ but received an unexpected
`HTTP response (status codes) <https://developer.mozilla.org/en-US/docs/Web/HTTP/Status>`_.

This error code includes the HTTP status. For example, `ERR_IOT_HTTPS_LOAD_REQUEST_STATUS 404` means
the server returned a "Page Not Found" response.

To solve this issue:

#. Open `<https://www.odoo.com>`_ in a web browser to check if the website is temporarily down for
   maintenance.
#. | If `<https://www.odoo.com>`_ is down for maintenance, wait for it to resume.
   | If the website is operational, open a `support ticket <https://www.odoo.com/help>`_ and make
     sure to include the 3-digit HTTPS status code in the ticket.

`ERR_IOT_HTTPS_LOAD_REQUEST_NO_RESULT`
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The IoT system successfully connected to `<https://www.odoo.com>`_, but the server refused to
provide the ref:`HTTPS certificate <iot/connect/https_certificate>`.

Check that the IoT system and database meet the :ref:`eligibility requirements
<iot/https_certificate_iot/iot-eligibility>` for an HTTPS certificate.


==================================================
SECTION: updating_iot.rst
PATH: applications/general/iot/iot_advanced/updating_iot.rst
==================================================

==================
IoT system updates
==================

Due to the complexity of IoT systems, the term *updating* can refer to several processes, including:

- :ref:`Updating the IoT system's image and/or core code <iot/updating_iot/image-code>`;
- :ref:`Updating the handlers <iot_updating_iot/handlers>`, which include the interfaces and drivers.

.. _iot/updating_iot/image-code:

Image and core code update
==========================

.. tabs::

   .. group-tab:: IoT box

      To check if the IoT box is up-to-date (and update it if needed), :ref:`access the IoT box's
      homepage <iot/iot-box/homepage>`, click the :icon:`fa-cogs` (:guilabel:`cogs`) button at the
      top-right, then :guilabel:`Update` in the :guilabel:`Version` section.

      .. tip::
         :ref:`Enable the developer mode <developer-mode>` to view the current versions of the IoT
         box's image and core code.

     **Image update**

      To update the IoT box's image, flash its SD card. Flashing can be performed using
      `balenaEtcher <https://etcher.balena.io>`_, a free and open-source tool for writing disk
      images to SD cards.

      .. note::
         - Updating the IoT system's image is often required after upgrading the Odoo database to a
           newer version.
         - A computer with a micro SD card reader/adapter is required to flash the micro SD card.
         - An alternative software for flashing the micro SD card is `Raspberry Pi Imager
           <https://www.raspberrypi.com/software/>`_.

      #. `Download balenaEtcher. <https://etcher.balena.io/#download-etcher>`_
      #. Insert the IoT box's micro SD card into the computer or adapter.
      #. | Open balenaEtcher, click :guilabel:`Flash from URL`, and enter the following URL:
         | `http://nightly.odoo.com/master/iotbox/iotbox-latest.zip`.
      #. Click :guilabel:`Select target` and select the SD card.
      #. Click :guilabel:`Flash` and wait for the process to finish.

      .. image:: updating_iot/etcher-flash.png
         :alt:  Flashing the SD card with balenaEtcher

     **Core code update**

      To update the IoT box's core code, click :guilabel:`Update` under :guilabel:`IoT Box Update`
      in the :guilabel:`Update` popup.

      .. warning::
         **Do not turn off or unplug the IoT box** during the update process, as doing so could leave
         the device in an inconsistent state, requiring the IoT box to be reflashed with a new image.

   .. group-tab:: Windows virtual IoT

      To update the Windows virtual IoT's image and code, :ref:`uninstall the program
      <iot/windows_iot/uninstall>` and :ref:`reinstall <iot/windows-iot/installation>` the latest
      package.

.. _iot_updating_iot/handlers:

Handler (driver) update
=======================

To update the IoT system's handlers (i.e., drivers and interfaces) and synchronize them with the
configured server handler's code, for example, to resolve issues where :doc:`devices <../devices>`
are not functioning properly with the IoT system, proceed as follows:

#. Access the :ref:`IoT box's <iot/iot-box/homepage>` or :ref:`Windows virtual IoT's
   <iot/windows-iot/homepage>` homepage and click the :icon:`fa-cogs` (:guilabel:`cogs`) button at
   the top-right.
#. Click :guilabel:`Update` in the :guilabel:`Version` section.
#. In the :guilabel:`Update` popup that opens, click :guilabel:`Force Drivers Update`.

.. important::
   If you have an :doc:`on-premise </administration/on_premise>` or :doc:`Odoo.sh
   </administration/odoo_sh>` database, the configured server must be up-to-date to ensure the
   handlers' code includes the latest fixes and patches.

.. note::
   A handler update is also performed automatically every time the IoT system is restarted unless
   the :guilabel:`Automatic drivers update` option is disabled in the :guilabel:`Technical
   information` tab in the :ref:`IoT system's form <iot/connect/IoT-form>` in Odoo.


==================================================
SECTION: windows_iot.rst
PATH: applications/general/iot/windows_iot.rst
==================================================

===================
Windows virtual IoT
===================

To start using the Windows virtual IoT:

#. Make sure the computer runs an updated version of Windows (Windows 10 or Windows 11), whether
   it's a laptop, desktop, or server.
#. :ref:`Install the Windows virtual IoT <iot/windows-iot/installation>` on the Windows computer.
#. Connect your :doc:`devices <devices>` to the Windows virtual IoT.
#. :ref:`Configure the Windows Firewall <iot/windows-iot/firewall>`.
#. :doc:`Connect the Windows virtual IoT to your Odoo database <connect>`.

.. note::
   - :abbr:`MRP (Material Requirement Planning)` devices, including cameras and measurement tools,
     are not compatible with Windows virtual IoT.
   - It is also possible to create a Windows Virtual Machine on a macOS/Linux computer. However,
     this option is not supported by Odoo, and no troubleshooting assistance will be provided.

.. seealso::
   :doc:`iot_advanced/troubleshooting`

.. important::
   Never make the Windows virtual IoT accessible from the public Internet.
   IoT systems are designed to provide your database with access to devices on your local network.
   Exposing them to the public Internet would create a **security risk**.

.. _iot/windows-iot/installation:

Installation
============

To install the Windows virtual IoT on a Windows computer:

#. Access `Odoo's download page <https://odoo.com/download>`_, scroll down to the :guilabel:`Virtual
   IOT` section, and click :guilabel:`Download`.
#. Open the downloaded :file:`.exe` file, allow the app to make changes to your device, select
   a language, and click :guilabel:`OK`.
#. Click :guilabel:`Next`, then :guilabel:`I Agree` to accept the terms and conditions and continue.
#. Verify you have the required space on your computer and click :guilabel:`Next`.
#. In the :guilabel:`Destination folder`, enter C:\\odoo and click :guilabel:`Install`.

   .. warning::
      Do not install Odoo's Windows virtual IoT in any Windows user directory, as this can cause
      issues with :ref:`HTTPS certificate generation <iot/connect/https_certificate>`.

#. Set up GPL Ghostscript: Click :guilabel:`Next`, agree to the terms and conditions, click
   :guilabel:`Install`, then :guilabel:`Finish`.
#. Click :guilabel:`Next` and :guilabel:`Finish` to complete the setup. The
   :ref:`IoT system's homepage <iot/windows-iot/homepage>` automatically opens in a web browser with
   the URL `http://localhost:8069`.
#. :ref:`Restart <iot/windows_iot/restart>` the Windows virtual IoT service.
#. Check that you can access the :ref:`IoT system's homepage <iot/windows-iot/homepage>` in a web
   browser:

   - on the Windows virtual IoT computer, and
   - on another device **on the same network as the IoT system** by navigating to the URL
     `http://xxx:8069` (where `xxx` is the IoT system's IP address).
   - on another device **on the same network as the IoT system** by navigating to the URL
     `https://xxx` (where `xxx` is the IoT system's IP address) to test for :ref:`HTTPS
     <iot/connect/https_certificate>` connection.

     .. tip::
        If you cannot access the :ref:`IoT system's homepage <iot/windows-iot/homepage>` from
        another device, create a :ref:`Windows Firewall <iot/windows-iot/firewall>` rule to allow
        communication through port `8069`.

Device connection
=================

Most :doc:`devices <devices>` automatically connect to the Windows computer used for the Windows
Virtual IoT through `Windows Plug and Play (PnP)
<https://learn.microsoft.com/en-us/windows-hardware/drivers/kernel/introduction-to-plug-and-play>`_.
However, if Windows does not recognize the device automatically upon connection, the administrator
may need to manually install the appropriate drivers.

.. tip::
   After connecting the devices to the computer, refresh the :ref:`IoT system's homepage
   <iot/windows-iot/homepage>` to verify that the device is listed. If the device does not appear,
   :ref:`reload the handlers <iot_updating_iot/handlers>` from the :ref:`IoT system's homepage
   <iot/windows-iot/homepage>`.

.. _iot/windows-iot/firewall:

Windows Firewall configuration
==============================

Firewalls help keep devices secure but can sometimes block legitimate connections. If the Windows
virtual IoT isn't accessible on the :abbr:`LAN (Local Area Network)`, for example, from another
device, it could be due to a firewall blocking the connection. To prevent this issue, configure
exceptions for network discovery in the :abbr:`OS (Operating System)` or firewall settings.

.. note::
   If third-party firewall software is installed on the Windows computer, refer to the software's
   documentation to configure firewall exceptions.

To create a rule on Windows Defender and allow communication through the required ports, follow
these steps:

#. Search the Windows start menu for `firewall` and select the :guilabel:`Windows Defender Firewall
   with Advanced Security` app.
#. In the left part of the window, select :guilabel:`Inbound Rules`.
#. In the right part of the window, under :guilabel:`Actions`, click :guilabel:`New Rule`.
#. In the :guilabel:`New Inbound Rule Wizard` that opens, select the :guilabel:`Port` type of rule
   and click :guilabel:`Next`.
#. On the :guilabel:`Protocols and Ports` page, make sure :guilabel:`TCP` and :guilabel:`Specified
   local ports` are selected, enter the following in the field: `8069, 80, 443`, and click
   :guilabel:`Next`.

   .. note::
      Other ports may be required depending on your IoT devices. For example, add port `9050` for
      the :doc:`/applications/sales/point_of_sale/payment_methods/terminals/worldline` payment
      terminal and port `9000` for the
      :doc:`/applications/sales/point_of_sale/payment_methods/terminals/ingenico` payment terminal.

#. On the :guilabel:`Action` page, select :guilabel:`Allow the connection` and click
   :guilabel:`Next`.
#. On the :guilabel:`Profile` page, disable any connection type(s) that don't apply to your
   Windows computer and click :guilabel:`Next`.
#. On the :guilabel:`Name` page, provide a :guilabel:`Name` (e.g., `Odoo`) and, optionally, a brief
   :guilabel:`Description`, then click :guilabel:`Finish`.

.. seealso::
   `Windows Firewall rules documentation
   <https://learn.microsoft.com/en-us/windows/security/operating-system-security/network-security/windows-firewall/rules>`_

.. _iot/windows-iot/homepage:

Windows virtual IoT homepage
============================

To access the Windows virtual IoT's homepage, navigate to the URL `http://localhost:8069` on the
Windows virtual IoT computer or open a web browser from another computer **on the same network as
the IoT system** and navigate to the URL `http://xxx:8069` (where `xxx` is the IoT system's IP
address).

Once the Windows virtual IoT is :doc:`connected to the Odoo database <connect>`, its homepage can
be accessed from Odoo by opening the IoT app, clicking the relevant IoT box's card, and
clicking :guilabel:`Homepage`.

.. image:: windows_iot/iot-windows-homepage.png
   :scale: 75%
   :alt: Windows virtual IoT's homepage

.. note::
   Make sure the :ref:`Windows Firewall is configured <iot/windows-iot/firewall>` to allow access.

.. _iot/windows_iot/restart:

Windows virtual IoT restart
===========================

To manually restart the Windows IoT server, search the Windows start menu for `services` and
select the Services app. Scroll down to the :guilabel:`odoo-server-xxx` service, right-click it, and
select :guilabel:`Start` or :guilabel:`Restart`.

.. _iot/windows_iot/uninstall:

Windows virtual IoT uninstall
=============================

To uninstall the Windows virtual IoT, `uninstall
<https://support.microsoft.com/en-us/windows/uninstall-or-remove-apps-and-programs-in-windows-4b55f974-2cc6-2d2b-d092-5905080eaf98#ID0EBD=Windows_11>`_
the Odoo program on your Windows computer. Confirm the uninstallation and complete the steps in the
:guilabel:`Odoo Uninstall` dialog.
