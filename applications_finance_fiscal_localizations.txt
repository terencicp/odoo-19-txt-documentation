

==================================================
SECTION: argentina.rst
PATH: applications/finance/fiscal_localizations/argentina.rst
==================================================

=========
Argentina
=========

Webinars
========

Below you can find videos with a general description of the localization, and how to configure it.

- `Webinar - Localización de Argentina <https://youtu.be/S5xlANeXja0>`_.
- `eCommerce - Localización de Argentina <https://www.youtube.com/watch?v=5gUi2WWfRuI>`_.

.. seealso::
   - `Smart Tutorial - Localización de Argentina
     <https://www.odoo.com/slides/smart-tutorial-localizacion-de-argentina-130>`_
   - :doc:`Documentation on e-invoicing's legality and compliance in Argentina
     <../accounting/customer_invoices/electronic_invoicing/argentina>`

Configuration
=============

Modules installation
--------------------

:ref:`Install <general/install>` the following modules to get all the features of the Argentinean
localization:

.. list-table::
   :header-rows: 1
   :widths: 25 25 50

   * - Name
     - Technical name
     - Description
   * - :guilabel:`Argentina - Accounting`
     - `l10n_ar`
     - Default :ref:`fiscal localization package <fiscal_localizations/packages>`, which represents
       the minimal configuration to operate in Argentina under the :abbr:`AFIP (Administración
       Federal de Ingresos Públicos)` regulations and guidelines.
   * - :guilabel:`Argentinean Accounting Reports`
     - `l10n_ar_reports`
     - VAT Book report and VAT summary report.
   * - :guilabel:`Argentinean Electronic Invoicing`
     - `l10n_ar_edi`
     - Includes all technical and functional requirements to generate electronic invoices via web
       service, based on the AFIP regulations.
   * - :ref:`Argentinean eCommerce <argentina/ecommerce-electronic-invoicing>`
     - `l10n_ar_website_sale`
     - (optional) Allows the user to see Identification Type and AFIP Responsibility in the
       eCommerce checkout form in order to create electronic invoices.
   * - :ref:`Argentina - Payment Withholdings <l10n_ar/payment-withholdings>`
     - `l10n_ar_withholding`
     - Allows registering withholdings during the payment of an invoice.

.. _argentina/configure-your-company:

Configure your company
----------------------

Once the localization modules are installed, the first step is to set up the company's data. In
addition to the basic information, a key field to fill in is the :guilabel:`AFIP Responsibility
Type`, which represents the fiscal obligation and structure of the company.

.. image:: argentina/select-responsibility-type.png
   :align: center
   :alt: Select AFIP Responsibility Type.

Chart of account
----------------

In Accounting, there are three different :guilabel:`Chart of Accounts` packages to choose from.
They are based on a company's AFIP responsibility type, and consider the difference between
companies that do not require as many accounts as the companies that have more complex fiscal
requirements:

- Monotributista (227 accounts);
- IVA Exento (290 accounts);
- Responsable Inscripto (298 Accounts).

.. image:: argentina/select-fiscal-package.png
   :align: center
   :alt: Select Fiscal Localization Package.

Configure master data
---------------------

Electronic Invoice Credentials
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Environment
***********

The AFIP infrastructure is replicated in two separate environments, **testing** and **production**.

Testing is provided so that the companies can test their databases until they are ready to move
into the **Production** environment. As these two environments are completely isolated from each
other, the digital certificates of one instance are not valid in the other one.

To select a database environment, go to :menuselection:`Accounting --> Settings --> Argentinean
Localization` and choose either :guilabel:`Prueba (Testing)` or :guilabel:`Produccion (Production)`.

.. image:: argentina/select-environment.png
   :align: center
   :alt: Select AFIP database environment: Testing or Production.

AFIP certificates
*****************

The electronic invoice and other AFIP services work with :guilabel:`Web Services (WS)` provided by
the AFIP.

In order to enable communication with the AFIP, the first step is to request a :guilabel:`Digital
Certificate` if you do not have one already.

#. :guilabel:`Generate Certificate Sign Request (Odoo)`. When this option is selected, a file with
   extension `.csr` (certificate signing request) is generated to be used in the AFIP portal to
   request the certificate.

   .. image:: argentina/request-certificate.png
      :alt: Request a certificate.

#. :guilabel:`Generate Certificate (AFIP)`. Access the AFIP portal and follow the instructions
   described in `this document <https://drive.google.com/file/d/17OKX2lNWd1bjUt3NxfqcCKBkBh-Xlpo-/
   view>`_ to get a certificate.

#. :guilabel:`Upload Certificate and Private Key (Odoo)`. Once the certificate is generated, upload
   it to Odoo using the :guilabel:`Pencil` icon next to the field :guilabel:`Certificado` and select
   the corresponding file.

   .. image:: argentina/upload-certificate-private-key.png
      :alt: Upload Certificate and Private Key.

.. tip::
   In case you need to configure the Homologation Certificate, please refer to the AFIP official
   documentation: `Homologation Certificate
   <http://www.afip.gob.ar/ws/documentacion/certificados.asp>`_. Furthermore, Odoo allows the user
   to test electronic invoicing locally without a Homologation Certificate. The following message
   will be in the chatter when testing locally:

   .. image:: argentina/local-testing.png
      :align: center
      :alt: Invoice validated locally because it is in a testing environment without testing
            certificate/keys.

Partner
~~~~~~~

Identification type and VAT
***************************

As part of the Argentinean localization, document types defined by the AFIP are now available in the
**Partner form**. Information is essential for most transactions. There are six
:guilabel:`Identification Types` available by default, as well as 32 inactive types.

.. image:: argentina/identification-types.png
   :align: center
   :alt: A list of AR Localization document types in Odoo, as defined by AFIP.

.. note::
   The complete list of :guilabel:`Identification Types` defined by the AFIP is included in Odoo,
   but only the common ones are active.

AFIP responsibility type
************************

In Argentina, the document type and corresponding transactions associated with customers and
vendors is defined by the AFIP Responsibility type. This field should be defined in the **Partner
form**.

.. image:: argentina/select-afip-responsibility-type.png
   :align: center
   :alt: Select AFIP Responsibility Type.

Taxes
~~~~~

As part of the localization module, the taxes are created automatically with their related
financial account and configuration, e.g., 73 taxes for :guilabel:`Responsable Inscripto`.

.. image:: argentina/automatic-tax-configuration.png
   :align: center
   :alt: A list of AR Localization taxes with financial amount and configuration in Odoo.

Taxes types
***********

Argentina has several tax types, the most common ones are:

- :guilabel:`VAT`: this is the regular VAT and can have various percentages;
- :guilabel:`Perception`: advance payment of a tax that is applied on invoices;
- :guilabel:`Retention`: advance payment of a tax that is applied on payments.

Special taxes
*************

Some Argentinean taxes are not commonly used for all companies, and those less common options are
labeled as inactive in Odoo by default. Before creating a new tax, be sure to check if that tax is
not already included as inactive.

.. image:: argentina/special-inactive-taxes.png
   :align: center
   :alt: A list showing less common Argentinean tax options, which are labeled as inactive in Odoo
         by default.

.. _document-types:

Document types
~~~~~~~~~~~~~~

In some Latin American countries, like Argentina, some accounting transactions such as invoices and
vendor bills are classified by document types defined by the governmental fiscal authorities. In
Argentina, the `AFIP <https://www.afip.gob.ar/>`__ is the governmental fiscal authority that
defines such transactions.

The document type is an essential piece of information that needs to be clearly displayed in
printed reports, invoices, and journal entries that list account moves.

Each document type can have a unique sequence per journal where it is assigned. As part of the
localization, the document type includes the country in which the document is applicable (this data
is created automatically when the localization module is installed).

The information required for the :guilabel:`Document Types` is included by default so the user does
not need to fill anything on this view:

.. image:: argentina/default-document-type-info.png
   :align: center
   :alt: A list of document types in Odoo.

.. note::
   There are several :guilabel:`Document Types` types that are inactive by default, but can be
   activated as needed.

Letters
*******

For Argentina, the :guilabel:`Document Types` include a letter that helps indicate the type of
transaction or operation. For example, when an invoice is related to a(n):

- :guilabel:`B2B transaction`, a document type :guilabel:`A` must be used;
- :guilabel:`B2C transaction`, a document type :guilabel:`B` must be used;
- :guilabel:`Exportation Transaction`, a document type :guilabel:`E` must be used.

The documents included in the localization already have the proper letter associated with each
:guilabel:`Document Type`, so there is no further configuration necessary.

.. image:: argentina/document-types-grouped-by-letters.png
   :align: center
   :alt: document types grouped by letters.

Use on invoices
***************

The :guilabel:`Document Type` on each transaction will be determined by:

- The journal entry related to the invoice (if the journal uses documents);
- The onditions applied based on the type of issuer and receiver (e.g., the type of fiscal regime of
  the buyer and the type of fiscal regime of the vendor).

Journals
--------

In the Argentinean localization, the journal can have a different approach depending on its usage
and internal type. To configure journals, go to :menuselection:`Accounting --> Configuration -->
Journals`.

For sales and purchase journals, it's possible to activate the option :guilabel:`Use Documents`,
which enables a list of :guilabel:`Document Types` that can be related to the invoices and vendor
bills. For more detail on invoices, please refer to the section :ref:`2.3 document types
<document-types>`.

If the sales or purchase journals do not have the :guilabel:`Use Documents` option activated, they
will not be able to generate fiscal invoices, meaning, their use case will be mostly limited to
monitoring account moves related to internal control processes.

AFIP information (also known as AFIP Point of Sale)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The :guilabel:`AFIP POS System` is a field only visible for the **Sales** journals and defines the
type of AFIP POS that will be used to manage the transactions for which the journal is created.

The AFIP POS defines the following:

#. the sequences of document types related to the web service;
#. the structure and data of the electronic invoice file.

.. image:: argentina/sales-journal.png
   :align: center
   :alt: A AFIP POS System field which is available on Sales journals in Odoo.

Web services
************

**Web services** help generate invoices for different purposes. Below are a few options to choose
from:

- :guilabel:`wsfev1: Electronic Invoice`: is the most common service, which is used to generate
  invoices for document types A, B, C, M  with no detail per item;
- :guilabel:`wsbfev1: Electronic Fiscal Bond`: is for those who invoice capital goods and wish to
  access the benefit of the Electronic Tax Bonds granted by the Ministry of Economy. For more
  details go to: `Fiscal Bond
  <https://www.argentina.gob.ar/acceder-un-bono-por-fabricar-bienes-de-capital>`__;
- :guilabel:`wsfexv1: Electronic Exportation Invoice`: is used to generate invoices for
  international customers and transactions that involve exportation processes, the document type
  related is type "E".

.. image:: argentina/web-services.png
   :align: center
   :alt: Web Services.

Here are some useful fields to know when working with web services:

- :guilabel:`AFIP POS Number`: is the number configured in the AFIP to identify the operations
  related to this AFIP POS;
- :guilabel:`AFIP POS Address`: is the field related to the commercial address registered for the
  POS, which is usually the same address as the company. For example, if a company has multiple
  stores (fiscal locations) then the AFIP will require the company to have one AFIP POS per
  location. This location will be printed in the invoice report;
- :guilabel:`Unified Book`: when the AFIP POS System is Preimpresa, then the document types
  (applicable to the journal) with the same letter will share the same sequence. For example:

  - Invoice: FA-A 0001-00000002;
  - Credit Note: NC-A 0001-00000003;
  - Debit Note: ND-A 0001-00000004.

Sequences
~~~~~~~~~

For the first invoice, Odoo synchronizes with the AFIP automatically and displays the last sequence
used.

.. note::
   When creating :guilabel:`Purchase Journals`, it's possible to define whether they are related to
   document types or not. In the case where the option to use documents is selected, there would be
   no need to manually associate the document type sequences, since the document number is provided
   by the vendor.

Usage and testing
=================

Invoice
-------

The information below applies to invoice creation once the partners and journals are created and
properly configured.

Document type assignation
~~~~~~~~~~~~~~~~~~~~~~~~~

When the partner is selected, the :guilabel:`Document Type` field will be filled in automatically
based on the AFIP document type:

- **Invoice for a customer IVA Responsable Inscripto, prefix A** is the type of document that shows
  all the taxes in detail along with the customer's information.

  .. image:: argentina/prefix-a-invoice-for-customer.png
     :alt: Invoice for a customer IVA Responsable Inscripto, prefix A.

- **Invoice for an end customer, prefix B** is the type of document that does not detail the taxes,
  since the taxes are included in the total amount.

  .. image:: argentina/prefix-b-invoice-for-end-customer.png
     :alt: Invoice for an end customer, prefix B.

- **Exportation Invoice, prefix E** is the type of document used when exporting goods that shows
  the incoterm.

  .. image:: argentina/prefix-e-exporation-invoice.png
     :alt: Exportation Invoice, prefix E

Even though some invoices use the same journal, the prefix and sequence are given by the
:guilabel:`Document Type` field.

The most common :guilabel:`Document Type` will be defined automatically for the different
combinations of AFIP responsibility type but it can be updated manually by the user before
confirming the invoice.

Electronic invoice elements
~~~~~~~~~~~~~~~~~~~~~~~~~~~

When using electronic invoices, if all the information is correct then the invoice is posted in the
standard way unless there is an error that needs to be addressed. When error messages pop up, they
indicate both the issue that needs attention along with a proposed solution. If an error persists,
the invoice remains in draft until the issue is resolved.

Once the invoice is posted, the information related to the AFIP validation and status is displayed
in the AFIP tab, including:

- :guilabel:`AFIP Autorisation`: CAE number;
- :guilabel:`Expiration Date`: deadline to deliver the invoice to the customers (normally 10 days
  after the CAE is generated);
- :guilabel:`Result:` indicates if the invoice has been :guilabel:`Aceptado en AFIP` and/or
  :guilabel:`Aceptado con Observaciones`.

.. image:: argentina/afip-status.png
   :align: center
   :alt: AFIP Status.

Invoice taxes
~~~~~~~~~~~~~

Based on the :guilabel:`AFIP Responsibility type`, the VAT tax can apply differently on the PDF
report:

- :guilabel:`A. Tax excluded`: in this case the taxed amount needs to be clearly identified in the
  report. This condition applies when the customer has the following AFIP Responsibility type of
  **Responsable Inscripto**;

  .. image:: argentina/tax-amount-excluded.png
     :alt: Tax excluded.

- :guilabel:`B. Tax amount included`: this means that the taxed amount is included as part of the
  product price, subtotal, and totals. This condition applies when the customer has the following
  AFIP Responsibility types:

  - IVA Sujeto Exento;
  - Consumidor Final;
  - Responsable Monotributo;
  - IVA liberado.

  .. image:: argentina/tax-amount-included.png
     :align: center
     :alt: Tax amount included.

Special use cases
~~~~~~~~~~~~~~~~~

Invoices for services
*********************

For electronic invoices that include :guilabel:`Services`, the AFIP requires to report the service
starting and ending date, this information can be filled in the tab :guilabel:`Other Info`.

.. image:: argentina/invoices-for-services.png
   :align: center
   :alt: Invoices for Services.

If the dates are not selected manually before the invoice is validated, the values will be filled
automatically with the first and last day of the invoice's month.

.. image:: argentina/service-dates.png
   :align: center
   :alt: Service Dates.

Exportation invoices
********************

Invoices related to :guilabel:`Exportation Transactions` require that a journal uses the AFIP POS
System **Expo Voucher - Web Service** so that the proper document type(s) can be associated.

.. image:: argentina/exporation-journal.png
   :align: center
   :alt: Exporation journal.

When the customer selected in the invoice is configured with an AFIP responsibility type
:guilabel:`Cliente / Proveedor del Exterior` - :guilabel:`Ley N° 19.640`, Odoo automatically
assigns the:

- Journal related to the exportation Web Service;
- Exportation document type;
- Fiscal position: Compras/Ventas al exterior;
- Concepto AFIP: Products / Definitive export of goods;
- Exempt Taxes.

.. image:: argentina/export-invoice.png
   :align: center
   :alt: Export invoice fields autofilled in Odoo.

.. note::
   The Exportation Documents require Incoterms to be enabled and configured, which can be found in
   :menuselection:`Other Info --> Accounting`.

.. image:: argentina/export-invoice-incoterm.png
   :align: center
   :alt: Export invoice - Incoterm.

Fiscal bond
***********

The :guilabel:`Electronic Fiscal Bond` is used for those who invoice capital goods and wish to
access the benefit of the Electronic Tax Bonds granted by the Ministry of Economy.

For these transactions, it is important to consider the following requirements:

- Currency (according to the parameter table) and invoice quotation;
- Taxes;
- Zone;
- Detail each item;

  - Code according to the Common Nomenclator of Mercosur (NCM);
  - Complete description;
  - Unit Net Price;
  - Quantity;
  - Unit of measurement;
  - Bonus;
  - VAT rate.

Electronic credit invoice MiPyme (FCE)
**************************************

For SME invoices, there are several document types that are classified as **MiPyME**, which are
also known as **Electronic Credit Invoice** (or **FCE** in Spanish). This classification develops a
mechanism that improves the financing conditions for small and medium-sized businesses, and allows
them to increase their productivity, through the early collection of credits and receivables issued
to their clients and/or vendors.

For these transactions it's important to consider the following requirements:

- specific document types (201, 202, 206, etc);
- the emitter should be eligible by the AFIP to MiPyME transactions;
- the amount should be bigger than 100,000 ARS;
- A bank account type CBU must be related to the emisor, otherwise the invoice cannot be validated,
  having an error message such as the following.

.. image:: argentina/bank-account-relation-error.png
   :align: center
   :alt: Bank account relation error.

To set up the :guilabel:`Transmission Mode`, go to settings and select either :guilabel:`SDC` or
:guilabel:`ADC`.

.. image:: argentina/transmission-mode.png
   :align: center
   :alt: Transmission Mode.

To change the :guilabel:`Transmission Mode` for a specific invoice, go to the :guilabel:`Other Info`
tab and change it before confirming.

.. note::
   Changing the :guilabel:`Transmission Mode` will not change the mode selected in
   :guilabel:`Settings`.

.. image:: argentina/transmission-mode-on-invoice.png
   :align: center
   :alt: Transmission Mode on Invoice.

When creating a :guilabel:`Credit/Debit` note related to a FCE document:

- use the :guilabel:`Credit and Debit Note` buttons, so all the information from the invoice is
  transferred to the new :guilabel:`Credit and Debit Note`;
- the document letter should be the same as than the originator document (either A or B);
- the same currency as the source document must be used. When using a secondary currency there is
  an exchange difference if the currency rate is different between the emission day and the payment
  date. It is possible to create a credit/debit note to decrease/increase the amount to pay in ARS.

.. image:: argentina/credit-debit-notes-button.png
   :align: center
   :alt: Credit & debit notes buttons.

When creating a :guilabel:`Credit Note` we can have two scenarios:

#. the FCE is rejected so the :guilabel:`Credit Note` should have the field :guilabel:`FCE, is
   Cancellation?` as *True*; or;
#. the :guilabel:`Credit Note`, is created to annulate the FCE document, in this case the field
   :guilabel:`FCE, is Cancellation?` must be *empty* (false).

.. image:: argentina/fce-es-cancelation.png
   :align: center
   :alt: FCE: Es Cancelación?

.. _argentina/invoice-printed-report:

Invoice printed report
~~~~~~~~~~~~~~~~~~~~~~

The :guilabel:`PDF Report` related to electronic invoices that have been validated by the AFIP
includes a barcode at the bottom of the format which represents the CAE number. The expiration date
is also displayed as it is a legal requirement.

.. image:: argentina/invoice-printed-report.png
   :align: center
   :alt: Invoice printed report.

Troubleshooting and auditing
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

For auditing and troubleshooting purposes, it is possible to obtain detailed information of an
invoice number that has been previously sent to the AFIP. To retrieve this information, activate the
:ref:`developer mode <developer-mode>`, then go to the :menuselection:`Accounting` menu and click on
the button :guilabel:`Consult Invoice` button in AFIP.

.. image:: argentina/consult-invoice-in-afip.png
   :align: center
   :alt: Consult invoice in AFIP.

.. image:: argentina/consult-invoice-in-afip-details.png
   :align: center
   :alt: Details of invoice consulted in AFIP.

It is also possible to retrieve the last number used in AFIP for a specific document type and POS
Number as a reference for any possible issues on the sequence synchronization between Odoo and
AFIP.

.. image:: argentina/consult-last-invoice-number.png
   :align: center
   :alt: Consult the last invoice number.

Vendor bills
------------

Based on the purchase journal selected for the vendor bill, the :guilabel:`Document Type` is now a
required field. This value is auto-populated based on the AFIP Responsibility type of Issuer and
Customer, but the value can be changed if necessary.

.. image:: argentina/changing-journal-document-type.png
   :align: center
   :alt: Changing journal and document type.

The :guilabel:`Document Number` field needs to be registered manually and the format will be
validated automatically. However, in case the format is invalid, a user error will be displayed
indicating the correct format that is expected.

.. image:: argentina/vendor-bill-document-number.png
   :align: center
   :alt: Vendor bill document number.

The vendor bill number is structured in the same way as the customer invoices, excepted that the
document sequence is entered by the user using the following format: *Document Prefix - Letter -
Document Number*.

Validate vendor bill number in AFIP
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

As most companies have internal controls to verify that the vendor bill is related to an AFIP valid
document, an automatic validation can be set in :menuselection:`Accounting --> Settings -->
Argentinean Localization --> Validate document in the AFIP`, considering the following levels:

- :guilabel:`Not available:` the verification is not done (this is the default value);
- :guilabel:`Available:` the verification is done. In case the number is not valid, it only displays
  a warning but still allows the vendor bill to be posted;
- :guilabel:`Required:` the verification is done, and it does not allow the user to post the vendor
  bill if the document number is not valid.

.. image:: argentina/verify-vendor-bills.png
   :align: center
   :alt: Verify Vendor Bills validity in AFIP.

Validate vendor bills in Odoo
*****************************

With the vendor validation settings enabled, a new button shows up on the vendor bills inside of
Odoo, labeled :guilabel:`Verify on AFIP`, which is located next to the :guilabel:`AFIP
Authorization code` field.

.. image:: argentina/verify-on-afip.png
   :align: center
   :alt: Verify on AFIP.

In case the vendor bill cannot be validated in AFIP, a value of :guilabel:`Rejected` will be
displayed on the dashboard and the details of the invalidation will be added to the chatter.

.. image:: argentina/afip-auth-rejected.png
   :align: center
   :alt: AFIP authorization Rejected.

Special use cases
~~~~~~~~~~~~~~~~~

Untaxed concepts
****************

There are some transactions that include items that are not a part of the VAT base amount, such as
fuel and gasoline invoices.

The vendor bill will be registered using one item for each product that is part of the VAT base
amount, and an additional item to register the amount of the exempt concept.

.. image:: argentina/vat-exempt.png
   :align: center
   :alt: VAT exempt.

Perception taxes
****************

The vendor bill will be registered using one item for each product that is part of the VAT base
amount, and the perception tax can be added in any of the product lines. As a result, there will be
one tax group for the VAT and another for the perception. The perception default value is always
:guilabel:`0.10`.

To edit the VAT perception and set the correct amount, you should use the :guilabel:`Pencil` icon
that is the next to the :guilabel:`Perception` amount. After the VAT perception amount has been set,
the invoice can then be validated.

.. image:: argentina/enter-perception-amount.png
   :align: center
   :alt: Enter the perception amount.

.. _l10n_ar/payment-withholdings:

Withholding management
----------------------

The Argentinean fiscal localization module is already loaded with the necessary withholdings
records, which can be seen by navigating to :menuselection:`Accounting app --> Configuration -->
Taxes` and removing the default :guilabel:`Sale or Purchase` filter. To verify these records, the
**Argentina Payment Withholdings** (`l10n_ar_withholding`) module must be :ref:`installed
<general/install>`:

Journal entries are *not* created when payments are posted unless :ref:`outstanding accounts
<accounting/journals/outstanding-accounts>` are set up. Thus, for this feature to work properly, it
is important to verify that *all* payment methods within the bank journals have an outstanding
payment and receipt account set.

.. image:: argentina/l10n-ar-outstanding-payments.png
   :alt: An outstanding payment account must be set.

This configuration is crucial for the proper accounting of withholding transactions with clients
and vendors.

.. note::
   In Argentina, withholdings represent the cancellation of a specific portion of the total debt
   owed to a supplier or a reduction in the total payment to be collected from a customer.
   Therefore, one or multiple withholdings can be recorded for each payment applied to an invoice.

Configuration
~~~~~~~~~~~~~

While Odoo already creates most of the required withholdings inside the :guilabel:`Taxes`
menu, in several cases, it is necessary to apply or modify certain configurations to correctly
calculate the withholding amount on vendor payments. The following withholding types are available:

- :ref:`Earnings <l10n_ar/earnings-withholdings>`
- :ref:`Earnings Scale <l10n_ar/earnings-scale-withholdings>`
- :ref:`IIBB Total Amount <l10n_ar/iib-total-amount-withholdings>`
- :ref:`IIBB Non-Taxable <l10n_ar/iib-nontax-withholdings>`

.. _l10n_ar/earnings-withholdings:

Earnings
********

For :guilabel:`Earnings` withholdings, Odoo already has a record for each regime group, which is
stated under the name of the tax and the AFIP code.

Each of these records are ready to be used. As a good practice, the configuration should be double
checked to make sure the configuration is updated and well-applied. The fields to validate are:

- :guilabel:`Amount`: This is the percentage of the total payment amount which is withheld.
- :guilabel:`Non-Taxable Amount`: Up to this amount, the withholding does not apply.
- :guilabel:`Minimum Withholding`: If the calculated withholding amount is smaller than this value,
  the total withholding amount is set to `0.0`.
- :guilabel:`Withholding Sequence`: This field helps to automate the capture of a withholding number
  under the payment line. If this field is not set, a number is manually captured while adding a
  withholding to a payment.

.. image:: argentina/l10n-ar-earnings.png
   :alt: Earnings withholding type.

.. _l10n_ar/earnings-scale-withholdings:

Earnings Scale
**************

In this particular case, a percentage does not need to be set. Instead, this withholding is
calculated based on the value of the :guilabel:`Scale` field.

To view, modify, or create new scales, navigate to :menuselection:`Accounting app --> Configuration
--> Earnings Scale`. By default, the Argentinian localization is preconfigured with two main scales.
However, scales should be created and updated as necessary to suit a business's needs.

.. note::
   Earnings scales are cumulative, which means that Odoo keeps track of the different records
   created for a bill and automatically calculates the proper withholding amount.

.. _l10n_ar/iib-total-amount-withholdings:

IIBB Total Amount
*****************

In this case, the necessary records related to the applicable province need to be created. The
withholding amount is calculated based on the percentage :guilabel:`Amount` set on the tax
configuration. Since Odoo does not automatically synchronize the percentages applicable to each
province, this information needs to be manually updated.

The recommendation, in this case, is to always duplicate and apply the different configurations for
each record to safeguard any technical configurations that allow the proper calculation and
accounting of the withholding.

.. _l10n_ar/iib-nontax-withholdings:

IIBB Untaxed
************

The configuration of non-taxable gross income withholdings is very similar to that of a :ref:`total
amount withholding <l10n_ar/iib-total-amount-withholdings>`, so the percentage :guilabel:`Amount` in
each of the records needs to be maintained. However, Odoo comes preconfigured with several records
that apply to different provinces. The difference, in this case, is that it is not necessary to
establish a non-taxable amount or minimum withholding for this record type.

Partner withholding assignation
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Once the proper configuration is set on each possible withholding for partners, the applicable
withholdings need to be assigned to each contact. To do this, open the :guilabel:`Contacts` app and
select the desired partner. In the :guilabel:`Accounting` tab, find the :guilabel:`Purchase
Withholdings` table.

By using the additional fields :guilabel:`From Date` and :guilabel:`To Date`, the applicability of
multiple withholdings can be automated across different date ranges. The :guilabel:`ref` field
allows you to apply an internal control number to each withholding line, which is just for internal
reference, so it does not affect any transactions and is not visible on them. These fields are
accessible from the :icon:`oi-settings-adjust` :guilabel:`(adjust settings)` menu.

- :guilabel:`From Date`: the start of the withholding date range.
- :guilabel:`To Date`: the end of the withholding date range.
- :guilabel:`ref`: apply an internal control number to each withholding line that is only visible
  for internal reference and does not affect any transactions.

Automatic withholding calculation and application per payment
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

By applying new payments to vendor bills, Odoo automatically applies and calculates the proper
withholding into the payment. Based on the record's configuration, it may be necessary to use a
reference number for each withholding line.

More withholdings can be added, or computed withholdings can be edited if necessary.

.. image:: argentina/l10n-ar-payment.png
   :alt: Payment with applied withholdings.

.. important::
   The total amount of the debt to be canceled is the total amount of the payment. However, Odoo
   still captures the net amount (i.e. the amount to be reconciled with the bank), which will be
   represented as the payment amount after the withholding application.

   .. image:: argentina/l10n-ar-payment-registered.png
      :alt: Payment registered form.

Check management
----------------

To install the *Third Party and Deferred/Electronic Checks Management* module, go to
:menuselection:`Apps` and search for the module by its technical name `l10n_latam_check` and click
the :guilabel:`Activate` button.

.. image:: argentina/l10n-latam-check-module.png
   :align: center
   :alt: l10n_latam_check module.

This module enables the required configuration for journals and payments to:

- Create, manage, and control your different types of checks
- Optimize the management of *own checks* and *third party checks*
- Have an easy and effective way to manage expiration dates from your own and third party checks

Once all the configurations are made for the Argentinian electronic invoice flow, it is also needed
to complete certain configurations for the own checks and the third party checks flows.

Own checks
~~~~~~~~~~

Configure the bank journal used to create your own checks by going to :menuselection:`Accounting -->
Configuration --> Journals`, selecting the bank journal, and opening the :guilabel:`Outgoing
Payments` tab.

- :guilabel:`Checks` should be available as a :guilabel:`Payment Method`. If not, click
  :guilabel:`Add a line` and type `Checks` under :guilabel:`Payment Method` to add them
- Enable the :guilabel:`Use electronic and deferred checks` setting.

.. note::
   This last configuration **disables** the printing ability but enables to:

   - Enter check numbers manually
   - Adds a field to allocate the payment date of the check

.. image:: argentina/bank-journal-conf.png
   :align: center
   :alt: Bank journal configurations.

Management of own checks
************************

Own checks can be created directly from the vendor bill. For this process, click on the
:guilabel:`Register Payment` button.

On the payment registration modal, select the bank journal from which the payment is to be made and
set the :guilabel:`Check Cash-In Date`, and the :guilabel:`Amount`.

.. image:: argentina/payment-popup-vendorbill.png
   :align: center
   :alt: Payment pop-up window with own check options enabled.

.. note::
   To manage current checks, the :guilabel:`Check Cash-In Date` field must be left blank or filled
   in with the current date. To manage deferred checks, the :guilabel:`Check Cash-In Date` must be
   set in the future.

To manage your existing own checks, navigate to :menuselection:`Accounting --> Vendors --> Own
Checks`. This window shows critical information such as the dates when checks need to be paid, the
total quantity of checks, and the total amount paid in checks.

.. image:: argentina/checks-menu-vendorbill.png
   :align: center
   :alt: Own checks menu location.

It is important to note that the list is pre-filtered by checks that are still *not reconciled* with
a bank statement - that were not yet debited from the bank - which can be verified with the
:guilabel:`Is Matched with a Bank Statement` field. If you want to see all of your own checks,
delete the :guilabel:`No Bank Matching` filter by clicking on the :guilabel:`X` symbol.

.. image:: argentina/check-menu-list-vendorbill.png
   :align: center
   :alt: Own checks menu organization and filtering.

Cancel an own check
*******************

To cancel an own check created in Odoo, navigate to :menuselection:`Accounting --> Vendors --> Own
Checks` and select the check to be cancelled, then click on the :guilabel:`Void Check` button. This
will break the reconciliation with the vendor bills and the bank statements and leave the check in a
**cancelled** state.

.. image:: argentina/empty-check-button.png
   :align: center
   :alt: Empty Check button to cancel Own Checks

Third party checks
~~~~~~~~~~~~~~~~~~

In order to register payments using third party checks, two specific journals need to be configured.
To do so, navigate to :menuselection:`Accounting --> Configuration --> Journals` and create two new
journals:

- `Third Party Checks`
- `Rejected Third Party Checks`

.. note::
   You can manually create more journals if you have multiple points of sale and need journals for
   those.

To create the *Third Party Checks* journal, click the :guilabel:`New` button and configure the
following:

- Type `Third Party Checks` as the :guilabel:`Journal Name`
- Select :guilabel:`Cash` as :guilabel:`Type`
- In the :guilabel:`Journal Entries` tab, set :guilabel:`Cash Account`: to `1.1.1.02.010 Cheques de
  Terceros`, input a :guilabel:`Short Code` of your choice, and select a :guilabel:`Currency`

.. image:: argentina/auto-cash-account.png
   :align: center
   :alt: Automatically created cash account.

The available payment methods are listed in the *payments* tabs:

- For new incoming third party checks, go to :menuselection:`Incoming Payments tab --> Add a line`
  and select :guilabel:`New Third Party Checks`. This method is used to create *new* third party
  checks.
- For incoming and outgoing existing third party checks, go to :menuselection:`Incoming Payments tab
  --> Add a line` and select :guilabel:`Existing Third Party Checks`. Repeat the same step for the
  :guilabel:`Outgoing Payments` tab. This method is used to receive and/or pay vendor bills using
  already *existing* checks, as well as for internal transfers.

.. tip::
   You can delete pre-existing payment methods appearing by default when configuring the third
   party checks journals.

.. image:: argentina/auto-payment-methods.png
   :align: center
   :alt: Payment methods automatically created.

The *Rejected Third Party Checks* journal also needs to be created and/or configured. This journal
is used to manage rejected third party checks and can be utilized to send checks rejected at the
moment of collection or when coming from vendors when rejected.

To create the *Rejected Third Party Checks* journal, click the :guilabel:`New` button and configure
the following:

- Type `Rejected Third Party Checks` as the :guilabel:`Journal Name`
- Select :guilabel:`Cash` as :guilabel:`Type`
- In the :guilabel:`Journal Entries` tab, set :guilabel:`Cash Account`: to `1.1.1.01.002 Rejected
  Third Party Checks`, input a :guilabel:`Short Code` of your choice, and select a
  :guilabel:`Currency`

Use the same payment methods as the *Third Party Checks* journal.

New third party checks
**********************

To register a *new* third party check for a customer invoice, click the :guilabel:`Register Payment`
button. In the pop-up window, you must select :guilabel:`Third Party Checks` as journal for the
payment registration.

Select :guilabel:`New Third Party Checks` as :guilabel:`Payment Method`, and fill in the
:guilabel:`Check Number`, :guilabel:`Payment Date`, and :guilabel:`Check Bank`. Optionally, you can
manually add the :guilabel:`Check Issuer Vat`, but this is automatically filled by the customer's
VAT number related to the invoice.

.. image:: argentina/third-party-payment-popup.png
   :align: center
   :alt: Payment pop-up window with New Third Party Check options enabled.

Existing third party checks
***************************

To pay a vendor bill with an *existing* check, click the :guilabel:`Register Payment` button. In the
pop-up window, you must select :guilabel:`Third Party Checks` as journal for the payment
registration.

Select :guilabel:`Existing Third Party Checks` as :guilabel:`Payment Method`, and select a check
from the :guilabel:`Check` field. The field shows all **available existing checks** to be used as
payment for vendor bills.

.. image:: argentina/existing-third-party-popup.png
   :align: center
   :alt: Payment pop-up window with Existing Third Party Check options enabled.

When an **existing third party check** is used, you can review the operations related to it. For
example, you can see if a third party check made to pay a customer invoice was later used as an
existing third party check to pay a vendor bill.

To do so, either go to :menuselection:`Accounting --> Customers --> Third Party Checks` or
:menuselection:`Accounting --> Vendors --> Own Checks` depending on the case, and click on a check.
In the :guilabel:`Check Current Journal` field, click on :guilabel:`=> Check Operations` to bring up
the check's history and movements.

.. image:: argentina/check-operations-menulist.png
   :align: center
   :alt: Check Operations menu.

The menu also displays critical information related to these operations, such as:

- The :guilabel:`Payment Type`, allowing to classify whether it is a payment *sent* to a vendor or a
  payment *received* from a customer
- The :guilabel:`Journal` in which the check is currently registered
- The **partner** associated with the operation (either customer or vendor).

.. _argentina/ecommerce-electronic-invoicing:

Ecommerce electronic invoicing
------------------------------


:ref:`Install <general/install>` the *Argentinian eCommerce* (`l10n_ar_website_sale`) module to
enable the following features and configurations:

- Clients being able to create online accounts for eCommerce purposes.
- Support for required fiscal fields in the eCommerce application.
- Receive payments for sale orders online.
- Generate electronic documents from the eCommerce application.

Configuration
~~~~~~~~~~~~~

Once all of the configurations are made for the Argentinian :ref:`electronic invoice
<argentina/configure-your-company>` flow, it is also necessary to complete certain configurations to
integrate the eCommerce flow.

Client account registration
***************************

To configure your website for client accounts, follow the instructions in the :doc:`checkout
<../../websites/ecommerce/checkout>` documentation.

Automatic invoice
*****************

Configure your website to generate electronic documents in the sales process by navigating to
:menuselection:`Website --> Configuration --> Settings` and activating the :guilabel:`Automatic
Invoice` feature in the :guilabel:`Invoicing` section to automatically generate the required
electronic documents when the online payment is confirmed.

.. image:: argentina/l10nar-automatic-invoicing-ecommerce.png
   :align: center
   :alt: Feature activated to invoice automatically.

Since an online payment needs to be confirmed for the :guilabel:`Automatic Invoice` feature to
generate the document, a :doc:`payment provider <../payment_providers>` **must** be configured for
the related website.

Products
********

To allow your products to be invoiced when an online payment is confirmed, navigate to the desired
product from :menuselection:`Website --> eCommerce --> Products`. In the :guilabel:`General
Information` tab, set the :guilabel:`Invoicing Policy` to :guilabel:`Ordered quantities` and define
the desired :guilabel:`Customer Taxes`.

Invoicing flow for eCommerce
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Once the configurations mentioned above are all set, clients can complete the following required
steps in the *Argentinian eCommerce* flow to input fiscal fields in the checkout process.

Fiscal fields are available for input in the checkout process once the :guilabel:`Country` field is
set as `Argentina`. Inputting the fiscal data enables the purchase to conclude in the corresponding
electronic document.

.. image:: argentina/l10nar-fiscal-fields-ar-ecommerce.png
   :align: center
   :alt: Fiscal required fields for electronic invoicing.

When the client makes a successful purchase and payment, the necessary invoice is generated with
the corresponding layout and fiscal stamps stated in the :ref:`Invoice printed report
<argentina/invoice-printed-report>`.

.. seealso::
   :doc:`Client account creation <../../websites/ecommerce/checkout>`

Liquidity product direct sales
------------------------------

Liquidity product direct sales are used for sales involving third parties. For such
sales, the seller and the proprietary company of the goods can each register their corresponding
sales and purchases.

.. note::
   :ref:`Install <general/install>` the *Argentinian Electronic Invoicing* module (`l10n_ar_edi`) to
   use this feature.

Configuration
~~~~~~~~~~~~~

Purchase journal
****************

A purchase journal is needed to generate an electronic vendor bill with a document type *Liquidity
Product*. This journal needs to be synchronized with the AFIP as it will be used to generate the
liquidity product electronic document.

To modify the existing purchase journal or create a new one, navigate to :menuselection:`Accounting
--> Configuration --> Journals`. Then, select the existing purchase journal or click the
:guilabel:`New` button, and fill in the following required information:

- :guilabel:`Type`: select :guilabel:`Purchase`.
- :guilabel:`Use Documents`: check this field to to be able select the electronic document type.
- :guilabel:`Is AFIP POS`: check this field to be able to generate electronic documents.
- :guilabel:`AFIP POS System`: select :guilabel:`Electronic Invoice - Web Service` from the
  drop-down menu in order to send the electronic document to AFIP via web service.
- :guilabel:`AFIP POS Number`: is the number configured in the AFIP to identify the operations
  related to this AFIP POS.
- :guilabel:`AFIP POS Address`: is the field related to the commercial address registered for the
  POS, which is usually the same address as the company. For example, if a company has multiple
  stores (fiscal locations) then the AFIP will require the company to have one AFIP POS per
  location. This location will be printed in the invoice report.

.. image:: argentina/l10n-ar-purchase-journal.png
   :align: center
   :alt: l10n_ar Purchase Journal Configuration.

Sales journal
*************

A sales journal is needed to register the invoice when a product is sold to a third party that will
then sell the same product. This journal will not be synced with AFIP as the invoice will not be
electronic.

To modify the existing sales journal or create a new one, navigate to
:menuselection:`Accounting --> Configuration --> Journals`. Then, selecting the sales journal or
click the :guilabel:`New` button, and fill in the following required information:

- :guilabel:`Type`: select :guilabel:`Sales`.
- :guilabel:`Use Documents`: check this field on the journal to select the electronic document type
  (in this case the electronic invoice).

.. image:: argentina/l10n-ar-sales-journal.png
   :align: center
   :alt: l10n_ar Sales Journal Configuration.

Invoicing flow
~~~~~~~~~~~~~~

Once the configurations are all set, the *Liquidity Product Vendor Bill* will be generated by the
company that is selling the product on behalf of another party. For example, a distributor of a
specific product.

Reports
=======

As part of the localization installation, financial reporting for Argentina is available in the
:guilabel:`Accounting` dashboard. To access these reports, navigate to :menuselection:`Accounting
--> Reporting --> Argentinean Statements`.

To access the VAT book report, go to :menuselection:`Accounting --> Reporting --> Tax Report`, click
the :icon:`fa-book` (:guilabel:`book`), and select :guilabel:`Argentinean VAT book (AR)`.

.. note::
   The VAT book report can be exported as a `.zip` file by selecting it in the dropdown menu in the
   top-left corner.

VAT summary
-----------

This pivot table is designed to check the monthly VAT totals. This report is for internal use and is
not sent to the AFIP.

IIBB - Sales by jurisdiction
----------------------------

This pivot table allows you to validate the gross income in each jurisdiction. It serves as an
affidavit for the corresponding taxes due but is not submitted to the AFIP.

.. image:: argentina/iibb-sales-jurisdiction.png
   :alt: IIBB Sales by jurisdiction.

IIBB - Purchases by jurisdiction
--------------------------------

This pivot table allows you to validate the gross purchases in each jurisdiction. It serves as an
affidavit for the corresponding taxes due but is not submitted to the AFIP.

.. image:: argentina/iibb-purchases-jurisdiction.png
   :alt: IIBB Purchases by jurisdiction.


==================================================
SECTION: australia.rst
PATH: applications/finance/fiscal_localizations/australia.rst
==================================================

=========
Australia
=========

Modules
=======

.. list-table::
   :widths: 25 25 50
   :header-rows: 1

   * - Name
     - Technical name
     - Description
   * - :guilabel:`Australia - Accounting`
     - `l10n_au`
     - The base :ref:`accounting <australia/accounting>` module for the Australian localization. It
       is installed automatically when the :guilabel:`Australia` :ref:`fiscal localization package
       <fiscal_localizations/packages>` is selected. This module also installs the :ref:`ABA Credit
       Transfer <australia/aba>` module.
   * - :guilabel:`Australian Reports - Accounting`
     - `l10n_au_reports`
     - Adds the :ref:`Taxable Payments Annual Report (TPAR) <australia/tpar>` and the :ref:`Business
       Activity Statement (BAS) <australia/bas>` report. It is installed automatically when the
       :guilabel:`Australia` :ref:`fiscal localization package <fiscal_localizations/packages>` is
       selected.
   * - :guilabel:`Australia - Payroll`
     - `l10n_au_hr_payroll`
     - The base :ref:`payroll <payroll/l10n_au/payroll>` module for the Australian localization.
   * - :guilabel:`Australia - Payroll with Accounting`
     - `l10n_au_hr_payroll_account`
     - Contains the necessary accounting data for the Australian payroll rules. It is installed
       automatically when the :ref:`Payroll Entries option <payroll-accounting>` is enabled.
   * - :guilabel:`Employment Hero Payroll`
     - `l10n_employment_hero`
     - Synchronizes all pay runs from :ref:`Employment Hero <payroll/l10n_au/employment-hero>`
       with Odoo's journal entries.

.. _australia/accounting:

Accounting
==========

Taxes and GST
-------------

In Australia, the standard **Goods and Services Tax (GST)** rate is 10%, but different rates and
exemptions exist for specific categories of goods and services.

.. image:: australia/default-taxes.png
   :alt: Default GST rates

.. note::
   The taxes impact the :ref:`BAS report <australia/bas>`.

Tax mapping
~~~~~~~~~~~

Within the Australian localization, tax names encompass the tax rate as an integral part of their
naming convention. Despite the high number of :doc:`taxes <../accounting/taxes>` configured in Odoo,
their rates are often similar (0% or 10%).

GST sales taxes
***************

The **GST sales** taxes available in Odoo are listed below.

.. list-table::
   :widths: 20 50 30
   :header-rows: 1

   * - GST name
     - Description
     - Label on invoices
   * - 10% GST
     - GST Sales
     - 10% GST
   * - 0% EX
     - GST Free on Export Sales
     - 0% GST Free
   * - 0% F
     - GST Free Sales
     - 0% Exempt
   * - 0% INP
     - Input Taxed Sales
     - 0% Input Taxed Sales
   * - 100% Adj
     - This is for adjustment, amounts can be modified to fit your needs
     - Tax Adjustments (Sales)

GST purchase taxes
******************

The **GST purchase** taxes available in Odoo are listed below.

.. list-table::
   :widths: 20 50 30
   :header-rows: 1

   * - GST name
     - Description
     - Label on invoices
   * - 10% GST
     - GST Purchases
     - 10% GST
   * - 10% C
     - Capital Purchases
     - 10% Capital Purchases
   * - 10% INP
     - Purchases for Input Taxed Sales
     - 10% Purchases for Input Taxed Sales
   * - 10% PRIV
     - Purchases for private use or not deductible
     - 10% Purchases for Private Use
   * - 0% F
     - GST Free Purchases
     - 0% GST Free
   * - 0% TPS
     - Purchase (Taxable Imports) - Tax Paid Separately
     - 0% GST Paid Separately
   * - 100% ONLY
     - GST Only on Imports
     - GST Only on Imports
   * - 100% Adj
     - Tax Adjustments (Purchases)
     - Tax Adjustments (Purchases)
   * - 100% DGST
     - Deferred GST Liability
     - 100% DGST
   * - No ABN
     - Tax Withheld for Partners without ABN
     - Withholding Tax for No ABN
   * - PAYGW - W3
     - Other amounts withheld (excluding any amount shown at W2 or W4)
     - Other Amounts Withheld (W3)

Variants
^^^^^^^^

Businesses from certain industries need to report payments made to subcontractors from relevant
services during the financial year. Odoo combines the use of taxes and fiscal positions to report
these payments on the :ref:`TPAR <australia/tpar>`. In order to be compliant with the TPAR's
obligations, two variants of the main purchase taxes are available in Odoo, but they are inactive by
default.

.. example::

   For the *10% GST* tax, the variants are:

   .. list-table::
      :widths: 20 40 20 20
      :header-rows: 1

      * - Tax name
        - Description
        - Reports impacted
        - Default status
      * - 10% GST
        - Default 10% GST tax
        - BAS
        - Active
      * - 10% GST TPAR
        - TPAR variant of the tax, if the contractor provided an ABN
        - | BAS
          | TPAR
        - Inactive
      * - 10% GST TPAR NO ABN
        - TPAR variant of the tax, if the contractor did not provide an ABN
        - | BAS
          | TPAR
        - Inactive

Deferred GST
~~~~~~~~~~~~

Odoo allows companies under the `Deferred Goods and Services Tax (DGST) scheme <https://www.ato.gov.au/businesses-and-organisations/gst-excise-and-indirect-taxes/gst/in-detail/rules-for-specific-transactions/international-transactions/deferred-gst?=redirected_deferredGSTscheme>`_
to automate their deferred GST flows.

Configuration
*************

It is recommended to:

- go to :menuselection:`Accounting --> Configuration --> Settings` and set the :guilabel:`Tax Return
  Periodicity` to :guilabel:`monthly` (= monthly BAS); and
- create a new journal to store all deferred GST entries by going to :menuselection:`Accounting
  --> Configuration --> Journals --> New`, and selecting :guilabel:`Miscellaneous` as its
  :guilabel:`Type` when configuring it.

By default, a tax (*100% DGST*, inactive by default) and an account (*21340 Deferred GST Liability*)
are available for Australian companies. Activate the tax by going to :menuselection:`Accounting -->
Configuration --> Taxes`. Search for the :guilabel:`Name` `100% DGST` (remove the default filter if
necessary), and click the :guilabel:`Activate` toggle switch.

Flow
****

1. Importing goods: purchase order and vendor bill
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

When importing goods from abroad, the GST liability can now be deferred for companies under the DGST
scheme. On the purchase order, select the :guilabel:`0% TPS` tax (tax paid separately) for the
relevant order lines.

.. image:: australia/dgst-po-tax.png
   :alt: Setting the 0% TPS tax on a purchase order

2. Recording the DGST balance on the BAS report
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

When the Australian Taxation Office (ATO) is advised electronically of the aggregated liability for
the company by the Integrated Cargo System (ICS), the GST balance deferred during the previous month
becomes available on the ATO's BAS portal.

.. important::
   Odoo does not yet fetch the DGST balance automatically from the ATO. A manual entry with the
   liability amount needs to be created in Odoo. We recommend using a new journal for this purpose
   since deferrals will be recurring.

Go to :menuselection:`Accounting --> Journal Entries --> New`. On the first journal item line, add
the :guilabel:`Account` `21340 Deferred GST Liability` and the deferred GST balance as a
:guilabel:`Credit`. To resume the example shown above, we credit $2,000 and save.

.. image:: australia/dgst-balance-credit.png
   :alt: Creating a journal entry with the DGST account

An auto-balancing line is created, along with journal items correctly assigning the right values in
the BAS :guilabel:`Tax Grids`. Sections *G11*, *G18*, *7A*, and *ONLY* are updated correctly.

.. image:: australia/dgst-tax-grids.png
   :alt: The journal entry with the auto-balancing line and BAS tax grids

After posting the journal entry, the BAS report displays the correct values for each section, along
with the DGST offset.

Reports
-------

.. _australia/bas:

Business Activity Statement (BAS)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The **BAS report** is a critical tax reporting requirement for businesses registered for GST in
Australia. The BAS is used to report and remit various taxes to the ATO. With the Odoo BAS feature,
businesses can report on the following:

- GST
- PAYG tax withheld
- DGST

Access the report from the Accounting dashboard by clicking :guilabel:`BAS Report (AU)` under the
:guilabel:`Miscellaneous Operations` section.

.. image:: australia/bas-report.png
   :alt: BAS report example

The base and tax amounts are collected from the **tax grid**, which is pre-configured in the system.
The tax grid can also be manually set up for any additional special use-case of GST (e.g., wine
equalization tax). Once the tax for each account is set up, the system automatically slots journal
items into the correct tax category. This ensures the BAS report is accurate and reflective of the
business's financial activities.

.. image:: australia/gst-grids.png
   :alt: GST grids example

Besides the GST sections, the BAS report also includes the **PAYG** tax withheld components (*W1* to
*W5*, then *summary, section 4*). This integration ensures that all payroll-related withholding
taxes are accurately captured and reflected within the report.

.. image:: australia/payg.png
   :alt: PAYG tax withheld and summary of BAS report example

The module incorporates built-in rules that facilitate the automatic calculation of taxes for types
W1 to W5. For a detailed walkthrough and more information on the calculation process for these
taxes, refer to the :ref:`Payroll section <payroll/l10n_au/payroll>`.

Closing
*******

When it is time to file the tax return with the ATO, click :guilabel:`Closing Entry`. The tax return
period can be configured under :menuselection:`Accounting --> Configuration --> Settings --> Tax
Return Periodicity`. The start date of the tax return period can also be defined on the report
itself through the period button (:icon:`fa-calendar` *period* *year*).

.. seealso::
   :doc:`Year-end closing <../accounting/reporting/year_end>`

.. note::
   Odoo uses calendar quarters rather than the Australian FY quarters, which means *July to
   September* is *Q3* in Odoo.

Before closing the entry for the first time, the default **GST payable account** and **GST
receivable account** need to be set. A notification pops up and redirects the user to the tax groups
configuration.

.. image:: australia/bas-accounts.png
   :alt: BAS report tax groups

Once the GST payable and GST receivable accounts are set up, the BAS report generates an accurate
journal closing entry automatically, which balances out the GST balance with the GST clearing
account.

The balance between GST receivable and payable is set against the tax clearing account defined on
the tax group. The amount to be paid to or received from the ATO can be reconciled against a bank
statement.

.. image:: australia/bas-taxes.png
   :alt: BAS report tax payment

.. important::
   The BAS report is not directly submitted to the ATO. Odoo helps you automatically compute the
   necessary values in each section, with the possibility to audit them to better understand the
   history behind these numbers. Businesses can copy these values and enter them on the `ATO portal
   <https://www.ato.gov.au/businesses-and-organisations/preparing-lodging-and-paying/business-activity-statements-bas/how-to-lodge-your-bas>`_.

.. _australia/tpar:

Taxable Payments Annual Report (TPAR)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Odoo allows businesses to report payments made to contractors or subcontractors during the financial
year. This is done by generating a **TPAR**. If you are unsure your business needs this report,
refer to the `ATO's TPAR web page <https://www.ato.gov.au/businesses-and-organisations/preparing-lodging-and-paying/reports-and-returns/taxable-payments-annual-report>`_.

Access the TPAR in Odoo by going to :menuselection:`Accounting --> Reporting --> Taxable Payments
Annual Reports (TPAR)`.

Configuration
*************

First, it is required to assign fiscal positions to your contractors before billing them to update
the TPAR. To do so, go to :menuselection:`Accounting --> Vendors --> Vendors`, select a contractor,
and set a :guilabel:`Fiscal Position` under the :guilabel:`Sales & Purchase` tab.

.. image:: australia/tpar-fiscal-positions.png
   :alt: TPAR fiscal position on a vendor

Based on the chosen fiscal position, the correct tax mapping will apply to the contractor's vendor
bills.

.. image:: australia/tpar-vendor-bill-tax.png
   :alt: TPAR vendor bill tax mapping

The TPAR includes the following information from contractors:

- :guilabel:`ABN`
- :guilabel:`Total GST` (the total tax paid)
- :guilabel:`Gross Paid` (the amounts are displayed after a vendor bill has been marked as paid)
- :guilabel:`Tax Withheld` (displayed if the contractor is registered with a fiscal position set to
  :guilabel:`TPAR without ABN`)

The TPAR can be exported to multiple formats: PDF, XLSX, and TPAR.

.. _australia/remittance:

Remittance advice
-----------------

A remittance advice is a document used as proof of payment to a business. In Odoo, it can be
accessed by going to :menuselection:`Accounting --> Vendors --> Payments`, selecting the payment(s),
and clicking :menuselection:`Print --> Payment Receipt`.

.. image:: australia/remittance.png
   :alt: Remittance advice example

.. _australia/peppol:

E-invoicing
-----------

Peppol
~~~~~~

Odoo is compliant with Australia's `Peppol requirements
<https://peppol.org/learn-more/country-profiles/australia/>`_. Set up your customers and vendors
by going to :menuselection:`Accounting --> Customers --> Customers` or :menuselection:`Vendors -->
Vendors`, selecting one, clicking the :guilabel:`Accounting` tab, and configuring the
:guilabel:`Electronic Invoicing` section as needed.

.. image:: australia/partner-einvoicing.png
   :alt: Electronic invoicing settings for a partner

.. important::
   Validating an invoice or credit note for a partner on the Peppol network will download a
   compliant XML file that can be manually uploaded to your Peppol network. Odoo is currently in the
   process of becoming an access point for the ANZ region.

.. _australia/aba:

ABA files for batch payments
----------------------------

An ABA file is a digital format developed by the `Australian Banking Association
<https://www.ausbanking.org.au/>`_. It is designed for business customers to facilitate bulk payment
processing by uploading a single file from their business management software.

The main advantage of using ABA files is to improve payment and matching efficiency. This is
achieved by consolidating numerous payments into one file for batch processing, which can be
submitted to all Australian banks.

Configuration
~~~~~~~~~~~~~

Batch payments
**************

Go to :menuselection:`Accounting --> Configuration --> Settings` and enable :guilabel:`Batch
Payments`.

Bank journal
************

Go to :menuselection:`Accounting --> Configuration --> Journals` and select the :guilabel:`Bank`
journal. Enter the :guilabel:`Account Number`, click :guilabel:`Create and edit...`, and fill in the
following fields:

- :guilabel:`Bank`
- :guilabel:`BSB`
- :guilabel:`Account Holder`

Then, toggle on the :guilabel:`Send Money` switch and click :guilabel:`Save & Close`.

.. note::
   Using the :guilabel:`Currency` field is optional.

Back on the :guilabel:`Journal Entries` tab, fill in the following fields under the :guilabel:`ABA`
section:

- :guilabel:`BSB`: the BSB code from the bank account is used to fill in this field.
- :guilabel:`Financial Institution Code`: the official 3-letter abbreviation of the bank (e.g.,
  `WBC` for Westpac)
- :guilabel:`Supplying User Name`: 6-digit number provided by the bank. Contact your bank or check
  its website if you do not know it.
- :guilabel:`APCA Identification Number`: 6-digit number provided by the bank. Contact your bank or
  check its website if you do not know it.
- :guilabel:`Include Self Balancing Transaction`: selecting this option adds an additional
   "self-balancing" transaction to the end of the ABA file, which is required by some banks.

Customers' and vendors' bank accounts
*************************************

Go to :menuselection:`Accounting --> Customers --> Customers` or :menuselection:`Accounting -->
Vendors --> Vendors` and select a customer or vendor. Open the :guilabel:`Accounting` tab, and,
under the :guilabel:`Bank Accounts` section, click :guilabel:`Add a line` to fill in their:

- :guilabel:`Account Number`
- :guilabel:`Bank`
- :guilabel:`BSB`
- :guilabel:`Account Holder`

Then, toggle on the :guilabel:`Send Money` switch and click :guilabel:`Save & Close`.

Generating an ABA file
~~~~~~~~~~~~~~~~~~~~~~

To generate an ABA file, create a vendor bill, confirm it, and ensure the vendor's banking
information is set up correctly.

Next, click :guilabel:`Pay` on the vendor bill, and select, for the following fields:

- :guilabel:`Journal`: :guilabel:`Bank`
- :guilabel:`Payment Method`: :guilabel:`ABA Credit Transfer`
- :guilabel:`Recipient Bank Account`: the vendor's account number

Once payments are created, go to :menuselection:`Accounting --> Vendors --> Payments`, select the
payments to be included in the batch, and click :guilabel:`Create Batch`. Verify all information is
correct and click :guilabel:`Validate`. Once validated, the ABA file is available in the **chatter**
on the right.

After uploading the file to your bank's portal, an ABA transaction line will appear in your bank
feed at the following bank feed iteration. You will need to reconcile it against the **batch
payment** made in Odoo.

Industry-specific features
==========================

Starshipit shipping
-------------------

Starshipit is a shipping service operator that facilitates the integration of Australasian shipping
couriers with Odoo. Refer to the :doc:`Starshipit documentation
<../../inventory_and_mrp/inventory/shipping_receiving/setup_configuration/starshipit_shipping>` for
detailed information.

.. seealso::
   `Starshipit Odoo webinar recording <https://www.youtube.com/watch?v=TcDWnoYLXWg>`_

.. _australia/buynow_paylater:

Buy Now, Pay Later solutions
----------------------------

*Buy Now, Pay Later* solutions are popular payment methods for eShops in Australia. Some of these
solutions are available via `Stripe <https://stripe.com/en-au/payments/payment-methods>`_ and
`AsiaPay <https://www.asiapay.com.au/payment.html#option>`_.

.. seealso::
   - :doc:`Stripe payment provider <../payment_providers/stripe>`
   - :doc:`AsiaPay payment provider <../payment_providers/asiapay>`

POS terminals
-------------

To establish a direct connection between Odoo and a POS terminal in Australia, a **Stripe** payment
terminal is required. Odoo supports the **EFTPOS** payment solution in Australia.

.. note::
   A Stripe payment terminal is not required to use Odoo as the main POS system. However, without
   one, cashiers must manually enter the final payment amount on the terminal.

.. seealso::
   - :doc:`Stripe payment provider <../payment_providers/stripe>`
   - :doc:`Stripe payment terminal <../../sales/point_of_sale/payment_methods/terminals/stripe>`
   - `Stripe.com terminal documentation <https://stripe.com/docs/terminal>`_


==================================================
SECTION: austria.rst
PATH: applications/finance/fiscal_localizations/austria.rst
==================================================

=======
Austria
=======

.. _localizations/austria/configuration:

Configuration
=============

:ref:`Install <general/install>` the following modules to get all the features of the Austrian
localization.

.. list-table::
   :header-rows: 1

   * - Name
     - Technical name
     - Description
   * - :guilabel:`Austria - Accounting`
     - `l10n_at`
     - Default :ref:`fiscal localization package <fiscal_localizations/packages>`.
   * - :guilabel:`Austria - Accounting Reports`
     - `l10n_at_reports`
     - Adds localized versions of financial reports
   * - :guilabel:`Austrian SAF-T Export`
     - `l10n_at_saft`
     - Adds the SAF-T export.
   * - :guilabel:`Austria - Security Regulation for Point of Sale`
     - `l10n_at_pos`
     - Adds RKSV compliance for POS.

.. seealso::
   :doc:`Documentation on e-invoicing’s legality and compliance in Austria
   <../accounting/customer_invoices/electronic_invoicing/austria>`

.. _localizations/austria/financial-reports:

Financial reports
=================

The following localized reports are available:

  - Balance sheet according to `§ 224 UGB <https://www.ris.bka.gv.at/NormDokument.wxe?Abfrage=Bundesnormen&Gesetzesnummer=10001702&Artikel=&Paragraf=224&Anlage=&Uebergangsrecht=>`_
  - Profit and loss according to `§ 231 UGB <https://www.ris.bka.gv.at/NormDokument.wxe?Abfrage=Bundesnormen&Gesetzesnummer=10001702&Artikel=&Paragraf=231&Anlage=&Uebergangsrecht=>`_ (Gesamtkostenverfahren)

.. seealso::
   :doc:`Accounting reporting documentation <../accounting/reporting>`

.. _localizations/austria/saf-t:

SAF-T (Standard Audit File for Tax)
===================================

The Austrian tax office may request a SAF-T. The Austrian SAF-T Export module allows exporting the
report in XML format.

.. _localizations/austria/saf-t-configuration:

Configuration
-------------

This section explains how to configure the database to ensure all the information required by the
SAF-T is available. If anything is missing, a warning message listing which information is needed
will be displayed during the export.

.. _localizations/austria/saf-t-company:

Company information
~~~~~~~~~~~~~~~~~~~

Open the database :guilabel:`Settings`. Under the :guilabel:`Companies` section, click
:guilabel:`Update Info` and ensure the following fields are correctly filled in:

- :guilabel:`Address`, by providing at least the following information:

  - :guilabel:`Street`
  - :guilabel:`City`
  - :guilabel:`ZIP`
  - :guilabel:`Country`

- :guilabel:`Phone`
- :guilabel:`Company ID` by providing your company's tax ID
- :guilabel:`Tax ID` by providing, if you have one, your :abbr:`UID-Nummer
  (Umsatzsteueridentifikationsnummer)` (including the country prefix)

.. _localizations/austria/saf-t-contact:

Contact person
**************

At least one **contact person** must be linked to your company in the :guilabel:`Contacts` app, and:

  - Ensure the contact type is set to :guilabel:`Individual`.
  - Select your company in the :guilabel:`Company name` field.
  - Provide at least one phone number using the :guilabel:`Phone` or :guilabel:`Mobile` field.

.. _localizations/austria/saf-t-customer-supplier-information:

Customer and supplier information
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Using the :guilabel:`Contacts` app, fill in the :guilabel:`Address` of any partner that appears in
your invoices, vendor bills, or payments.

For partners that are companies, fill in the VAT number (including the country prefix) in the
:guilabel:`Tax ID` field.

.. _localizations/austria/saf-t-accounting:

Accounting settings
~~~~~~~~~~~~~~~~~~~

Go to :menuselection:`Accounting --> Configuration --> Settings`. Under the :guilabel:`Austrian
localization` section, fill in the following fields:

- :guilabel:`ÖNACE-Code`
- :guilabel:`Profit Assessment Method`

.. seealso::
   `ÖNACE information on the Austrian Economic Chambers website
   <https://www.wko.at/service/zahlen-daten-fakten/oenace.html>`_

.. _localizations/austria/saf-t-chart-of-account:

Chart of accounts mapping
~~~~~~~~~~~~~~~~~~~~~~~~~

The Austrian SAF-T specifications define a chart of accounts (COA). All relevant accounts for the
SAF-T export must be annotated with a fitting account from this COA.

The needed mapping information is supplied by adding tags to the accounts. For example, adding the
`1000` tag to an account maps it (virtually) to the SAF-T COA account with the code `1000`. Any
number can be used as long as there is an account in the SAF-T COA with that code.

The :guilabel:`Austria - Accounting` module adds a tag for each SAF-T COA account. Furthermore, it
automatically maps many accounts from the default Austrian COA.

You can try exporting the SAF-T report to check if there are unmapped accounts (or mapped to
multiple SAF-T accounts). A warning will be displayed if there is any issue with your configuration
or the mapping. Clicking :guilabel:`View Problematic Accounts` lets you view them.

.. seealso::
   :doc:`Chart of accounts documentation <../accounting/get_started/chart_of_accounts>`

.. _localizations/austria/saf-t-exporting:

Exporting the SAF-T report
--------------------------

To export the SAF-T report, go to :menuselection:`Accounting --> Reports --> General Ledger`. Click
the right side of the :guilabel:`PDF` button and select :guilabel:`SAF-T`.

.. image:: austria/austria-saft-button.png
   :alt: The SAF-T button to export the file in XML format

.. _localizations/austria/pos:

Point of Sale
=============

.. _localizations/austria/pos-rksv:

RKSV (Registrierkassensicherheitsverordnung)
--------------------------------------------

The :abbr:`RKSV (Registrierkassensicherheitsverordnung)` is an Austrian regulation designed
to secure cash registers and prevent tax fraud. It requires businesses to use tamper-proof
electronic cash register systems, including :doc:`point of sale </applications/sales/point_of_sale>`
systems.

These systems must be equipped with a **Signature Creation Unit (SCU)**, which is
responsible for signing each transaction. This ensures that the transaction data cannot be altered.
Additionally, the regulation mandates periodic transaction data exports for audit purposes. Odoo
provides a compliant solution through `fiskaly <https://fiskaly.com>`_, a *cloud-based solution*.

.. _localizations/austria/pos-rksv-configuration:

Configuration
~~~~~~~~~~~~~

:ref:`Install <general/install>` the **Austria - Security Regulation for Point of Sale**
(`l10n_at_pos`) module.

.. tip::
   If this module is not listed, :ref:`update the app list <general/install>`.

.. _localizations/austria/pos-rksv-company:

Company information
*******************

Open the Settings app, navigate to the :guilabel:`Companies` section, and click
:icon:`oi-arrow-right` :guilabel:`Update Info` to make sure the :ref:`information
<localizations/austria/saf-t-company>` is up-to-date and correctly filled in.

To link your company to Fiskaly and use it in Odoo, open the :guilabel:`Fiskaly` tab and enable
:guilabel:`Managed by Odoo` :icon:`fa-toggle-on`, which activates automatic integration management.

If a Fiskaly account already exists with its own credentials, disable the toggle and configure the
existing :guilabel:`Fiskaly credentials` manually.

.. note::
   For testing, ensure that :guilabel:`Test Fiskaly` :icon:`fa-toggle-on` is enabled to run the
   integration without impacting the production server. Since test mode is enabled by default,
   disable :guilabel:`Test Fiskaly` :icon:`fa-toggle-off` to switch to production mode.

  .. image:: austria/management-toggle.png
    :alt: Management toggle

.. important::
   Once the credentials have been authenticated, the Fiskaly management option (by Odoo or custom)
   and the mode (test or production) can no longer be modified.

Click :guilabel:`Generate Credentials` to create a new organization in the Fiskaly system and
generate the necessary credentials to run the service. Next, click :guilabel:`Authenticate Keys`
to validate those credentials.

.. _localizations/austria/pos-fiskaly-finanzonline:

Link a Fiskaly organization to FinanzOnline
*******************************************

To link the Fiskaly organization with the Austrian Ministry of Finance, FinanzOnline credentials
must be provided. To do so, fill in the following information in your company's :guilabel:`Fiskaly`
tab:

- :guilabel:`Participant Identifier`
- :guilabel:`User Identifier`
- :guilabel:`User Pin`

.. note::
   FinanzOnline credentials can be accessed through an existing account or by `creating a new one
   <https://finanzonline.bmf.gv.at/>`_ if it has not yet been set up.

.. tip::
   Random credentials can be used in **test mode**, but valid credentials are required in
   **production mode**.

Click :guilabel:`Authenticate FON` to link your Fiskaly organization to the Austrian Ministry of
Finance and start regular :doc:`point of sale </applications/sales/point_of_sale>` operations.

.. _localizations/austria/pos-digitally-sign-receipts:

Digitally signatured receipts
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

To ensure the integrity and authenticity of the receipts, the system automatically signs them using
the :abbr:`SCU (Signature Creation Unit)` in a background process. The receipt then displays an
encrypted signature as a QR code containing the receipt number and information about the SCU used to
sign it.

.. note::
   - If the :abbr:`SCU (Signature Creation Unit)` is unavailable, receipts may not include a QR
     code; in such cases:

     - Make sure the receipt includes a :guilabel:`Sicherheitseinrichtung ausgefallen` message,
       indicating that the system is linked to Fiskaly services, but the SCU is temporarily
       unavailable.
     - If this message is missing from the receipt, it indicates no connection to Fiskaly services.

   - Orders that remain unsigned due to SCU unavailability can be signed manually. To do so, follow
     these steps:

     #. Go to :menuselection:`Point of Sale --> Orders --> Orders`.
     #. To identify unsigned orders, click the :icon:`oi-settings-adjust` :guilabel:`(adjust
        settings)` icon in the :guilabel:`Orders` list view to reveal the :guilabel:`Receipt
        Signed?` column.
     #. Select the unsigned orders, click :icon:`fa-cog` :guilabel:`Actions`, and select
        :guilabel:`Sign Order`.

.. _localizations/austria/pos-dep7:

DEP7 export
~~~~~~~~~~~

The exported :abbr:`DEP7 (Digitale Schnittstelle der Finanzverwaltung für Kassensysteme)` file
allows authorities to verify transactions and ensure compliance with anti-fraud measures. Businesses
must periodically generate it for audit purposes and submit it to the Austrian tax authorities upon
request.

To generate it, go to :menuselection:`Point of Sale --> Reporting --> DEP7 Reports`, and, in the
:guilabel:`DEP7 Reports`, fill in the following mandatory fields:

- :guilabel:`Start Datetime`: Exports data with dates on or after the start date.
- :guilabel:`End Datetime`: Exports data with dates on or before the end date.
- :guilabel:`Point of Sale`: Specify from which point of sale(s) data must be exported.

Then, click :guilabel:`Print` to download the PDF file with DEP7 data.

.. image:: austria/dep7-reports.png
   :alt: DEP7 Reports

.. _localizations/austria/pos-montly-yearly-receipts:

Monthly / Yearly closing receipts
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

To print monthly/yearly closing receipts, :ref:`start a session <pos/session-start>` from the **POS
dashboard** and click :guilabel:`Open Register` on the related point of sale. Click the
:icon:`oi-view-list` :guilabel:`(list view)` icon in the top-right corner and select
:guilabel:`Montly/Yearly Receipts`.

The last month is selected by default in the :guilabel:`Print closing receipts` window. To change
it,  select :guilabel:`Monthly` or :guilabel:`Yearly`, then click the :icon:`fa-calendar-o`
:guilabel:`(calendar)` icon to select the desired month/year.


==================================================
SECTION: belgium.rst
PATH: applications/finance/fiscal_localizations/belgium.rst
==================================================

=======
Belgium
=======

.. _belgium/configuration:

Configuration
=============

Install the :guilabel:`🇧🇪 Belgium` :ref:`fiscal localization package
<fiscal_localizations/packages>` to get all the default accounting features of the Belgian
localization, following the :abbr:`IFRS(International Financial Reporting Standards)` rules.

.. seealso::
   :doc:`Documentation on e-invoicing’s legality and compliance in Belgium
   <../accounting/customer_invoices/electronic_invoicing/belgium>`

.. _belgium/coa:

Chart of accounts
=================

You can reach the :guilabel:`Chart of accounts` by going to :menuselection:`Accounting -->
Configuration --> Accounting: Chart of Accounts`.

The Belgian chart of accounts includes pre-configured accounts as described in the :abbr:`PCMN(Plan
Comptable Minimum Normalisé)`. To add a new account, click :guilabel:`New`. A new line appears. Fill
it in, click :guilabel:`Save`, and then :guilabel:`Setup` to configure it further.

.. seealso::
   :doc:`../accounting/get_started/chart_of_accounts`

.. _belgium/taxes:

Taxes
=====

Default Belgian taxes are created automatically when the :guilabel:`Belgium - Accounting` and
the :guilabel:`Belgium - Accounting Reports` modules are installed. Each tax impacts the Belgian
:guilabel:`Tax Report`, available by going to :menuselection:`Accounting --> Reporting -->
Statements Reports: Tax Report`.

In Belgium, the standard VAT rate is **21%**, but there are lower rates for some categories of goods
and services. An intermediate rate of **12%** is applied on social housing and food served in
restaurants, while a reduced rate of **6%** applies to most basic goods, such as food, water supply,
books, and medicine. A **0%** rate applies to some exceptional goods and services, such as some
daily and weekly publications, as well as recycled goods.

.. _belgium/non-deductible:

Non-deductible taxes
--------------------

In Belgium, some taxes are not fully deductible, such as taxes on the maintenance of cars. This
means a part of these taxes is considered as an expense.

In Odoo, you can configure non-deductible taxes by creating tax rules for these taxes and linking
them to the corresponding accounts. This way, the system automatically calculates the taxes and
allocates them to the appropriate accounts.

To configure a new non-deductible tax, go to :menuselection:`Accounting --> Configuration -->
Accounting: Taxes`, and click :guilabel:`New`:

#. :guilabel:`Add a line` and select :guilabel:`Base` in the :guilabel:`Based On` column;
#. :guilabel:`Add a line`, then select :guilabel:`on tax` in the :guilabel:`Based on` column and
   enter the **non-deductible** percentage in the :guilabel:`%` column;
#. On the :guilabel:`of tax` line, select the :guilabel:`Tax Grid(s)` related to your tax;
#. :guilabel:`Add a line` with the **deductible** percentage in the :guilabel:`%` column;
#. Set :guilabel:`of tax` in :guilabel:`Based On`;
#. Select :guilabel:`411000 VAT recoverable` as account, and select the related tax grid.

Once you have created a non-deductible tax, you can apply it to your transactions by selecting the
appropriate tax during the encoding of bills and credit notes. The system automatically calculates
the tax amount and allocates it to the corresponding accounts based on the tax rules configured.

.. example::
   With the Belgian localization, the **21% car** tax is created by default (50% non-deductible).

   .. image:: belgium/deductible-tax.png
      :alt: Example of not-fully deductible tax

.. seealso::
  - :doc:`Taxes <../accounting/taxes>`
  - :doc:`../accounting/reporting/tax_returns`

.. _belgium/reports:

Reports
=======

Here is the list of Belgian-specific reports available:

- Balance sheet;
- Profit & loss;
- Tax report;
- Partner VAT Listing;
- EC Sales List;
- Intrastat.

You can access Belgian-specific versions of reports by clicking on the **book** icon when on a
report and selecting its Belgian version: **(BE)**.

.. image:: belgium/belgian-reports.png
   :alt: Belgian version of reports

.. seealso::
   :doc:`../accounting/reporting`

.. _belgium/disallowed-expenses:

Disallowed expenses report
--------------------------

**Disallowed expenses** are expenses that can be deducted from your accounting result but not from
your fiscal result.

The **disallowed expenses report** is available by going to :menuselection:`Accounting --> Reporting
--> Management: Disallowed Expenses`. It allows financial results in real-time, and periodic
changes. This report is generated based on the **disallowed expenses categories** that you can reach
by going to :menuselection:`Accounting --> Configuration --> Management: Disallowed Expenses
Categories`. Some categories already exist by default but do not have any rates. Click on
:guilabel:`Set Rates` to update a specific category.

.. tip::
  - You can add multiple rates for various dates. In that case, the rate used to calculate the
    expense depends on the date at which it is calculated, and the rate set for that date.
  - If you have the **Fleet** app installed, tick the :guilabel:`Car Category` box when applicable.
    This makes the vehicle mandatory while booking a vendor bill.

To link a disallowed expenses category with a specific account, go to :menuselection:`Accounting -->
Configuration --> Accounting: Chart of Accounts`. Find the account you want, and click on
:guilabel:`Setup`. Add the :guilabel:`Disallowed Expense category` in the :guilabel:`Disallowed
Expenses` field. From now, when an expense is created with this account, the disallowed expense is
calculated based on the rate mentioned in the :guilabel:`Disallowed Expense category`.

Let's take an example reflecting **restaurant** and **car expenses**.

.. _belgium/restaurant-expenses:

Restaurant expenses
~~~~~~~~~~~~~~~~~~~

In Belgium, 69% of **restaurant** expenses are deductible. Create a new **disallowed expenses
category** and set both :guilabel:`Related Account(s)` and :guilabel:`Current Rate`.

.. _belgium/vehicle-split:

Car expenses: vehicle split
~~~~~~~~~~~~~~~~~~~~~~~~~~~

In Belgium, the deductible percentage varies from car to car and, therefore, should be indicated for
each vehicle. To do so, open :menuselection:`Fleet` and select a vehicle. In the :guilabel:`Tax
info` tab, go to the :guilabel:`Deductibility Rates` section and click on :guilabel:`Add a
line`. Add a :guilabel:`Start Date` and a :guilabel:`%`. The amounts go in the same account for all
car expenses.

When you create a bill for car expenses, you can link each expense to a specific car by filling the
:guilabel:`Vehicle` column, so the right percentage is applied.

.. image:: belgium/car-bill.png
   :alt: Disallowed expenses categories

The :guilabel:`vehicle split` option available in the disallowed expenses report allows you to see
the rate and disallowed amount for each car.

.. image:: belgium/vehicle-split.png
   :alt: Disallowed expenses categories

.. _belgium/forms:

Fee form 281.50 and form 325
============================

.. _belgium/281.50:

Fee form 281.50
---------------

Annually, a **281.50 fee form** must be reported to the fiscal authorities. To do so, the tag
`281.50` must be added on the **contact form** of the entities concerned by the **281.50** fee. To
add the tag, open :menuselection:`Contacts`, select the person or company you want to create a
**281.50 fee form** for, and add the `281.50` tag in the :guilabel:`Tags` field.

.. image:: belgium/281-50.png
   :alt: add the tag 281.50 on a contact form

.. note::
   Make sure the **street, zip code, country**, and **VAT number** are also informed on the
   **Contact form**.

Then, depending on the nature of the expense, add the corresponding `281.50` tag on the impact
accounts. To do so, go to :menuselection:`Accounting --> Configuration --> Accounting: Chart of
Accounts`, and click on :guilabel:`Setup` to add the corresponding `281.50` tag on the impacted
accounts, i.e., :guilabel:`281.50 - Commissions`, depending on the nature of the expense.

.. _belgium/325:

Form 325
--------

You can create a **325 form** by going to :menuselection:`Accounting --> Reporting --> Belgium:
Create 325 form`. A new page pops up: select the right options and click :guilabel:`Generate 325
form`. To open an already generated **325 form**, go to :menuselection:`Accounting --> Reporting -->
Belgium: Open 325 forms`.

.. image:: belgium/325-form.png
   :alt: Add the tag 281-50 on a contact form

.. _belgium/coda-soda:

CODA and SODA statements
========================

.. _belgium/coda:

CODA
----

**CODA** is an electronic XML format used to import Belgian bank statements. You can download CODA
files from your bank and import them directly into Odoo by clicking :guilabel:`Import file` from
your :guilabel:`Bank` journal on your dashboard.

.. image:: belgium/coda-import.png
   :alt: Import CODA files

.. seealso::
   :ref:`Import bank files <accounting/transactions/import>`

.. _belgium/soda:

SODA
----

**SODA** is an electronic XML format used to import accounting entries related to salaries. SODA
files can be imported into the journal you use to record salaries by going to your Accounting
**dashboard** and clicking :guilabel:`Upload` in the related journal card form.

Once your **SODA** files are imported, the entries are created automatically in your salary journal.

.. image:: belgium/soda-import.png
   :alt: Import SODA files

.. _belgium/einvoicing:

CodaBox
-------

**CodaBox** is a service that allows Belgian companies and accounting firms to access bank
information and statements. Odoo provides a way to import such statements automatically.

Configuration
~~~~~~~~~~~~~

To configure and use Codabox, first :ref:`install <general/install>` the :guilabel:`CodaBox` module.

.. _belgium/codabox-configuration-connection:

Configure the Connection
************************

.. tabs::

   .. tab:: For companies

      .. important::
         Make sure the :doc:`company settings </applications/general/companies>` are correctly
         configured, i.e., the country is set to :guilabel:`Belgium` and the :guilabel:`Tax ID` or
         :guilabel:`Company ID` field is filled.

      #. Go to :menuselection:`Accounting --> Configuration --> Settings`, then go to the
         :guilabel:`CodaBox & SODA` section.
      #. Click on :guilabel:`Manage Connection` to open the connection wizard, which shows the
         :guilabel:`Company VAT/ID` number that will be used for the connection.
      #. If this is your **first connection**, click on :guilabel:`Create connection`.
         The wizard confirms that the connection has been created on **Odoo's side**. Follow the
         steps to validate the connection on **CodaBox's side** too.

         If this is **not your first connection**, the :guilabel:`Password` provided by
         Odoo during the first connection will be requested to create a new connection.

            .. note::
               This :guilabel:`Password` is unique to Odoo and must be stored securely
               on your side.

   .. tab:: For accounting firms
      .. note::
         Accounting firms must manage their clients on separate databases and configure them
         individually to avoid mixing up their data. The connection must be made by an accounting
         firm with valid CodaBox Connect credentials.
         In the following instructions, we will refer to your client's company as *Company* and to
         your accounting firm as *Accounting Firm*.

      .. important::
         Make sure the :doc:`company settings </applications/general/companies>` are correctly
         configured, i.e., the country is set to :guilabel:`Belgium`, the :guilabel:`Tax ID` or
         :guilabel:`Company ID` and :guilabel:`Accounting Firm` fields are filled, as well as the
         :guilabel:`Tax ID` of the :guilabel:`Accounting Firm`.

      #. Go to :menuselection:`Accounting --> Configuration --> Settings`, then go to the
         :guilabel:`CodaBox & SODA` section.
      #. Click on :guilabel:`Manage Connection` to open the connection wizard, which shows the
         :guilabel:`Accounting Firm VAT` number and the :guilabel:`Company VAT/ID` number that will
         be used for the connection.
      #. If this is your **first connection**, click on :guilabel:`Create connection`. The wizard
         confirms that the connection has been created on **Odoo's side**. Follow the steps to
         validate the connection on **CodaBox's side**, too.

         If this is **not your first connection**, the :guilabel:`Accounting Firm Password` provided
         by Odoo during the first connection will be requested to create a new connection.

            .. note::
               This :guilabel:`Accounting Firm Password` is unique to Odoo and must be stored
               securely on your side.

The :guilabel:`Status` should have now switched to :guilabel:`Connected`.

Configure the journals
**********************

.. tabs::

   .. tab:: For CODA files

      #. :doc:`Create a new bank journal <../accounting/bank>`.
      #. Set the right IBAN in the :guilabel:`Account Number` field.
      #. Select :guilabel:`CodaBox synchronization` as the :guilabel:`Bank Feed`.

      .. image:: belgium/codabox_configuration_coda_journal.png
         :align: center
         :alt: Configuration of a CODA journal.

      .. tip::
         When working with bank transactions that use different currencies, it is recommended to
         create multiple journals with the same bank account but different currencies.

   .. tab:: For SODA files

      #. Create a new miscellaneous journal.
      #. Go to :menuselection:`Accounting --> Configuration --> Settings`, then go to the
         :guilabel:`CodaBox` section.
      #. Select the journal you just created in the SODA journal field.

      .. image:: belgium/codabox_configuration_soda_setting.png
         :align: center
         :alt: Configuration of a SODA journal.

Synchronization
~~~~~~~~~~~~~~~

Once the connection is established, Odoo can be synchronized with CodaBox.

.. tabs::

   .. tab:: For CODA files

      CODA files are automatically imported from CodaBox every 12 hours. You do
      not have to do anything. However, if you wish, it can also be done manually,
      by clicking on :guilabel:`Fetch from CodaBox` in the Accounting Dashboard.

   .. tab:: For SODA files

      SODA files are automatically imported from CodaBox once a day as a draft. You do not have to
      do anything. However, if you wish, it can also be done manually by clicking on
      :guilabel:`Fetch from CodaBox` in the Accounting Dashboard.

      By default, if an account in the SODA file is not mapped to an account in Odoo, the Suspense
      Account (499000) is used, and a note is added to the created journal entry.

      .. note::
         You can access the mapping between the SODA and Odoo accounts by going to
         :menuselection:`Accounting --> Configuration --> Settings` and clicking on the
         :guilabel:`Open SODA Mapping` button in the :guilabel:`CodaBox` section.


Potential issues
~~~~~~~~~~~~~~~~

* **CodaBox is not configured. Please check your configuration.**

  Either the :guilabel:`Company VAT` or the :guilabel:`Accounting Firm VAT` is not set.

*  **No connection exists with these accounting firms and company VAT numbers.**
   **Please check your configuration.**

    This can happen when checking the connection status, and the :guilabel:`Accounting Firm VAT` and
    :guilabel:`Company VAT` combination still needs to be registered. This may happen if you have
    changed the :guilabel:`Company VAT` after the connection was established. For security reasons,
    you have to :ref:`recreate a connection <belgium/codabox-configuration-connection>`
    for this :guilabel:`Company VAT`.

*  **It seems that your CodaBox connection is not valid anymore. Please connect again.**

    This can happen if you revoke Odoo's access to your CodaBox account or still need to complete
    the configuration process. In this case, you must revoke the connection and create a new one.

*  **The provided password is not valid for this accounting firm.**
   **You must reuse the password you received from Odoo during your first connection.**

    The password you provided is different from the one you received from Odoo during your first
    connection. You must use the password you received from Odoo during your first connection to
    create a new connection for this accounting firm. If you have lost your password, you must first
    revoke the Odoo connection on CodaBox's side (i.e., on your myCodaBox portal). Then, you can
    revoke the connection on Odoo's side and
    :ref:`create a new one <belgium/codabox-configuration-connection>`.

*  **It seems that the company or accounting firm VAT number you provided is not valid.**
   **Please check your configuration.**

    Either the :guilabel:`Company VAT` or the :guilabel:`Accounting Firm VAT` is not in a valid
    Belgian format.

*  **It seems that the accounting firm VAT number you provided does not exist in CodaBox.**
   **Please check your configuration.**

    The :guilabel:`Accounting Firm VAT` number you provided is not registered in CodaBox.
    You may not have a valid CodaBox license linked to this VAT number.

*  **It seems you have already created a connection to CodaBox with this accounting firm.**
   **To create a new connection, you must first revoke the old one on myCodaBox portal.**

    You must go to your myCodaBox portal and revoke Odoo's access to your CodaBox account.
    Then, you can :ref:`create a new connection <belgium/codabox-configuration-connection>`
    on Odoo's side.

.. tip::
    To revoke the connection between Odoo and CodaBox, go to
    :menuselection:`Accounting --> Configuration --> Settings`, scroll down to the
    :guilabel:`CodaBox` section, click on :guilabel:`Manage Connection`, then click on
    :guilabel:`Revoke`.

.. _belgium/codaclean:

Codaclean
---------

**Codaclean** is a service that allows Belgian companies and accounting firms to access bank
information and statements. Odoo provides a way to import such statements and their transactions
automatically.

.. _belgium/codaclean-configuration:

Configuration
~~~~~~~~~~~~~

.. note::
   Make sure to :ref:`install <general/install>` the :guilabel:`Codaclean` (`l10n_be_codaclean`)
   module.


.. _belgium/codaclean-configuration-connection:

Connection with Odoo
********************

To connect Odoo with Codaclean, follow these steps:

#. Open the Settings app, navigate to the :ref:`Companies <general/companies/company>` section, and
   click :icon:`oi-arrow-right` :guilabel:`Manage Companies` to make sure the company's
   :guilabel:`Country` is set to :guilabel:`Belgium`.
#. Go to :menuselection:`Accounting --> Configuration --> Settings` and scroll to the
   :guilabel:`Codaclean` section.
#. Click :guilabel:`Manage Connection` to open the connection wizard, enter the Codaclean
   :guilabel:`Username` and :guilabel:`Password` and click :guilabel:`Connect`.

The :guilabel:`Status` is updated to :guilabel:`Connected`.

.. tip::
   Once the connection is established, the :guilabel:`Manage Connection` wizard provides two options:

   - Update Codaclean credentials: Enter the new :guilabel:`Username` and :guilabel:`Password`, then
     click :guilabel:`Change Credentials`.
   - Remove Codaclean connection: Click :guilabel:`Disconnect`; no :guilabel:`Username` or
     :guilabel:`Password` is required.

.. _belgium/codaclean-configuration-journal:

Journal creation
****************

A specific bank journal must be created for Codaclean synchronization. To do so, :doc:`create a new
bank journal <../accounting/bank>`, make sure to enter the correct IBAN in the :guilabel:`Bank
Account Number` field, and select :guilabel:`Codaclean Syncronization` in the :guilabel:`Bank Feeds`
field.

.. tip::
   For bank transactions in different currencies, it is recommended to create a separate journal for
   each currency, using the same bank account.

.. _belgium/codaclean-synchronization:

Synchronization
~~~~~~~~~~~~~~~

Once the connection is established, Odoo is synchronized with Codaclean, and new CODA files received
via Codaclean are checked every twelve hours.

.. tip::
   To manually check for new CODA files, go to the Accounting Dashboard and click :guilabel:`Fetch
   from Codaclean` on the relevant :ref:`journal <belgium/codaclean-configuration-journal>` .

.. _belgium/peppol:

Electronic invoicing with Peppol
================================

As of 1 January 2026, all Belgian companies must be registered on the Peppol network to send and
receive electronic invoices.

To activate Peppol, refer to the :ref:`Peppol documentation <accounting/e-invoicing/peppol>`,
ensuring during :ref:`registration <accounting/e-invoicing/peppol-registration>` that:

- The :guilabel:`Peppol EAS` field is set to :guilabel:`0208 - Numero d'entreprise /
  ondernemingsnummer / Unternehmensnummer`.
- the :guilabel:`Peppol Endpoint` field is set to the company registry number.

In addition, when veryfing that a customer is :ref:`registered as a Peppol participant
<accounting/e-invoicing/contact-verification>`, ensure the :guilabel:`Format` field is set to
:guilabel:`BIS Billing 3.0`.

.. seealso::
   :ref:`Peppol documentation <accounting/e-invoicing/peppol>`

.. _belgium/cash-discount:

Cash discount
=============

In Belgium, if an early payment discount is offered on an invoice, the tax is calculated based on
the discounted total amount, whether the customer benefits from the discount or not.

To apply the right tax amount and report it correctly in your VAT return, set the tax reduction as
:guilabel:`Always (upon invoice)`.

.. seealso::
   :doc:`../accounting/customer_invoices/cash_discounts`

.. _belgium/pos-restaurant-certification:

Fiscal certification: POS restaurant
====================================

In Belgium, the owner of a cooking business such as a restaurant or food truck is required by law to
use a government-certified **Cash Register System** for their receipts. This applies if their yearly
earnings (excluding VAT, drinks, and take-away food) exceed 25,000 euros.

This government-certified system entails the use of a :ref:`certified POS system
<belgium/certified-pos>`, along with a device called a :ref:`Fiscal Data Module <belgium/fdm>` (or
**black box**) and a :ref:`VAT Signing Card <belgium/vat>`.

.. important::
   Do not forget to register as *foodservice industry manager* on the `Federal Public Service
   Finance registration form <https://www.systemedecaisseenregistreuse.be/fr/enregistrement>`_.

.. _belgium/certified-pos:

Certified POS system
--------------------

The Odoo POS system is certified for databases hosted on **Odoo Online**, **Odoo.sh**, and
**On-Premise**.

.. seealso::
   :doc:`/administration/standard_extended_support`

A `certified POS system <https://www.systemedecaisseenregistreuse.be/systemes-certifies>`_ must
adhere to rigorous government regulations, which means it operates differently from a non-certified
POS.

- On a certified POS, you cannot:

  - Set up and use the **global discounts** feature (the `pos_discount` module is blacklisted and
    cannot be activated).
  - Set up and use the **loyalty programs** feature (the `pos_loyalty` module is blacklisted and
    cannot be activated).
  - Reprint receipts (the `pos_reprint` module is blacklisted and cannot be activated).
  - Modify prices in order lines.
  - Modify or delete order lines in POS orders.
  - Sell products without a valid VAT number.
  - Use a POS that is not connected to an IoT box.

- The :doc:`cash rounding <../../sales/point_of_sale/pricing/cash_rounding>` feature must be
  activated and set to a :guilabel:`Rounding Precision` of `0,05` and a :guilabel:`Rounding Method`
  set as :guilabel:`Half-Up`.
- Taxes must be set as included in the price. To set it up, go to :menuselection:`Point of Sale -->
  Configuration --> Settings`, and from the :guilabel:`Accounting` section, open the
  :guilabel:`Default Sales Tax` form by clicking the arrow next to the default sales tax field.
  There, click :guilabel:`Advanced Options` and enable :guilabel:`Included in Price`.
- At the start of a POS session, users must click :guilabel:`Work in` to clock in. Doing so allows
  the registration of POS orders. If users are not clocked in, they cannot make POS orders.
  Likewise, they must click :guilabel:`Work Out` to clock out at the end of the session.

.. warning::
   If you configure a POS to work with a :abbr:`FDM (Fiscal Data Module)`, you cannot use it again
   without it.

.. _belgium/fdm:

Fiscal Data Module (FDM)
------------------------

An FDM, or **black box**, is a government-certified device that works together with the Point of
Sale application and saves your POS orders information. Concretely, a **hash** (:dfn:`unique code`)
is generated for each POS order and added to its receipt. This allows the government to verify that
all revenue is declared.

.. warning::
   Only the FDM from **Boîtenoire.be** with the `FDM certificate number BMC04
   <https://www.systemedecaisseenregistreuse.be/fr/systemes-certifies#FDM%20certifiés>`_ is
   supported by Odoo. `Contact the manufacturer (GCV BMC) <https://www.boîtenoire.be/contact>`_ to
   order one.

Configuration
~~~~~~~~~~~~~

Before setting up your database to work with an FDM, ensure you have the following hardware:

- a **Boîtenoire.be** (certificate number BMC04) FDM;
- an RS-232 serial null modem cable per FDM;
- an RS-232 serial-to-USB adapter per FDM;
- an :ref:`IoT Box <belgium/iotbox>` (one IoT box per FDM); and
- a receipt printer.

.. _belgium/blackbox:

Black box module
****************

As a pre-requisite, :ref:`activate <general/install>` the `Belgian Registered Cash Register` module
(technical name: `pos_blackbox_be`).

.. image:: belgium/be-modules.png
   :alt: black box modules for belgian fiscal certification

Once the module is activated, add your VAT number to your company information. To set it up, go to
:menuselection:`Settings --> Companies --> Update Info`, and fill in the :guilabel:`VAT` field.
Then, enter a national registration number for every staff member who operates the POS system. To do
so, go to the :guilabel:`Employees` app and open an employee form. There, go to :menuselection:`HR
settings tab --> Attendance/Point of Sale`, and fill in the :guilabel:`INSZ or BIS number` field.

.. image:: belgium/bis-number.png
   :alt: ISNZ or BIS number field on employee form

.. tip::
   To input your information, click on your avatar, go to :menuselection:`My Profile --> Preference
   tab`, and enter your INSZ or BIS number in the designated field.

.. warning::
   You must configure the :abbr:`FDM (Fiscal Data Module)` directly in the production database.
   Utilizing it in a testing environment may result in incorrect data being stored within the FDM.

.. _belgium/iotbox:

IoT Box
*******

In order to use an :abbr:`FDM (Fiscal Data Module)`, you need a registered IoT Box. To register your
IoT box, you must contact us through our `support contact form <https://www.odoo.com/help>`_ and
provide the following information:

- your VAT number;
- your company's name, address, and legal structure;
- the identifier of your IoT Box.

Once your IoT box is certified, :doc:`connect <../../general/iot/connect>` it to your database. To
verify that the IoT Box recognizes the FDM, go to the IoT homepage and scroll down the
:guilabel:`IOT Device` section, which should display the FDM.

.. image:: belgium/iot-devices.png
   :alt: Hardware status page on a registered IoT Box

Then, add the IoT to your POS. To do so, go to :menuselection:`Point of Sale --> Configuration -->
Point of Sale`, select your POS, scroll down to the :guilabel:`Connected Device` section, and enable
:guilabel:`IoT Box`. Lastly, add the FMD in the :guilabel:`Fiscal Data Module` field.

.. note::
   To be able to use an FDM, you must at least connect one :guilabel:`Receipt Printer`.

.. _belgium/vat:

VAT signing card
----------------

When you open a POS session and make your initial transaction, you are prompted to enter the PIN
provided with your :abbr:`VSC (VAT signing card)`. The card is delivered by the :abbr:`FPS (Service
Public Federal Finances)` upon `registration <https://www.systemedecaisseenregistreuse.be/fr/enregistrement>`_.


==================================================
SECTION: brazil.rst
PATH: applications/finance/fiscal_localizations/brazil.rst
==================================================

======
Brazil
======

.. |IAP| replace:: :abbr:`IAP (In-app-purchase)`
.. |API| replace:: :abbr:`API (Application programming interface)`
.. |SO| replace:: :abbr:`SO (Sales order)`

.. seealso::
   Helpful resources for the Brazilian localization, including onboarding materials and videos:

   - `Onboarding checklist for new users
     <https://docs.google.com/document/d/e/2PACX-1vSNYTYVnR_BzvQKL3kn5YdVzPjjHc-WHw_U3udk5tz_dJXo69woj9QrTMinH_siyOX2rLGjvspvc8AF/pub>`_.
   - `YouTube playlist - Brazil (Localization)
     <https://youtube.com/playlist?list=PL1-aSABtP6ADqexw4YNCbKPmpFggajxlX&si=RgmZR3Jco3223Np4>`_.
   - `YouTube playlist - Tutoriais Odoo em Português
     <https://youtube.com/playlist?list=PL1-aSABtP6ACGOW2UREePGjHQ2Bgdy-UZ&si=j6tiI36eB7BoKVQB>`_.
   - :doc:`Documentation on e-invoicing's legality and compliance in Brazil
     <../accounting/customer_invoices/electronic_invoicing/brazil>`

.. _localizations/brazil/modules:

Modules
=======

The following modules related to the Brazilian localization are available:

.. list-table::
   :header-rows: 1
   :widths: 25 25 50

   * - Name
     - Technical name
     - Description
   * - :guilabel:`Brazilian - Accounting`
     - `l10n_br`
     - Brazilian :ref:`fiscal localization package <fiscal_localizations/packages>`, complete with
       the Brazilian chart of accounts, taxes, tax report, fiscal positions, and document and
       identification types.
   * - :guilabel:`Brazil - Accounting Reports`
     - `l10n_br_reports`
     - Accounting reports for Brazil.
   * - :guilabel:`AvaTax Brazil`, :guilabel:`Avatax Brazil Sale` & :guilabel:`Test SOs for the
       Brazilian Avatax`
     - `l10n_br_avatax`, `l10n_br_avatax_sale` & `l10n_br_test_avatax_sale`
     - Goods and Services tax computation through Avalara.
   * - :guilabel:`Brazilian Accounting EDI`
     - `l10n_br_edi`
     - Provides electronic invoicing through Avatax.
   * - :guilabel:`Brazilian Accounting EDI For Sale`
     - `l10n_br_edi_sale`
     - Adds some fields to sale orders that are carried over the invoice.
   * - :guilabel:`Brazilian Accounting EDI for POS`
     - `l10n_br_edi_pos`
     - Provides electronic invoicing through Avatax in the POS.
   * - :guilabel:`Brazilian Accounting EDI for eCommerce`
     - `l10n_br_edi_website_sale`
     - Allows tax calculation and EDI for eCommerce users.
   * - :guilabel:`Brazilian Accounting EDI for stock`
     - `l10n_br_edi_stock`
     - Adds delivery-related information to the NF-e.
   * - :guilabel:`Brazil - Website Sale`
     - `l10n_br_website_sale`
     - Allows tax calculation and EDI for eCommerce users.
   * - :guilabel:`Brazil - Sale`
     - `l10n_br_sales`
     - Sale modifications for Brazil
   * - :guilabel:`Brazil - Sale Subscription`
     - `l10n_br_sale_subscription`
     - Sale subscription modifications for Brazil

.. note::
   The localization's core modules are installed automatically with the localization. The rest can
   be manually :doc:`installed </applications/general/apps_modules>`.

.. _localizations/brazil/loc-review:

Localization overview
=====================

The Brazilian localization package ensures compliance with Brazilian fiscal and accounting
regulations. It includes tools for managing taxes, fiscal positions, reporting, and a predefined
chart of accounts tailored to Brazil’s standards.

The Brazilian localization package provides the following key features to ensure compliance with
local fiscal and accounting regulations:

- :ref:`Chart of accounts <localizations/brazil/chart-of-accounts>`: a predefined structure tailored
  to Brazilian accounting standards
- :ref:`Taxes <localizations/brazil/taxes>`: pre-configured tax rates, including standard VAT,
  zero-rated, and exempt options.
- :doc:`Payroll </applications/hr/payroll>`
- :doc:`Reporting <../accounting/reporting>`

.. _localizations/brazil/chart-of-accounts:

Chart of accounts
-----------------

In the :doc:`chart of accounts <../accounting/get_started/chart_of_accounts>`, the accounts are
mapped automatically to their corresponding taxes, and the default account payable and account
receivable fields.

.. note::
   The Brazil chart of accounts is based on the SPED CoA, which provides a baseline of the necessary
   accounts.

.. _localizations/brazil/taxes:

Taxes
-----

:doc:`Taxes <../accounting/taxes>` are automatically created and configured when installing the
Brazilian localization. Avalara uses some to compute taxes on sales orders or invoices.

Taxes used for services must be manually added and configured, as the rate may differ depending on
the city where the service is offered.

.. important::
   NFS-e can't be issued for service taxes created manually. To :ref:`electronically send an NFS-e
   <localizations/brazil/e-invoice-services>`, compute taxes using Avalara.

.. warning::
   Do not delete taxes, as they are used for the AvaTax tax computation. If deleted, Odoo creates
   them again when used in an |SO| or invoice, computing taxes with AvaTax. However, the account
   used to register the tax must be reconfigured in the tax's :guilabel:`Definition` tab, under
   the :guilabel:`Distribution for invoices` and :guilabel:`Distribution for refunds` sections.

.. _localizations/brazil/company-and-contacts:

Company and contacts
====================

To use all the features of this fiscal localization, the following fields are required on the
:doc:`company record </applications/general/companies>`:

- :guilabel:`Name`
- :guilabel:`Address`: add :guilabel:`City`, :guilabel:`State`, :guilabel:`Zip Code`,
  :guilabel:`Country`

  - In the :guilabel:`Street` field, enter the street name, number, and any additional address
    information.
  - In the :guilabel:`Street 2` field, enter the neighborhood.

- :guilabel:`Identification Number`: :guilabel:`CNPJ` or :guilabel:`CPF`
- :guilabel:`Tax ID`: associated with the identification type
- :guilabel:`IE`: State registration
- :guilabel:`IM`: Municipal registration
- :guilabel:`SUFRAMA code`: Superintendence of the Manaus Free Trade Zone - add if applicable
- :guilabel:`Phone`
- :guilabel:`Email`

Configure the :guilabel:`Fiscal Information` within the :guilabel:`Sales and Purchase` tab:

   - Add the :ref:`Fiscal Position <localizations/brazil/fiscal-positions>` for AvaTax Brazil.
   - :guilabel:`Tax Regime`: Federal Tax Regime
   - :guilabel:`ICMS Taxpayer Type`: indicates :guilabel:`ICMS regime`, :guilabel:`Exempt status`,
     or :guilabel:`Non-Taxpayer`
   - :guilabel:`Main Activity Sector`

Configure the following extra :guilabel:`Fiscal Information` to issue NFS-e:

   - Add the :ref:`Fiscal Position <localizations/brazil/fiscal-positions>` for AvaTax Brazil.
   - :guilabel:`COFINS Details`: :guilabel:`Taxable, Not Taxable, Taxable with rate 0%, Exempt,
     Suspended`
   - :guilabel:`PIS Details` :guilabel:`Taxable, Not Taxable, Taxable with rate 0%, Exempt,
     Suspended`
   - :guilabel:`CSLL Taxable` if the company is subject to CSLL or not

.. tip::
   If it is a simplified regime, the ICMS rate must be configured. To do so, go to
   :menuselection:`Accounting --> Configuration --> Settings`, scroll down to the :guilabel:`Taxes`
   section, and set the :guilabel:`Sales Tax` and :guilabel:`Purchase Tax` fields in the
   :guilabel:`Default Taxes` section.

The same configuration applies to the relevant :doc:`contact <../../essentials/contacts>` form when
using the AvaTax integration.

.. note::
   Select the :guilabel:`Company` option for a contact with a tax ID (CNPJ), or check
   :guilabel:`Individual` for a contact with a CPF.

.. _localizations/brazil/avatax-account:

AvaTax integration
==================

.. note::
   - Make sure to :ref:`install <general/install>` the :guilabel:`AvaTax Brazil` (`l10n_br_avatax`)
     module.
   - Odoo is a certified partner of Avalara Brazil.
   - The :doc:`Avalara AvaTax integration <../accounting/taxes/avatax>` uses :doc:`In-App-Purchases
     (IAPs) <../../essentials/in_app_purchase>` to compute taxes and handle electronic documents
     (e.g., :ref:`NF-e <localizations/brazil/e-invoice-goods>`, :ref:`NFS-e
     <localizations/brazil/e-invoice-services>`). Each action consumes credits from the `IAP credit
     balance <https://iap.odoo.com/iap/in-app-services/819>`_. On creation, new databases receive
     500 free credits.

To compute the goods and services tax and process electronic invoices, the following configurations
are needed:

- :ref:`Company <localizations/brazil/company-and-contacts>`
- :ref:`Contacts <localizations/brazil/company-and-contacts>`
- :ref:`AvaTax configuration<localizations/brazil/avatax-credentials>`.
- :ref:`A1 digital certificate <localizations/brazil/certificate-upload>`
- :ref:`Tax mapping <localizations/brazil/fiscal-positions>`
- :ref:`Products <localizations/brazil/products>`

.. _localizations/brazil/avatax-configuration:

Configuration
-------------

.. _localizations/brazil/avatax-credentials:

Credentials
~~~~~~~~~~~

:ref:`Activate AvaTax in Odoo <accounting/avatax/credentials>` and, in the :guilabel:`AvaTax Brazil`
section, add the administrator's email address for the AvaTax portal in the :guilabel:`AvaTax Portal
Email` field, then click :icon:`fa-plug` :guilabel:`Create account`.

.. warning::
   When **testing** or **creating a production** :guilabel:`AvaTax Portal Email` integration in a
   sandbox or production database, use a real email address, as it is needed to :ref:`connect to
   Avalara <accounting/avatax/prerequisites>` and set up the certificates, whether to test or use it
   on production.

   There are two different Brazilian Avalara Portals:

   - One for testing: https://portal.sandbox.avalarabrasil.com.br/
   - One for production: https://portal.avalarabrasil.com.br/

   When the account is created from Odoo, select the right environment. Moreover, the email used to
   open the account cannot be used to open another account. Save the :guilabel:`API ID` and
   :guilabel:`API Key` when the account is created from Odoo.

   .. image:: brazil/transfer-api-credentials.png
      :alt: Transfer API Credentials.

After the account is created from Odoo, go to the Avalara Portal to set up the password:

#. Access the `Avalara portal <https://portal.avalarabrasil.com.br/Login>`_.
#. Click :guilabel:`Meu primeiro acesso`.
#. Add the email address used in Odoo to create the Avalara/AvaTax account, and click
   :guilabel:`Solicitar Senha`.
#. An email will then be received with a token and a link to create a password. Click on this link
   and copy-paste the token to allocate the desired password.

.. tip::
   If you use AvaTax in Odoo for tax computation **only**, setting a password or accessing the
   Avalara portal is unnecessary. However, to use the electronic invoice service, access to
   AvaTax is needed, and the :ref:`certificate must be uploaded
   <localizations/brazil/certificate-upload>`.

.. note::
   |API| credentials can be transferred. This option should be used only when an account has already
   been created in another Odoo instance and must be reused.

.. _localizations/brazil/certificate-upload:

A1 certificate upload
~~~~~~~~~~~~~~~~~~~~~

To issue electronic invoices, a certificate must be uploaded to the `AvaTax portal
<https://portal.avalarabrasil.com.br/Login>`_.

The certificate will be synchronized with Odoo as long as the external identifier number in the
AvaTax portal matches, without special characters, with the CNPJ number, and the identification
number (CNPJ) in Odoo matches the CNPJ in AvaTax.

.. important::
   Some cities require the certificate to be linked within the City Portal system before issuing
   NFS-e from Odoo.

   If an error message from the city that says :guilabel:`Your certificate is not linked
   to the user` is received, this process needs to be done in the city portal.

.. _localizations/brazil/fiscal-positions:

Fiscal positions
~~~~~~~~~~~~~~~~

To set up the :guilabel:`Automatic Tax Mapping (Avalara Brazil)` :ref:`fiscal position
<accounting/avatax/fiscal_positions>`, enable the :guilabel:`Detect Automatically` and
:guilabel:`Use AvaTax Brazil API` options.

.. seealso::
   :doc:`Fiscal positions <../accounting/taxes/fiscal_positions>`

.. _localizations/brazil/products:

Products
~~~~~~~~

To use the AvaTax integration on sales orders and invoices, enter the following information in the
:guilabel:`Sales` tab of the product form under the :guilabel:`Brazil Accounting` section, based on
how the product will be used.

.. _localizations/brazil/e-invoice-goods:

E-invoices for goods (NF-e)
***************************

.. important::
   The :ref:`Avalara integration <localizations/brazil/avatax-account>` works on a credit-based
   system, where each interaction with Avalara consumes one credit. Below are the main
   credit-consuming operations:

   **Sales application**

   - Tax calculation on quotations and sales orders.

   **Accounting application**

   - Tax calculation on invoices.
   - Electronic invoice submission (NF-e or NFS-e).

   **Occasional operations**: (each step is billed separately)

   - :ref:`Correction letter (Carta de Correção) <localizations/brazil/correction-letter>`
   - :ref:`Invoice cancellation <localizations/brazil/invoice-cancellation>`
   - :ref:`Sales refund via credit note <localizations/brazil/credit-notes>`
   - :ref:`Sales complementary invoice via debit note <localizations/brazil/debit-notes>`
   - :ref:`Invoice number range invalidation <localizations/brazil/invoice-number-invalidation>`
   - Other tax validations.

.. note::
   If taxes are calculated in the **Sales** app, and the invoice is later issued in the
   **Accounting** app, the calculation happens twice, consuming two credits.

.. example::
   | **Sales order confirmed**
   | :icon:`fa-arrow-down` 1 credit (tax calculation)
   | **Invoice created**
   | :icon:`fa-arrow-down` 1 credit (tax calculation)
   | **Invoice confirmed and submitted**
   | :icon:`fa-arrow-down` 1 credit (tax calculation) + 1 credit (submit invoice)
   | **Total: 4 credits**

- :guilabel:`CEST Code`: tax classification code identifying goods and products subject to tax
  substitution under ICMS regulations, and helps determine the applicable tax treatment and
  procedures for specific items. The product's applicability to this requirement can be verified at
  https://www.codigocest.com.br/.
- :guilabel:`Mercosul NCM Code`: Mercosur Common Nomenclature Product Code
- :guilabel:`Source of Origin`: origin of the product, which can be foreign or domestic, among other
  possible options, depending on the specific use case
- :guilabel:`SPED Fiscal Product Type`: fiscal product type according to the SPED list table
- :guilabel:`Purpose of Use`: intended purpose of use for this product

.. note::
   Odoo automatically creates three products to be used for transportation costs associated with
   sales. These are named :guilabel:`Freight`, :guilabel:`Insurance`, and :guilabel:`Other Costs`
   and are already configured. If more need to be created, duplicate and use the same configuration:

   - :guilabel:`Product Type` :guilabel:`Service`
   - :guilabel:`Transportation Cost Type`: :guilabel:`Insurance`, :guilabel:`Freight`, or
     :guilabel:`Other Costs`

.. _localizations/brazil/e-invoice-services:

E-invoices for services (NFS-e)
*******************************

.. important::
   The :ref:`Avalara integration <localizations/brazil/avatax-account>` works on a credit-based
   system, where each interaction with Avalara consumes one credit. Below are the main
   credit-consuming operations:

   **Sales application**

   - Tax calculation on quotations and sales orders.

   **Accounting application**

   - Tax calculation on invoices.
   - Electronic invoice submission (NF-e or NFS-e).
   - Invoice status check (1 credit is consumed each time the invoice status is checked).

   **Occasional operations**: (each step is billed separately)

   - :ref:`Correction letter (Carta de Correção) <localizations/brazil/correction-letter>`
   - :ref:`Invoice cancellation <localizations/brazil/invoice-cancellation>`
   - :ref:`Sales refund via credit note <localizations/brazil/credit-notes>`
   - :ref:`Sales complementary invoice via debit note <localizations/brazil/debit-notes>`
   - :ref:`Invoice number range invalidation <localizations/brazil/invoice-number-invalidation>`
   - Other tax validations.

.. note::
   If taxes are calculated in the **Sales** app and the invoice is later issued in the
   **Accounting** app, the calculation happens twice, consuming two credits.

.. example::
   | **Sales order confirmed**
   | :icon:`fa-arrow-down` 1 credit (tax calculation)
   | **Invoice created**
   | :icon:`fa-arrow-down` 1 credit (tax calculation)
   | **Invoice confirmed and submitted**
   | :icon:`fa-arrow-down` 1 credit (tax calculation) + 1 credit (submit invoice)
   | **Total: 4 credits**

- :guilabel:`Mercosul NCM Code`: Mercosur Common Nomenclature Product Code
- :guilabel:`Purpose of Use`: intended purpose of use for this product
- :guilabel:`Service Code Origin`: City Service Code where the provider is registered
- :guilabel:`Labor Assignment`: checkbox to select if the service involves labor
- :guilabel:`Transport Cost Type`: type of transport costs to select
- :guilabel:`Service Codes`: City Service Code where the service will be provided; if no code is
  added, the :guilabel:`Service Code Origin` will be used.

.. _localizations/brazil/tax-computation:

Tax computation
---------------

.. seealso::
   :ref:`Tax calculation <accounting/avatax/tax-calculation>`

.. _localizations/brazil/tax-calculations:

Tax calculations on quotations and sales orders
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Trigger an |API| call to calculate taxes on a quotation or sales order automatically with AvaTax in
any of the following ways:

- **Quotation confirmation**
    Confirm a quotation into a sales order.
- **Manual trigger**
    Click :guilabel:`Compute Taxes Using AvaTax`.
- **Preview**
    Click :guilabel:`Preview`.
- **Email a quotation/sales order**
    Send a quotation or sales order to a customer via email.
- **Online quotation access**
    When a customer accesses the quotation online (via the portal view), the |API| call is
    triggered.

.. _localizations/brazil/tax-calculations-invoices:

Tax calculations on invoices
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Trigger an |API| call to calculate taxes on a customer invoice automatically with AvaTax in any of
the following ways:

- **Manual trigger**
    Click :guilabel:`Compute Taxes Using AvaTax`.
- **Preview**
    Click :guilabel:`Preview`.
- **Online invoice access**
    When a customer accesses the invoice online (via the portal view), the |API| call is triggered.

.. note::
   The :guilabel:`Fiscal Position` must be set to `Automatic Tax Mapping (Avalara Brazil)` for any
   of these actions to compute taxes automatically.

.. seealso::
   :doc:`Fiscal positions (tax and account mapping) <../accounting/taxes/fiscal_positions>`

.. _localizations/brazil/accounting:

Accounting
==========

.. _localizations/brazil/electronic-documents:

Electronic documents
--------------------

.. _localizations/brazil/journals:

Configuration
~~~~~~~~~~~~~

A *series* number is linked to a sequence number range for electronic invoices. To configure the
series number on a sales journal, go to :menuselection:`Accounting --> Configuration --> Journals`
and set it in the :guilabel:`Series` field. If more than one series is needed, a new sales journal
must be created, and a new series number must be assigned for each series.

Enable the :guilabel:`Use Documents?` option as the :guilabel:`Series` field will only be displayed
if the :guilabel:`Use Documents?` option is selected on the journal.

When issuing electronic and non-electronic invoices, the :guilabel:`Type` field selects the document
type used when creating the invoice.

.. note::
   When creating the journal, ensure the :guilabel:`Dedicated Credit Note Sequence` field in the
   :guilabel:`Accounting Information` section is unchecked, as in Brazil, sequences between
   invoices, credit notes, and debit notes are shared per series number, which means per journal.

.. _localizations/brazil/customer-invoices:

Customer invoices
~~~~~~~~~~~~~~~~~

To process an electronic invoice for goods (NF-e) or services (NFS-e), the invoice must be confirmed
and taxes must be computed by Avalara. The following fields must be filled out:

- :guilabel:`Customer`, with all customer information
- :guilabel:`Payment Method: Brazil`: Specify the expected payment method.
- :guilabel:`Document Type`: Select :guilabel:`(55) Electronic Invoice (NF-e)` or :guilabel:`(SE)
  Electronic Service Invoice (NFS-e)`.

:guilabel:`Other Info` tab:

- :guilabel:`Fiscal Position` set as :guilabel:`Automatic Tax Mapping (Avalara Brazil)`.

Some optional fields depend on the nature of the transaction. These fields in the :guilabel:`Other
Info` tab are not required, so in most cases, leaving them blank will not result in errors from the
government when the invoice is submitted:

- :guilabel:`Freight Model` determines how the goods are planned to be transported - domestic.
- :guilabel:`Transporter Brazil` determines who is doing the transportation.

Then, click :guilabel:`Send`. In the :guilabel:`Print & Send` window, click :guilabel:`Process
e-invoice` and any other options, such as :guilabel:`Download` or :guilabel:`Email`. Finally, click
:guilabel:`Send` to process the invoice with the government.

.. note::
   All fields available on the invoice used to issue an electronic invoice are also available on the
   sales order, if needed. When creating the first invoice, the :guilabel:`Document Number` field is
   displayed and allocated as the first number to be used sequentially for subsequent invoices.

.. _localizations/brazil/credit-notes:

Credit notes
~~~~~~~~~~~~

If a sales return needs to be registered, a :ref:`credit note can be created in Odoo
<accounting/credit_notes/issue-credit-note>` and sent to the government for validation.

.. note::
   Credit notes are only available for electronic invoices for goods (NF-e).

.. _localizations/brazil/debit-notes:

Debit notes
~~~~~~~~~~~

If additional information needs to be included or values that were not accurately provided in the
original invoice need to be corrected, a :ref:`debit note can be issued
<accounting/credit_notes/issue-debit-note>`.

.. note::
   - Debit notes are only available for electronic invoices for goods (NF-e).
   - Only the products included in the original invoice can be included in the debit note. While
     changes can be made to the product's unit price or quantity, products **cannot** be added to
     the debit note. The purpose of this document is only to declare the amount to be added to the
     original invoice for the same or fewer products.

.. _localizations/brazil/invoice-cancellation:

Invoice cancellation
~~~~~~~~~~~~~~~~~~~~

It is possible to cancel an electronic invoice that the government validated.

.. note::
   Check whether the electronic invoice is still within the cancellation deadline, which may vary
   according to each state's legislation.

.. _localizations/brazil/e-invoice-goods-nf-e:

E-invoices for goods (NF-e)
***************************

To cancel an e-invoice for goods (NF-e) in Odoo, click :guilabel:`Request Cancel` and add a
cancellation :guilabel:`Reason` on the pop-up that appears. To send this cancellation reason to the
customer via email, enable the :guilabel:`E-mail` checkbox.

.. note::
   This is an electronic cancellation, which means that Odoo will send a request to the government
   to cancel the NF-e. It will then consume one |IAP| credit, as an |API| call occurs.

.. _localizations/brazil/e-invoice-services-nf-e:

E-invoices for services (NFS-e)
*******************************

To cancel an e-invoice for services (NFS-e) in Odoo, click :guilabel:`Request Cancel`. There is no
electronic cancellation process in this case, as not every city has this service available. The
user needs to cancel this NFS-e on the city portal manually. Once that step is completed, they can
request the cancellation in Odoo, which will cancel the invoice.

.. _localizations/brazil/correction-letter:

Correction letter
~~~~~~~~~~~~~~~~~

A correction letter can be created and linked to an electronic invoice for goods (NF-e) that the
government validated.

To do so in Odoo, click :guilabel:`Correction Letter` and add a correction :guilabel:`Reason` to the
pop-up. To send the correction reason to a customer via email, enable the :guilabel:`E-mail`
checkbox.

.. note::
   Correction letters are only available for electronic invoices for goods (NF-e).

.. _localizations/brazil/invoice-number-invalidation:

Invoice number range invalidation
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

A range of sequences that are assigned to sales journals can be invalidated by the government if
they are not currently used **and** will not be used in the future. To do so, go to
:menuselection:`Accounting --> Configuration --> Journals`, open the journal, click the
:icon:`fa-cog` (gear) icon, and select :guilabel:`Invalidate Number Range (BR)`. On the
:guilabel:`Invalidate Number Range (BR)` wizard, add the :guilabel:`Initial Number` and
:guilabel:`End Number` of the range that should be cancelled, and enter an invalidation
:guilabel:`Reason`.

.. note::
   - Invoice number range invalidation is only available for electronic invoices for goods (NF-e).
   - The journal's chatter records the log of the cancelled numbers, along with the XML file.

.. _localizations/brazil/vendor-bills:

Vendor bills
------------

When receiving an invoice from a supplier, encode the bill in Odoo by adding all the commercial
information and the same Brazilian-specific information recorded on the :ref:`customer invoices
<localizations/brazil/electronic-documents>`.

These Brazilian-specific fields are:

- :guilabel:`Payment Method: Brazil`: Specify the expected payment method.
- :guilabel:`Document Type`: used by the vendor
- :guilabel:`Document Number`: the invoice number from the supplier
- :guilabel:`Freight Model`: **NF-e specific** how goods are planned to be transported - domestic
- :guilabel:`Transporter Brazil`: **NF-e specific** who is doing the transportation.

.. _localizations/brazil/pos:

Point of sale NFC-e
===================

The NFC-e is a legal document that supports selling goods or merchandise to the final customer. Like
the :ref:`NF-e <localizations/brazil/e-invoice-goods-nf-e>`, the electronic customer invoice is also
issued in XML file format and has an auxiliary document (DANFC-e) known as the *NFC-e Summary*. This
electronic document can be issued through **Odoo Point of Sale**.

Its legal validity is guaranteed by the digital signature and by each Brazilian state's SEFAZ
(Secretaria da Fazenda).

.. important::
   The :ref:`Avalara integration <localizations/brazil/avatax-account>` operates on a credit-based
   system. Each operation that involves communication with Avalara consumes one credit. The
   following operations within the **Point of Sale** (POS) application are subject to credit
   consumption:

   - Tax calculation at the time of sale
   - Electronic invoice issuance (NFC-e)

.. note::
   Each step is billed separately. For example, calculating taxes and issuing an invoice for the
   same POS transaction consumes two credits.

.. seealso::
   :doc:`Point of Sale <../../sales/point_of_sale>`

.. _localizations/brazil/pos-configuration:

Configuration
-------------

:ref:`Install <general/install>` the :guilabel:`Brazilian Accounting EDI for POS` (`l10nbr_edi_pos`)
module and make sure to activate :doc:`AvaTax <../accounting/taxes/avatax>`.

.. _localizations/brazil/pos-csc-details:

CSC details
-----------

Go to :menuselection:`Accounting --> Configuration --> Settings` and scroll to the :guilabel:`Taxes`
section. In the :guilabel:`NFC-e configuration` section, complete the following CSC (Taxpayer
Security Code) fields:

- :guilabel:`CSC ID`: The *CSC ID* or *CSC Token* is an identification of the taxpayer security
  code, which can have 1 to 6 digits and is available on the official website of your state’s
  Department of Finance (SEFAZ).
- :guilabel:`CSC Number`: The *CSC Number* is a code of up to 36 characters that only you and the
  Department of Finance know. It is used to generate the QR Code of the NFC-e and ensure the
  authenticity of the DANFE.

.. note::
   The information required for these fields can be generated through the SEFAZ website of each
   Brazilian State by the company's accountant.

.. _localizations/brazil/pos-product:

Product configuration
---------------------

Access the relevant :doc:`product form in POS <../../sales/point_of_sale/configuration>`, then
configure the :ref:`product <localizations/brazil/products>`'s :guilabel:`Brazil Accounting`
fields.

.. _localizations/brazil/pos-shop-configuration:

Point of sale
-------------

Go to :menuselection:`Point of Sale --> Configuration --> Settings` and make sure that the relevant
Point of Sale is :doc:`selected at the top of the screen <../../sales/point_of_sale/configuration>`.
Then, scroll to the :guilabel:`Accounting` section and configure the :guilabel:`Brazilian EDI`
fields:

- :guilabel:`Series`
- :guilabel:`Next number`: the next NFC-e number in the sequence to be issued, for instance, if the
  last number issued in SEFAZ is `100`, the *Next number* will be `101`.

.. _localizations/brazil/pos-workflow:

Workflow
--------

.. _localizations/brazil/generate-nfc-e:

Generating an NFC-e
~~~~~~~~~~~~~~~~~~~

To generate an NFC-e, follow these steps:

#. :ref:`Open the relevant point of sale shop and make a sale <pos/session-start>`.
#. Validate the payment to calculate taxes and issue an NFC-e. The valid NFC-e appears on the right
   side of the screen.

.. image:: brazil/l10n-br-nfce-succesfully-issued.png
   :alt: NFC-e Success in a POS session.

.. note::
   It is also possible to issue an NFC-e that identifies the customer by their CPF/CNPJ. To do
   so, click :icon:`fa-user` :guilabel:`Customer`, search for the customer, or create a new one.

   The following are mandatory fields to issue a CPF/CNPJ identified NFC-e:

   - :guilabel:`Name`
   - :guilabel:`City` and :guilabel:`State` where the invoice is being issued
   - :guilabel:`CPF/CNPJ`

#. Click :guilabel:`Validate`. The NFC-e appears, highlighting the customer's CPF on the print.
#. Click :guilabel:`Print` or :guilabel:`Send via e-mail` to deliver the invoice to the customer.

.. _localizations/brazil/nfc-e-print:

NFC-e ticket print
~~~~~~~~~~~~~~~~~~

After :ref:`generating and validating the NFC-e <localizations/brazil/generate-nfc-e>`, click
:guilabel:`Print` to deliver the invoice.

.. note::
   The Odoo NFC-e feature is compatible with any thermal printer and does not require an :doc:`Odoo
   IoT Box <../../general/iot>`.

.. _localizations/brazil/order-with-nfc-e-error:

Re-issuing a PoS order with an NFC-e error
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

If the NFC-e returns an error, follow these steps:

#. Correct the error.
#. Re-issue the NFC-e by clicking the :icon:`fa-bars` :guilabel:`(menu)` icon and selecting
   :guilabel:`Orders`.
#. Filter the list to show only :guilabel:`Paid` orders and click :guilabel:`Details`. The error is
   displayed.
#. Click :guilabel:`Send NFC-e`.

.. note::
   If the error has been corrected and the PoS session is closed, Odoo logs the tax adjustment in
   the chatter of the related journal entry. The journal entry for the order indicates that the
   taxes were incorrectly calculated. In this case, reprocessing the NFC-e is required.

.. image:: brazil/l10n-br-order-error-screen.png
   :alt: Point of sale order view form.

.. _localizations/brazil/nfc-e-refunds-cancellations:

NFC-e refunds & cancellations
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

:ref:`Refunds can be processed directly in Odoo <pos/refund>`, but *cancellations* must be performed
through the official government portal.

When the process is finalized, the approved return NF-e is created, meaning the **previous NFC-e is
canceled**.

.. image:: brazil/l10n-br-return-succeed.png
   :alt: Return of Goods NF-e Approved.

.. important::
   SEFAZ only allows cancellation of an NFC-e **within 30 minutes** of its issuance on the SEFAZ
   website. After this period, a manual refund must be processed, along with the issuance of a
   *Return of Goods NF-e*.


==================================================
SECTION: canada.rst
PATH: applications/finance/fiscal_localizations/canada.rst
==================================================

======
Canada
======

.. |COA| replace:: :abbr:`CoA (Chart of Accounts)`
.. |AR| replace:: :abbr:`AR (Accounts Receivable)`
.. |AP| replace:: :abbr:`AP (Accounts Payable)`

The Odoo Canada localization package provides tailored features and configurations for Canadian
businesses.

A series of videos on the subject of Accounting are available through Odoo's eLearning platform.
These videos cover how to start from scratch, set up configurations, complete common workflows, and
provide in-depth looks at some specific use cases.

.. seealso::
   - `Odoo Tutorials: Accounting & Invoicing
     <https://www.odoo.com/slides/accounting-and-invoicing-19>`_
   - `Odoo SmartClass: Accounting <https://www.odoo.com/slides/smartclass-accounting-121>`_

Configuration
=============

Below are the available modules in Odoo for accounting use in Canada.

Modules installation
--------------------

:ref:`Install <general/install>` the following modules to get all the features of the Canadian
localization:

.. list-table::
   :header-rows: 1
   :widths: 25 25 50

   * - Name
     - Technical name
     - Description
   * - :guilabel:`Canada - Accounting`
     - `l10n_ca`
     - Base accounting module for Canadian localization.
   * - :guilabel:`Canada - Accounting Reports`
     - `l10n_ca_reports`
     - Adds Canadian accounting reports.
   * - :guilabel:`Canadian Checks Layout`
     - `l10n_ca_check_printing`
     - Enables the printing of payments on pre-printed check paper. Supports the three most common
       check formats and works natively with the linked checks from `checkdepot.net
       <https://checkdepot.net/collections/computer-checks/Odoo>`_.

       - `Check on top: Quicken / QuickBooks standard
         <https://checkdepot.net/collections/computer-checks/odoo+top-check>`_
       - `Check on middle: Peachtree standard
         <https://checkdepot.net/collections/computer-checks/odoo+middle-check>`_
       - `Check on bottom: ADP standard
         <https://checkdepot.net/collections/computer-checks/odoo+Bottom-Check>`_

.. _l10n_ca/coa:

Chart of accounts
=================

The :doc:`chart of accounts (COA) <../accounting/get_started/chart_of_accounts>` for the Canadian
localization, in Odoo, has accounts grouped into seven main categories, with corresponding numeric
values that prefix individual journal entries:

- **Receivable**: the balance of money (or credit) due to the business for goods or services
  delivered or used, but not yet paid for by customers. |AR| is indicated by the journal code
  labeled (or beginning) with :guilabel:`1`.
- **Payable**: the business's short-term obligations owed to its creditors or suppliers, which have
  not yet been paid. |AP| is indicated by the journal code labeled (or beginning) with
  :guilabel:`2`.
- **Equity**: the amount of money that would be returned to a company's shareholders if all of the
  assets were liquidated and all of the company's debt was paid off in the case of liquidation.
  Equity is indicated by the journal code labeled (or beginning) with :guilabel:`3` or
  :guilabel:`9`.
- **Assets**: items listed on the balance sheet that contains economic value or have the ability to
  generate cash flows in the future, such as a piece of machinery, a financial security, or a
  patent. Assets are indicated by the journal code labeled (or beginning) with :guilabel:`1`.
- **Liability**: refers to a company's financial debts or obligations that arise during the course
  of business operations. Liabilities are indicated by the journal code labeled (or beginning) with
  :guilabel:`2`.
- **Income**: synonymous with *net income*, this is the profit a company retains after paying off
  all relevant expenses from sales revenue earned. Income is indicated by the journal code labeled
  (or beginning) with :guilabel:`4` or :guilabel:`6`.
- **Expenses**: the cost of operations that a company incurs to generate revenue. Expenses are
  indicated by the journal code labeled (or beginning) with a :guilabel:`6`.

.. tip::
   Predefined accounts are included in Odoo, as part of the |COA| that's installed with the Canadian
   localization package. The accounts listed below are preconfigured to perform certain operations
   within Odoo. It is recommended to **not** delete these accounts; however, if changes are needed,
   rename the accounts instead.

   .. list-table::
      :header-rows: 1
      :stub-columns: 1

      * - :guilabel:`Type`
        - :guilabel:`Account Name`
      * - :guilabel:`Current Assets`
        - | :guilabel:`Bank Suspense Account`
          | :guilabel:`Outstanding Receipts`
          | :guilabel:`Outstanding Payments`
          | :guilabel:`Liquidity Transfer`
          | :guilabel:`Stock Valuation`
          | :guilabel:`Stock Interim (Received)`
          | :guilabel:`Stock Interim (Delivered)`
          | :guilabel:`Cost of Production`
      * - :guilabel:`Income`
        - | :guilabel:`Foreign Exchange Gain`
          | :guilabel:`Cash Difference Gain`
          | :guilabel:`Cash Discount Gain`
      * - :guilabel:`Expenses`
        - | :guilabel:`Cash Discount Loss`
          | :guilabel:`Foreign Exchange Loss`
          | :guilabel:`Cash Difference Loss`
      * - :guilabel:`Current Year Earnings`
        - :guilabel:`Undistributed Profits/Losses`
      * - :guilabel:`Receivable`
        - :guilabel:`Account Receivable`
      * - :guilabel:`Payable`
        - :guilabel:`Account Payable`

.. seealso::
   - :doc:`../accounting/get_started/chart_of_accounts`
   - :doc:`../accounting/get_started/cheat_sheet`

.. _l10n_ca/fiscal-positions:

Fiscal positions
================

Canadian tax rates and taxable items vary by province and territory. Default fiscal positions are
automatically created when the Odoo **Accounting** application is installed. To manage or configure
additional fiscal positions, navigate to :menuselection:`Accounting --> Configuration --> Fiscal
Positions`.

The following fiscal positions are available by default:

- :guilabel:`Alberta (AB)`
- :guilabel:`British Columbia (BC)`
- :guilabel:`Manitoba (MB)`
- :guilabel:`New Brunswick (NB)`
- :guilabel:`Newfoundland and Labrador (NL)`
- :guilabel:`Nova Scotia (NS)`
- :guilabel:`Northwest Territories (NT)`
- :guilabel:`Nunavut (NU)`
- :guilabel:`Ontario (ON)`
- :guilabel:`Prince Edward Islands (PE)`
- :guilabel:`Quebec (QC)`
- :guilabel:`Saskatchewan (SK)`
- :guilabel:`Yukon (YT)`
- :guilabel:`International (INTL)`

.. image:: canada/l10n-ca-fiscal-positions.png
   :alt: The default fiscal positions for the Canada localization in Odoo Accounting.

.. note::
   When considering what taxes to be applied, it is the province where the delivery occurs that
   matters. Therefore, delivery is the responsibility of the vendor and is accounted for at the
   customer location.

.. example::
   - A delivery is made to a customer from another province.
        Set the fiscal position on the customer's record to the province of the customer.
   - A customer from another province comes to pick up products.
        No fiscal position should be set on the customer's record.
   - An international vendor doesn't charge any tax, but taxes are charged by the customs broker.
        Set the fiscal position on the vendor's record to *International*.
   - An international vendor charges provincial tax.
        Set the fiscal position on the vendor's record to your position.

.. seealso::
   :doc:`../accounting/taxes/fiscal_positions`

.. _l10n_ca/taxes:

Taxes
=====

In Canada, tax rates and what is considered taxable vary by province and territory. Default *Sales*
and *Purchases* taxes are created automatically when the Odoo **Accounting** application is
installed. To manage existing or configure additional taxes, navigate to :menuselection:`Accounting
--> Configuration --> Taxes`.

.. _l10n_ca/taxes-avatax:

AvaTax
------

**Avalara AvaTax** is a cloud-based tax calculation and compliance software that integrates with
Odoo for several localizations, including Canada. Integrating AvaTax with Odoo provides real-time
and region-specific tax calculations when items are sold, purchased, and invoiced in the database.

.. important::
   AvaTax is available for integration with databases/companies that have locations in Canada and/or
   the United States. Reference the :ref:`accounting/avatax/fiscal_country` documentation for more
   information.

.. seealso::
   Refer to the documentation articles below to integrate and configure an AvaTax account with an
   Odoo database:

   - :doc:`AvaTax integration <../accounting/taxes/avatax>`
   - :doc:`Avalara management portal <../accounting/taxes/avatax/avalara_portal>`
   - :doc:`Calculate taxes with AvaTax <../accounting/taxes/avatax/avatax_use>`
   - Avalara's support documents: `About AvaTax
     <https://community.avalara.com/support/s/document-item?language=en_US&bundleId=dqa1657870670369_dqa1657870670369&topicId=About_AvaTax.html&_LANG=enus>`_

.. _l10n_ca/reports:

Reports
=======

A number of :doc:`report selections <../accounting/reporting>` are readily available for the
Canadian localization, under the :menuselection:`Accounting app --> Reporting` drop-down menu:

- :ref:`Balance Sheet <accounting/reporting/balance-sheet>`: a "snapshot" of a company's financial
  position at a specific point in time, which contains an overview of a company's assets,
  liabilities, and equity.

  Be sure to select the :menuselection:`Balance sheet (CA)` option from the :icon:`fa-book`
  :guilabel:`Report` filter.

  .. image:: canada/l10n-ca-balance-sheet.png
     :alt: Balance sheet report selection for CA localization in Odoo.

- :ref:`Profit & Loss <accounting/reporting/balance-sheet>`: otherwise known as a *P&L statement* or
  *income statement*, provides a summary of a company's revenues, expenses, and profits/losses over
  a given period of time.

  Be sure to select the :menuselection:`Profit and loss (CA)` option from the :icon:`fa-book`
  :guilabel:`Report` filter.

  .. image:: canada/l10n-ca-profit-loss.png
     :alt: Profit and loss report selection for CA localization in Odoo.

- :guilabel:`Cash Flow Statement`: shows how much cash and cash equivalents a company has received
  and spent in a given period.
- :ref:`Executive Summary <accounting/reporting/executive-summary>`: an overview report that covers
  the key performance indicators of a company's financial position, such as revenue, profit, and
  debt.
- :ref:`Tax Report <accounting/reporting/tax-report>`: an official form filed for a tax authority
  that reports income, expenses, and other pertinent tax information. Tax reports allow taxpayers to
  calculate their tax liability, schedule tax payments, or request refunds for the overpayment of
  taxes. In Odoo, the tax report can be made monthly, every two months, quarterly, every 4 months,
  semi-annually, and annually.

.. seealso::
   - :doc:`Accounting reporting <../accounting/reporting>`
   - :doc:`../../essentials/search`

.. _l10n_ca/cash-discount:

Cash discount
=============

Cash discounts can be configured from :menuselection:`Accounting app --> Payment Terms`. Each
payment term can be set up with a cash discount and reduced tax.

.. seealso::
   :doc:`../accounting/customer_invoices/cash_discounts`

Writing checks
==============

The Canadian localization allows users to print checks for vendor payments. Be sure the *Canadian
Checks Layout* (`l10n_ca_check_printing`) module for the CA localization is :ref:`installed
<general/install>`.

To enable check printing from Odoo, navigate to :menuselection:`Accounting --> Configuration -->
Settings` and find the :guilabel:`Vendor Payments` section. From here, tick the :guilabel:`Checks`
checkbox to reveal several fields for check configuration.

Select a :guilabel:`Check Layout` from the drop-down menu:

- :guilabel:`Print Check (Top) - CA`
- :guilabel:`Print Check (Middle) - CA`
- :guilabel:`Print Check (Bottom) - CA`

Next, choose whether or not to enable the :guilabel:`Multi-Pages Check Stub` checkbox.

Optionally set a :guilabel:`Check Top Margin`, :guilabel:`Check Left Margin`, or :guilabel:`Check
Right Margin` if required.

Tick the :guilabel:`Print Date Label` checkbox if a date label is required.

Once all check configurations are complete, :guilabel:`Save` the settings.

.. tip::
   Some of the check formats may require pre-printed paper from a third party vendor.
   `Pre-printed checks from checkdepot.net <https://checkdepot.net/collections/odoo-checks>`_ are
   recommended.

.. seealso::
   :doc:`../accounting/payments/pay_checks`


==================================================
SECTION: chile.rst
PATH: applications/finance/fiscal_localizations/chile.rst
==================================================

=====
Chile
=====

.. tip::
   Watch the two webinar recordings below for a general presentation of the localization, and search
   the playlist for tutorials to discover practical workflows while using Odoo in Chile.

   - `Webinar: intro and demo <https://youtu.be/BHnByZiyYcM>`_.
   - `Webinar: delivery guide <https://youtu.be/X7i4PftnEdU>`_.
   - `Playlist of tutorials
     <https://youtube.com/playlist?list=PL1-aSABtP6AB6UY7VUFnVgeYOaz33fb4P>`_.

.. seealso::
   - `Chilean localization app tour <https://www.youtube.com/watch?v=3qYkgbmBYHw>`_
   - `Chilean localization smart tutorial
     <https://www.odoo.com/slides/smart-tutorial-localizacion-de-chile-131>`_
   - :doc:`Documentation on e-invoicing's legality and compliance in Chile
     <../accounting/customer_invoices/electronic_invoicing/chile>`

.. _chile/configuration:

Modules
=======

:ref:`Install <general/install>` the following modules to utilize all the features of the Chilean
localization.

.. list-table::
   :header-rows: 1

   * - Name
     - Technical name
     - Description
   * - :guilabel:`Chile - Accounting`
     - `l10n_cl`
     - Adds the minimal accounting features required for a company to operate in Chile under the
       :abbr:`SII (Servicio de Impuestos Internos)` regulations and guidelines.
   * - :guilabel:`Chile - Accounting Reports`
     - `l10n_cl_reports`
     - Adds the *Propuesta F29* and *Balance Tributario (8 columnas)* reports.
   * - :guilabel:`Chile - E-invoicing`
     - `l10n_cl_edi`
     - Includes all technical and functional requirements to receive and generate **electronic
       receipts** and **invoices** online based on the :abbr:`SII (Servicio de Impuestos Internos)`
       regulations.
   * - :guilabel:`Electronic Exports of Goods for Chile`
     - `l10n_cl_edi_exports`
     - Includes technical and functional requirements to generate electronic invoices for exporting
       goods based on the :abbr:`SII (Servicio de Impuestos Internos)` and customs regulations.
   * - :guilabel:`Chile - E-Invoicing Delivery Guide`
     - `l10n_cl_edi_stock`
     - Includes all technical and functional requirements to generate delivery guides via web
       service based on the :abbr:`SII (Servicio de Impuestos Internos)` regulations.

.. note::
   - Odoo automatically installs the appropriate package for the company according to the country
     selected at the creation of the database.
   - The *Chile - E-Invoicing Delivery Guide* module depends on the *Inventory* application.

.. important::
   All features are only available if the company already completed the `SII Sistema de Facturación
   de Mercado <https://www.sii.cl/factura_electronica/factura_mercado/proceso_certificacion.htm>`_
   certification process.

Company information
===================

Navigate to :menuselection:`Settings --> Companies: Update Info` and ensure the following company
information is up-to-date and correctly filled in:

- :guilabel:`Company Name`
- :guilabel:`Address`:

  - :guilabel:`Street`
  - :guilabel:`City`
  - :guilabel:`State`
  - :guilabel:`ZIP`
  - :guilabel:`Country`

- :guilabel:`Tax ID`: enter the identification number for the selected :ref:`Taxpayer Type
  <chile/fiscal-info>`.
- :guilabel:`Activity Names`: select up to four activity codes.
- :guilabel:`Company Activity Description`: enter a short description of the company's activity.

Accounting settings
===================

Next, navigate to :menuselection:`Accounting --> Configuration --> Settings --> Chilean
Localization` and follow the instructions to configure the:

- :ref:`Fiscal information <chile/fiscal-info>`
- :ref:`Electronic invoice data <chile/electronic-invoice>`
- :ref:`DTE incoming email server <chile/dte-email>`
- :ref:`Signature certificates <chile/certificate>`

.. _chile/fiscal-info:

Fiscal information
------------------

Configure the following :guilabel:`Tax payer information`:

- :guilabel:`Taxpayer Type` by selecting the taxpayer type that applies:

  - :guilabel:`VAT Affected (1st Category)`: for invoices that charge taxes to customers
  - :guilabel:`Fees Receipt Issuer (2nd Category)`: for suppliers who issue fees receipt (Boleta)
  - :guilabel:`End consumer`: only issues receipts
  - :guilabel:`Foreigner`

- :guilabel:`SII Office`: select your company's :abbr:`SII (Servicio de Impuestos Internos)`
  regional office

.. _chile/electronic-invoice:

Electronic invoice data
-----------------------

Select your :guilabel:`SII Web Services` environment:

- :guilabel:`SII - Test`: for test databases using test :abbr:`CAFs (Folio
  Authorization Code)` obtained from the :abbr:`SII (Servicio de Impuestos Internos)`. In this mode,
  the direct connection flows can be tested, with the files being sent to the :abbr:`SII (Servicio
  de Impuestos Internos)`.
- :guilabel:`SII - Production`: for production databases.
- :guilabel:`SII - Demo Mode`: files are created and accepted automatically in demo mode but are
  **not** sent to the :abbr:`SII (Servicio de Impuestos Internos)`. For this reason, rejection
  errors or *Accepted with Objections* will not appear in this mode. Every internal validation can
  be tested in demo mode. Avoid selecting this option in a production database.

Then, enter the :guilabel:`Legal Electronic Invoicing Data`:

- :guilabel:`SII Resolution N°`
- :guilabel:`SII Resolution Date`

.. image:: chile/electronic-invoice-data.png
   :alt: Required information for electronic invoice.
   :align: center

.. _chile/dte-email:

DTE incoming email server
=========================

The :abbr:`DTE (Documentos Tributarios Electrónicos)` :guilabel:`Email Box Electronic Invoicing` can
be defined to receive your customers' claim and acceptance emails. Enabling this option from
:menuselection:`Accounting --> Configuration --> Settings --> Chilean Localization` is necessary if
you want to use *Email Box Electronic Invoicing* as the :abbr:`DTE (Documentos Tributarios
Electrónicos)` incoming email server.

.. important::
   In order to receive your SII documents, it's necessary to set up your own email server. More
   information on how to do this can be found in this documentation:
   :doc:`../../general/email_communication`

Begin by clicking :guilabel:`Configure DTE Incoming Email`, then click :guilabel:`New` to add a
server and fill in the following fields:

- :guilabel:`Name`: give the server a name.
- :guilabel:`Server Type`: select the server type used.

  - :guilabel:`IMAP Server`
  - :guilabel:`POP Server`
  - :guilabel:`Local Server`: uses a local script to fetch emails and create new records. The
    script can be found in the :guilabel:`Configuration` section with this option selected.
  - :guilabel:`Gmail OAuth Authentication`: requires your Gmail API credentials to be configured in
    the general settings. A direct link to the configuration can be found in the :guilabel:`Login
    Information` section.

- :guilabel:`DTE Server`: enable this option. By checking this option, this email account will be
  used to receive the electronic invoices from the suppliers, and communications from the :abbr:`SII
  (Servicio de Impuestos Internos)` regarding the electronic invoices issued. In this case, this
  email should match both emails declared on the :abbr:`SII (Servicio de Impuestos Internos)` site
  in the section: *ACTUALIZACION DE DATOS DEL CONTRIBUYENTE*, *Mail Contacto SII* and *Mail Contacto
  Empresas*.

In the :guilabel:`Server & Login` tab (for IMAP and POP servers):

- :guilabel:`Server Name`: enter the hostname or IP of the server.
- :guilabel:`Port`: enter the server port.
- :guilabel:`SSL/TLS`: enable this option if connections are encrypted using the SSL/TLS protocol.
- :guilabel:`Username`: enter the server login username.
- :guilabel:`Password`: enter the server login password.

.. image:: chile/dte-incoming-email.png
   :alt: Incoming email server configuration for Chilean DTE.
   :align: center

.. tip::
   Before going live, it is recommended to archive or remove all emails related to vendor bills that
   are not required to be processed in Odoo from your inbox.

.. _chile/certificate:

Certificate
-----------

A digital certificate in `.pfx` format is required to generate the electronic invoice signature. To
add one, click :guilabel:`Configure Signature Certificates` under the :guilabel:`Signature
Certificates` section. Then, click :guilabel:`New` to configure the certificate:

- :guilabel:`Certificate Key`: click :guilabel:`Upload your file` and select the `.pfx` file.
- :guilabel:`Certificate Passkey`: enter the file's passphrase.
- :guilabel:`Subject Serial Number`: depending on the certificate format, the field might not be
  automatically populated. In that case, enter the certificate's legal representative :abbr:`RUT
  (Rol Único Tributario)`.
- :guilabel:`Certificate Owner`: select one if you need to restrict the certificate for a specific
  user. Leave the field empty to share it with all billing users.

.. image:: chile/new-certificate.png
   :alt: Digital certificate configuration.
   :align: center

.. warning::
   If the :guilabel:`Certificate Owner` field is set to a specific user, and there are no
   certificates shared with users, then the automatic sending of electronic documents and receipt
   acknowledgments is **disabled**.

Multicurrency
=============

The official currency rate is provided by `Chilean mindicador.cl <https://mindicador.cl>`_. Navigate
to :menuselection:`Accounting --> Configuration --> Settings --> Currencies: Automatic Currency
Rates` to set an :guilabel:`Interval` for when the rate is automatically updated, or to select
another :guilabel:`Service`.

.. _chile/partner-information:

Partner information
===================

Configuring partner contacts is also required to send :abbr:`SII (Servicio de Impuestos Internos)`
electronic invoices. Open the :menuselection:`Contacts` app to do so and fill in the following
fields on a new or existing contact form.

- :guilabel:`Name`
- :guilabel:`Email`
- :guilabel:`Identification Number`
- :guilabel:`Taxpayer Type`
- :guilabel:`Activity Description`

In the :guilabel:`Electronic Invoicing` tab:

- :guilabel:`DTE Email`: enter the sender's email address for the partner.
- :guilabel:`Delivery Guide Price`: select which price the delivery guide displays, if any.

.. note::
   The :guilabel:`DTE Email` is the email used for sending electronic documents and must be set in
   the contact that will be part of an electronic document.

.. image:: chile/dte-email-electronic-invoice.png
   :alt: Chilean electronic invoice data for partners.
   :align: center

Document types
==============

Accounting documents are categorized by :abbr:`SII (Servicio de Impuestos Internos)`-defined
document types.

Document types are created automatically upon installation of the localization module, and can be
managed by navigating to :menuselection:`Accounting --> Configuration --> Document Types`.

.. image:: chile/chilean-document-types.png
   :alt: Chilean fiscal document types list.
   :align: center

.. note::
   Several document types are inactive by default but can be activated by toggling the
   :guilabel:`Active` option.

Use on invoices
---------------

The document type on each transaction is determined by:

- The journal related to the invoice, identifying if the journal uses documents.
- The condition applied based on the type of issuer and recipient (e.g., the buyer or vendor's
  fiscal regime).

Journals
========

*Sales journals* in Odoo usually represent a business unit or location.

.. example::
   - Ventas Santiago.
   - Ventas Valparaiso.

For retail stores it is common to have one journal per :abbr:`POS (Point of Sale)`.

.. example::
   - Cashier 1.
   - Cashier 2.

The *purchase* transactions can be managed with a single journal, but sometimes companies use more
than one journal in order to handle some accounting transactions that are not related to vendor
bills. This configuration can easily be set by using the following model.

.. example::
   - Tax payments to the government.
   - Employees payments.

Create a sales journal
----------------------

To create a sales journal, navigate to :menuselection:`Accounting --> Configuration --> Journals`.
Then, click the :guilabel:`New` button, and fill in the following required information:

- :guilabel:`Type`: select :guilabel:`Sale` from the drop-down menu for customer invoice journals.
- :guilabel:`Point of sale type`: if the sales journal will be used for electronic documents, the
  option :guilabel:`Online` must be selected. Otherwise, if the journal is used for invoices
  imported from a previous system or if you are using the :abbr:`SII (Servicio de Impuestos
  Internos)` portal *Facturación MiPyme*, you can use the option :guilabel:`Manual`.
- :guilabel:`Use Documents`: check this field if the journal will use document types. This field is
  only applicable to purchase and sales journals that can be related to the different sets of
  document types available in Chile. By default, all the sales journals created will use documents.

Next, from the :guilabel:`Jounal Entries` tab, define the :guilabel:`Default Income Account` and
:guilabel:`Dedicated Credit Note Squence` in the :guilabel:`Accounting Information` section.
Configuring these fields is required for one of the debit notes :ref:`use cases <chile/use-cases>`.

.. _chile/caf-documentation:

CAF
===

A *folio authorization code* (CAF) is required for each document type that will be issued
electronically. The :abbr:`CAF (Folio Authorization Code)` is a file the :abbr:`SII (Servicio de
Impuestos Internos)` provides to the issuer with the folios/sequences authorized for the electronic
invoice documents.

Your company can request multiple folios and obtain several :abbr:`CAFs (Folio Authorization Codes)`
linked to different folio ranges. These :abbr:`CAFs (Folio Authorization Code)` are shared within
all journals, so you only need one active :abbr:`CAF (Folio Authorization Code)` per document type,
and it will be applied to all journals.

Please refer to the `SII documentation <https://palena.sii.cl/dte/mn_timbraje.html>`_ to check the
details on how to acquire the :abbr:`CAF (Folio Authorization Code)` files.

.. important::
   The :abbr:`CAFs (Folio Authorization Code)` required by the :abbr:`SII (Servicio de Impuestos
   Internos)` are different from production to test (certification mode). Make sure you have the
   correct :abbr:`CAF (Folio Authorization Code)` set depending on your environment.

Upload CAF files
----------------

Once the :abbr:`CAF (Folio Authorization Code)` files have been acquired from the :abbr:`SII
(Servicio de Impuestos Internos)` portal, they need to be uploaded in the database by navigating to
:menuselection:`Accounting --> Configuration: Chilean SII --> CAFs`. Then, click the :guilabel:`New`
begin the configuration. On the :abbr:`CAF (Folio Authorization Code)` form, upload your :abbr:`CAF
(Folio Authorization Code)` file by clicking the :guilabel:`Upload your file` button and then click
:guilabel:`Save`.

Once uploaded, the status changes to :guilabel:`In Use`. At this moment, when a transaction is used
for this document type, the invoice number takes the first folio in the sequence.

.. important::
   The document types have to be active before uploading the :abbr:`CAF (Folio Authorization Code)`
   files. In case some folios have been used in the previous system, the next valid folio has to be
   set when the first transaction is created.

Chart of accounts
=================

The chart of accounts is installed by default as part of the data set included in the localization
module. The accounts are mapped automatically in:

- Taxes
- Default Account Payable
- Default Account Receivable
- Transfer Accounts
- Conversion Rate

.. seealso::
   :doc:`../accounting/get_started/chart_of_accounts`

Taxes
=====

As part of the localization module, taxes are created automatically with their related financial
account and configuration. These taxes can be managed from :menuselection:`Accounting -->
Configuration --> Taxes`.

Chile has several tax types, the most common ones are:

- **VAT**: the regular VAT can have several rates.
- **ILA**: the tax for alcoholic drinks.

.. seealso::
   :doc:`../accounting/taxes`

Usage and testing
=================

Electronic invoice workflow
---------------------------

In the Chilean localization, the electronic invoice workflow includes customer invoice issuance and
vendor bill reception. The following diagram explains how information is shared to the :abbr:`SII
(Servicio de Impuestos Internos)`, customers, and vendors.

.. image:: chile/electronic-invoice-workflow.png
   :alt: Diagram with Electronic invoice transactions.
   :align: center

Customer invoice emission
-------------------------

After the partners and journals are created and configured, the invoices are created in the standard
way. For Chile, one of the differences is the document type that is automatically selected based on
the taxpayer. The document type can be changed manually if needed on the invoice by navigating to
:menuselection:`Accounting --> Customers --> Invoices`.

.. image:: chile/customer-invoice-document-type.png
   :alt: Customer invoice document type selection.
   :align: center

.. important::
   :guilabel:`Documents type 33` electronic invoice must have at least one item with tax, otherwise
   the :abbr:`SII (Servicio de Impuestos Internos)` rejects the document validation.

.. _chile/electronic-invoice-validation:

Validation and DTE status
~~~~~~~~~~~~~~~~~~~~~~~~~

Once all invoice information is filled, either manually or automatically when generated from a sales
order, validate the invoice. After the invoice is posted:

- The :abbr:`DTE (Documentos Tributarios Electrónicos)` file is created automatically and recorded
  in the chatter.
- The :abbr:`DTE (Documentos Tributarios Electrónicos)` :abbr:`SII (Servicio de Impuestos Internos)`
  status is set as :guilabel:`Pending` to be sent.

  .. image:: chile/xml-creation.png
     :alt: DTE XML File displayed in chatter.
     :align: center

The :abbr:`DTE (Documentos Tributarios Electrónicos)` status is updated automatically by Odoo with a
scheduled action that runs every day at night, if the response from the :abbr:`SII (Servicio de
Impuestos Internos)` is needed immediately, you can do it manually as well by following the
:abbr:`DTE (Documentos Tributarios Electrónicos)` status workflow:

.. image:: chile/dte-status-flow.png
   :alt: Transition of DTE status flow.
   :align: center

#. The first step is to send the :abbr:`DTE (Documentos Tributarios Electrónicos)` to the :abbr:`SII
   (Servicio de Impuestos Internos)`. This can be sent manually by clicking the :guilabel:`Enviar
   Ahora` button. This generates a :guilabel:`SII Tack number` for the invoice, which is used to
   check the details sent by the :abbr:`SII (Servicio de Impuestos Internos)` via email. Then, the
   :guilabel:`DTE status` is updated to :guilabel:`Ask for Status`.
#. Once the :abbr:`SII (Servicio de Impuestos Internos)` response is received, Odoo updates the
   :guilabel:`DTE status`. To do it manually, click on the button :guilabel:`Verify on SII`. The
   result can either be :guilabel:`Accepted`, :guilabel:`Accepted With Objection` or
   :guilabel:`Rejected`.

   .. image:: chile/dte-status-steps.png
      :alt: Identification transaction for invoice and Status update.
      :align: center

   .. important::
      There are intermediate statuses in the :abbr:`SII (Serviciqo de Impuestos Internos)` before
      acceptance or rejection. It's recommended to **NOT** continuously click :guilabel:`Verify in
      SII` for smooth processing.

      .. image:: chile/chatter-internal-statuses.png
         :alt: Electronic invoice data statuses.
         :align: center

#. The final response from the :abbr:`SII (Servicio de Impuestos Internos)` can take on one of these
   values:

   - :guilabel:`Accepted`: indicates the invoice information is correct, our document is now
     fiscally valid and it's automatically sent to the customer.
   - :guilabel:`Accepted with objections`: indicates the invoice information is correct, but a minor
     issue was identified, nevertheless the document is now fiscally valid and it's automatically
     sent to the customer.
   - :guilabel:`Rejected`: indicates the invoice information is incorrect and must be corrected.
     Details are sent to emails you registered in the :abbr:`SII (Servicio de Impuestos Internos)`.
     If it is properly configured in Odoo, the details are also retrieved in the chatter once the
     email server is processed.

     If the invoice is rejected please follow these steps:

     #. Change the document to :guilabel:`Draft`.
     #. Make the required corrections based on the message received from the :abbr:`SII (Servicio
        de Impuestos Internos)` in the chatter.
     #. Post the invoice again.

     .. image:: chile/rejected-invoice.png
        :alt: Message when an invoice is rejected.
        :align: center

Crossed references
~~~~~~~~~~~~~~~~~~

When the invoice is created, as a result of another fiscal document, the information related to the
originator document must be registered in the :guilabel:`Cross-Reference` tab. This tab is commonly
used for credit or debit notes, however, in some cases it can be used for customer invoices, as
well. In the case of the credit and debit notes, they are set automatically by Odoo.

.. image:: chile/cross-reference-tab-registration.png
   :alt: Crossed referenced document(s).
   :align: center

.. _chile/electronic-invoice-pdf-report:

Invoice PDF report
~~~~~~~~~~~~~~~~~~

Once the invoice is accepted and validated by the :abbr:`SII (Servicio de Impuestos Internos)` and
the PDF is printed, it includes the fiscal elements that indicate that the document is fiscally
valid.

.. image:: chile/accepted-invoice-fiscal-information.png
   :alt: Fiscal elements and barcode printed in accepted invoices.

.. important::
   If you are hosted in Odoo SH or On-Premise, you should manually install the `pdf417gen
   <https://pypi.org/project/pdf417gen/>`_ library. Use the following command to install it:
   :command:`pip install pdf417gen`.

Commercial validation
~~~~~~~~~~~~~~~~~~~~~

Once the invoice has been sent to the customer:

#. :guilabel:`DTE Partner Status` changes to :guilabel:`Sent`.
#. The customer must send a reception confirmation email.
#. Subsequently, if commercial terms and invoice data are correct, an acceptance confirmation is
   sent; otherwise, a claim is sent.
#. The field :guilabel:`DTE Acceptance Status` is updated automatically.

.. image:: chile/partner-dte-status.png
   :alt: Message with the commercial acceptance from the customer.
   :align: center

Processed for claimed invoices
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Once the invoice has been accepted by the :abbr:`SII (Servicio de Impuestos Internos)`, **it can not
be cancelled in Odoo**. In case you get a claim for your customer, the correct way to proceed is
with a credit note to either cancel the invoice or correct it. Please refer to the
:ref:`chile/credit-notes` section for more details.

.. image:: chile/accepted-invoice.png
   :alt: Invoice Commercial status updated to claimed.
   :align: center

Common errors
~~~~~~~~~~~~~

There are multiple reasons behind a rejection from the :abbr:`SII (Servicio de Impuestos Internos)`,
but these are some of the common errors you might have and how to solve them:

- | **Error:** `RECHAZO- DTE Sin Comuna Origen`
  | **Hint:** make sure the company address is properly filled including the state and city.
- | **Error:** `en Monto - IVA debe declararse`
  | **Hint:** the invoice lines should include one VAT tax, make sure you add one on each invoice
    line.
- | **Error:** `Rut No Autorizado a Firmar`
  | **Hint:** the :abbr:`RUT (Rol Único Tributario)` entered is not allowed to invoice
    electronically, make sure the company :abbr:`RUT (Rol Único Tributario)` is correct and is valid
    in the :abbr:`SII (Servicio de Impuestos Internos)` to invoice electronically.
- | **Error:** `Fecha/Número Resolucion Invalido RECHAZO- CAF Vencido : (Firma_DTE[AAAA-MM-DD] -
    CAF[AAAA-MM-DD]) &gt; 6 meses`
  | **Hint:** try to add a new CAF related to this document as the one you're using is expired.
- | **Error:** `Element '{http://www.sii.cl/SiiDte%7DRutReceptor': This element is not expected.
    Expected is ( {http://www.sii.cl/SiiDte%7DRutEnvia ).`
  | **Hint:** Make sure the field :guilabel:`Document Type` and :guilabel:`VAT` are set in the
    customer and in the main company.
- | **Error:** `Usuario sin permiso de envio.`
  | **Hint:** this error indicates that most likely, your company has not passed the `Certification
    process <https://www.sii.cl/factura_electronica/factura_mercado/proceso_certificacion.htm>`_ in
    the :abbr:`SII (Servicio de Impuestos Internos)` - Sistema de Facturación de Mercado. If this is
    the case, please contact your Account Manager or Customer Support as this certification is not
    part of the Odoo services, but we can give you some alternatives. If you already passed the
    certification process, this error appears when a user different from the owner of the
    certificate is trying to send :abbr:`DTE (Documentos Tributarios Electrónicos)` files to the
    :abbr:`SII (Servicio de Impuestos Internos)`.
- | **Error:** `CARATULA`
  | **Hint:** there are just five reasons why this error could show up and all of them are related
    to the *Caratula* section of the XML:

    - The company's :abbr:`RUT (Rol Único Tributario)` number is incorrect or missing.
    - The certificate owner :abbr:`RUT (Rol Único Tributario)` number is incorrect or missing.
    - The :abbr:`SII's (Servicio de Impuestos Internos)` :abbr:`RUT (Rol Único Tributario)` number
      (this should be correct by default) is incorrect or missing.
    - The resolution date is incorrect or missing.
    - The resolution number is incorrect or missing.

.. _chile/credit-notes:

Credit notes
------------

When a cancellation or correction is needed over a validated invoice, a credit note must be
generated. It is important to consider that a :abbr:`CAF (Folio Authorization Code)` file is
required for the credit note, which is identified as :guilabel:`Document Type` :guilabel:`61` in the
:abbr:`SII (Servicio de Impuestos Internos)`. Please refer to the :ref:`CAF section
<chile/caf-documentation>` for more information on the process to load the :abbr:`CAF (Folio
Authorization Code)` on each document type.

.. image:: chile/credit-note-document-type.png
   :alt: Creation of CAF for Credit notes.
   :align: center

Use cases
~~~~~~~~~

Cancel referenced document
**************************

In case you need to cancel or invalidate an invoice, navigate to :menuselection:`Accounting -->
Customers --> Invoices` and select the desired invoice. Then, use the button :guilabel:`Add Credit
Note` and select :guilabel:`Full Refund`, in this case the :abbr:`SII (Servicio de Impuestos
Internos)` reference code is automatically set to :guilabel:`Anula Documento de referencia`.

.. image:: chile/credit-note-cancel-ref-doc.png
   :alt: Credit note cancelling the referenced document.
   :align: center

Correct referenced document
***************************

If a correction in the invoice information is required, for example the street name on the original
invoice is wrong, then use the button :guilabel:`Add Credit Note`, select :guilabel:`Partial Refund`
and select the option :guilabel:`Only Text Correction`. In this case the :guilabel:`SII Reference
Code` field is automatically set to :guilabel:`Corrects Referenced Document Text`.

.. image:: chile/credit-note-correct-text.png
   :alt: Credit note correcting referenced document text.
   :align: center

Odoo creates a credit note with the corrected text in an invoice and :guilabel:`Price` `0.00`.

.. image:: chile/text-correction-label.png
   :alt: Credit note with the corrected value on the invoice lines.
   :align: center

.. important::
   Make sure to define the :guilabel:`Default Credit Account` in the sales journal specifically for
   this use case.

Corrects referenced document amount
***********************************

When a correction on the amounts is required, use the button :guilabel:`Add Credit note` and select
:guilabel:`Partial Refund`. In this case the :guilabel:`SII Reference Code` is automatically set to
:guilabel:`Corrige el monto del Documento de Referencia`.

.. image:: chile/credit-note-correct-amount.png
   :alt: Credit note for partial refund to correct amounts, using the SII reference code 3.
   :align: center

Debit notes
-----------

In Chilean localization, debit notes, in addition to credit notes, can be created using the
:guilabel:`Add Debit Note` button, with two main use cases.

.. _chile/use-cases:

Use cases
~~~~~~~~~

Add debt on invoices
********************

The primary use case for debit notes is to increase the value of an existing invoice. To do so,
select option :guilabel:`3. Corrige el monto del Documento de Referencia` for the
:guilabel:`Reference Code SII` field.

.. image:: chile/debit-note-correct-amount.png
   :alt: Debit note correcting referenced document amount.
   :align: center

In this case Odoo automatically includes the :guilabel:`Source Invoice` in the :guilabel:`Cross
Reference` tab.

.. image:: chile/auto-ref-debit-note.png
   :alt: Automatic reference to invoice in a debit note.
   :align: center

.. tip::
   You can only add debit notes to an invoice already accepted by the SII.

Cancel credit notes
*******************

In Chile, debits notes are used to cancel a valid credit note. To do this, click the :guilabel:`Add
Debit Note` button and select the :guilabel:`1: Anula Documentos de referencia` option for the
:guilabel:`Reference Code SII` field.

.. image:: chile/debit-note-cancel-ref-doc.png
   :alt: Debit note to cancel the referenced document (credit note).
   :align: center

Vendor bills
------------

As part of the Chilean localization, you can configure your incoming email server to match the one
you have registered in the :abbr:`SII (Servicio de Impuestos Internos)` in order to:

- Automatically receive the vendor bills :abbr:`DTE (Documentos Tributarios Electrónicos)` and
  create the vendor bill based on this information.
- Automatically send the reception acknowledgement to your vendor.
- Accept or claim the document and send this status to your vendor.

Reception
~~~~~~~~~

As soon as the vendor email with the attached :abbr:`DTE (Documentos Tributarios Electrónicos)` is
received:

#. The vendor bill maps all the information included in the XML.
#. An email is sent to the vendor with the reception acknowledgement.
#. The :guilabel:`DTE Status` is set as :guilabel:`Acuse de Recibido Enviado`.

Acceptation
~~~~~~~~~~~

If all the commercial information is correct on your vendor bill, then you can accept the document
using the :guilabel:`Aceptar Documento` button. Once this is done, the :guilabel:`DTE Acceptation
Status` changes to :guilabel:`Accepted` and an email of acceptance is sent to the vendor.

.. image:: chile/accept-vendor-bill-btn.png
   :alt: Button for accepting vendor bills.
   :align: center

Claim
~~~~~

In case there is a commercial issue or the information is not correct on your vendor bill, you can
claim the document before validating it, using the :guilabel:`Claim` button. Once this is done, the
:guilabel:`DTE Acceptation Status` changes to :guilabel:`Claim` and a rejection email is sent to the
vendor.

.. image:: chile/claim-vendor-bill-btn.png
   :alt: Claim button in vendor bills to inform the vendor all the document is commercially
         rejected.
   :align: center

If you claim a vendor bill, the status changes from :guilabel:`Draft` to :guilabel:`Cancel`
automatically. Considering this as best practice, all the claimed documents should be cancelled as
they won't be valid for your accounting records.

Electronic purchase invoice
---------------------------

The *electronic purchase invoice* is a feature included in the `l10n_cl_edi` module.

Once all configurations have been made for :ref:`electronic invoices <chile/electronic-invoice>`
(e.g., uploading a valid company certificate, setting up master data, etc.), the electronic
purchase invoices need their own :abbr:`CAFs (Folio Authorization Code)`. Please refer to the
:ref:`CAF documentation <chile/caf-documentation>` to check the details on how to acquire the
:abbr:`CAFs (Folio Authorization Code)` for electronic purchase invoices.

Electronic purchase invoices are useful when vendors are not obligated to expedite an electronic
vendor bill for your purchase. Still, your obligations require a document to be sent to the
:abbr:`SII (Servicio de Impuestos Internos)` as proof of purchase.

Configuration
~~~~~~~~~~~~~

To generate an electronic purchase invoice from a vendor bill, the bill must be created in a
purchase journal with the *Use Documents* feature enabled. It is possible to modify an existing
purchase journal or create a new one in the following process.

To modify the existing purchase journal, or create a new purchase journal, navigate to
:menuselection:`Accounting --> Configuration --> Journals`. Then, click the :guilabel:`New` button,
and fill in the following required information:

- :guilabel:`Type`: select :guilabel:`Purchase` from the drop-down menu for vendor bill journals.
- :guilabel:`Use Documents`: check this field so the journal can generate electronic documents (in
  this case the electronic purchase invoice).

Generate an electronic purchase invoice
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

To generate this type of document, it is necessary to create a vendor bill in Odoo. To do so,
navigate to :menuselection:`Accounting --> Vendors --> Bills`, and click the :guilabel:`New` button.

When all of the electronic purchase invoice information is filled, select the option :guilabel:`(46)
Electronic Purchase Invoice` in the :guilabel:`Document Type` field:

After the vendor bill is posted:

- The :abbr:`DTE (Documentos Tributarios Electrónicos)` file (Electronic Tax Document) is
  automatically created and added to the chatter.
- The :guilabel:`DTE SII Status` is set as :guilabel:`Pending to be sent`.

Odoo automatically updates the *DTE Status* every night using a scheduled action. To get a response
from the :abbr:`SII (Servicio de Impuestos Internos)` immediately, click the :guilabel:`Send now to
SII` button.

Delivery guide
--------------

To install the :guilabel:`Delivery Guide` module, go to :menuselection:`Apps` and search for `Chile
(l10n_cl)`. Then click :guilabel:`Install` on the module :guilabel:`Chile - E-Invoicing Delivery
Guide`.

.. note::
   :guilabel:`Chile - E-Invoicing Delivery Guide` has a dependency with :guilabel:`Chile -
   Facturación Electrónica`. Odoo will install the dependency automatically when the
   :guilabel:`Delivery Guide` module is installed.

The *Delivery Guide* module includes the ability to send the :abbr:`DTE (Documentos Tributarios
Electrónicos)` to :abbr:`SII (Servicio de Impuestos Internos)` and the stamp in PDF reports for
deliveries.

Once all configurations have been made for :ref:`electronic invoices <chile/electronic-invoice>`
(e.g., uploading a valid company certificate, setting up master data, etc.), delivery guides need
their own :abbr:`CAFs (Folio Authorization Code)`. Please refer to the :ref:`CAF documentation
<chile/caf-documentation>` to check the details on how to acquire the :abbr:`CAF (Folio
Authorization Code)` for electronic Delivery Guides.

Verify the following important information in the :guilabel:`Price for the Delivery Guide`
configuration:

- :guilabel:`From Sales Order`: delivery guide takes the product price from the sales order and
  shows it on the document.
- :guilabel:`From Product Template`: Odoo takes the price configured in the product template and
  shows it on the document.
- :guilabel:`No show price`: no price is shown in the delivery guide.

Electronic delivery guides are used to move stock from one place to another and they can represent
sales, sampling, consignment, internal transfers, and basically any product move.

Delivery guide from a sales process
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. warning::
   A delivery guide should **not** be longer than one page or contain more than 60 product lines.

When a sales order is created and confirmed, a delivery order is generated. After validating the
delivery order, the option to create a delivery guide is activated.

.. image:: chile/delivery-guide-creation-btn.png
   :alt: Create Delivery Guide button on a sales process.
   :align: center

.. warning::
   When clicking on :guilabel:`Create Delivery Guide` for the first time, a warning message pops up,
   stating the following:

   `No se encontró una secuencia para la guía de despacho. Por favor, establezca el primer número
   dentro del campo número para la guía de despacho`

   .. image:: chile/delivery-guide-number-warning.png
      :alt: First Delivery Guide number warning message.
      :align: center

This warning message means the user needs to indicate the next sequence number Odoo has to take to
generate the delivery guide (e.g. next available :abbr:`CAF (Folio Authorization Code)` number), and
only happens the first time a delivery guide is created in Odoo. After the first document has been
correctly generated, Odoo takes the next available number in the :abbr:`CAF (Folio Authorization
Code)` file to generate the following delivery guide.

After the delivery guide is created:

- The :abbr:`DTE (Documentos Tributarios Electrónicos)` file (Electronic Tax Document) is
  automatically created and added to the :guilabel:`chatter`.
- The :guilabel:`DTE SII Status` is set as :guilabel:`Pending to be sent`.

.. image:: chile/chatter-delivery-guide.png
   :alt: Chatter notes of Delivery Guide creation.
   :align: center

The :guilabel:`DTE Status` is automatically updated by Odoo with a scheduled action that runs every
night. To get a response from the :abbr:`SII (Servicio de Impuestos Internos)` immediately, press
the :guilabel:`Send now to SII` button.

Once the delivery guide is sent, it may then be printed by clicking on the :guilabel:`Print Delivery
Guide` button.

.. image:: chile/print-delivery-guide-btn.png
   :alt: Printing Delivery Guide PDF.
   :align: center

Delivery guide will have fiscal elements that indicate that the document is fiscally valid when
printed (if hosted in *Odoo SH* or on *On-premise* remember to manually add the
:guilabel:`pdf417gen` library mentioned in the :ref:`Invoice PDF report section
<chile/electronic-invoice-pdf-report>`).

Electronic receipt
------------------

To install the :guilabel:`Electronic Receipt` module, go to :menuselection:`Apps` and search for
`Chile (l10n_cl)`. Then click :guilabel:`Install` on the module :guilabel:`Chile - Electronic
Receipt`.

.. note::
   :guilabel:`Chile - Electronic Receipt` has a dependency with :guilabel:`Chile - Facturación
   Electrónica`. Odoo will install the dependency automatically when the :guilabel:`E-invoicing
   Delivery Guide` module is installed.

Once all configurations have been made for :ref:`electronic invoices <chile/electronic-invoice>`
(e.g., uploading a valid company certificate, setting up master data, etc.), electronic receipts
need their own :abbr:`CAFs (Folio Authorization Code)`. Please refer to the :ref:`CAF documentation
<chile/caf-documentation>` to check the details on how to acquire the :abbr:`CAFs (Folio
Authorization Code)` for electronic receipts.

Electronic receipts are useful when clients do not need an electronic invoice. By default, there is
a partner in the database called :guilabel:`Anonymous Final Consumer` with a generic :abbr:`RUT (Rol
Único Tributario)` `66666666-6` and taxpayer type of :guilabel:`Final Consumer`. This partner can be
used for electronic receipts or a new record may be created for the same purpose.

.. image:: chile/electronic-receipt-customer.png
   :alt: Electronic Receipt module.
   :align: center

Although electronic receipts should be used for final consumers with a generic :abbr:`RUT (Rol Único
Tributario)`, it can also be used for specific partners. After the partners and journals are created
and configured, the electronic receipts are created in the standard way as electronic invoice, but
the type of document :guilabel:`(39) Electronic Receipt` should be selected in the invoice form:

.. image:: chile/document-type-39.png
   :alt: Document type 39 for Electronic Receipts.
   :align: center

Validation and DTE status
~~~~~~~~~~~~~~~~~~~~~~~~~

When all of the electronic receipt information is filled, manually (or automatically) proceed to
validate the receipt from the sales order. By default, :guilabel:`Electronic Invoice` is selected as
the :guilabel:`Document Type`, however in order to validate the receipt correctly, make sure to edit
the :guilabel:`Document Type` and change to :guilabel:`Electronic Receipt`.

After the receipt is posted:

- The :abbr:`DTE (Documentos Tributarios Electrónicos)` file (Electronic Tax Document) is created
  automatically and added to the :guilabel:`chatter`.
- The :guilabel:`DTE SII Status` is set as :guilabel:`Pending to be sent`.

.. image:: chile/electronic-receipt-ste-status.png
   :alt: Electronic Receipts STE creation status.
   :align: center

The :guilabel:`DTE Status` is automatically updated by Odoo with a scheduled action that runs every
day at night. To get a response from the :abbr:`SII (Servicio de Impuestos Internos)` immediately,
press the :guilabel:`Send now to SII` button.

Please refer to the :ref:`DTE Workflow <chile/electronic-invoice-validation>` for electronic
invoices as the workflow for electronic receipt follows the same process.

Electronic export of goods
--------------------------

To install the :guilabel:`Electronic Exports of Goods` module, go to :menuselection:`Apps` and
search for `Chile (l10n_cl)`. Then click :guilabel:`Install` on the module :guilabel:`Electronic
Exports of Goods for Chile`.

.. note::
   :guilabel:`Chile - Electronic Exports of Goods for Chile` has a dependency with :guilabel:`Chile
   - Facturación Electrónica`.

Once all configurations have been made for :ref:`electronic invoices <chile/electronic-invoice>`
(e.g., uploading a valid company certificate, setting up master data, etc.), electronic exports of
goods need their own :abbr:`CAFs (Folio Authorization Code)`. Please refer to the :ref:`CAF
documentation <chile/caf-documentation>` to check the details on how to acquire the :abbr:`CAFs
(Folio Authorization Code)` for electronic receipts.

Electronic invoices for the export of goods are tax documents that are used not only for the
:abbr:`SII (Servicio de Impuestos Internos)` but are also used with customs and contain the
information required by it.

Contact configurations
~~~~~~~~~~~~~~~~~~~~~~

.. image:: chile/taxpayer-type-export-goods.png
   :alt: Taxpayer Type needed for the Electronic Exports of Goods module.
   :align: center

Chilean customs
~~~~~~~~~~~~~~~

When creating an electronic exports of goods invoice, these new fields in the :guilabel:`Other Info`
tab are required to comply with Chilean regulations.

.. image:: chile/chilean-custom-fields.png
   :alt: Chilean customs fields.
   :align: center

PDF report
~~~~~~~~~~

Once the invoice is accepted and validated by the :abbr:`SII (Servicio de Impuestos Internos)` and
the PDF is printed, it includes the fiscal elements that indicate that the document is fiscally
valid and a new section needed for customs.

.. image:: chile/pdf-report-section.png
   :alt: PDF report section for the Electronic Exports of Goods PDF Report.
   :align: center

eCommerce electronic invoicing
------------------------------

To install the :guilabel:`Chilean eCommerce` module, go to :menuselection:`Apps, search for the
module by its technical name `l10n_cl_edi_website_sale`, and click the :guilabel:`Activate` button.

.. image:: chile/ecommerce-module-chile.png
   :align: center
   :alt: l10n_cl eCommerce module.

This module enables the features and configurations to:

- Generate electronic documents from the *eCommerce* application
- Support for required fiscal fields in the *eCommerce* application
- Effectively let the final client decide the electronic document to be generated for their
  purchase

Once all of the configurations are made for the Chilean :ref:`electronic invoice
<chile/electronic-invoice>` flow, the following configurations are required for the eCommerce flow
to be integrated.

To configure your website to generate electronic documents during the sale process, go to
:menuselection:`Website --> Configuration --> Settings --> Invoicing` and activate the
:guilabel:`Automatic Invoice` feature. Activating this feature allows electronic documents to be
automatically generated when an online payment is confirmed.

.. image:: chile/website-configurations-ecommerce-chile.png
   :align: center
   :alt: Invoice Policy and Automatic Invoice configurations.

Since an online payment needs to be confirmed for the *automatic invoice* feature to generate the
document, a payment provider must be configured for the related website.

.. note::
   Review the :doc:`../payment_providers` documentation for information on which payment providers
   are supported in Odoo, and how to configure them.

It is also recommended to configure your products so they are able to be invoiced when an online
payment is confirmed. To do so, go to :menuselection:`Website --> eCommerce --> Products` and select
the product template of the desired product. Then, set the :guilabel:`Invoicing Policy` to
:guilabel:`Ordered quantities`.

.. image:: chile/ordered-quantities-product.png
   :align: center
   :alt: Invoice Policy configuration in Products.

Invoicing flows
~~~~~~~~~~~~~~~

Clients from Chile will be able to select if they need an **invoice** or a **ballot** for their
purchase with an extra step added during the checkout process.

.. image:: chile/select-edi-docs-ecommerce.png
   :align: center
   :alt: Option for EDI Documents for clients.

If the customer selects the :guilabel:`Electronic Invoice` option, fiscal fields are required to be
filled out, including the :guilabel:`Activity Description`, the :guilabel:`Identification Number`
and their :guilabel:`DTE Email`.

.. image:: chile/fiscal-fields-invoice-ecommerce.png
   :align: center
   :alt: Fiscal fields required for an Invoice to be requested.

If the client selects the :guilabel:`Electronic Receipts` option, they will be directed to the next
step, and the electronic document will be generated for the *Consumidor Final Anónimo* contact.

Clients from countries other than Chile, will have their electronic receipts automatically generated
for them by Odoo.

.. note::
   If a purchase through eCommerce requires an export, the customer will need to contact your
   company to generate an electronic export invoice (*document type 110*), which can be done from
   the *Accounting* app.

Point of Sale electronic invoicing
----------------------------------

To install the :guilabel:`Chilean Module for Point of Sale`, go to the :menuselection:`Apps`
application on the main Odoo dashboard, search for the module by its technical name
`l10n_cl_edi_pos`, and click the :guilabel:`Activate` button.

.. image:: chile/pos-edi-module-chile.png
   :align: center
   :alt: l10n_cl POS EDI module.

This module enables the following features and configurations to:

- Generate electronic documents from the *Point of Sale* application
- Support the required fiscal fields for contacts created in the *Point of Sale* application
- Effectively lets the final client decide the type of electronic document to be generated for their
  purchase
- Print QR or 5-digit codes in tickets to access to electronic invoices

To configure contacts with the required fiscal information, review the :ref:`partner information
<chile/partner-information>` section, or directly modify a contact. Navigate to
:menuselection:`Point of Sale --> Session --> Customers --> Details`, and edit any of the following
fields:

- :guilabel:`Name`
- :guilabel:`Email`
- :guilabel:`Identification Type`
- :guilabel:`Tax Payer Type`
- :guilabel:`Type Giro`
- :guilabel:`DTE Email`
- :guilabel:`RUT`

.. image:: chile/fiscal-required-pos-session.png
   :align: center
   :alt: Contact with fiscal information created from POS.

To configure the products, navigate to :menuselection:`Point of Sale --> Products --> Products` and
select a product record. In the :guilabel:`Sales` tab of the product form, it is necessary to mark
the product as :guilabel:`Available for POS`, this makes the product available for sale in the
*Point of Sale* app.

.. image:: chile/available-in-pos-product.png
   :align: center
   :alt: Product with fiscal information created from POS.

Optionally, the following features are available for configuration in the :menuselection:`Point of
Sale --> Configuration --> Settings --> Bills & Receipts section`:

- :guilabel:`Use QR code on ticket`: this feature enables a QR code to be printed on the user's
  receipt so they can easily request an invoice after their purchase
- :guilabel:`Generate a code on ticket`: this feature enables a 5-digit code to be generated on the
  receipt, allowing the user to request an invoice through the customer portal

.. image:: chile/qr-code-ticket.png
   :align: center
   :alt: Configuration to generate QR or 5 digit codes on tickets.

Invoicing flows
~~~~~~~~~~~~~~~

The following sections cover the invoicing flows for the *Point of Sale* application.

Electronic receipts: anonymous end user
***************************************

When making a purchase as an anonymous user that does not request an electronic invoice, Odoo
automatically selects :guilabel:`Consumidor Final Anónimo` as the contact for the order and
generates the electronic receipt.

.. image:: chile/invoice-receipt-selection.png
   :align: center
   :alt: Automatic contact selection of an anonymous end consumer.

.. note::
   If the client requests a credit note due to a return of their purchase, the credit note should be
   made using the *Accounting* app. See the :doc:`credit notes and refunds
   <../accounting/customer_invoices/credit_notes>` documentation for detailed instructions.

Electronic receipts: specific customer
**************************************

When specific user makes a purchase that does not request an electronic invoice, Odoo automatically
selects the contact for the order as the :guilabel:`Consumidor Final Anónimo`, and allows you to
select or create the required customer contact with their fiscal information for the receipt.

.. image:: chile/contact-for-electronic-invoice.png
   :align: center
   :alt: Selection of contact for the receipt.

.. note::
   If the client requests a credit note because of a return of this type of purchase, the credit
   note and return process can be managed directly from the :abbr:`POS (Point of Sale)` session.

Electronic invoices
*******************

When clients request an electronic invoice, it is possible to select or create the required contact
with their fiscal information. When the payment is being made, select the option :guilabel:`Invoice`
to generate the document.

.. image:: chile/invoice-option-at-payment.png
   :align: center
   :alt: Selection of invoice option at payment.

.. note::
   For both the electronic receipts and invoices, if the product is not affected by taxes, Odoo
   detects this and generates the correct type of document for tax-exempt sales.

Returns
*******

For electronic receipts (not generated for the *Consumidor Final Anónimo*) and electronic invoices,
it is possible to manage the process to return products sold in a :abbr:`POS (Point of Sale)` order
by selecting the :guilabel:`Refund` button.

.. image:: chile/refund-order.png
   :align: center
   :alt: Refund option in the POS application.

Orders can be searched by the order status or by contact, and be selected for the refund to be based
on the client's original order.

.. image:: chile/select-order-refund.png
   :align: center
   :alt: Selection of order for the refund process.

When the return payment is validated, Odoo generates the necessary credit note, referencing the
original receipt or invoice, partially or fully cancelling the document.

.. seealso::
   `Smart tutorial - Electronic invoicing for point of sale
   <https://www.youtube.com/watch?v=B2XuWmtlmno&t=360s>`_.

Financial reports
=================

Balance tributario de 8 columnas
--------------------------------

This report presents the accounts in detail (with their respective balances), classifying them
according to their origin and determining the level of profit or loss that the business had within
the evaluated period of time.

You can find this report in :menuselection:`Accounting --> Reporting --> Balance Sheet` and
selecting in the :guilabel:`Report` field the option :guilabel:`Chilean Fiscal Balance (8 Columns)
(CL)`.

.. image:: chile/locate-fiscal-balance-report.png
   :alt: Location of the Reporte Balance Tributario de 8 Columnas.
   :align: center

.. image:: chile/8-col-fiscal-balance-report.png
   :alt: Chilean Fiscal Balance (8 Columns).
   :align: center

Propuesta F29
-------------

The form *F29* is a new system that the :abbr:`SII (Servicio de Impuestos Internos)` enabled to
taxpayers, and that replaces the *Purchase and Sales Books*. This report is integrated by Purchase
Register (CR) and the Sales Register (RV). Its purpose is to support the transactions related to
VAT, improving its control and declaration.

.. important::
   The *Propuesta F29 (CL)* report in Odoo covers the basic legal requirements as a first proposal
   for your final tax declaration.

This record is supplied by the electronic tax documents (DTE's) that have been received by the
:abbr:`SII (Servicio de Impuestos Internos)`.

You can find this report in :menuselection:`Accounting --> Reporting --> Tax Reports` and selecting
the :guilabel:`Report` option :guilabel:`Propuesta F29 (CL)`.

.. image:: chile/locate-propuesta-f29-report.png
   :alt: Location of the Propuesta F29 (CL) Report.
   :align: center

It is possible to set the :abbr:`PPM (Provisional Monthly Payments rate)` and the
:guilabel:`Proportional Factor for the fiscal year` from the :menuselection:`Accounting -->
Configuration --> Settings`.

.. image:: chile/f29-report.png
   :alt: Default PPM and Proportional Factor for the Propuesta F29 Report.
   :align: center

Or manually in the reports by clicking on the :guilabel:`✏️ (pencil)` icon.

.. image:: chile/manual-ppm-f29-report.png
   :alt: Manual PPM for the Propuesta F29 Report.
   :align: center


==================================================
SECTION: colombia.rst
PATH: applications/finance/fiscal_localizations/colombia.rst
==================================================

========
Colombia
========

.. |DIAN| replace:: :abbr:`DIAN (Dirección de Impuestos y Aduanas Nacionales)`
.. |NIT| replace:: :abbr:`NIT (El Número de Identificación Tributaria)`

Odoo's Colombian localization package provides accounting, fiscal, and legal features for databases
in Colombia - such as chart of accounts, taxes, and electronic invoicing. The localization has the
following `prerequisites
<https://micrositios.dian.gov.co/sistema-de-facturacion-electronica/que-requieres-para-factura-electronicamente/>`_
when using the `DIAN Own Software
<https://micrositios.dian.gov.co/sistema-de-facturacion-electronica/como-puedes-facturar-electronicamente/>`_
solution with Odoo:

- Be registered in the `RUT
  <https://www.dian.gov.co/tramitesservicios/tramites-y-servicios/tributarios/Paginas/RUT.aspx>`_
  (Registro Único Tributario) with a valid |NIT|.
- Have a valid digital signature certificate `approved by the ONAC
  <https://onac.org.co/directorio-de-acreditados/>`_.
- `Register and get enabled
  <https://micrositios.dian.gov.co/sistema-de-facturacion-electronica/proceso-de-registro-y-habilitacion-como-facturador-electronico/>`_
  by completing the certification process required by the |DIAN|.

.. seealso::
   - For more information on how to complete the certification process for the |DIAN| module, review
     the following `webinar <https://www.youtube.com/watch?v=l0G6iDc7NQA>`_
   - `Smart Tutorial - Colombian Localization
     <https://www.odoo.com/slides/smart-tutorial-localizacion-de-colombia-132>`_
   - :doc:`Documentation on e-invoicing's legality and compliance in Colombia
     <../accounting/customer_invoices/electronic_invoicing/colombia>`

.. _localization/colombia/configuration:

Configuration
=============

.. _localization/colombia/modules:

Modules installation
--------------------

:ref:`Install <general/install>` the following modules to get all the features of the Colombian
localization:

.. list-table::
   :header-rows: 1
   :widths: 25 25 50

   * - Name
     - Technical name
     - Description
   * - :guilabel:`Colombia - Accounting`
     - `l10n_co`
     - Default :ref:`fiscal localization package <fiscal_localizations/packages>`. This module adds
       the base accounting features for the Colombian localization: chart of accounts, taxes,
       withholdings, and identification document type.
   * - :guilabel:`Electronic invoicing for Colombia with DIAN`
     - `l10n_co_dian`
     - This module includes the features required for integration with the |DIAN| as its own
       software, and adds the ability to generate electronic invoices and support documents based on
       |DIAN| regulations.
   * - :guilabel:`Colombian - Accounting Reports`
     - `l10n_co_reports`
     - This module includes accounting reports for sending certifications to suppliers for
       withholdings applied.
   * - :guilabel:`Electronic invoicing for Colombia with Carvajal`
     - `l10n_co_edi`
     - This module includes the features required for integration with Carvajal. Adds the ability to
       generate the electronic invoices and support documents, based on |DIAN| regulations.
   * - :guilabel:`Colombian - Point of Sale`
     - `l10n_co_pos`
     - This module includes **Point of Sale** receipts for Colombian localization.

.. _localization/colombia/configuration/company:

Company information
-------------------

To configure your company information:

#. Access your company's contact form:

   - Go to the :guilabel:`Contacts` app and search for your company or;
   - Go to the :guilabel:`Settings` app, activate the :ref:`developer mode <developer-mode>`, and in
     the :guilabel:`Companies` section, click :guilabel:`Update Info`. Then, in the
     :guilabel:`Contact` field, click on the company name.

#. Configure the following information:

   - :guilabel:`Company Name`.
   - :guilabel:`Address`: Including :guilabel:`City`, :guilabel:`Department`, and :guilabel:`ZIP`
     code.
   - :guilabel:`Identification Number`: Select the :guilabel:`Identification Type` (:guilabel:`NIT`,
     :guilabel:`Cédula de Ciudadanía`, :guilabel:`Registro Civil`, etc.). When the
     :guilabel:`Identification Type` is :guilabel:`NIT`, the
     :guilabel:`Identification Number` **must** have the *verification digit* at the end of the ID
     prefixed by a hyphen (`-`).

#. Go to the :guilabel:`Sales & Purchase` tab and configure the :guilabel:`Fiscal Information`:

   - :guilabel:`Obligaciones y Responsabilidades`: Select the fiscal responsibility for the company.
     (:guilabel:`O-13` Gran Contribuyente, :guilabel:`O-15` Autorretenedor,
     :guilabel:`O-23` Agente de retención IVA, :guilabel:`O-47` Regimen de tributación simple,
     :guilabel:`R-99-PN` No Aplica).
   - :guilabel:`Gran Contribuyente`: If the company is *Gran Contribuyente*, enable this option.
   - :guilabel:`Fiscal Regimen`: Select the Tribute Name for the company (:guilabel:`IVA`,
     :guilabel:`INC`, :guilabel:`IVA e INC`, or :guilabel:`No Aplica`)
   - :guilabel:`Commercial Name`: If the company uses a specific commercial name and it needs to be
     displayed in the invoice.

.. tip::
   The data configured in the :guilabel:`Fiscal Information` section is printed in the valid fiscal
   PDF reports.

.. _localization/colombia/einvoice-configuration:

Electronic invoicing credentials and |DIAN| environment
-------------------------------------------------------

To configure the user credentials to be used to connect with the |DIAN|'s web service and the
|DIAN| environment, navigate to :menuselection:`Accounting --> Configuration --> Settings` and
scroll to the :guilabel:`Colombian Electronic Invoicing` section. Then, follow these steps:

#. Select :guilabel:`DIAN: Free Service` as the :guilabel:`Electronic Invoicing Provider`.
#. Configure the :guilabel:`Operation Modes` for the respective types of documents
   (*electronic invoices* or *support documents*) to be generated from Odoo. Click
   :guilabel:`Add a line`, then fill in the fields:

   - :guilabel:`Software Mode`: the type of document to be generated with the operation mode.
   - :guilabel:`Software ID`: the ID generated by |DIAN| for the specific operation mode.
   - :guilabel:`Software PIN`: the PIN selected in the operation mode configuration in the |DIAN|
     portal.
   - :guilabel:`Testing ID`: the testing ID generated by |DIAN| and obtained after testing the
     operation mode.

#. Configure the available :guilabel:`Certificates` to sign the electronic documents. Click
   :guilabel:`Add a line`, then fill in the fields:

   - :guilabel:`Name`: the name of the certificate.
   - :guilabel:`Certificate`: upload the certificate file in PEM format. In the :guilabel:`Private
     Key` field that appears on the screen, select an existing private key or create a new one. To
     do so, enter a key name and select :guilabel:`Create and edit`. Then, in the :guilabel:`Create
     Private Key` wizard, upload a valid :guilabel:`Key file` and click :guilabel:`Save & Close`.

     .. image:: colombia/dian-credentials-configuration.png
        :alt: Colombian electronic invoicing credentials configured.

#. Configure the |DIAN| environment; the |DIAN| electronic invoicing module offers four different
   |DIAN| environments to connect with:

   - **DIAN demo mode**: This environment allows to test electronic invoicing workflows using
     a demo digital certificate. Files are created and accepted automatically and are not sent
     to any |DIAN| environment. Every internal validation can be tested. To activate it, tick the
     :guilabel:`DIAN Demo Mode` checkbox.

     .. note::
        The :guilabel:`DIAN Demo Mode` checkbox is hidden from view when the :guilabel:`Test
        environment` checkbox is enabled.

   - **Certification environment**: This environment is useful to pass the |DIAN| certification
     process and obtain the *Enabled* status to invoice from Odoo. To activate it, enable both the
     :guilabel:`Test environment` and the :guilabel:`Activate the certification process` checkboxes.
   - **Testing environment**: This environment allows reproducing electronic invoicing flows
     and validations in the |DIAN| testing portal. To activate it, enable only the :guilabel:`Test
     Environment` checkbox.
   - **Production environment**: This environment allows generating valid electronic documents. To
     activate it, disable both the :guilabel:`Test environment` and the :guilabel:`Activate the
     certification process` checkboxes.

     .. important::
        Do not activate :guilabel:`DIAN Demo Mode` on a production database. This mode is intended
        for use in test environments only.

.. note::
   In a multi-company database, each company can have its own certificate.

.. seealso::
   For electronic invoicing configurations using the Carvajal solution, review the following video:
   `Configuración de Facturación Electrónica - Localización de Colombia
   <https://www.youtube.com/watch?v=bzweMwTEbfY&list=PL1-aSABtP6ABxZshems3snMjx7bj_7ZsZ&index=3>`_.

.. _localization/colombia/master-data:

Master data
-----------

.. _localization/colombia/contacts:

Contacts
~~~~~~~~

Configure the following fields on the :doc:`contact form <../../essentials/contacts>`:

- :guilabel:`Identification Number` (VAT): Select the identification number type and enter the
  identification number. If the identification number type is :guilabel:`NIT`, the identification
  number must include the verification digit at the end, prefixed by a hyphen (`-`).
- :ref:`Fiscal Information fields <localization/colombia/configuration/company>` in the
  :guilabel:`Sales & Purchase` tab.

.. _localization/colombia/products:

Products
~~~~~~~~

Access the product's form via :menuselection:`Accounting --> Customers --> Products` and ensure
that either the :guilabel:`UNSPSC Category` field (found in the :guilabel:`Accounting tab`) or the
:guilabel:`Internal Reference` field (in the :guilabel:`General Information` tab) is configured.

.. _localization/colombia/taxes:

Taxes
~~~~~

To create or modify taxes, go to :menuselection:`Accounting --> Configuration --> Taxes`, and select
the related tax.

If sales transactions include products with taxes, configure the :guilabel:`Value Type` field in the
:guilabel:`Advanced Options` tab. Retention tax types (:guilabel:`ICA`, :guilabel:`IVA`,
:guilabel:`Fuente`) are also included. This configuration is used to display taxes correctly on the
invoice.

.. image:: colombia/dian-taxes-configuration.png
   :alt: Specific tax configurations per DIAN regulations.

.. _localization/colombia/co-journals:

Sales journals
~~~~~~~~~~~~~~

Once the |DIAN| has assigned the official sequence and prefix for the electronic invoice resolution,
the sales journals related to the invoices **must** be updated in Odoo. To do so, navigate
to :menuselection:`Accounting --> Configuration --> Journals` and select an existing sales journal
or create a new one with the :guilabel:`Create` button.

On the sales journal form, enter the :guilabel:`Journal Name` and :guilabel:`Type`, then set a
unique :guilabel:`Short Code` in the :guilabel:`Journals Entries` tab. Then, configure the following
data in the :guilabel:`Advanced Settings` tab:

- :guilabel:`Electronic invoicing`: enable UBL 2.1 (Colombia).
- :guilabel:`Invoicing Resolution`: resolution number issued by |DIAN| to the company via their test
  set.
- :guilabel:`Resolution Date`: initial effective date of the resolution.
- :guilabel:`Resolution End Date`: end date of the resolution's validity.
- :guilabel:`Range of Numbering (minimum)`: first authorized invoice number.
- :guilabel:`Range of Numbering (maximum)`: last authorized invoice number.
- :guilabel:`Technical Key`: control key received from the |DIAN| portal test set or from their web
  service in case of the production environment.

When the database is configured for the :ref:`production environment
<localization/colombia/einvoice-configuration>`, instead of configuring these fields manually,
click the :guilabel:`Reload DIAN configuration` button to obtain the |DIAN| resolution information
from the |DIAN| web service.

.. image:: colombia/reload-dian-configuration-button.png
   :alt: Reload DIAN configuration button in sale journals.

.. important::
   - The short code and resolution of the journal **must** match the ones received in the |DIAN|
     portal test set or from the MUISCA portal.
   - The :ref:`invoice sequence and prefix <localization/colombia/invoice-creation>` **must** be
     correctly configured when the first invoice is created. Odoo automatically assigns a prefix
     and sequence to the following invoices.

.. _localization/colombia/purchase-journals:

Purchase journals
~~~~~~~~~~~~~~~~~

Once the |DIAN| has assigned the official sequence and prefix for the *support document* related to
vendor bills, the purchase journals related to their supporting documents need to be updated in
Odoo. The process is similar to the configuration of the :ref:`sales journals
<localization/colombia/co-journals>`.

.. seealso::
   For more information on support document journals using the Carvajal solution, review the
   `Documento Soporte - Localización de Colombia video
   <https://www.youtube.com/watch?v=UmYsFcD7xzE&list=PL1-aSABtP6ABxZshems3snMjx7bj_7ZsZ&index=8>`_.

.. _localization/colombia/chart-of-accounts:

Chart of accounts
~~~~~~~~~~~~~~~~~

The :doc:`chart of accounts </applications/finance/accounting/get_started/chart_of_accounts>` is
installed by default as part of the localization module. The accounts are mapped automatically in
taxes, default account payable, and default account receivable. The chart of accounts for Colombia
is based on the PUC (Plan Unico de Cuentas).

.. _localization/colombia/workflows:

Multicurrency
-------------

The official exchange rate for Colombia is provided by the `Banco de la República
<https://suameca.banrep.gov.co/estadisticas-economicas/>`_.

To enable automatic exchange rate updates, follow these steps:

#. Go to :menuselection:`Accounting --> Configuration --> Settings`.
#. Navigate to the :guilabel:`Currencies` section and enable :guilabel:`Automatic Currency Rates`.
#. Ensure that :guilabel:`[CO] Bank of the Republic` is selected as the :guilabel:`Service`.
#. Select an :guilabel:`Interval` for how frequently the currency rate should be automatically
   updated.

Main workflows
==============

.. _localization/colombia/electronic-invoices:

Electronic invoices
-------------------

The following is a breakdown of the main workflow for electronic invoices with the Colombian
localization:

#. The user creates an invoice.
#. Odoo generates the legal XML file.
#. Odoo generates the CUFE (Invoice Electronic Code) with the electronic signature.
#. Odoo sends a notification to DIAN.
#. |DIAN| validates the invoice.
#. |DIAN| accepts or rejects the invoice.
#. Odoo generates the PDF invoice with a QR code.
#. Odoo compresses the attached document (containing the sent XML file and the DIAN validation
   response) and the fiscal valid PDF into a :file:`.zip` file.
#. The user sends the invoice (:file:`.zip` file) via Odoo to the acquirer.

.. _localization/colombia/invoice-creation:

Invoice creation
~~~~~~~~~~~~~~~~

.. note::
   The functional workflow taking place before an invoice validation does **not** alter the main
   changes introduced with the electronic invoice.

Electronic invoices are generated and sent to both the |DIAN| and the customer. These documents can
be created from the sales order or manually generated. To create a new invoice, go to
:menuselection:`Accounting --> Costumers --> Invoices`, and select :guilabel:`Create`. On the
invoice form, configure the following fields:

- :guilabel:`Customer`: customer's information.
- :guilabel:`Journal`: journal used for electronic invoices.
- :guilabel:`Electronic Invoice Type`: Select the type of document. By default, :guilabel:`Factura
  de Venta` is selected.
- :guilabel:`Invoice Lines`: Specify the products with the correct taxes.

.. important::
   When creating the first invoice related to an electronic invoicing journal, it is required to
   manually change the *sequence* of the invoice to the |DIAN| format: `Prefix + Sequence`.

   For example, format the sequence from `SETP/2024/00001` to `SETP1`.

When done, click :guilabel:`Confirm`.

.. _localization/colombia/send-electronic-invoice:

Electronic invoice sending
~~~~~~~~~~~~~~~~~~~~~~~~~~

After the :ref:`invoice confirmation <localization/colombia/invoice-creation>`, click
:guilabel:`Print & Send`. In the wizard that appears, make sure to enable the :guilabel:`DIAN` and
:guilabel:`Email` checkboxes to send an XML to the |DIAN| web service and the validated invoice to
the client fiscal email and click :guilabel:`Print & Send`. Then:

- The XML document is created.
- The CUFE is generated.
- The XML is processed synchronously by the |DIAN|.
- If accepted, the file is displayed in the chatter and the email to the client with the
  corresponding :file:`.zip` file.

.. image:: colombia/zip-xml-chatter-colombia.png
   :alt: EDI documents available in the chatter.

The :guilabel:`DIAN` tab then displays the following:

- :guilabel:`Signed Date`: timestamp recorded of the XML creation.
- :guilabel:`Status`: Status result obtained in the |DIAN| response. If the invoice was
  rejected, the error messages can be seen here.
- :guilabel:`Testing Environment`: To know if the document sent was delivered to the |DIAN| testing
  environment.
- :guilabel:`Certification Process`: To know if the document was sent as part of the certification
  process with the |DIAN|.
- :guilabel:`Download`: To download the sent XML file, even if the |DIAN| result was
  rejected.
- :guilabel:`Fetch Attached Document`: To download the generated attached document file included in
  the delivered :file:`.zip` file to the client.

.. image:: colombia/dian-tab-electronic-document.png
   :alt: EDI document record available in DIAN tab.

.. _localization/colombia/credit-notes:

Credit notes
------------

The process for credit notes is the same as for invoices. To create a credit note with reference to
an invoice, go to :menuselection:`Accounting --> Customers --> Invoices`. On the invoice, click
:guilabel:`Add Credit Note`, and complete the following information:

- :guilabel:`Credit Method`: Select the type of credit method.

  - :guilabel:`Partial Refund`: Use this option when it is a partial amount.
  - :guilabel:`Full Refund`: Use this option if the credit note is for the full amount.
  - :guilabel:`Full refund and new draft invoice`: Use this option if the credit note is
    auto-validated and reconciled with the invoice. The original invoice is duplicated as a new
    draft.

- :guilabel:`Reason`: Enter the reason for the credit note.
- :guilabel:`Reversal Date`: Select if you want a specific date for the credit note or if it is the
  journal entry date.
- :guilabel:`Use Specific Journal`: Select the journal for your credit note or leave it empty if
  you want to use the same journal as the original invoice.
- :guilabel:`Refund Date`: If you chose a specific date, select the date for the refund.

Once reviewed, click the :guilabel:`Reverse` button.

.. _localization/colombia/debit-notes:

Debit notes
-----------

The process for debit notes is similar to credit notes. To create a debit note with reference to an
invoice, go to :menuselection:`Accounting --> Customers --> Invoices`. On the invoice, click the
:guilabel:`Add Debit Note` button, and enter the following information:

- :guilabel:`Reason`: Type the reason for the debit note.
- :guilabel:`Debit note date`: Select the specific options.
- :guilabel:`Copy lines`: Select this option if you need to register a debit note with the same
  lines of invoice.
- :guilabel:`Use Specific Journal`: Select the printer point for your debit note, or leave it empty
  if you want to use the same journal as the original invoice.

When done, click :guilabel:`Create Debit Note`.

.. _localization/colombia/support-document:

Support document for vendor bills
---------------------------------

With master data, credentials, and the purchase journal configured for support documents related to
vendor bills, you can start using *support documents*.

Support documents for vendor bills can be created from your purchase order or manually. Go to
:menuselection:`Accounting --> Vendors --> Bills` and fill in the following data:

- :guilabel:`Vendor`: Enter the vendor's information.
- :guilabel:`Bill Date`: Select the date of the bill.
- :guilabel:`Journal`: Select the journal for support documents related to the vendor bills.
- :guilabel:`Invoiced Lines`: Specify the products with the correct taxes.

Once reviewed, click the :guilabel:`Confirm` button. Upon confirmation, an XML file is created and
automatically sent to Carvajal.

.. _localization/colombia/common-errors:

Common errors
-------------

During the XML validation, the most common errors are related to missing :ref:`master data
<localization/colombia/master-data>`. In such cases, a validation error message is displayed and
sending is blocked.

If the invoice was sent and set as *Rejected* by the |DIAN|, the error messages are visible by
clicking the :icon:`fa-info-circle` :guilabel:`(info circle)` icon next to the :guilabel:`Status`
field in the :guilabel:`DIAN` tab. Using the reported error codes, it is possible to review
solutions to apply before re-sending.

.. image:: colombia/rejected-invoice-error-message.png
   :alt: Example of error messages on rejected invoices.

After the master data or other issues are corrected, it is possible to reprocess the XML again. Do
so by following the :ref:`electronic invoice sending <localization/colombia/send-electronic-invoice>`
flow.

.. _localization/colombia/reports:

Financial reports
=================

.. _localization/colombia/certificado-ica:

Certificado de Retención en ICA
-------------------------------

This report is a certification to vendors for withholdings made for the Colombian Industry and
Commerce (ICA) tax. The report can be found under :menuselection:`Accounting --> Reporting -->
Colombian Statements --> Certificado de Retención en ICA`.

Click the :icon:`fa-cog` :guilabel:`(gear)` icon to display options to :guilabel:`Download Excel`
and :guilabel:`Copy to Documents`.

.. image:: colombia/retencion-ica-dian.png
   :alt: Certificado de Retención en ICA report in Odoo Accounting.

.. _localization/colombia/certificado-iva:

Certificado de Retención en IVA
-------------------------------

This report issues a certificate on the amount withheld from vendors for VAT withholding. The report
can be found under :menuselection:`Accounting --> Reporting --> Colombian Statements --> Certificado
de Retención en IVA`.

Click the :icon:`fa-cog` :guilabel:`(gear)` icon to display options to :guilabel:`Download Excel`
and :guilabel:`Copy to Documents`.

.. image:: colombia/retencion-iva-dian.png
   :alt: Certificado de Retención en IVA report in Odoo Accounting.

.. _localization/colombia/certificado-fuente:

Certificado de Retención en la Fuente
-------------------------------------

This certificate is issued to partners for the withholding tax that they have made. The report can
be found under :menuselection:`Accounting --> Reporting --> Colombian Statements --> Certificado de
Retención en Fuente`.

Click the :icon:`fa-cog` :guilabel:`(gear)` icon to display options to :guilabel:`Download Excel`
and :guilabel:`Copy to Documents`.

.. image:: colombia/retencion-fuente-dian.png
   :alt: Certificado de Retención en Fuente report in Odoo Accounting.


==================================================
SECTION: denmark.rst
PATH: applications/finance/fiscal_localizations/denmark.rst
==================================================

=======
Denmark
=======

Compliance with Danish bookkeeping requirements: data retention and integrity
=============================================================================

This page outlines how Odoo complies with the Danish Bookkeeping Act,
specifically regarding the storage and integrity of financial transactions and receipts.
Odoo recognizes the importance of adhering to Danish regulations and has implemented robust
measures to ensure clients' data is secure and compliant.

.. important::
   Odoo’s registration as a digital bookkeeping system has been confirmed by the Danish Business
   Authority under registration numbers `fob585505` and `fob441967`. Customers must meet certain
   conditions to benefit from it, as outlined below.


Key requirements of the Danish Bookkeeping Act
----------------------------------------------

The Danish Bookkeeping Act (DBA) outlines the `requirements for digital bookkeping systems
<https://danishbusinessauthority.dk/requirements-digital-bookkeeping-systems>`_:

- **Retain transactional data and receipts:** Store all recorded transactions and receipts
  covered by § 3 for a minimum of five years from the end of the financial year to which they pertain.

- **Ensure data integrity:** Prevent the customer from changing, backdating, or deleting recorded transactions.

- **Maintain data accessibility:** Store all recorded transactions in a structured and machine-readable format
  for the required five-year period, regardless of customer relationship status, bankruptcy, or dissolution.

- **Provide decryption capabilities:** Ensure that encrypted bookkeeping data and receipts can be decrypted
  into a structured and readable format.

Odoo Compliance
---------------

Odoo's registration as digital standard bookkeeping systems with the Danish Business Authority
confirms that Odoo meets the applicable criteria for digital bookkeeping systems in Denmark,
in accordance with the requirements of the :abbr:`DBA (Danish Bookkeeping Act)`.

However, to benefit from all the required guarantees for digital bookkeeping systems in Denmark,
customers must meet a few conditions.

Conditions for full DBA compliance
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- The customer uses Odoo Accounting on the Odoo SaaS platform (Odoo Online);
- The customer has an active Odoo subscription (e.g., Standard or Custom Plan), or their database is
  managed by an officially registered `Odoo Accounting Firm <https://www.odoo.com/accounting-firms>`_;
- The customer refrains from customizations or actions intended to undermine the system’s immutability,
  traceability, or security controls.

.. note::
  Customers using Odoo products outside these conditions are responsible for ensuring their own
  compliance with the DBA.

When the above conditions are met, the requirements of the DBA are fulfilled through features and
processes described in the following sections.

Immutable transaction records
-----------------------------

- Once transactions are recorded, they cannot be deleted through the user interface.
- All modifications are logged, providing a complete audit trail.
- While historically dated entries can be made, Odoo records the creation date and time of the entry.

Secure document storage
-----------------------

- Receipts and digital vouchers are stored as attachments and integrated into the database, ensuring they
  are included in backups.
- Posted documents cannot be deleted.
- We fully support the storage of mandatory digital vouchers as defined by Danish regulations.

Continuous data availability
----------------------------

- Clients with active subscriptions can access all transactions and digital vouchers through Odoo.
- Regardless of customer relations, bankruptcy, or dissolution, Odoo can provide access to transaction
  and digital voucher details to former clients for six years (see :ref:`localizations/denmark/data-lifecycle`).

Automated data export and secure storage
----------------------------------------

- Odoo Accounting implements no automatic deletion or archival of recorded transactions, so if a customer has
  been recording transactions for six years, the six years of history are preserved in the Odoo Accounting database.
- As described in the `Odoo Cloud Hosting SLA <https://www.odoo.com/cloud-sla>`_ and
  `Odoo Privacy Policy <https://www.odoo.com/privacy>`_, the Odoo Cloud relies on immutable daily snapshot
  backups, which cannot be individually altered or deleted, even at the customer's request, ensuring their integrity.
- All documents and receipts stored in a database backup are available as a standard ZIP archive accompanying
  the SQL dump.

.. _localizations/denmark/data-lifecycle:

Data lifecycle management
-------------------------

- Odoo database backups are available in standard SQL dump formats at all times and include all recorded
  transactions.
- The `Odoo Cloud Hosting SLA <https://www.odoo.com/cloud-sla>`_ guarantees three months of backup history to all
  active customers. As a special guarantee for Danish customers subject to the DBA and meeting the conditions
  highlighted above the last Odoo Cloud backup retention gets increased to six years as soon as they decide to
  terminate their Odoo Cloud subscription, in order to comply with the requirements of Annex 1, 4 of Executive Order 97.

Decryption
----------

Odoo Accounting customer data on the Odoo Cloud is always stored in encrypted form (encryption at rest at
storage level). When backups are retrieved, they are automatically decrypted and provided in decrypted form in
standard formats for the user: SQL dumps + ZIP archive of all attached documents (file store).


==================================================
SECTION: ecuador.rst
PATH: applications/finance/fiscal_localizations/ecuador.rst
==================================================

=======
Ecuador
=======

With the Ecuadorian localization, electronic documents can be generated using XML, fiscal
folio, electronic signature, and direct connection to tax authority SRI.

The supported documents are invoices, credit notes, debit notes, purchase liquidations, and
withholdings.

The localization also includes automation to easily predict the withholding tax to be applied to
each purchase invoice.

.. seealso::
   - `App Tour - Localización de Ecuador <https://www.youtube.com/watch?v=BQOXVSDeeK8>`_
   - `Smart Tutorial - Localización de Ecuador
     <https://www.odoo.com/slides/smart-tutorial-localizacion-de-ecuador-170>`_
   - :doc:`Documentation on e-invoicing's legality and compliance in Ecuador
     <../accounting/customer_invoices/electronic_invoicing/ecuador>`

.. tip::
   - **SRI**: *Servicio de Rentas Internas*, the government organization that enforces the payment
     of taxes in Ecuador.
   - **SRI certificate**: Document or digital credential issued by the *SRI* that is crucial for
     compliance with Ecuadorian tax laws.
   - **EDI**: *Electronic Data Interchange*, which refers to the electronic transmission of
     documents.
   - **RIMPE**: *Regimen Simplificado para Emprendedores y Negocios*, the type of taxpayer qualified
     for SRI.

.. _localizations/ecuador/module-installation:

Modules
=======

:doc:`Install </applications/general/apps_modules>` the following modules to get all the features of
the Ecuadorian localization:

.. list-table::
   :header-rows: 1
   :widths: 25 25 50

   * - Name
     - Technical name
     - Description
   * - :guilabel:`Ecuadorian - Accounting`
     - `l10n_ec`
     - The default :doc:`fiscal localization package <../fiscal_localizations>` adds accounting
       characteristics for the Ecuadorian localization, which represent the minimum configuration
       required for a company to operate in Ecuador according to the guidelines set by the
       :abbr:`SRI (servicio de rentas internas)`. The module's installation automatically loads:
       a chart of accounts, taxes, document types, and tax support types. Additionally, the
       generation of forms 103 and 104 is automatic.
   * - :guilabel:`Ecuadorian Accounting EDI`
     - `l10n_ec_edi`
     - Includes all the technical and functional requirements to generate and validate
       :doc:`Electronics Documents <../accounting/customer_invoices/electronic_invoicing>` based on
       the technical documentation published by the SRI. The authorized documents are: Invoices,
       Credit Notes, Debit Notes, Withholdings, and Purchase liquidations.
   * - :guilabel:`Ecuadorian Accounting Reports`
     - `l10n_ec_reports`
     - Includes all the technical and functional requirements to generate forms 103 and 104.
   * - :guilabel:`Ecuador - ATS Report`
     - `l10n_ec_reports_ats`
     - Includes all the technical and functional requirements to generate the ATS report XML file
       ready to be uploaded to the *DIMM Formularios*.
   * - :guilabel:`Ecuadorian Website`
     - `l10n_ec_website_sale`
     - Includes all the technical and functional requirements to generate automatic electronic
       invoices from a Website sale.
   * - :guilabel:`Ecuadorian Point of Sale`
     - `l10n_ec_edi_pos`
     - Includes all the technical and functional requirements to generate automatic electronic
       invoices from a POS sale.
   * - :guilabel:`Ecuadorian Delivery Guide`
     - `l10n_ec_edi_stock`
     - Includes all the technical and functional requirements to generate :ref:`electronic delivery
       guides <localizations/ecuador/electronic-delivery-guide>`.

.. note::
   In some cases, such as when upgrading to a version with additional modules, those modules may not
   be installed automatically. Any missing modules can be manually
   :doc:`installed </applications/general/apps_modules>`.

.. seealso::
   :doc:`/applications/hr/payroll/payroll_localizations` are documented separately.

.. _localizations/ecuador/specifics:

Localization overview
=====================

The Ecuadorian localization package ensures compliance with Ecuadorian fiscal and accounting
regulations. It includes tools for managing taxes, fiscal positions, reporting, and a predefined
chart of accounts tailored to Ecuador's standards.

The Ecuadorian localization package provides the following key features to ensure compliance with
local fiscal and accounting regulations:

- :doc:`../accounting/get_started/chart_of_accounts`: a predefined structure aligned with the latest
  standards of Ecuador’s *Superintendency of Companies*, organized into multiple categories and
  fully compatible with NIIF accounting
- :ref:`Products <localizations/ecuador/products>`
- :ref:`Taxes <localizations/ecuador/taxes>`: pre-configured tax rates, including standard VAT,
  zero-rated, and exempt options
- :doc:`../accounting/taxes/fiscal_positions`: automated tax adjustments based on customer or
  supplier registration status
- :ref:`Document types <localizations/ecuador/document types>`: classification of transactions like
  *customer invoices* and *vendor bills* using government-defined document types set by the SRI
  (Ecuador’s tax authority)
- :ref:`Company and contacts <localizations/ecuador/company-contact>`
- :ref:`Electronic documents <localizations/ecuador/electronic-documents>`
- :ref:`VAT withholding <localizations/ecuador/vat-withholding>`
- :ref:`Printer points <localizations/ecuador/printer-points>`
- :ref:`Withholding <localizations/ecuador/withholding>`
- :ref:`Reporting <localizations/ecuador/reporting>`

.. _localizations/ecuador/products:

Products
--------

If products have any :doc:`withholding taxes <../accounting/taxes/retention>`, they must be
configured on the product form. To do so, go to :menuselection:`Accounting --> Vendors -->
Products`. On the :guilabel:`General Information` tab, specify both :guilabel:`Purchase Taxes` and
:guilabel:`Profit Withhold`.

.. _localizations/ecuador/taxes:

Taxes
-----

To manage taxes, navigate to :menuselection:`Accounting --> Configuration --> Taxes`. Depending on
the tax type, the following options may be required for additional configuration:

- :guilabel:`Tax Name`: Follows a specific format depending on the tax type:

  - | **For IVA (Value-Added Tax)**:
    | `IVA [percent] (104, [form code] [tax support code] [tax support short name])`
    | Example: `IVA 12% (104, RUC [tax support code] IVA)`
  - | **For Income Tax Withholding codes**:
    | `Code ATS [percent of withhold] [withhold name]`
    | Example: `Code ATS 10% Retención a la Fuente`

- :guilabel:`Tax Support`: Configure only for the IVA tax. This option is used to register purchase
  withholdings.
- :guilabel:`Code ATS`: Configure only for income tax withholding codes, as it is necessary to
  register a withholding.

In the :guilabel:`Definition` tab:

- :guilabel:`Tax Grids`: Configure the code of a 104 form if it is an IVA tax, and the code of a
  103 form if it is an income tax withholding code.

.. seealso::
   :doc:`Configuring taxes <../accounting/taxes>`

.. _localizations/ecuador/document types:

Document types
--------------

To access or configure document types, go to :menuselection:`Accounting --> Configuration -->
Document Types`. Each document type can have a unique sequence per journal where it is assigned. As
part of the localization, the document type includes the country where the document is applicable;
also, the data is created automatically when the localization module is installed. The information
required for the document types is included by default and doesn't need to be changed.

.. _localizations/ecuador/company-contact:

Company and contact
-------------------

.. seealso::
   :doc:`Configure a company or individual contact <../../essentials/contacts>`

The following fields should be completed for localization purposes on the contact form:

- :guilabel:`Name`: Enter the company or individual's name.
- :guilabel:`Address`: The :guilabel:`Street` sub-field is required to confirm electronic invoices.
- :guilabel:`Identification Number`: For a company, enter the :guilabel:`Ruc`. For individuals,
  enter the :guilabel:`Cédula` or :guilabel:`Passport` number.
- :guilabel:`SRI Taxpayer Type`: Select the contact's SRI taxpayer type.
- :guilabel:`Phone`: Enter the company or individual's phone number.
- :guilabel:`Email`: Enter the company or individual's email. This email is used to send electronic
  documents, such as invoices.

.. note::
   The :guilabel:`SRI Taxpayer Type` indicated on the contact form determines which :ref:`VAT and
   profit withholding <localizations/ecuador/vat-withholding>` taxes apply when using this contact
   on a vendor bill.

.. _localizations/ecuador/electronic-documents:

Electronic documents
--------------------

To upload information for electronic documents, go to :menuselection:`Accounting --> Configuration
--> Settings`, and scroll to the :guilabel:`Ecuadorian Localization` section.

Configure the following information, starting with the :guilabel:`Electronic Invoicing` section:

- :guilabel:`Company legal name`
- :guilabel:`Regime`: Select whether the company is in the :guilabel:`Regular Regime (without
  additional messages in the RIDE)` or is qualified as in the :guilabel:`RIMPE Regime`.
- :guilabel:`Special Taxpayer Number`: If the company is qualified as a special taxpayer, complete
  this field with the company's corresponding tax contributor number.
- :guilabel:`Forced to Keep Accounting Books`: Enable this option if needed.

:guilabel:`Withholding` section:

- :guilabel:`Consumables`: Enter the code of the default withholding tax used when purchasing goods.
- :guilabel:`Services`: Enter the code of the default withholding tax used when purchasing services.
- :guilabel:`Credit Card`: Enter the code of the default withholding tax used when purchasing with
  credit cards.
- :guilabel:`Withhold Agent Number`: Enter the company's withholding agent resolution number, if
  applicable.

:guilabel:`SRI Connection` section:

- :guilabel:`Certificate file for SRI`: Select the company's :guilabel:`SRI certificate`. Click
  :icon:`oi-arrow-right` :guilabel:`SRI Certificates` to upload one, if necessary.
- :guilabel:`Use production servers`: Enable this option if electronic documents are used in the
  production environment; leave it disabled if the testing environment is used instead.

:guilabel:`Withholding accounts` section:

- :guilabel:`Sales Tax Base Account`: Enter the company's sales tax base account.
- :guilabel:`Purchase Tax Base Account`: Enter the company's sales tax purchase account.

.. important::
   When using the testing environment, EDI data is sent to test servers.

.. note::
   - The values entered in the :guilabel:`Consumables` and :guilabel:`Services` withholding fields
     are used as default values for domestic **only when** no withholdings are set up on the *SRI
     Taxpayer Type*.
   - The entered :guilabel:`Credit Card` withholding value is always applied when a credit or debit
     card SRI payment method is used.

.. _localizations/ecuador/vat-withholding:

VAT withholding
---------------

.. note::
   This configuration applies only if the SRI recognizes the company as a withholding agent. If not,
   skip this step.

To configure a VAT withholding, go to :menuselection:`Accounting --> Configuration --> Taxpayer Type
SRI`. Then, configure the :guilabel:`Name` of the taxpayer type, the :guilabel:`Goods VAT
Withholding`, and the :guilabel:`Services VAT Withholding`.

.. tip::
   If the :guilabel:`Taxpayer Type` is :guilabel:`Rimpe`, configure the :guilabel:`Profit Withhold`
   percentage.

.. _localizations/ecuador/printer-points:

Printer points
--------------

*Printer points* need to be configured for each type of electronic document used, such as customer
invoices, credit notes, and debit notes.

To configure printer points, navigate to :menuselection:`Accounting --> Configuration -->
Journals`. For each electronic document, click :guilabel:`New`, and enter the following information
on the journal form:

- :guilabel:`Journal Name`: Enter in this format: `[Emission Entity]-[Emission Point] [Document
  Type]`, e.g., `001-001 Sales Documents`.
- :guilabel:`Type`: Refers to the journal type; select :guilabel:`Sales`.

Once the :guilabel:`Type` is selected, complete the following fields:

- :guilabel:`Use Documents?`: Enable this option if legal invoicing (invoices, debit/credit notes)
  is used, as this is the standard configuration. If not, select the option to record accounting
  entries unrelated to legal invoicing documents, such as receipts, tax payments, or journal
  entries.
- :guilabel:`Emission Entity`: Enter the facility number.
- :guilabel:`Emission Point`: Enter the printer point.
- :guilabel:`Emission address`: Enter the address of the facility.

In the :guilabel:`Journal Entries` tab, under the :guilabel:`Accounting information` section, fill
in the following fields:

- :guilabel:`Default Income Account`: Enter the default income account.
- :guilabel:`Dedicated Credit Note Sequence`: Enable this option if *credit notes* should be
  generated from this printer point (i.e., the journal).
- :guilabel:`Dedicated Debit Note Sequence`: Enable this option if *debit notes* should be
  generated from this printer point (i.e., the journal).
- :guilabel:`Short Code`: Enter a unique 5-digit code for the accounting entry sequence (e.g.,
  VT001).

Customer invoices, credit notes, and debit notes must use the same journal as the
:guilabel:`Emission Point`, whereas the :guilabel:`Entity Point` should be unique per journal.

Finally, in the :guilabel:`Advanced Settings` tab, check the :guilabel:`Electronic invoicing`
checkbox to enable sending XML/EDI invoices.

.. seealso::
   :doc:`../accounting/customer_invoices/electronic_invoicing`

.. _localizations/ecuador/withholding:

Withholding
-----------

To define a *withholding journal*, go to :menuselection:`Accounting --> Configuration --> Journals`.
For each withholding journal, click :guilabel:`New`, and enter the following information:

- :guilabel:`Journal Name`: Enter this format: `[Emission Entity]-[Emission Point] [Document Type]`,
  e.g.,`001-001 Withholding`.
- :guilabel:`Type`: Refers to the journal type. Select :guilabel:`Miscellaneous`.
- :guilabel:`Withhold Type`: Select :guilabel:`Purchase Withhold`.

Once the :guilabel:`Type` and :guilabel:`Withhold Type` are selected, complete the following fields:

- :guilabel:`Emission Entity`: Enter the facility number.
- :guilabel:`Emission Point`: Enter the printer point.
- :guilabel:`Emission address`: Enter the address of the facility.

In the :guilabel:`Journal Entries` tab, under the :guilabel:`Accounting information` section, fill
in the following fields:

- :guilabel:`Default Account`: Configure the default income account.
- :guilabel:`Short Code`: Enter a unique 5-digit code for the accounting entry sequence (e.g.,
  `WT001`).

Finally, in the :guilabel:`Advanced Settings` tab, check the :guilabel:`Electronic invoicing`
checkbox to enable sending XML/EDI invoices.

.. _localizations/ecuador/reporting:

Reporting
---------

Ecuadorian companies submit fiscal reports to the SRI, with Odoo supporting two main ones: **reports
103** and **104**.

To get these reports, go to :menuselection:`Accounting --> Reporting --> Tax Return`.  Click the
:icon:`fa-book` :guilabel:`Report:` icon and select `103 (EC)` or `104 (EC)`.

.. _localizations/ecuador/report-103:

Report 103
~~~~~~~~~~

This report details income tax withholdings in a given period and can be reported monthly or
semi-annually. It includes information about base, tax amounts, and tax codes and can be used for
SRI reporting.

.. _localizations/ecuador/report-104:

Report 104
~~~~~~~~~~

This report details VAT tax and VAT withholding for a given period and can be generated monthly or
semi-annually. It includes information about base, tax amounts, and tax codes and can be used for
SRI reporting.

.. _localizations/ecuador/ats:

ATS report
~~~~~~~~~~

To enable downloading the ATS :abbr:`ATS (Anexo Transaccional Simplificado)` report in XML format,
:doc:`install </applications/general/apps_modules>` the *ATS Report* (`l10n_ec_reports_ats`) module.

.. note::
   The Ecuadorian *ATS Report* module depends on the previous installation of the *Accounting* app
   and the *Ecuadorian EDI module*.

.. _localizations/ecuador/ats-configuration:

Configuration
*************

To issue electronic documents, ensure the company is configured as explained in the
:ref:`electronic invoice <localizations/ecuador/company-contact>` section. In the :abbr:`ATS (Anexo
Transaccional Simplificado)`, every document generated in Odoo, such as :ref:`invoices
<localizations/ecuador/customer-invoice>`, :ref:`vendor bills <localizations/ecuador/vendor-bill>`,
:ref:`sales <localizations/ecuador/customer-withholdings>` and :ref:`purchases withholdings
<localizations/ecuador/purchase-withholding>`, :ref:`credit notes
<localizations/ecuador/credit-notes>`, and :ref:`debit notes <localizations/ecuador/debit-notes>`,
is included.

.. _localizations/ecuador/ats-vendor-bills:

Vendor bills
^^^^^^^^^^^^

When generating a :ref:`vendor bill <localizations/ecuador/vendor-bill>`, register the authorization
number from the vendor's invoice. To do so, go to :menuselection:`Accounting --> Vendors --> Bills`
and select the bill. Then, enter the number from the vendor's invoice in the
:guilabel:`Authorization Number` field.

.. _localizations/ecuador/ats-credit-debit-notes:

Credit and debit notes
^^^^^^^^^^^^^^^^^^^^^^

When creating a :ref:`credit <localizations/ecuador/credit-notes>` or :ref:`debit
<localizations/ecuador/debit-notes>` note manually or through an import, link it to the sales
invoice it modifies.

.. note::
   Some information is required to the documents before downloading the :abbr:`ATS (Anexo
   Transaccional Simplificado)` file. For example, add the *Authorization Number* and the *SRI
   Payment Method* to documents when needed.

.. _localizations/ecuador/ats-xml-generation:

XML generation
**************

To generate the :abbr:`ATS (Anexo Transaccional Simplificado)` report, go to
:menuselection:`Accounting --> Reporting --> Tax Return`. Choose a period for the desired :abbr:`ATS
(Anexo Transaccional Simplificado)` report, then click :guilabel:`ATS`. Then, upload the downloaded
XML file to *DIMM Formularios*.

.. note::
   When downloading the :abbr:`ATS (Anexo Transaccional Simplificado)` report, Odoo generates a
   warning pop-up alerting the user if a document(s) has missing or incorrect data. Nevertheless,
   the XML file can still be downloaded.

.. _localizations/ecuador/accounting:

Accounting
==========

.. _localizations/ecuador/sales-documents:

Sales documents
---------------

.. _localizations/ecuador/customer-invoice:

Customer invoice
~~~~~~~~~~~~~~~~

Customer invoices, electronic documents :doc:`created from sales orders or manually
<../accounting/customer_invoices/overview>`, must contain the following data and, once validated,
are sent to the SRI:

- :guilabel:`Journal`: Select the option matching the customer invoice's printer point.
- :guilabel:`Document Type`: Type the document type in this format: `(01) Invoice`.
- :guilabel:`Payment Method (SRI)`: Select how the invoice will be paid.

.. _localizations/ecuador/credit-notes:

Customer credit note
~~~~~~~~~~~~~~~~~~~~

:doc:`Customer credit notes <../accounting/customer_invoices/credit_notes>` are electronic
documents sent to the SRI once validated. :ref:`Credit notes
<accounting/credit_notes/issue-credit-note>` can only be registered from a validated (posted)
invoice.

Keep the :guilabel:`Document Type` on :guilabel:`(04) Credit Note` in the :guilabel:`Credit note`
window.

Filling out a credit note follows the same process as completing an :ref:`invoice
<accounting/invoice/creation>`.

.. note::
   When creating the first credit note, select :guilabel:`Reverse` and assign the first credit note
   number or, by default, Odoo assigns `NotCr 001-001-000000001` as the first credit note number.

.. _localizations/ecuador/debit-notes:

Customer debit note
~~~~~~~~~~~~~~~~~~~

:ref:`Customer debit notes <accounting/credit_notes/issue-debit-note>` are electronic documents sent
to the SRI once validated. They can only be registered from a validated (posted) invoice.

In the :guilabel:`Use Specific Journal` of the :guilabel:`Create Debit Note` window, select the
printer point for the credit note or leave it empty to use the same journal as the original
invoice.

.. _localizations/ecuador/customer-withholdings:

Customer withholding
~~~~~~~~~~~~~~~~~~~~

:guilabel:`Customer withholdings` are non-electronic documents issued by the client to apply a
withholding to a sale. They can only be registered from a validated (posted) invoice.

On the invoice, click :guilabel:`Add Withhold` and complete the following information in the
:guilabel:`Customer withholding` window:

- :guilabel:`Document Number`: Enter the withholding number.
- :guilabel:`Withhold Lines`: Select the taxes that the customer is withholding.

Before validating the withholding, review that the amounts for each tax are the same as the original
document.

.. _localizations/ecuador/purchase-documents:

Purchase documents
------------------

.. _localizations/ecuador/vendor-bill:

Vendor bill
~~~~~~~~~~~

:doc:`Vendor bills <../accounting/vendor_bills>`, non-electronic documents created from purchase
orders or manually, require a specific :ref:`vendor bill journal
<localizations/ecuador/vendor-bills-journal>`.

.. _localizations/ecuador/vendor-bills-journal:

Vendor bills journal
********************

Use the following configuration to set up the vendor bills journal:

- Select :guilabel:`Purchase` as the :guilabel:`Type`.
- **Do not** tick the :guilabel:`Purchase Liquidations` checkbox.
- Add a :guilabel:`Default Expense Account`.

To configure a vendor bill, make sure also to complete the following Ecuador-specific fields:

- :guilabel:`Document Type`: Enter this document type: `(01) Invoice`.
- :guilabel:`Document number`: Enter the document number.
- :guilabel:`Payment Method (SRI)`: Select how to pay the vendor bill.

.. important::
   When creating the purchase withholding, verify that the bases (base amounts) are correct. If the
   amount of the tax in the :guilabel:`Vendor bill` needs to be edited, click :guilabel:`Edit`. Or,
   from the :guilabel:`Journal Items` tab, click :guilabel:`Edit` and set the adjustment as desired.

.. _localizations/ecuador/purchase-liquidation:

Purchase liquidation
~~~~~~~~~~~~~~~~~~~~

*Purchase liquidations* are electronic documents sent to the SRI once they're validated. Companies
issue them when they make a purchase, but the vendor does not provide an invoice due to one or more
of the following reasons:

- Non-residents of Ecuador provided services.
- Foreign companies provided services without residency or facility in Ecuador.
- Purchase of goods or services from natural persons not registered with a RUC, who cannot issue
  sales receipts or customer invoices.
- Reimbursement for purchasing goods or services must be given to employees in a dependency
  relationship (full-time employee).
- Members of collegiate bodies have provided services in the exercise of their function.

In these cases, a :ref:`purchase liquidation journal
<localizations/ecuador/purchase-liquidation-journal>` must be created.

.. _localizations/ecuador/purchase-liquidation-journal:

Create a purchase liquidation journal
*************************************

To create a *purchase liquidations* journal, enter the following information:

- :guilabel:`Journal Name`: Enter this format: `[Emission Entity]-[Emission Point] [Document Type]`,
  e.g., `001-001 Purchase Liquidations`.
- :guilabel:`Type`: Refers to the journal type. Select :guilabel:`Purchase`.

Once the :guilabel:`Type` is selected, complete the following fields:

- :guilabel:`Purchase Liquidations`: Tick this checkbox to enable purchase liquidations.
- :guilabel:`Use Documents?`: Enable this option if legal invoicing (invoices, debit/credit notes)
  is used, as this is the standard configuration. If not, select the option to record accounting
  entries unrelated to legal invoicing documents, such as receipts, tax payments, or journal
  entries.
- :guilabel:`Emission Entity`: Enter the facility number.
- :guilabel:`Emission Point`: Enter the printer point.
- :guilabel:`Emission address`: Enter the address of the facility.
- :guilabel:`Short Code`: Enter a unique 5-digit code for the accounting entry sequence (e.g.,
  `PT001`).

Finally, in the :guilabel:`Advanced Settings` tab, check the :guilabel:`Electronic invoicing`
checkbox to enable sending XML/EDI invoices.

.. _localizations/ecuador/purchase-liquidation-creation:

Create a purchase liquidation
*****************************

Purchase liquidations, created from *purchase orders* or manually from *vendor bills*, must contain
the following data:

- :guilabel:`Vendor`: Enter the vendor's information.
- :guilabel:`Journal`: Select the :guilabel:`Purchase Liquidation` journal with the correct printer
  point.
- :guilabel:`Document Type`: Enter this document type: `(03) Purchase Liquidation`.
- :guilabel:`Document number`: Enter the document number (sequence). This must only be entered once,
  and the sequence will automatically be assigned to the subsequent documents.
- :guilabel:`Payment Method (SRI)`: Select how to pay the invoice.
- :guilabel:`Products`: Specify the product with the correct taxes.

Then, validate the :guilabel:`Purchase Liquidation`.

.. _localizations/ecuador/purchase-withholding:

Purchase withholding
~~~~~~~~~~~~~~~~~~~~

*Purchase withholdings* are electronic documents sent to the SRI once they're validated. They can
only be registered from a validated (posted) invoice.

On the invoice, click :guilabel:`Add Withhold` and complete the following fields in the
:guilabel:`Withhold` window:

- :guilabel:`Document number`: Enter the document number (sequence). This must only be entered once,
  and the sequence will automatically be assigned for the next documents.
- :guilabel:`Withhold lines`: The taxes appear automatically according to the configuration of
  products and vendors. Review if the taxes and tax support are correct. If not, edit and select
  the correct taxes and tax support.

Then, validate the :guilabel:`Withholding`.

.. note::
   Tax support types must be configured on the :guilabel:`Vendor Bill`. To do so, go to the tax
   applied on the :guilabel:`Vendor Bill` and change the :guilabel:`Tax Support` there.

A withholding tax can be divided into two or more lines, depending on whether two or more
withholding percentages apply.

.. example::
   Odoo suggests a VAT withholding of 30% with tax support 01. VAT withholding of 70% can be added
   to a new line with the same tax support. Odoo allows it if the base total matches the
   :guilabel:`Vendor Bill`'s total.

.. _localizations/ecuador/expense reimbursement:

Expense reimbursement
---------------------

Expense reimbursements apply to the following cases:

- :guilabel:`Individual`: reimbursement to an employee for miscellaneous expenses (e.g., purchase
  liquidations)
- :guilabel:`Legal Entity`: reimbursement for incurred expenses, such as representation expenses
  (e.g., hiring a lawyer)

To enable expense reimbursement, make sure a :ref:`purchase liquidation journal
<localizations/ecuador/purchase-liquidation>` has been created for an individual or a :ref:`vendor
bills journal <localizations/ecuador/vendor-bill>` for a legal entity.

.. note::
   In the vendor bills journal, be sure the following necessary configurations are set for a legal
   entity:

   - Select :guilabel:`Purchase` as the :guilabel:`Type`.
   - **Do not** tick the :guilabel:`Purchase Liquidations` checkbox.
   - Add a :guilabel:`Default Expense Account`.

Next, to create a reimbursement, :ref:`create a vendor bill <localizations/ecuador/vendor-bill>`
using the *purchase liquidation* or *vendor bills* journal. On the vendor bill, configure the
following fields:

- :guilabel:`Vendor`: This field should be an employee.
- :guilabel:`Document Type`: Verify that this field is accurately populated from the journal.
- :guilabel:`Payment Method (SRI)`: Select a payment method.
- :guilabel:`Reimbursement Lines` tab: Click :guilabel:`Auto Fill Invoice Lines` to automatically
  populate the invoice lines or add the expenses line by line, and provide the following details for
  each expense:

  - :guilabel:`Partner or authorization number`
  - :guilabel:`Date`
  - :guilabel:`Document Type`
  - :guilabel:`Document Number`
  - :guilabel:`Tax Base`
  - :guilabel:`Tax`

Then, click :guilabel:`Confirm Vendor Bill` and :guilabel:`Process Now`. The XML and authorization
number for the purchase liquidation are recorded, and the purchase withholding created from this
vendor bill includes the reimbursement information.

.. image:: ecuador/l10n-ec-individual-flow.png
   :alt: Expense Reimbursement.

.. _localizations/ecuador/electronic-delivery-guide:

Electronic delivery guide
-------------------------

An *Electronic Delivery Guide* in Ecuador is a legal document that supports the transportation of
goods or merchandise from one place to another within the national territory. It is issued by the
sender of the goods and aims to record and justify the movement of products to avoid legal or tax
issues. It is a fiscal requirement mandated by the *Internal Revenue Service (SRI)*.

.. important::
   Make sure to :doc:`install </applications/general/apps_modules>` the :guilabel:`Ecuadorian
   Delivery Guide` (`l10n_ec_edi_stock`) module.

.. _localizations/ecuador/transporter:

Transporter
~~~~~~~~~~~

To create a new carrier (transporter), first :doc:`create a new contact <../../essentials/contacts>`
and fill out the contact information as a :guilabel:`Company`. Make sure the following fields are
complete:

- :guilabel:`Identification Number`: Select :guilabel:`RUC` and type the carrier's RUC number.
- :guilabel:`SRI Taxpayer Type`: Select :guilabel:`Companies - Legal Entities` as the partner
  position in the tax pyramid to automate the computation of VAT withholdings.

.. image:: ecuador/l10n-ec-carrier-contact.png
   :alt: Configuration of a carrier contact.

.. _localizations/ecuador/certificate-file:

Certificate file for SRI
~~~~~~~~~~~~~~~~~~~~~~~~

To upload the certificate file for SRI, go to :menuselection:`Accounting --> Configuration -->
Settings`, scroll to the :guilabel:`Ecuadorian Localization` section, and click
:icon:`oi-arrow-right` :guilabel:`SRI Certificates` in the :guilabel:`SRI Connection` section. Then,
to create a new certificate, click :guilabel:`New` and fill out the following fields:

- :guilabel:`Name`: The title of the certificate.
- :guilabel:`Certificate`: Use the :guilabel:`Upload your file` button to upload the SRI
  certificate.
- :guilabel:`Certificate Password`: Include the password to decrypt the PKS file if required.

Once the certificate is created, click :guilabel:`Settings` to go back to the settings and ensure
the certificate is selected in the :guilabel:`Certificate file for SRI` field and the :guilabel:`Use
production servers` checkbox is ticked.

.. _localizations/ecuador/warehouse configuration:

Warehouse configuration
~~~~~~~~~~~~~~~~~~~~~~~

To configure a warehouse, first :doc:`create a new warehouse
<../../inventory_and_mrp/inventory/warehouses_storage/inventory_management/warehouses>`. Enter the
following data for each warehouse that generates an electronic delivery guide:

- :guilabel:`Entity Point`: the emission entity number given by the SRI
- :guilabel:`Emission Point`: the emission point number given by the SRI
- :guilabel:`Next Delivery Guide Number`: the forwarding tracking number (editable after first
  saving the warehouse).

.. _localizations/ecuador/generate-electronic-delivery:

Generate an electronic delivery guide
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Once the :doc:`delivery <../../inventory_and_mrp/inventory/shipping_receiving/setup_configuration>`
from inventory is created during the sales workflow, make sure the following fields are complete in
the :guilabel:`Delivery Guide` section on the :guilabel:`Additional info` tab:

- :guilabel:`Transporter`: Enter the :ref:`contact <localizations/ecuador/transporter>` created.
- :guilabel:`Plate Number`: Enter the vehicle plate number.
- :guilabel:`Transfer Reason`: By default, :guilabel:`Goods dispatch` is set; modify as needed.
- :guilabel:`Start date`: Automatically set to the creation date (editable).
- :guilabel:`End date`: Automatically set to 15 days after the start date (editable).

.. image:: ecuador/l10n-ec-delivery-guide-settings.png
   :alt: Delivery Guide Settings.

Click :guilabel:`Validate`, then :guilabel:`Generate Delivery Guide`. Subsequently, the following
information will be available in the :guilabel:`Delivery Guide` section:

- :guilabel:`Authorization date`: date on which the government authorizes the document.
- :guilabel:`Authorization number`: EDI authorization number (same as access key).
- :guilabel:`Delivery Guide Status`: status of the delivery guide.

.. image:: ecuador/l10n-ec-authorization-number.png
   :alt: Authorization number.

To receive the XML and PDF, an email can be sent to the contact used in the :guilabel:`Delivery
Address` field  - this is an optional and manual step; the :guilabel:`Send Email` button needs to be
clicked.

.. image:: ecuador/l10n-ec-delivery-guide-pdf.png
   :alt: Delivery Guide PDF.

.. _localizations/ecuador/ecommerce:

eCommerce
=========

The :ref:`ATS Report module <localizations/ecuador/ats>` enables the following:

- Choose the *SRI Payment Method* for each payment method's configuration.
- Customers can manually input their identification type and number during eCommerce checkout.
- Automatically generate a valid electronic invoice for Ecuador at the end of the checkout process.

.. seealso::
   :doc:`eCommerce documentation <../../websites/ecommerce>`

.. _localizations/ecuador/online-payments:

Online payments
---------------

To enable online payments, add the relevant :doc:`payment provider(s) <../payment_providers>` and
configure the necessary :ref:`payment methods <payment_providers/payment_methods>`. It is mandatory
to set the :guilabel:`SRI Payment Method` for each method.

.. note::
   Adding the :guilabel:`SRI Payment Method` is necessary to correctly generate the electronic
   invoice from an eCommerce sale. Select a **payment method** to access its configuration menu and
   field.

.. _localizations/ecuador/automatic-invoice:

Automatic invoice
-----------------

:ref:`Invoices <handling/legal>` can be generated after the checkout process.

.. tip::
   The invoice's email template can be modified from the :guilabel:`Invoice Email Template` field
   under the :guilabel:`Automatic Invoice` option.

.. important::
   The sales journal used for invoicing is the first in the priority sequence in the
   :guilabel:`Journal` menu.

.. _localizations/ecuador/ecommerce-workflow:

Identification type and number
------------------------------

During the checkout process, the client making a purchase will have the option to indicate their
identification type and number. This information is required to generate the electronic invoice
after the checkout is completed correctly.

.. note::
   Verification is done to ensure the :guilabel:`Identification Number` field is completed and has
   the correct number of digits. For RUC identification, 13 digits are required, and for Cédula, 9
   digits are required.

After finishing the checkout process, a confirmed invoice is generated, ready to be sent manually or
asynchronously to the SRI.

.. _localizations/ecuador/point-of-sale:

Point of sale electronic invoicing
==================================

Make sure the *Ecuadorian module for Point of Sale* (`l10n_ec_edi_pos`) is :ref:`installed
<localizations/ecuador/module-installation>` to enable the following features and configurations:

- Choose the SRI payment method in each payment method configuration.
- Manually input the customer's identification type and number when creating a new contact on *POS*.
- Automatically generate a valid electronic invoice for Ecuador at the end of the checkout process.

.. _localizations/ecuador/payment-method-configuration:

Payment method configuration
----------------------------

To :doc:`create a payment method for a point of sale <../../sales/point_of_sale/payment_methods>`,
go to :menuselection:`Point of Sale --> Configuration --> Payment Methods`. Then, set the
:guilabel:`SRI Payment Method` in the payment method form.

.. _localizations/ecuador/invoicing-flow:

Invoicing flows
---------------

.. _localizations/ecuador/identification-type-number:

Identification type and number
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The P0S cashier can :ref:`create a new contact for a customer <pos/customers>` who requests an
invoice from an open POS session.

The *Ecuadorian Module for Point of Sale* adds two new fields to the contact creation form:
:guilabel:`Identification Type` and :guilabel:`Tax ID`.

.. note::
   As the identification number length differs depending on the identification type, Odoo
   automatically checks the :guilabel:`Tax ID` field when saving the contact form. To manually
   ensure the length is correct, know that the :guilabel:`RUC` and :guilabel:`Citizenship` types
   require 13 and 10 digits, respectively.

.. _localizations/ecuador/anonymous-end-consumer:

Electronic invoice: anonymous end consumer
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

When clients do not request an electronic invoice for their purchase, Odoo automatically sets the
customer as :guilabel:`Consumidor Final` and generates an electronic invoice anyway.

.. note::
   If the client requests a credit note due to a return of this type of purchase, the credit note
   should be made using the client's real contact information. Credit notes cannot be created for
   *Consumidor Final* and can be managed :ref:`directly from the POS session <pos/refund>`.

.. _localizations/ecuador/specific-customer:

Electronic invoice: specific customer
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

If a customer requests an invoice for their purchase, it is possible to select or create a contact
with their fiscal information. This ensures the invoice is generated with accurate customer details.

.. note::
   If the client requests a credit note due to a return of this type of purchase, the credit note
   and return process can be managed :ref:`directly from the POS session <pos/refund>`.


==================================================
SECTION: egypt.rst
PATH: applications/finance/fiscal_localizations/egypt.rst
==================================================

=====
Egypt
=====

.. _egypt/installation:

Installation
============

:ref:`Install <general/install>` the following modules to get all the features of the Egyptian
localization:

.. list-table::
   :header-rows: 1

   * - Name
     - Technical name
     - Description
   * - :guilabel:`Egypt - Accounting`
     - ``l10n_eg``
     - Default :ref:`fiscal localization package <fiscal_localizations/packages>`
   * - :guilabel:`Egyptian E-invoice Integration`
     - ``l10n_eg_edi_eta``
     - :ref:`Egyptian Tax Authority (ETA) e-invoicing integration <egypt/e-invoicing>`

.. _egypt/e-invoicing:

Egyptian e-invoicing
====================

Odoo is compliant with the **Egyptian Tax Authority (ETA) e-invoicing** requirements.

.. important::
   Egyptian e-invoicing is available from Odoo 15.0. If needed, :doc:`upgrade
   </administration/upgrade>` your database.

.. seealso::
   - `Video: Egypt E-invoicing <https://www.youtube.com/watch?v=NXuBPLR4pVw>`_
   - :doc:`/administration/upgrade`

.. _egypt/e-invoicing-eta-portal:

Register Odoo on your ETA portal
--------------------------------

You must register your Odoo ERP system on your ETA portal to get your API credentials. You need
these codes to :ref:`configure your Odoo Accounting app <egypt/e-invoicing-configuration>`.

Access your company profile on the ETA portal by clicking on :guilabel:`View Taxpayer Profile`.

.. image:: egypt/taxpayer-profile.png
   :align: center
   :alt: Clicking on "View Taxpayer Profile" on an ETA invoicing portal

Next, go to the :guilabel:`Representatives` section and then click on :guilabel:`Register ERP`.
Fill out the :guilabel:`ERP Name` (e.g., ``Odoo``) and leave the other fields empty.

.. image:: egypt/add-erp-system.png
   :align: center
   :alt: Filling out of the form to register an ERP system on the ETA portal.

Once successfully registered, the website displays your API credentials:

- Client ID
- Client Secret 1
- Client Secret 2

.. note::
   - ETA should give you a username and a password to access their online portal.
   - Ask ETA to provide you with preproduction portal access as well.
   - These codes are confidential and should be stored safely.

.. _egypt/e-invoicing-configuration:

Configuration on Odoo
---------------------

To connect your Odoo database to your ETA portal account, go to :menuselection:`Accounting -->
Configuration --> Settings --> ETA E-Invoicing Settings`, and set the :guilabel:`ETA Client ID` and
:guilabel:`ETA Secret` that you retrieved when you :ref:`registered Odoo on your ETA portal
<egypt/e-invoicing-eta-portal>`. Set an invoicing threshold if needed.

.. image:: egypt/eta-api-integration.png
   :align: center
   :alt: Configuration of the ETA E-Invoicing credentials in Odoo Accounting

.. important::
   - **Test on your preproduction portal** before starting to issue real invoices on the production
     ETA portal.
   - **Credentials** for preproduction and production environments are different. Make sure to
     update them on Odoo when you move from one environment to another.
   - If not done yet, fill out your company details with your company's full address, country, and
     Tax ID.

.. _egypt/e-invoicing-eta-codes:

ETA codes
~~~~~~~~~

E-invoicing works with a set of codes provided by the ETA. You can use the `ETA documentation
<https://sdk.preprod.invoicing.eta.gov.eg/codes/>`_ to code your business attributes.

Most of these codes are handled automatically by Odoo, provided that your :ref:`branches
<egypt/e-invoicing-branches>`, :ref:`customers <egypt/e-invoicing-customers>`, and :ref:`products
<egypt/e-invoicing-products>` are correctly configured.

- Company Information:

  - Company Tax ID
  - | Branch ID
    | If you have only one branch, use ``0`` as the branch code.
  - Activity type Code

- Other Information:

  - | Product Codes
    | Your company's products should be coded and matched with their **GS1** or **EGS** codes.
  - | Tax Codes
    | Most of the taxes codes are already configured on Odoo in the :guilabel:`ETA Code (Egypt)`
      field. We advise you to make sure these codes match your company's taxes.

.. seealso::
   - `Egyptian eInvoicing & eReceipt SDK - Code Tables
     <https://sdk.preprod.invoicing.eta.gov.eg/codes/>`_
   - :doc:`../accounting/taxes`

.. _egypt/e-invoicing-branches:

Branches
~~~~~~~~

Create a contact and a journal for each branch of your company and configure its ETA settings.

To do so, go to :menuselection:`Accounting --> Configuration --> Journals`, then click on
:guilabel:`Create`.

Name the journal according to your company's branch and set the :guilabel:`Type` as
:guilabel:`Sales`. Next, open the :menuselection:`Advanced Settings` tab and fill out the
:guilabel:`Egyptian ETA settings` section:

- In the :guilabel:`Branch` field, select the branch's contact or create it.
- Set the :guilabel:`ETA Activity Code`.
- Set the :guilabel:`ETA Branch ID` (use ``0`` if you have one branch only).

.. image:: egypt/branch-journal.png
   :align: center
   :alt: Sales journal configuration of an Egyptian company's branch

.. important::
   The contact selected in the :guilabel:`Branch` field must be set as a :guilabel:`Company`
   (**not** as an :guilabel:`Individual`), and the :guilabel:`Address` and :guilabel:`Tax ID` fields
   must be filled out.

.. _egypt/e-invoicing-customers:

Customers
~~~~~~~~~

Make sure your customers' contact forms are correctly filled out so your e-invoices are valid:

- contact type: :guilabel:`Individual`: or :guilabel:`Company`:
- :guilabel:`Country`:
- :guilabel:`Tax ID`: Tax ID or Company registry for companies. National ID for individuals.

.. note::
   You can edit your customers' contact forms by going to :menuselection:`Accounting --> Customers
   --> Customers`.

.. _egypt/e-invoicing-products:

Products
~~~~~~~~

Make sure your products are correctly configured so your e-invoices are valid:

- :guilabel:`Product Type`: storable products, consumables, or services.
- :guilabel:`Unit of Measure`: if you also use Odoo Inventory and have enabled :doc:`Units of
  Measure <../../inventory_and_mrp/inventory/product_management/configure/uom>`.
- :guilabel:`Barcode`: **GS1** or **EGS** barcode
- :guilabel:`ETA Item code` (under the :menuselection:`Accounting` tab): if the barcode doesn't
  match your ETA item code.

.. note::
   You can edit your products by going to :menuselection:`Accounting --> Customers --> Products`.

.. _egypt/e-invoicing-usb-authentication:

USB authentication
------------------

Each person who needs to electronically sign invoices needs a specific USB key to authenticate and
send invoices to the ETA portal through an ERP.

.. note::
   You can contact the :abbr:`ETA (Egyptian Tax Authority)` or `Egypt Trust
   <https://www.egypttrust.com/>`_ to get these USB keys.

.. _egypt/e-invoicing-local-proxy:

Install Odoo as a local proxy on your computer
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

An Odoo local server works as a bridge between your computer and your Odoo database hosted online.

Download the Odoo Community installer from the page https://www.odoo.com/page/download and start the
installation on your computer.

Select :guilabel:`Odoo IoT` as the type of install.

.. image:: egypt/install-odoo-local-proxy.png
   :align: center
   :alt: Selection of "Odoo IoT" during the installation of Odoo Community.

.. note::
   This installation of Odoo only works as a server and does not install any Odoo apps on your
   computer.

Once the installation is complete, the installer displays your **access token** for the Odoo Local
Proxy. Copy the token and save it in a safe place for later use.

.. seealso::
   - `Odoo: Download Odoo <https://www.odoo.com/page/download>`_
   - :doc:`../../../administration/on_premise`

.. _egypt/e-invoicing-usb-configuration:

Configure the USB key
~~~~~~~~~~~~~~~~~~~~~

Once the local proxy server is installed on your computer, you can link it with your Odoo database.

#. Go to :menuselection:`Accounting --> Configurations --> Thumb Drive` and click on
   :guilabel:`Create`.
#. Input a :guilabel:`Company` name, the :guilabel:`ETA USB Pin` given to you by your USB key
   provider, and the :guilabel:`Access Token` provided at the end of the :ref:`local proxy
   installation <egypt/e-invoicing-local-proxy>`, then click on :guilabel:`Save`.
#. Click on :guilabel:`Get certificate`.

.. image:: egypt/thumb-drive.png
   :align: center
   :alt: Creating a new thumb drive for the e-invoicing of an egyptian company.


==================================================
SECTION: fiscal_localizations.rst
PATH: applications/finance/fiscal_localizations.rst
==================================================

:show-content:

====================
Fiscal localizations
====================

Fiscal localizations are country-specific modules that allow you to be compliant with a country's
fiscal requirements. Most of these modules are related to the Accounting app, but they can also be
necessary for other apps such as Point of Sale, eCommerce, etc., depending on a country's fiscal
requirements.

.. seealso::
   :doc:`../hr/payroll/payroll_localizations` are documented separately.

.. _fiscal_localizations/packages:

Configuration
=============

Odoo should automatically install the fiscal localization's core modules based on the company's
country when the related app is installed. The rest can be manually :ref:`installed
<general/install>`. Refer to the :ref:`list of countries <fiscal_localizations/countries-list>` to
view the currently supported countries and access their specific documentation.

.. note::
   Each company in a multi-company environment can use different fiscal localization modules.

Verify the right package of modules is installed by going to :menuselection:`Accounting -->
Configuration --> Settings` and checking the :guilabel:`Package` field under the :guilabel:`Fiscal
Localization` section. Select another one if necessary.

.. warning::
   Selecting another package is only possible if no entry has been posted.

These packages require fine-tuning the chart of accounts, activating the taxes to be used,
configuring the country-specific statements and certifications, and sometimes more.

.. _fiscal_localizations/countries-list:

List of countries
=================

Fiscal localization modules are available for the countries listed below.

.. note::
   New countries are frequently added to this list and Odoo keeps expanding and improving existing
   localizations and the related documentation.

- Algeria
- :doc:`Argentina <fiscal_localizations/argentina>`
- :doc:`Australia <fiscal_localizations/australia>`
- :doc:`Austria <fiscal_localizations/austria>`
- Bangladesh
- :doc:`Belgium <fiscal_localizations/belgium>`
- Benin
- Bolivia
- :doc:`Brazil <fiscal_localizations/brazil>`
- Burkina Faso
- Bulgaria
- Cameroon
- :doc:`Canada <fiscal_localizations/canada>`
- Central African Republic
- Chad
- :doc:`Chile <fiscal_localizations/chile>`
- China
- :doc:`Colombia <fiscal_localizations/colombia>`
- Comoros
- Congo
- Costa Rica
- Croatia
- Cyprus
- Czech Republic
- Democratic Republic of the Congo
- :doc:`Denmark <fiscal_localizations/denmark>`
- Dominican Republic
- :doc:`Ecuador <fiscal_localizations/ecuador>`
- :doc:`Egypt <fiscal_localizations/egypt>`
- Equatorial Guinea
- Estonia
- Ethiopia
- Finland
- :doc:`France <fiscal_localizations/france>`
- Gabon
- :doc:`Germany <fiscal_localizations/germany>`
- Guinea
- Greece
- :doc:`Guatemala <fiscal_localizations/guatemala>`
- Guinea-Bissau
- Honduras
- :doc:`Hong Kong <fiscal_localizations/hong_kong>`
- Hungary
- :doc:`India <fiscal_localizations/india>`
- :doc:`Indonesia <fiscal_localizations/indonesia>`
- :doc:`Italy <fiscal_localizations/italy>`
- Ivory Coast
- Japan
- :doc:`Jordan <fiscal_localizations/jordan>`
- Kazakhstan
- :doc:`Kenya <fiscal_localizations/kenya>`
- Kuwait
- Latvia
- Lithuania
- :doc:`Luxembourg <fiscal_localizations/luxembourg>`
- Mali
- Malta
- Mauritius
- :doc:`Malaysia <fiscal_localizations/malaysia>`
- :doc:`Mexico <fiscal_localizations/mexico>`
- Mongolia
- Morocco
- Mozambique
- :doc:`Netherlands <fiscal_localizations/netherlands>`
- :doc:`New Zealand <fiscal_localizations/new_zealand>`
- Niger
- Nigeria
- Norway
- :doc:`Oman <fiscal_localizations/oman>`
- Pakistan
- Panama
- :doc:`Peru <fiscal_localizations/peru>`
- :doc:`Philippines <fiscal_localizations/philippines>`
- Poland
- Portugal
- Qatar
- :doc:`Romania <fiscal_localizations/romania>`
- Rwanda
- :doc:`Saudi Arabia <fiscal_localizations/saudi_arabia>`
- Senegal
- Serbia
- :doc:`Singapore <fiscal_localizations/singapore>`
- Slovakia
- Slovenia
- South Africa
- :doc:`Spain <fiscal_localizations/spain>`
- Sweden
- :doc:`Switzerland <fiscal_localizations/switzerland>`
- Taiwan
- Tanzania
- :doc:`Thailand <fiscal_localizations/thailand>`
- Tunisia
- Türkiye
- Uganda
- Ukraine
- :doc:`United Arab Emirates <fiscal_localizations/united_arab_emirates>`
- :doc:`United Kingdom <fiscal_localizations/united_kingdom>`
- :doc:`United States of America <fiscal_localizations/united_states>`
- :doc:`Uruguay <fiscal_localizations/uruguay>`
- Venezuela
- :doc:`Vietnam <fiscal_localizations/vietnam>`
- Zambia

.. toctree::
   :titlesonly:

   fiscal_localizations/argentina
   fiscal_localizations/australia
   fiscal_localizations/austria
   fiscal_localizations/belgium
   fiscal_localizations/brazil
   fiscal_localizations/canada
   fiscal_localizations/chile
   fiscal_localizations/colombia
   fiscal_localizations/denmark
   fiscal_localizations/ecuador
   fiscal_localizations/egypt
   fiscal_localizations/france
   fiscal_localizations/germany
   fiscal_localizations/guatemala
   fiscal_localizations/hong_kong
   fiscal_localizations/india
   fiscal_localizations/indonesia
   fiscal_localizations/italy
   fiscal_localizations/jordan
   fiscal_localizations/kenya
   fiscal_localizations/luxembourg
   fiscal_localizations/malaysia
   fiscal_localizations/mexico
   fiscal_localizations/netherlands
   fiscal_localizations/new_zealand
   fiscal_localizations/oman
   fiscal_localizations/peru
   fiscal_localizations/philippines
   fiscal_localizations/romania
   fiscal_localizations/saudi_arabia
   fiscal_localizations/singapore
   fiscal_localizations/spain
   fiscal_localizations/switzerland
   fiscal_localizations/thailand
   fiscal_localizations/united_arab_emirates
   fiscal_localizations/united_kingdom
   fiscal_localizations/united_states
   fiscal_localizations/uruguay
   fiscal_localizations/vietnam


==================================================
SECTION: france.rst
PATH: applications/finance/fiscal_localizations/france.rst
==================================================

======
France
======

.. _localizations/france/configuration/modules:

Modules
=======

The following modules related to the French localization are available:

.. list-table::
    :header-rows: 1

    * - Name
      - Technical name
      - Description
    * - :guilabel:`France - Accounting`
      - `l10n_fr_account`
      - French :ref:`fiscal localization package <fiscal_localizations/packages>` that applies only
        to companies based in mainland France and doesn't include DOM-TOMs.
    * - :guilabel:`France - Accounting Reports`
      - `l10n_fr_reports`
      - Export of the French VAT report, which can be sent to the DGFiP, an OGA, or a professional
        accountant.
    * - :guilabel:`France - Payroll with Accounting`
      - `l10n_fr_hr_payroll_account`
      - Includes the necessary accounting data for the French payroll rules.
    * - :guilabel:`France - Factur-X integration with Chorus Pro`
      - `l10n_fr_facturx_chorus_pro`
      - Adds fields needed for :ref:`submitting invoices to Chorus Pro
        <localizations/france/e-invoicing>`.
    * - :guilabel:`France - FEC Import`
      - `l10n_fr_fec_import`
      - Import of standard FEC files, useful for importing accounting history.
    * - :guilabel:`France - VAT Anti-Fraud Certification for Point of Sale (CGI 286 I-3 bis)`
      - `l10n_fr_pos_cert`
      - :ref:`Point of Sale VAT anti-fraud certification
        <localizations/france/vat-anti-fraud-certification>`

.. note::
   The localization's core modules are installed automatically with the localization. The rest can
   be manually :doc:`installed </applications/general/apps_modules>`.

.. _localizations/france/loc-overview:

Localization overview
=====================

The French localization package ensures compliance with French fiscal and accounting regulations. It
includes tools for managing taxes, fiscal positions, reporting, and a predefined chart of accounts
tailored to France’s standards.

The French localization package provides the following key features to ensure compliance with local
fiscal and accounting regulations:

- :doc:`../accounting/get_started/chart_of_accounts`: a predefined structure tailored to French
  accounting standards
- :doc:`../accounting/taxes/fiscal_positions`: automated tax adjustments based on customer or
  supplier registration status
- :doc:`Taxes <../accounting/taxes>`: pre-configured tax rates, including standard VAT,
  zero-rated, and exempt options
- :doc:`Payroll </applications/hr/payroll>`
- :ref:`Reporting <localizations/france/reporting>`

.. _localizations/france/reporting:

Reporting
---------

:doc:`Installing </applications/general/apps_modules>` the :guilabel:`France - Accounting`
(`l10n_fr_account`) module gives access to some accounting reports specific to France, such as:

- :guilabel:`Bilan comptable (FR)` (:guilabel:`Balance Sheet`)
- :guilabel:`Compte de résultats (FR)` (:guilabel:`Profit and Loss`)
- :guilabel:`Rapport de taxes (FR)` (:guilabel:`Tax Report`)

.. _localizations/france/accounting:

Accounting
==========

.. _localizations/france/e-invoicing:

E-Invoicing
-----------

The `Chorus Pro <https://portail.chorus-pro.gouv.fr/aife_csm>`_ portal, managed by the AIFE (Agence
pour l'Informatique financière de l'État), is the official platform for submitting electronic
invoices to French public entities. It allows businesses to send and manage invoices, track their
processing status, and access payment updates. Since January 2020, electronic invoicing has been
mandatory for all business-to-government (B2G) transactions in France. Odoo supports integration
with Chorus Pro to submit invoices generated in Odoo.

.. _localizations/france/e-invoicing-configuration:

Configuration
~~~~~~~~~~~~~

To send invoices to Chorus Pro, the following configuration is required:

#. :doc:`Install </applications/general/apps_modules>` the :guilabel:`France - Factur-X integration
   with Chorus Pro` (`l10n_fr_facturx_chorus_pro`) module.
#. :ref:`Register <accounting/e-invoicing/peppol-registration>` with Peppol, as invoices are sent
   from Odoo to Chorus Pro via the :ref:`Peppol <accounting/e-invoicing/peppol>` network.
#. If you don’t already have a Chorus Pro account, go to the `Chorus Pro
   <https://portail.chorus-pro.gouv.fr/aife_csm>`_ page, click :guilabel:`Créer un compte`, and
   create one.
#. :ref:`Configure the relevant customers' contact form
   <localizations/france/e-invoicing-contacts>`.

.. seealso::
   `Chorus Pro documentation <https://portail.chorus-pro.gouv.fr/aife_documentation>`_

.. _localizations/france/e-invoicing-contacts:

Customers
*********

To submit invoices to Chorus Pro, configure the relevant customers' contact form as follows:

#. Verify the :guilabel:`Country` and :guilabel:`VAT` fields are filled out.
#. In the :guilabel:`Sales & Purchase` tab, ensure the :guilabel:`SIRET` field is completed.
#. In the :guilabel:`Accounting` tab, fill in the following fields in the :guilabel:`Customer
   Invoices` section:

   - :guilabel:`eInvoice format`: Select :guilabel:`BIS Billing 3.0`.
   - Make sure :guilabel:`France SIRET` is selected in the next field, then type `11000201100044`,
     the reference used by Chorus Pro.

.. _localizations/france/e-invoicing-invoices:

Sending invoices to Chorus Pro
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

To send invoices to Chorus Pro, follow these steps:

#. Go to :menuselection:`Accounting --> Customers --> Invoices` and open or create the invoice.
#. In the :guilabel:`Other Info` tab, make sure the following fields are filled in the
   :guilabel:`Chorus Pro` section:

   - :guilabel:`Buyer Reference`: :guilabel:`Service Exécutant` in Chorus Pro
   - :guilabel:`Contract Reference`: :guilabel:`Numéro de Marché` in Chorus Pro
   - :guilabel:`Purchase Order Reference`: :guilabel:`Engagement Juridique` in Chorus Pro

#. Confirm the invoice.
#. Click :guilabel:`Send` and, in the :guilabel:`Send` window, enable :guilabel:`By Peppol`.
#. Click :guilabel:`Send`.

Once the invoice is sent, the Peppol status of the invoice is updated to :guilabel:`Done`.

.. seealso::
   :ref:`Peppol <accounting/e-invoicing/peppol>`

.. _localizations/france/fec:

FEC - Fichier des Écritures Comptables
--------------------------------------

An FEC :dfn:`Fichier des Écritures Comptables` audit file contains all the accounting data and
entries recorded in all the accounting journals for a financial year. The entries in the file must
be arranged in chronological order. Since January 2014, every French company is required to produce
and transmit this file upon request by the tax authorities for audit purposes.

.. _localizations/france/fec-import:

FEC Import
~~~~~~~~~~

:doc:`Install </applications/general/apps_modules>` the :guilabel:`France - FEC Import`
(`l10n_fr_fec_import`) module to import FEC files from other software.

To enable this feature, go to :menuselection:`Accounting --> Configuration --> Settings`. In the
:guilabel:`Accounting Import` section, click :icon:`oi-arrow-right` :guilabel:`Import` and
:guilabel:`Import FEC`. Then, in the :guilabel:`FEC Import` window, upload the FEC file and click
:guilabel:`Import`.

.. note::
   Importing FEC files from different years requires no particular actions or computations. However,
   if multiple files contain RAN :dfn:`Reports à Nouveaux` with the starting balance for the year,
   these entries are automatically marked as unnecessary in Odoo and may need to be deleted.

.. _localizations/france/fec-file-formats:

File formats
************

.. note::
   - FEC files must be in CSV format, as XML format is not supported.
   - The FEC CSV file is a plain text file structured as a data table. The first line serves as the
     header, defining the list of fields for each entry, and each following line represents a single
     accounting entry without any specific order.

FEC files must comply with the following technical specifications:

- **Encoding**: UTF-8, UTF-8-SIG and iso8859_15.
- **Separator**: any of these: `;` or `|` or `,` or `TAB`.
- **Line terminators**: both CR+LF (`\\r\\n`) and LF (`\\n`) character groups are supported.
- **Date format**: `%Y%m%d`

.. _localizations/france/fec-fields:

Fields description and use
**************************

+----+---------------+--------------------------------------+-----------------------------------+-----------------+
|  # | Field name    | Description                          | Use                               | Format          |
+====+===============+======================================+===================================+=================+
| 01 | JournalCode   | Journal Code                         | `journal.code` and `journal.name` | Alphanumeric    |
|    |               |                                      | if `JournalLib` is not provided   |                 |
+----+---------------+--------------------------------------+-----------------------------------+-----------------+
| 02 | JournalLib    | Journal Label                        | `journal.name`                    | Alphanumeric    |
+----+---------------+--------------------------------------+-----------------------------------+-----------------+
| 03 | EcritureNum   | Numbering specific to each journal   | `move.name`                       | Alphanumeric    |
|    |               | sequence number of the entry         |                                   |                 |
+----+---------------+--------------------------------------+-----------------------------------+-----------------+
| 04 | EcritureDate  | Accounting entry Date                | `move.date`                       | Date (yyyyMMdd) |
+----+---------------+--------------------------------------+-----------------------------------+-----------------+
| 05 | CompteNum     | Account Number                       | `account.code`                    | Alphanumeric    |
+----+---------------+--------------------------------------+-----------------------------------+-----------------+
| 06 | CompteLib     | Account Label                        | `account.name`                    | Alphanumeric    |
+----+---------------+--------------------------------------+-----------------------------------+-----------------+
| 07 | CompAuxNum    | Secondary account Number             | `partner.ref`                     | Alphanumeric    |
|    |               | (accepts null)                       |                                   |                 |
+----+---------------+--------------------------------------+-----------------------------------+-----------------+
| 08 | CompAuxLib    | Secondary account Label              | `partner.name`                    | Alphanumeric    |
|    |               | (accepts null)                       |                                   |                 |
+----+---------------+--------------------------------------+-----------------------------------+-----------------+
| 09 | PieceRef      | Document Reference                   | `move.ref` and `move.name`        | Alphanumeric    |
|    |               |                                      | if `EcritureNum` is not provided  |                 |
+----+---------------+--------------------------------------+-----------------------------------+-----------------+
| 10 | PieceDate     | Document Date                        | `move.date`                       | Date (yyyyMMdd) |
+----+---------------+--------------------------------------+-----------------------------------+-----------------+
| 11 | EcritureLib   | Account entry Label                  | `move_line.name`                  | Alphanumeric    |
+----+---------------+--------------------------------------+-----------------------------------+-----------------+
| 12 | Debit         | Debit amount                         | `move_line.debit`                 | Float           |
+----+---------------+--------------------------------------+-----------------------------------+-----------------+
| 13 | Credit        | Credit amount                        | `move_line.credit`                | Float           |
|    |               | (Field name "Crédit" is not allowed) |                                   |                 |
+----+---------------+--------------------------------------+-----------------------------------+-----------------+
| 14 | EcritureLet   | Accounting entry cross reference     | `move_line.fec_matching_number`   | Alphanumeric    |
|    |               | (accepts null)                       |                                   |                 |
+----+---------------+--------------------------------------+-----------------------------------+-----------------+
| 15 | DateLet       | Accounting entry date                | unused                            | Date (yyyyMMdd) |
|    |               | (accepts null)                       |                                   |                 |
+----+---------------+--------------------------------------+-----------------------------------+-----------------+
| 16 | ValidDate     | Accounting entry validation date     | unused                            | Date (yyyyMMdd) |
+----+---------------+--------------------------------------+-----------------------------------+-----------------+
| 17 | Montantdevise | Currency amount                      | `move_line.amount_currency`       | Float           |
|    |               | (accepts null)                       |                                   |                 |
+----+---------------+--------------------------------------+-----------------------------------+-----------------+
| 18 | Idevise       | Currency identifier                  | `currency.name`                   | Alphanumeric    |
|    |               | (accepts null)                       |                                   |                 |
+----+---------------+--------------------------------------+-----------------------------------+-----------------+

These two fields appear in the same order as the others, replacing them.

+----+---------------+--------------------------------------+-----------------------------------+-----------------+
| 12 | Montant       | Amount                               | `move_line.debit`                 | Float           |
|    |               |                                      | or `move_line.credit`             |                 |
+----+---------------+--------------------------------------+-----------------------------------+-----------------+
| 13 | Sens          | Can be "C" for Credit                | determines `move_line.debit`      | Char            |
|    |               | or "D" for Debit                     | or `move_line.credit`             |                 |
+----+---------------+--------------------------------------+-----------------------------------+-----------------+

.. _localizations/france/fec-implementation:

Implementation details
**********************

The following accounting entities are imported from the FEC files: **Accounts, Journals, Partners**,
and **Moves**. The module automatically determines the encoding, line terminator, and separator used
in the file. Next, a check is performed to ensure that each line has the correct number of fields
matching the header. If the check is successful, the entire file is read, stored in memory, and
scanned. Accounting entities are then imported one type at a time in the following order.

.. _localizations/france/fec-accounts:

Accounts
^^^^^^^^

Each accounting entry is associated with an account identified by the :guilabel:`CompteNum` field.

.. _localizations/france/fec-code-matching:

Code matching
^^^^^^^^^^^^^

If an account with the same code already exists, the existing one is used rather than creating a new
one. In Odoo, account numbers follow the default digit length of the fiscal localization. Since the
FEC module is tied to the French localization, the default account length is 6 digits.
This means that trailing zeros in account codes are removed, and the comparison between the account
codes in the FEC file and those already in Odoo is made based only on the first six digits of the
codes.

.. example::
   The account code `65800000` in the file is matched with an existing `658000` account in Odoo,
   and the existing account is used instead of creating a new one.

.. _localizations/france/fec-reconcilable-flag:

Reconcilable flag
^^^^^^^^^^^^^^^^^

An account is technically flagged as *reconcilable* if the first line in which it appears has the
:guilabel:`EcritureLet` field filled out, indicating that the accounting entry will be reconciled
with another one.

.. note::
   The field can be left empty on the line, but the entry must still be reconciled with an
   unrecorded payment. The account is flagged as reconcilable once the import of the move lines
   requires it.

.. _localizations/france/fec-account-type:

Account type and templates matching
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Since the account **type** is not specified in the FEC format, **new** accounts are created with the
default type :guilabel:`Current Assets`. After the import process, they are matched against the
installed Chart of Account templates. The *reconcile* flag is also determined this way.

The matching is performed by comparing the left-most digits, starting with all digits, followed by
3 digits, and then 2 digits.

.. example::

   +------------+------------+-----------------+---------------------+---------------------+
   | Name       | Code       | Full comparison | 3-digits comparison | 2-digits comparison |
   +============+============+=================+=====================+=====================+
   | Template   | `400000`   | `400000`        | `400`               | `40`                |
   +------------+------------+-----------------+---------------------+---------------------+
   | CompteNum  | `40100000` | `40100000`      | `401`               | `40`                |
   +------------+------------+-----------------+---------------------+---------------------+
   | **Result** |            |                 |                     | Match **found**     |
   +------------+------------+-----------------+---------------------+---------------------+

The account type is then flagged as :guilabel:`payable` and :guilabel:`reconcilable` based on the
account template.

.. _localizations/france/fec-journals:

Journals
^^^^^^^^

Journals are checked against the existing ones in Odoo to avoid duplicates, even when importing
multiple FEC files.

If a journal with the same code already exists, the existing journal is used instead of creating a
new one.

New journals have the prefix :guilabel:`FEC-` added to their name. For example, :guilabel:`ACHATS`
becomes :guilabel:`FEC-ACHATS`.

.. note::
   Journals are *not* archived, allowing the user to manage them as desired.

.. _localizations/france/fec-journal-type:

Journal type determination
^^^^^^^^^^^^^^^^^^^^^^^^^^

The journal type is not specified in the format (similar to the accounts) and is initially created
with the default type :guilabel:`general`.

At the end of the import process, the journal type is determined based on the following rules
regarding related moves and accounts:

- | :guilabel:`bank`: Moves in these journals always include a line (debit or credit) impacting a
    liquidity account.
  | :guilabel:`cash` / :guilabel:`bank` can be interchanged, so :guilabel:`bank` is assigned when
    this condition is met.
- | :guilabel:`sale`: Moves in these journals mostly have debit lines on receivable accounts and
    credit lines on tax income accounts.
  | Sale refund journal items are debit/credit inverted.
- | :guilabel:`purchase`: Moves in these journals mostly have credit lines on payable accounts and
    debit lines on expense accounts.
  | Purchase refund journal items are debit/credit inverted.
- | :guilabel:`general`: Used for everything else.

.. note::
   - A minimum of three moves is required to identify the journal type.
   - A threshold of 70% of the moves must meet the criteria for a journal type to be determined.

.. example::
   Suppose we are analyzing the moves that share a certain :guilabel:`journal_id`.

   +------------------------------------------------------------+-------+------------+
   | Moves                                                      | Count | Percentage |
   +============================================================+=======+============+
   | that have a sale account line and no purchase account line | 0     | 0          |
   +------------------------------------------------------------+-------+------------+
   | that have a purchase account line and no sale account line | 1     | 25%        |
   +------------------------------------------------------------+-------+------------+
   | that have a liquidity account line                         | 3     | **75%**    |
   +------------------------------------------------------------+-------+------------+
   | **Total**                                                  | 4     | 100%       |
   +------------------------------------------------------------+-------+------------+

   The journal :guilabel:`type` would be :guilabel:`bank`, because the bank's move percentage (75%)
   exceeds the threshold (70%).

.. _localizations/france/fec-partners:

Contacts
^^^^^^^^

Each contact keeps its :guilabel:`Reference` from the :guilabel:`CompAuxNum` field.

.. note::
   These fields are searchable based on previous FEC imports for fiscal/audit purposes.

.. tip::
   Similar and potential duplicate contacts can be merged using the Data Cleaning App.

.. _localizations/france/fec-moves:

Moves
^^^^^

Entries are posted and reconciled immediately upon submission, with the :guilabel:`EcritureLet`
field used to match the entries.

The :guilabel:`EcritureNum` field represents the name of the moves, but it may sometimes be left
empty. In such cases, the :guilabel:`PieceRef` field is used instead.

.. _localizations/france/fec-rounding-issue:

Rounding issues
^^^^^^^^^^^^^^^

A rounding tolerance is applied based on currency precision for debit and credit amounts (i.e., 0.01
for EUR). If the difference falls under this tolerance, a new line is added to the move, called
:guilabel:`Import rounding difference`, targeting the following accounts:

- `658000` Charges diverses de gestion courante, for added debits
- `758000` Produits divers de gestion courante, for added credits

.. _localizations/france/fec-missing-move-name:

Missing move name
^^^^^^^^^^^^^^^^^

If the the :guilabel:`EcritureNum` field is not filled out and :guilabel:`PieceRef` field is not
suited to determine the move name (it may be used as an accounting move line reference), it becomes
impossible to identify which lines should be grouped into a single move, and effectively preventing
the creation of balanced moves.

In such cases, a final attempt is made to group all lines by the same journal and date
(:guilabel:`JournalLib`, :guilabel:`EcritureDate`). If this grouping generates balanced moves
(sum(credit) - sum(debit) = 0), then each different combination of journal and date creates a new
move.

.. example::
   `ACH` + `2021/05/01` --> new move on journal `ACH` with name `20210501`.

If this attempt fails, an error message is displayed, listing all the move lines that are considered
unbalanced.

.. _localizations/france/fec-partner-information:

Contact information
^^^^^^^^^^^^^^^^^^^

If a line includes contact information, it is copied to the accounting move itself, provided the
targeted journal is of type :guilabel:`payable` or :guilabel:`receivable`.

.. _localizations/france/fec-export:

FEC Export
~~~~~~~~~~

To download the FEC, go to :menuselection:`Accounting --> Reporting --> General Ledger`. Click the
:icon:`fa-cog` :guilabel:`(gear)` icon and select :guilabel:`FEC`. In
the :guilabel:`FEC File Generation` window, fill in the following fields:

- :guilabel:`Start Date`
- :guilabel:`End Date`
- :guilabel:`Test File`: Enable this option to test the FEC file generation.
- :guilabel:`Exclude lines at 0`: Enable this option if needed.
- :guilabel:`Excluded Journals`: Select the journal(s) to exclude.

Then, click :guilabel:`Generate`.

.. seealso::
   - `Official Technical Specification (fr)
     <https://www.legifrance.gouv.fr/codes/article_lc/LEGIARTI000027804775>`_
   - `Test-Compta-Demat (Official FEC Testing tool)
     <https://github.com/DGFiP/Test-Compta-Demat>`_

.. _localization/france/liasse-fiscale:

Liasse fiscale
--------------

The *liasse fiscale* (tax returns) is a collection of standardized financial documents that
businesses must submit annually to the tax authorities. It comprehensively summarizes the company’s
financial activities and determines corporate taxes.

`Teledec <https://www.teledec.fr>`_ is a platform used to prepare and submit tax returns using data
from accounting records. To synchronize your accounting data stored in Odoo with Teledec and
electronically send your company's *liasse fiscale* to the DGFiP (Direction Générale des Finances
Publiques), follow these steps:

#. :ref:`localization/france/teledec-account`
#. :ref:`localization/france/teledec-registration`
#. :ref:`localization/france/teledec-synchronization`

.. _localization/france/teledec-account:

Teledec account creation
~~~~~~~~~~~~~~~~~~~~~~~~

To create a Teledec account, access the `Teledec account creation page <https://www.teledec.fr/s-enregistrer>`_
and fill in the :guilabel:`Adresse e-mail` field with an email address. Choose a secure password,
accept the general terms and conditions by checking the box, and click :guilabel:`S'enregistrer` to
save. Then, enter the :abbr:`SIREN (Système d'identification du répertoire des entreprises,
Business Directory Identification System)` number of the company.

.. note::
   If the account has already been created, click :guilabel:`Déjà enregistré?` (Already registered).

.. _localization/france/teledec-registration:

Company registration and fiscal year information
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

To register the company on Teledec, go to :guilabel:`Vos entreprises` (Your companies) and click
:guilabel:`Enregistrer votre entreprise` (Register your company). Make sure to fill in the following
company information in the :guilabel:`Coordonnées de l'entreprise` (Company's details) and
:guilabel:`Représentant légal` (Legal representative) sections:

- :guilabel:`Nom de l'entreprise`: Company's name.
- :guilabel:`Forme juridique`: Select the company's legal form.
- :guilabel:`Les comptes sont clôturés le`: Closing date.
- :guilabel:`Régime d'imposition, choix de la liasse`: Select the Tax scheme and tax return option.
- :guilabel:`Adresse du siège social`: Head office address.
- :guilabel:`Nom du représentant légal`: Legal representative's name.
- :guilabel:`Agissant en qualité de`: Legal representative's function.
- :guilabel:`Numéro de téléphone`: Phone number.

Click :guilabel:`Sauvegarder` (Save) to display the next step
:guilabel:`Informations générales sur l'exercice déclaré` (General information about the declared
fiscal year). Then, fill in information on the financial year, such as the fiscal year start and end
dates or the closing date and duration of the previous fiscal period. After saving, the list of
documents included in the *liasse fiscale* is displayed, including both standard tax forms and
those customized for the company’s tax return.

.. tip::
   - The :guilabel:`Etat` (Status) column shows the progress of the document filing.
   - Click :guilabel:`Compléter` to fill out a document, then :guilabel:`Sauvegarder` to save.
   - To print a blank version of the declaration, click :guilabel:`Imprimer la déclaration` and
     select the :guilabel:`Imprimer la déclaration avec les notices` option.

.. _localization/france/teledec-synchronization:

Odoo synchronization
~~~~~~~~~~~~~~~~~~~~

To enable Odoo to automatically fill in the data for the :guilabel:`Liasse fiscale`, click
:guilabel:`Autres actions` (Other actions) in the top-right corner and select
:guilabel:`Synchroniser avec un logiciel tiers` (Synchronize with third-party software), then
:guilabel:`Synchroniser cette liasse avec Odoo` (Synchronize this *liasse* with Odoo).

In the :guilabel:`Synchroniser cette liasse avec Odoo` window, fill in the following
information to complete the synchronization:

- :guilabel:`Nom / URL complète de la base de données Odoo`: Odoo database name or URL. To provide
  the full URL of the database, enable :guilabel:`Je voudrais donner une url complète hors .odoo.com`
  option.
- :guilabel:`Nom de l'utilisateur`: User name associated with the Odoo account.
- :guilabel:`Clé API`: :ref:`API key <api/external_api/keys>` generated by the Odoo instance.

.. note::
   In a multi-company setup, the following configurations are required in Odoo:

   - The user linked to the generated :ref:`API key <api/external_api/keys>` must have
     :ref:`access <general/companies/users>` to the company intended for synchronization.
   - This company must also be set as the user's :guilabel:`Default Company`, as Teledec always
     synchronizes with the user's default company.

Next, click :guilabel:`Importer` to synch data from Odoo. In the
:guilabel:`Confirmation de la synchronisation de liasse avec Odoo` window, review the amounts and
make any necessary changes. Then click :guilabel:`Importer la balance` to confirm the
synchronization of the *liasse fiscale* with Odoo and import the balance.

.. important::
   Clicking :guilabel:`Importer la balance` may overwrite or alter any manual updates made
   previously.

To make payment and send the declaration to the tax authorities, click :guilabel:`Paiement & envoi
de la déclaration`.

.. _localizations/france/pos:

Point of sale
=============

.. _localizations/france/vat-anti-fraud-certification:

VAT anti-fraud certification
----------------------------

Since January 2018, new anti-fraud legislation has been in effect in France and its overseas
territories (DOM-TOM). This legislation establishes specific requirements for the integrity,
security, storage, and archiving of sales data. Odoo complies with these legal requirements by
providing a module and a downloadable certificate of conformity.

Anti-fraud cash register software, such as Odoo (CGI art. 286, I. 3° bis), is required for companies
taxable in France or DOM-TOM, where some customers are private individuals (B2C). This rule applies
to all company sizes, but auto-entrepreneurs exempt from VAT are unaffected.

.. seealso::
   - `Frequently Asked Questions
     <https://www.economie.gouv.fr/files/files/directions_services/dgfip/controle_fiscal/actualites_reponses/logiciels_de_caisse.pdf>`_
   - `Official Statement
     <http://bofip.impots.gouv.fr/bofip/10691-PGP.html?identifiant=BOI-TVA-DECLA-30-10-30-20160803>`_
   - `Item 88 of Finance Law 2016
     <https://www.legifrance.gouv.fr/affichTexteArticle.do?idArticle=JORFARTI000031732968&categorieLien=id&cidTexte=JORFTEXT000031732865>`_

.. _localizations/france/pos-odoo-certification:

Odoo certification
~~~~~~~~~~~~~~~~~~

The tax administration requires all companies to provide a certificate of conformity confirming that
their software complies with anti-fraud legislation. In case of non-compliance, a €7,500 fine may be
imposed.

.. note::
   This `certificate <https://www.odoo.com/my/contract/french-certification/>`_ is granted by Odoo
   SA to Odoo Enterprise users.

To get the certification, follow these steps:

#. :doc:`Install </applications/general/apps_modules>` the :guilabel:`France - VAT Anti-Fraud
   Certification for Point of Sale (CGI 286 I-3 bis)` (`l10n_fr_pos_cert`) module.
#. Set the :guilabel:`Country` field on the :doc:`company record </applications/general/companies>`
   to encrypt entries for the inalterability check.
#. Download the mandatory `certificate of conformity
   <https://www.odoo.com/my/contract/french-certification/>`_ delivered by Odoo SA.

.. _localizations/france/pos-anti-fraud-features:

Anti-fraud features
~~~~~~~~~~~~~~~~~~~

The anti-fraud module introduces the following features:

- :ref:`Inalterability <localizations/france/pos-inalterability>`
- :ref:`Security <localizations/france/pos-security>`
- :ref:`Storage <localizations/france/pos-storage>`

.. _localizations/france/pos-inalterability:

Inalterability
**************

All methods to cancel or modify key data in POS orders, invoices, and journal entries are
deactivated for companies located in France or any DOM-TOM.

.. note::
   In a multi-company environment, only the documents of such companies are impacted.

.. _localizations/france/pos-security:

Security
********

To ensure inalterability, every order or journal entry is encrypted upon validation. This number
(or hash) is calculated from the document's key data and the hash of the precedent documents. The
module introduces an interface to test the data's inalterability. The test will fail if any
information is modified on a document after its validation. The algorithm recomputes all the hashes
and compares them against the initial ones. In case of failure, the system points out the first
corrupted document recorded in the system.

Only users with :doc:`administrator </applications/general/users/access_rights>` access rights can
initiate the inalterability check:

- For POS orders, go to :menuselection:`Point of Sales --> Reporting --> POS Inalterability Check`;
- For journal entries, go to :menuselection:`Invoicing/Accounting --> Configuration --> Settings`.
  In the :guilabel:`Reporting` section, click :guilabel:`Download the Data Inalterability Check
  Report`.

.. _localizations/france/pos-storage:

Storage
*******

The system also processes automatic sales closings daily, monthly, and annually. Such closings
compute the sales total for the period and the cumulative grand totals from the very first sales
entry recorded in the system.

To access closings, either go to :menuselection:`Point of Sales --> Reporting --> Sales Closings` or
:menuselection:`Invoicing/Accounting --> Reporting --> Sales Closings`.

.. note::
   - Closings compute the totals for journal entries of sales journals (Journal Type = Sales).
   - For multi-companies environments, such closings are performed by company.
   - POS orders are posted as journal entries at the closing of the POS session. Closing a POS
     session can be done anytime. To prompt users to do it daily, the module prevents them from
     resuming a session that was opened more than 24 hours ago. Such a session must be closed before
     selling again.
   - A period’s total is computed from all the journal entries posted after the previous closing of
     the same type, regardless of their posting date. Recording a new sales transaction for a
     period already closed will be counted in the very next closing.

.. tip::
   For test & audit purposes, closings can be manually generated in :ref:`developer mode
   <developer-mode>`. To do so, go to :menuselection:`Settings --> Technical --> Scheduled Actions`.
   In the scheduled actions list view, open the desired :guilabel:`Sale Closing` action and click
   :guilabel:`Run manually`.

.. _localizations/france/pos-responsibilities:

Responsibilities
~~~~~~~~~~~~~~~~

Uninstalling this module will reset the security hashes. This means the system will no longer
guarantee the integrity of the past data.

Users are responsible for their Odoo system and must operate it carefully. Modifying source code
responsible for ensuring data integrity is not allowed.

Odoo is not responsible for any issues with this module's functionality if caused by uncertified
third-party applications.


==================================================
SECTION: germany.rst
PATH: applications/finance/fiscal_localizations/germany.rst
==================================================

=======
Germany
=======

Accounting
==========

Chart of accounts
-----------------

Both SKR03 and SKR04 charts of accounts are supported in Odoo. When you create a new Odoo Online
database, SKR03 is installed by default.

Verify which is installed by going to :menuselection:`Accounting --> Configuration --> Settings`
and checking the :guilabel:`Package` field under the :guilabel:`Fiscal Localization` section.

.. warning::
   Selecting another package is only possible if you have not created an accounting entry. If one
   was posted, a new company or database must be set up to select another package. In
   addition, all journal entries will need to be created again.

Reports
-------

The following German-specific reports available on Odoo Enterprise:

- Balance Sheet
- Profit & Loss
- Tax Report (Umsatzsteuervoranmeldung)
- EC Sales List
- Intrastat

Exporting entries from Odoo to DATEV
------------------------------------

Provided that one of the German :ref:`fiscal localization packages
<fiscal_localizations/packages>` is installed, you can export your accounting entries from Odoo to
DATEV from the general ledger.

Two types of exports are needed: first the DATEV ATCH export, then the DATEV DATA export.

.. note::
   Both are needed at different stages to transfer the data correctly to DATEV, as DATEV works with
   two interfaces, one for clients (DUO - DATEV Unternehmen Online) and one for tax advisors (DATEV
   Rechnungswesen).

1. DATEV ATCH
~~~~~~~~~~~~~

Go to :menuselection:`Accounting --> Reporting --> General Ledger`, click the :icon:`fa-cog`
(:guilabel:`Actions`) button, and select :guilabel:`Datev ATCH (zip)`.

.. image:: germany/datev-export.png
   :alt: General ledger's actions menu with DATEV exports

Upload the downloaded ZIP file via the `DATEV Belegtransfer software <https://www.datev.de/web/de/service-und-support/software-bereitstellung/download-bereich/betriebliches-rechnungswesen/belegtransfer>`_.

If you do not have the DATEV Belegtransfer software installed on your computer, ask your tax advisor
to help you with this.

.. warning::
   The DATEV ATCH ZIP file includes the files (reports) linked to an Odoo invoice or bill. For
   customer invoices, the file must have been generated by using the :guilabel:`Send` button. For
   vendor bills, the file must have been received via an email alias or uploaded by using the
   :guilabel:`Upload` button.

.. admonition:: DATEV ATCH ZIP file

   The ZIP file contains two types of files:

   - the individual invoice/bill files (PDF, JPEG, etc.) for the selected period on the general
     ledger, and
   - a :file:`document.xml` file used to generate a unique ID (GUID) for each file.

   These unique IDs are essential as they allow DATEV to automatically link the files to the
   individual journal items, which will be imported with the DATEV DATA file in the next step.

2. DATEV DATA
~~~~~~~~~~~~~

Go to :menuselection:`Accounting --> Reporting --> General Ledger`, click the :icon:`fa-cog`
(:guilabel:`Actions`) button, and select :guilabel:`Datev DATA (zip)`.

Transfer the downloaded ZIP file to your tax advisor. They should import the ZIP file into DATEV
Rechnungswesen.

Check with your tax advisor how often they need these files.

.. admonition:: DATEV ATCH ZIP file

   The ZIP file contains three CSV files:

   - the :file:`EXTF_customer_accounts.csv` file containing all information related to your
     customers,
   - the :file:`EXTF_vendor_accounts.csv` file containing all information related to your vendors,
     and
   - the :file:`EXTF_accounting_entries.csv` containing all journal items for the period defined on
     the general ledger, as well as the unique IDs (GUID) so that the journal items can be linked to
     the files inside the DATEV ATCH ZIP file.

.. _germany/gobd:

GoBD compliance
---------------

**GoBD** stands for *Grundsätze zur ordnungsmäßigen Führung und Aufbewahrung von Büchern,
Aufzeichnungen und Unterlagen in elektronischer Form sowie zum Datenzugriff*. In short, it is a
guideline for the proper management and storage of books, records, and documents in electronic form,
as well as for data access, that is relevant for the German tax authority, tax declaration, and
balance sheet.

These principles have been written and published by the Federal Ministry of Finance (BMF) in
November 2014. Since January 2015, **they have become the norm** and have replaced previously
accepted practices linked to computer-based accounting. Several changes have been made by the BMF in
2019 and January 2020 to specify some of the content due to the development of digital solutions
(cloud hosting, paperless companies, etc.).

.. important::
   Odoo is certified **GoBD-compliant**.

Understanding GoBD in relation to accounting software
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The **GoBD is binding for companies that have to present accounts**, which includes SMEs,
freelancers, and entrepreneurs, to the financial authorities. As such, **the taxpayer himself is the
sole responsible** for the complete and exhaustive keeping of fiscal-relevant data (above-mentioned
financial and related data).

Apart from software requirements, the user is required to ensure internal control systems (*in
accordance with sec. 146 of the Fiscal Code*):

- access rights control;
- segregation of duties, functional separating;
- entry controls (error notifications, plausibility checks);
- reconciliation checks at data entry;
- processing controls; and
- measures to prevent intentional or unintentional manipulation of software, data, or documents.

The user must distribute tasks within their organization to the relevant positions (*control*) and
verify that the tasks are properly and completely performed (*supervision*). The result of these
controls must be recorded (*documentation*), and should errors be found during these controls,
appropriate measures to correct the situation should be put into place (*prevention*).

Data security
~~~~~~~~~~~~~

The taxpayer must **secure the system against any data loss** due to deletion, removal, or theft of
any data. If the entries are not sufficiently secured, the bookkeeping will be regarded as not in
accordance with the GoBD guidelines.

Once bookings have been finally posted, they can no longer be changed or deleted via the
application.

- If Odoo is used in the cloud, regular backups are part of the Odoo Online service. In addition,
  regular backups can be downloaded and backed up on external systems.

  .. seealso::
     `Odoo Cloud Hosting - Service Level Agreement <https://www.odooo.com/cloud-sla>`_

- If the server is operated locally, the user is responsible for creating the necessary backup
  infrastructure.

.. important::
   In some cases, data has to be kept for ten years or more, so always have backups saved. It is
   even more important if you decide to change software provider.

Responsibility of the software editor
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Considering GoBD applies only to the taxpayer, **the software editor can by no means be held
responsible for the accurate and compliant documentation of their users' financial transactional
data**. It can merely provide the necessary tools for the user to respect the software-related
guidelines described in the GoBD.

Ensuring compliance through Odoo
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The keywords, when it comes to GoBD are: **traceable, verifiable, true, clear, and continuous**.
In short, you need to have audit-proof archiving in place, and Odoo provides you with the means to
achieve all of these objectives:

#. | **Traceability and verifiability**
   | Each record in Odoo is stamped with the creator of the document, the creation date, the
     modification date, and who modified it. In addition, relevant fields are tracked. Thus, it can
     be seen which value was changed by whom in the chatter of the relevant object.
#. | **Completeness**
   | All financial data must be recorded in the system, and there can be no gaps. Odoo ensures that
     there is no gap in the numbering of the financial transactions. It is the responsibility of the
     user to encode all financial data in the system. As most financial data in Odoo is generated
     automatically, it remains the responsibility of the user to encode all vendor bills and
     miscellaneous operations completely.
#. | **Accuracy**
   | Odoo ensures that, with the correct configuration, the correct accounts are used. In addition,
     the control mechanisms between purchase orders and sales orders and their respective invoices
     reflect the reality of the business. It is the responsibility of the user to scan and attach
     the paper-based vendor bill to the respective record in Odoo. *Odoo Documents helps you
     automate this task*.
#. | **Timely booking and record-keeping**
   | As most financial data in Odoo is generated by the transactional objects (for example, the
     invoice is booked at confirmation), Odoo ensures out-of-the-box timely record-keeping. It is
     the responsibility of the user to encode all incoming vendor bills in a timely manner, as well
     as the miscellaneous operations.
#. | **Order**
   | Financial data stored in Odoo is, per definition, ordered and can be reordered according to
     most fields present in the model. A specific ordering is not enforced by the GoBD, but the
     system must ensure that a given financial transaction can be quickly found by a third-party
     expert. Odoo ensures this out-of-the-box.
#. | **Inalterability**
   | With the German Odoo localization, Odoo is in standard configured in such a way that the
     inalterability clause can be adhered to without any further customization.

GoBD export
~~~~~~~~~~~

In the case of fiscal control, the fiscal authority can request three levels of access to the
accounting system (Z1, Z2, Z3). These levels vary from direct access to the interface to the
handover of the financial data on a storage device.

In the case of a handover of financial data to a storage device, the GoBD does **not** enforce the
format. It can be, for example, in XLS, CSV, XML, Lotus 123, SAP-format, AS/400-format, or else.
Odoo supports the CSV and XLS export of financial data out of the box. The GoBD **recommends** the
export in a specific XML-based GoBD format (see "Ergänzende Informationen zur
Datenträgerüberlassung" §3), but it is not binding.

Non-compliance
~~~~~~~~~~~~~~

In the event of an infringement, you can expect a fine and a court order demanding the
implementation of specific measures.

.. _germany/pos:

Point of Sale
=============

Technical security system
-------------------------

The **Kassensicherungsverordnung** (The Act on Protection against Manipulation of Digital Records)
requires that electronic record-keeping systems - including the :doc:`point of sale
</applications/sales/point_of_sale>` systems - must be equipped with a **technical security system**
(also called **TSS** or **TSE**).

Odoo offers a service that is compliant with the help of `fiskaly <https://fiskaly.com>`_, a
*cloud-based solution*.

.. important::
   Since this solution is cloud-based, a working internet connection is required.

.. note::
   The only VAT rates allowed are given by fiskaly. You can check these rates by consulting
   `fiskaly DSFinV-K API: VAT Definition
   <https://developer.fiskaly.com/api/dsfinvk/v0/#tag/VAT-Definition>`_.

Configuration
~~~~~~~~~~~~~

:ref:`Install <general/install>` the **Germany - Certification for Point of Sale**
(`l10n_de_pos_cert`) and **Germany - Certification for Point of Sale of type restaurant**
(`l10n_de_pos_res_cert`) modules.

.. tip::
   If these modules are not listed, :ref:`update the app list <general/install>`.

Company registration at the financial authority
***********************************************

To register your company, open the :guilabel:`Settings` app, click :guilabel:`Update Info` under the
:guilabel:`Companies` section, and fill in the following fields:

- :guilabel:`Company Name`
- :guilabel:`Address`
- :guilabel:`VAT`
- :guilabel:`St.-Nr.` (Steuernummer) this number is assigned by the tax office to every taxable
  natural or legal person (e.g., `2893081508152`).
- :guilabel:`W-IdNr.` (Wirtschafts-Identifikationsnummer) this number is used as a permanent
  identification number for economically active persons.

You can then **register your company through fiskaly** by opening the :guilabel:`Fiskaly` tab and
clicking the :guilabel:`Fiskaly Registration` button.

.. tip::
   If you do not see the :guilabel:`Fiskaly Registration` button, make sure that you *saved* your
   company details and are not in *editing mode* anymore.

Once the registration has been finalized, new fields appear:

- :guilabel:`Fiskaly Organization ID` refers to the ID of your company on fiskaly's side.
- :guilabel:`Fiskaly API Key` and :guilabel:`Fiskaly API Secret` are the credentials the system
  uses to access the services offered by fiskaly.

.. image:: germany/fiskaly-registration.png
   :alt: Fiskaly registration tab

.. note::
   It is possible to request new credentials if there is any issue with the current ones by clicking
   the :guilabel:`New keys` button.

Create a technical security system and link it to a POS
*******************************************************

To use a point of sale in Germany, first create a :abbr:`TSS (Technical Security System)` by going
to :menuselection:`Point of Sale --> Configuration --> Point of Sale`, selecting the
:guilabel:`Point of Sale` to edit, then checking the :guilabel:`Create TSS` box under the
:guilabel:`Fiskaly API` section.

Once the creation of the TSS is successful, you can find the:

- :guilabel:`TSS ID`, which refers to the ID of your TSS on fiskaly's side, and
- :guilabel:`Fiskaly Client ID`, which refers to your POS on fiskaly's side.

.. image:: germany/fiskaly-tss.png
   :alt: Fiskaly API section

DSFinV-K export
~~~~~~~~~~~~~~~

Whenever you close a PoS session, the details of the orders are sent to the :abbr:`DSFinV-K
(Digitale Schnittstelle der Finanzverwaltung für Kassensysteme)` service of fiskaly.

In case of an audit, you can export the data sent to DSFinV-K by going to :menuselection:`Point of
Sale --> Orders --> DSFinV-K Exports --> New`.

.. image:: germany/pos-orders-menu.png
   :alt: Menu to export DSFinV-K

These fields are mandatory:

- :guilabel:`Start Datetime`: export data with dates larger than or equal to the given start date
- :guilabel:`End Datetime`: export data with dates smaller than or equal to the given end date

Leave the :guilabel:`Point of Sale` field blank to export the data of all your points of sale;
specify one if you want to export data for this specific POS only.

.. image:: germany/dsfinv-k-export.png
   :alt: Exporting DSFinV-K

When an export is successfully triggered and is being processed, the :guilabel:`State` field should
mention :guilabel:`Pending`. Click :guilabel:`Refresh State` to check if it is ready.


==================================================
SECTION: guatemala.rst
PATH: applications/finance/fiscal_localizations/guatemala.rst
==================================================

=========
Guatemala
=========

.. |SAT| replace:: :abbr:`SAT (Superintendencia de Administración Tributaria)`
.. |EDI| replace:: :abbr:`EDI (Electronic Data Interchange)`
.. |UUID| replace:: :abbr:`UUID (Universally Unique Identifier)`

.. _guatemala/intro:

Introduction
============

With the Guatemalan localization, you can connect to the tax authority Superintendencia de
Administración Tributaria (SAT) to generate electronic documents with its XML, fiscal folio, and
electronic signature.

The supported documents are:

- :guilabel:`FACT-Factura`,
- :guilabel:`FCAM-Factura Cambiaria`,
- :guilabel:`FPEQ-Factura de Pequeño Contribuyente`,
- :guilabel:`NCRE-Credit Note`,
- :guilabel:`NDEB-Debit Note`,
- :guilabel:`NABN-Nota de Abono`,
- :guilabel:`FCAP-Factura Cambiaria Pequeño Contribuyente`,
- :guilabel:`FACT-Factura with Export Complement`.

The localization requires an `Infile <https://infile.com.gt/>`_ account, which enables users to
generate electronic documents within Odoo. To request an Infile account, fill out the `Infile
Registration Form <https://share.hsforms.com/1HksZ6i1VRRWHRhXPvYZORQrwu2r>`_.

.. seealso::
   :doc:`Documentation on e-invoicing's legality and compliance in Guatemala
   <../accounting/customer_invoices/electronic_invoicing/guatemala>`

Glossary
--------

The following terms are used throughout the Guatemalan localization:

- **SAT**: *Superintendencia de Administración Tributaria* is the government entity responsible for
  enforcing tax payments in Guatemala.
- **FEL**: *Factura Electrónica en Línea* is the electronic invoicing system mandated by the SAT in
  Guatemala, which requires businesses to issue and manage electronic documents in compliance with
  local regulations.
- **EDI**: *Electronic Data Interchange* refers to the sending of electronic documents.
- **Infile**: is the third-party organization that facilitates the interchange of electronic
  documents between companies and the Guatemalan government.
- **UUID**: *Universally Unique Identifier* is a unique alphanumeric code assigned by the SAT to
  each certified electronic document in the FEL system, used for traceability and official
  validation.
- **Phrases**: Type of Phrases with specific Scenario Codes are used in the Guatemalan localization
  to comply with the requirements of the SAT. They should be added depending on the issuer regime,
  receiver, and operation type. These phrases are used in the XML and PDF documents.
- **Establishment Code**: A unique identifier assigned by the SAT to each business establishment,
  which is required for electronic invoicing.
- **Quetzal**: The official currency of Guatemala, represented by the symbol GTQ. This is the base
  currency for all financial transactions in the Guatemalan localization.

Configuration
=============

Modules installation
--------------------

:ref:`Install <general/install>` the following modules to get all the features of the Guatemalan
localization:

.. list-table::
   :header-rows: 1
   :widths: 25 25 50

   * - Name
     - Technical name
     - Description
   * - :guilabel:`Guatemala - Accounting`
     - `l10n_gt`
     - The default :doc:`fiscal localization package <../fiscal_localizations>`. It adds accounting
       characteristics for the Guatemalan localization, which represent the minimum configuration
       required for a company to operate in Guatemala according to the guidelines set by the |SAT|.
       The module's installation automatically loads the chart of accounts and taxes.
   * - :guilabel:`Guatemala Accounting EDI`
     - `l10n_gt_edi`
     - Includes all the technical and functional requirements to generate and validate
       :doc:`Electronics Documents <../accounting/customer_invoices/electronic_invoicing>`, based on
       the technical documentation published by the |SAT|. The authorized documents are :ref:`listed
       above <guatemala/intro>`.

.. note::
   Odoo automatically installs the base module **Guatemala - Accounting** when a database is
   installed with `Guatemala` selected as the country. However, to enable electronic invoicing, the
   **Guatemala Accounting EDI** (`l10n_gt_edi`) module needs to be manually :ref:`installed
   <general/install>`.

Company
-------

To configure your company information, open the **Settings** app, scroll down to the
:guilabel:`Companies` section, click :guilabel:`Update Info`, and configure the following:

- :guilabel:`Company Name`
- :guilabel:`Address`, including the :guilabel:`Street`, :guilabel:`City`, :guilabel:`State`,
  :guilabel:`ZIP`, and :guilabel:`Country`
- :guilabel:`Tax ID`: Enter the identification number for the selected taxpayer type.
- :guilabel:`VAT Affiliation`: Select the VAT affiliation for the company, which is the type of
  Regime the company belongs to.
- :guilabel:`Legal Name`: The legal name of the company, which is used in the XML and PDF documents.
- :guilabel:`Establishment Code`: A necessary part of the XML when creating an electronic document.
  If this field is not set, all electronic documents will be rejected.

  To locate the :guilabel:`Establishment Code` in your `SAT account <https://portal.sat.gob.gt/>`_,
  go to :menuselection:`FEL --> Administración de Establecimientos`. The list of registered
  establishments is displayed along with their corresponding codes.

.. important::
   After configuring the company in the database settings, navigate to the company's contact form
   and verify that the :guilabel:`Identification Number` :guilabel:`Type` is set to :guilabel:`NIT`.

Electronic invoicing credentials
--------------------------------

In Guatemala, electronic invoicing is mandatory for most businesses. Odoo connects with the
authorized provider, Infile, to generate and submit electronic documents to the |SAT| for
validation.

Before issuing electronic documents, you must configure and connect Odoo to Infile to ensure they
are properly validated and assigned an official |UUID|.

Infile
~~~~~~

Sign a service agreement directly with `Infile <https://infile.com.gt/>`_. Infile will then provide
the necessary credentials to input in Odoo.

.. note::
   To create an Infile account and benefit from the **8% discount** available for Odoo customers,
   fill out the: `Infile Registration Form <https://share.hsforms.com/1HksZ6i1VRRWHRhXPvYZORQrwu2r>`_.
   An Infile agent will contact you to help you complete the onboarding process and sign the service agreement.

Odoo
~~~~

In Odoo, once you have completed the Infile process, navigate to :menuselection:`Accounting -->
Configuration --> Settings`, scroll down to the :guilabel:`Guatemalan Localization` section, then
follow these steps:

#. Select the :guilabel:`Infile Web Services` environment, either :guilabel:`Test` or
   :guilabel:`Production`.
#. Enter the :guilabel:`Infile Credentials`:

   - :guilabel:`Infile WS Username or Prefix`
   - :guilabel:`Infile Token`
   - :guilabel:`Infile Key`

#. Click on :guilabel:`Save`.

.. note::
   The :guilabel:`Infile Credentials` are provided by Infile and are required for both test and
   production environments. If they are not available, contact Infile support.

.. tip::
   The demo environment is for testing only and does not generate legal documents, |UUID| keys, or
   fiscal folios. No Infile account or credentials are needed to use the demo environment.

Multi-currency
~~~~~~~~~~~~~~

The official currency exchange rate in Guatemala is provided by the Bank of Guatemala. Odoo can
connect directly to its services and get the currency rate either automatically or manually.

.. seealso::
   :doc:`Multi-currencies <../accounting/get_started/multi_currency>`

Master data
-----------

Chart of accounts
~~~~~~~~~~~~~~~~~

The :doc:`chart of accounts <../accounting/get_started/chart_of_accounts>` is installed by default
as part of the set of data included in the localization module, the accounts are mapped
automatically in taxes, default accounts payable, and default accounts receivable.

Accounts can be added or deleted according to the company's needs.

Contacts
~~~~~~~~

The following fields must be completed on contact forms:

- :guilabel:`Company Name`
- :guilabel:`Address`, including the :guilabel:`Street`, :guilabel:`City`, :guilabel:`State`,
  :guilabel:`ZIP`, and :guilabel:`Country`
- :guilabel:`Identification Number`:

  - :guilabel:`Type`: Select an identification type.
  - :guilabel:`Number`: Required to confirm an electronic invoice.

.. note::
   To automatically include a specific phrase in the XML and PDF of every electronic invoice for a
   contact, select it in :guilabel:`Phrases` field in the :guilabel:`Sales & purchase` tab of the
   contact form.

Taxes
~~~~~

As part of the Guatemala localization module, taxes are automatically created with their configuration
and related financial accounts.

Electronic invoices
===================

Once the database has been configured successfully, electronic documents can be created and sent.

Once :doc:`customer invoices <../accounting/customer_invoices>` are validated, they can be sent
electronically to |SAT| via Infile, provided the following fields are completed:

- :guilabel:`Customer`: Type the customer's information.
- :guilabel:`GT Document Type`: Select the type of document you want to create, i.e.,
  :guilabel:`FACT - Factura Electrónica` or :guilabel:`FCAM - Factura Cambiara`. By default, the
  document type is set to :guilabel:`FACT`.
- :guilabel:`Due date`: To compute if the invoice is due now or later.
- :guilabel:`Journal`: Select the sales journal.
- :guilabel:`Products`: Specify the product(s) with the correct taxes.

When done, click :guilabel:`Confirm`.

.. note::
   If you need to add a specific phrase based on the transaction, go to the :guilabel:`Other Info`
   tab and add the corresponding phrase in :guilabel:`GT Phrases`. These phrases are used in the XML
   and PDF documents.

.. note::
   If you need to add an addendum to the invoice, you can do so in the :guilabel:`Terms and
   Conditions` field. The addendum will be included in the XML document and can be used to provide
   additional information or notes related to the invoice.

After the invoice confirmation, click :guilabel:`Send`. In the wizard that appears, make sure to
enable the :guilabel:`Send to SAT` and :guilabel:`by Email` checkboxes to send the XML to the |SAT|
through Infile's web service and the validated invoice to the client's email, and click
:guilabel:`Send`. Then, the following occurs:

- The XML document is created.
- The |UUID| is generated.
- The XML is processed synchronously by Infile.

  - If accepted, the file is displayed in the chatter, and the email to the client with the
    corresponding :file:`pdf` and :file:`xml` file is sent.
  - If the file contains errors, a warning message displays the reason(s) and the email is not sent.

.. image:: guatemala/pdf-xml-chatter-guatemala.png
   :alt: EDI documents available in the chatter.

The :guilabel:`SAT` tab then displays the following:

- :guilabel:`Datetime`: Timestamp recorded of the XML creation.
- :guilabel:`GT Status`: Status result obtained in the |SAT| response. If the file contains errors,
  a warning message displays the reason(s) and the email is not sent.
- :guilabel:`UUID`: The unique identifier assigned by the |SAT| to the electronic document.
- :guilabel:`Download Certificate`: To download the sent XML file, even if the |SAT| result was
  rejected.

.. image:: guatemala/sat-tab-electronic-document.png
   :alt: EDI document record available in SAT tab.

.. _localization/guatemala/credit-notes:

Debit and credit notes
----------------------

To send a debit or credit note to Infile, first create the :ref:`debit
<accounting/credit_notes/issue-debit-note>` or :ref:`credit note
<accounting/credit_notes/issue-credit-note>`.

Then, in the :guilabel:`Send` window, click :guilabel:`Send to SAT (Guatemalan EDI)` to submit it
for real-time validation. Upon successful validation, the QR code from Infile is embedded in the
debit or credit note PDF.

Export invoices
---------------

Exportation invoices must meet the following conditions:

- The customer's :guilabel:`Identification type` must be :guilabel:`VAT`, :guilabel:`Passport`, or
  :guilabel:`Foreign ID`.
- The following fields must be defined in the customer invoice's :guilabel:`Other Info` tab, under
  the :guilabel:`Accounting` section:

   - :guilabel:`Incoterm`
   - :guilabel:`GT Phrases`: :guilabel:`Type 4 Code 1`
   - :guilabel:`Consignatory Company`

- All invoice lines must include taxes set to 0%.

.. image:: guatemala/l10n-gt-factura-de-cliente.png
   :alt: Exportation invoices main data.


==================================================
SECTION: hong_kong.rst
PATH: applications/finance/fiscal_localizations/hong_kong.rst
==================================================

=========
Hong Kong
=========

Configuration
=============

:ref:`Install <general/install>` the following modules to get the latest features of the Hong Kong
localization:

.. list-table::
   :header-rows: 1

   * - Name
     - Technical name
     - Description
   * - :guilabel:`Hong Kong - Accounting`
     - `l10n_hk`
     - The base module to manage chart of accounting and localization for Hong Kong.
   * - :guilabel:`Hong Kong - Payroll`
     - `l10n_hk_hr_payroll`
     - Enables :ref:`payroll <payroll/l10n_hk/payroll>` specific localization features for Odoo *Payroll*
       app. This module also installs :guilabel:`Hong Kong - Payroll with Accounting` and
       :guilabel:`Documents - Hong Kong Payroll`.
   * - :guilabel:`Hong Kong - Payroll with Accounting`
     - `l10n_hk_hr_payroll_account`
     - Installs the link between Hong Kong payroll and accounting.
   * - :guilabel:`Documents - Hong Kong Payroll`
     - `documents_l10n_hk_hr_payroll`
     - Integrates employee ir56 forms in the Odoo *Documents* app.

FPS QR codes on invoices
========================

:abbr:`FPS (Faster Payment System)` is a payment service platform that allows customers to make
instant domestic payments to individuals and merchants in Hong Kong dollars or Renminbi via online
and mobile banking.

Activate QR codes
-----------------

Go to :menuselection:`Accounting app --> Configuration --> Settings`. Under the :guilabel:`Customer
Payments` section, tick the checkbox beside the :guilabel:`QR Codes` feature. Then, click
:guilabel:`Save`.

FPS bank account configuration
------------------------------

Go to :menuselection:`Contacts app --> Configuration --> Bank Accounts section --> Bank Accounts`.
Then select the bank account for FPS activation. Proceed to set the :guilabel:`Proxy Type` and fill
in the :guilabel:`Proxy Value` field, depending on the type chosen.

Remember to include the invoice number in the QR code, by ticking the :guilabel:`Include Reference`
checkbox.

.. image:: hong_kong/hk-fps-bank-setting.png
   :align: center
   :alt: FPS bank account configuration.

.. important::
   - The account holder's country must be set to `Hong Kong` on its contact form.
   - The account holder's city is mandatory.
   - You could also include the invoice number in the QR code by checking the :guilabel:`Include
     Reference` checkbox.

.. seealso::
   :doc:`../accounting/bank`

Bank journal configuration
--------------------------

Go to :menuselection:`Accounting app --> Configuration --> Journals` and open the bank journal.
Then, fill out the :guilabel:`Account Number` and :guilabel:`Bank` fields, located in the
:guilabel:`Journal Entries` tab.

.. image:: hong_kong/hk-bank-account-journal-setting.png
   :align: center
   :alt: Bank Account's journal configuration.

Issue invoices with FPS QR codes
--------------------------------

When creating a new invoice, open the :guilabel:`Other Info` tab and set the :guilabel:`Payment
QR-code` option to :guilabel:`EMV Merchant-Presented QR-code`.

.. image:: hong_kong/hk-qr-code-invoice-setting.png
   :align: center
   :alt: Select EMV Merchant-Presented QR-code option.

Ensure that the :guilabel:`Recipient Bank` is configured, as Odoo uses this field to generate the
FPS QR code.


==================================================
SECTION: india.rst
PATH: applications/finance/fiscal_localizations/india.rst
==================================================

=====
India
=====

.. _india/installation:

Installation
============

:ref:`Install <general/install>` the following modules to get all the features of the Indian
localization:

.. list-table::
   :header-rows: 1

   * - Name
     - Technical name
     - Description
   * - :guilabel:`Indian - Accounting`
     - `l10n_in`
     - Default :ref:`fiscal localization package <fiscal_localizations/packages>`
   * - :guilabel:`Indian E-invoicing`
     - `l10n_in_edi`
     - :ref:`Indian e-invoicing integration <india/e-invoicing>`
   * - :guilabel:`Indian E-waybill`
     - `l10n_in_ewaybill`
     - :ref:`Indian E-way bill integration <india/e-waybill>`
   * - :guilabel:`Indian E-waybill Stock`
     - `l10n_in_ewaybill_stock`
     - :ref:`E-waybill creation from the Inventory app <india/e-waybill-stock>`
   * - :guilabel:`Indian - Accounting Reports`
     - `l10n_in_reports`
     - Adds the :ref:`Indian GST Return filing <india/gstr>` and the :ref:`Indian
       Tax reports <india/gstr_reports>`.

.. _india/company:

Company
-------

To configure your company information, open the **Settings** app, scroll down to the
:guilabel:`Companies` section, click :guilabel:`Update Info`, and configure the following:

- :guilabel:`Company Name`
- :guilabel:`Address`, including the :guilabel:`Street`, :guilabel:`City`, :guilabel:`State`,
  :guilabel:`ZIP`, and :guilabel:`Country`
- :guilabel:`PAN`: essential for determining the type of taxpayer.
- :guilabel:`GSTIN`: necessary for generating e-Invoices, E-waybills and filing GST returns.

.. _india/indian-configuration:

Indian Configuration
====================

The **Indian Integration** section provides essential taxation and compliance features to simplify
financial operations. To enable these features, navigate to :menuselection:`Accounting -->
Configuration --> Settings` and scroll down to the :guilabel:`Indian Integration` section.

.. image:: india/indian-integration.png
   :alt: Indian Integration Section

- :guilabel:`TDS/TCS`: Activate this to enable :ref:`TDS/TCS <india/tds-tcs-threshold>`
  functionality along with account-based TDS/TCS section suggestions.
- :guilabel:`Registered Under GST`: Select this if your business is registered under GST to access
  GST-related features, including e-invoice, e-waybill, GST e-filing, fetch vendor e-invoiced
  document and check GST number status.
- :guilabel:`E-Invoicing`: Connects to the :ref:`e-invoice <india/e-invoicing>` :abbr:`NIC
  (National Informatics Center)` portal to submit invoices.
- :guilabel:`E-Way bill`: Connects to the :ref:`e-waybill <india/e-waybill>` :abbr:`NIC
  (National Informatics Center)` portal to generate e-waybills.
- :guilabel:`GST E-Filing & Matching`: Enable the feature to facilitate :ref:`GST return filing
  <india/gstr>` and connect with the GST portal to submit GSTR-1 and retrieve GSTR-2B.
- :guilabel:`Check GST Number Status`: Enable to verify :ref:`GSTIN Status <india/gstin_status>`.
- :guilabel:`Fetch Vendor E-Invoiced Document`: Helps in creating draft vendor bills using
  e-invoice data submitted by vendors on GST portal.

.. important::
   Check the :guilabel:`Production Environment` checkbox to start using Indian services in the
   production environment. If you want to use the testing environment then keep the checkbox
   unchecked.

.. _india/e-invoicing:

e-Invoice system
================

Odoo is compliant with the **Indian Goods and Services Tax (GST) e-Invoice system** requirements.

Setup
-----

.. _india/e-invoicing-api:

NIC e-Invoice registration
~~~~~~~~~~~~~~~~~~~~~~~~~~

You must register on the :abbr:`NIC (National Informatics Centre)` e-Invoice portal to get your
**API credentials**. You need these credentials to :ref:`configure your Odoo Accounting app
<india/e-invoicing-configuration>`.

#. Log in to the `NIC e-Invoice portal <https://einvoice1.gst.gov.in/>`_ by clicking
   :guilabel:`Login` and entering your :guilabel:`Username` and :guilabel:`Password`;

   .. note::
      If you are already registered on the NIC portal, you can use the same login credentials.

   .. image:: india/e-invoice-system-login.png
      :alt: Register Odoo ERP system on e-invoice web portal

#. From the dashboard, go to :menuselection:`API Registration --> User Credentials --> Create API
   User`;
#. After that, you should receive an :abbr:`OTP (one-time password)` code on your registered mobile
   number. Enter the OTP code and click :guilabel:`Verify OTP`;
#. Select :guilabel:`Through GSP` for the API interface, set :guilabel:`Tera Software Limited` as
   GSP, and type in a :guilabel:`Username` and :guilabel:`Password` for your API. Once it is done,
   click :guilabel:`Submit`.

   .. image:: india/submit-api-registration-details.png
      :alt: Submit API specific Username and Password

.. _india/e-invoicing-configuration:

Configuration in Odoo
~~~~~~~~~~~~~~~~~~~~~

To enable the e-Invoice service in Odoo, :ref:`activate <india/indian-configuration>` the
:guilabel:`E-Invoicing` feature and enter the :guilabel:`Username` and :guilabel:`Password`
previously set for the API.

.. _india/e-invoicing-workflow:

Workflow
--------

.. _india/generate-e-invoice:

Generate e-Invoice
~~~~~~~~~~~~~~~~~~

Once an invoice is confirmed, click the :guilabel:`Send` button to open the wizard. Select
:guilabel:`E-Invoicing`, then click the :guilabel:`Generate` button. Odoo will upload the
JSON-signed file of the invoice to the NIC e-Invoice portal.

.. image:: india/generate-e-invoice.png
   :alt: Generate e-Invoice

.. note::
   - You can find the JSON-signed file and check the e-Invoicing status in the chatter.

.. _india/invoice-pdf-report:

Invoice PDF report
~~~~~~~~~~~~~~~~~~

Once an invoice is validated and submitted, the invoice PDF report can be printed. The report
includes the :abbr:`IRN (Invoice Reference Number)`, :guilabel:`Acknowledgement` (number and date)
and QR code. These certify that the invoice is a valid fiscal document.

.. image:: india/invoice-report.png
   :alt: IRN and QR code

.. _india/edi-cancellation:

e-Invoice cancellation
~~~~~~~~~~~~~~~~~~~~~~

To cancel an e-Invoice, click the :guilabel:`Request Cancel` button on the related invoice. In the
:guilabel:`Cancel E-Invoice` window, fill out the :guilabel:`Cancel Reason` and :guilabel:`Cancel
Remarks`.

.. note::
   - You can find the e-Invoicing status in the chatter.

.. _india/e-invoice-negative-lines:

Management of negative lines in e-Invoices
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Negative lines are typically used to represent discounts or adjustments associated with specific
products or global discounts. The government portal prohibits the submission of data with negative
lines, which means they need to be converted based on the HSN code and GST rate. This is done
automatically by Odoo.

.. example::

   Consider the following example:

   +---------------------------------------------------------------------------------------------------+
   |                                     **Product Details**                                           |
   +=======================+==============+==================+==============+==============+===========+
   | **Product Name**      | **HSN Code** | **Tax Excluded** | **Quantity** | **GST Rate** | **Total** |
   +-----------------------+--------------+------------------+--------------+--------------+-----------+
   | Product A             |  123456      |  1,000           |  1           |  18%         |  1,180    |
   +-----------------------+--------------+------------------+--------------+--------------+-----------+
   | Product B             |  239345      |  1,500           |  2           |  5%          |  3,150    |
   +-----------------------+--------------+------------------+--------------+--------------+-----------+
   | Discount on Product A |  123456      |  -100            |  1           |  18%         |  -118     |
   +-----------------------+--------------+------------------+--------------+--------------+-----------+

   Here's the transformed representation:

   +-------------------------------------------------------------------------------------------------------------+
   |                                         **Product Details**                                                 |
   +==================+==============+==================+==============+==============+==============+===========+
   | **Product Name** | **HSN Code** | **Tax Excluded** | **Quantity** | **Discount** | **GST Rate** | **Total** |
   +------------------+--------------+------------------+--------------+--------------+--------------+-----------+
   | Product A        |  123456      |  1,000           |  1           |  100         |  18%         |  1,062    |
   +------------------+--------------+------------------+--------------+--------------+--------------+-----------+
   | Product B        |  239345      |  1,500           |  2           |  0           |  5%          |  3,150    |
   +------------------+--------------+------------------+--------------+--------------+--------------+-----------+

   In this conversion, negative lines have been transformed into positive discounts, maintaining
   accurate calculations based on the HSN Code and GST rate. This ensures a more straightforward and
   standardized representation in the E-invoice records.

.. _india/verify-e-invoice:

GST e-Invoice verification
~~~~~~~~~~~~~~~~~~~~~~~~~~

After submitting an e-Invoice, you can verify if the invoice is signed from the GST e-Invoice system
website itself.

#. Download the JSON file from the attached files. It can be found in the chatter of the related
   invoice;
#. Open the `NIC e-Invoice portal <https://einvoice1.gst.gov.in/>`_ and go to
   :menuselection:`Search --> Verify Signed Invoice`;
#. Select the JSON file and submit it;

   .. image:: india/verify-invoice.png
      :alt: select the JSON file for verify invoice

   If the file is signed, a confirmation message is displayed.

   .. image:: india/signed-invoice.png
      :alt: verified e-invoice

.. _india/e-waybill:

E-Way bill
==========

.. _india/e-waybill-setup:

Setup
-----

Odoo is compliant with the **Indian Goods and Services Tax (GST) E-waybill system** requirements.

.. _india/e-waybill-api:

API registration on NIC E-Way bill
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

You must register on the :abbr:`NIC (National Informatics Centre)` E-Way bill portal to create your
**API credentials**. You need these credentials to :ref:`configure your Odoo Accounting app
<india/e-waybill-configuration>`.

#. Log in to the `NIC E-Way bill portal <https://ewaybillgst.gov.in/>`_ by clicking
   :guilabel:`Login` and entering your :guilabel:`Username` and :guilabel:`Password`;
#. From your dashboard, go to :menuselection:`Registration --> For GSP`;
#. Click :guilabel:`Send OTP`. Once you have received the code on your registered mobile number,
   enter it and click :guilabel:`Verify OTP`;
#. Check if :guilabel:`Tera Software Limited` is already on the registered GSP/ERP list. If so, use
   the username and password used to log in to the NIC portal. Otherwise, follow the next steps;

   .. image:: india/e-waybill-gsp-list.png
      :alt: E-Way bill list of registered GSP/ERP

#. Select :guilabel:`Add/New`, select :guilabel:`Tera Software Limited` as your GSP Name, create a
   :guilabel:`Username` and a :guilabel:`Password` for your API, and click :guilabel:`Add`.

   .. image:: india/e-waybill-registration-details.png
      :alt: Submit GSP API registration details

.. _india/e-waybill-configuration:

Configuration in Odoo
~~~~~~~~~~~~~~~~~~~~~

To enable the E-Way bill service in Odoo, :ref:`activate <india/indian-configuration>` the
:guilabel:`E-Way bill` feature and enter the :guilabel:`Username` and :guilabel:`Password`.

.. _india/e-waybill-workflow:

Workflow
--------

.. _india/generate-e-waybill:

Generate E-Way bill
~~~~~~~~~~~~~~~~~~~

To generate an E-Way bill, confirm the customer invoice/vendor bill and click :guilabel:`Create
e-Waybill`. Enter the necessary details and click :guilabel:`Generate e-Waybill` to proceed.

.. note::
   - You can find the JSON-signed file in the attached files in the chatter.

Invoice PDF report
~~~~~~~~~~~~~~~~~~

You can print the invoice PDF report once you have submitted the E-Way bill. The report includes the
**E-Way bill number** and the **E-Way bill validity date**.

.. image:: india/e-waybill-invoice-report.png
   :alt: E-way bill acknowledgment number and date

.. _india/e-waybill-cancellation:

E-Way bill cancellation
~~~~~~~~~~~~~~~~~~~~~~~

To cancel an E-Way bill, click :guilabel:`e-Waybill` on the related invoice/bill, then
:guilabel:`Cancel e-Waybill`. In the :guilabel:`Cancel Ewaybill` window, fill out the
:guilabel:`Cancel Reason` and :guilabel:`Cancel Remarks`.

.. image:: india/e-waybill-cancellation.png
   :alt: Cancel reason and remarks

.. note::
   - Once you request to cancel the E-Way bill, Odoo automatically submits the JSON-signed file to
     the government portal. You can check the JSON file in the chatter.

.. _india/e-waybill-stock:

E-waybill creation from receipts and delivery orders
----------------------------------------------------

.. note::
   Make sure the **E-Way bill Stock** module is :ref:`installed <general/install>` and
   the :ref:`E-Way bill setup <india/e-waybill-setup>` is complete.

To create E-Way bills from :doc:`receipts and deliveries
</applications/inventory_and_mrp/inventory/shipping_receiving/daily_operations>` in the Inventory
app, follow these steps:

#. Go to :menuselection:`Inventory --> Operations --> Deliveries` or :menuselection:`Inventory -->
   Operations --> Receipts` and select an existing delivery order/receipt or create a new one.

#. Click :guilabel:`Create E-waybill/Challan`.

   .. note::
      To create an E-way bill:

      - A delivery order must be in the :guilabel:`Done` state (i.e., validated)
      - A receipt must have the :guilabel:`Ready` or :guilabel:`Done` state.

#. Click :guilabel:`Generate e-Waybill` to validate the E-Way bill and send it to the NIC E-Way
   bill portal.

   .. tip::
      To use the E-Way bill as a challan for goods deliveries without sending it to the NIC
      E-Waybill portal, click :guilabel:`Use as Challan`.

To print the E-waybill or the challan, click the :icon:`fa-cog` :guilabel:`(gear)` icon and select
:icon:`fa-print` :guilabel:`Ewaybill / Delivery Challan`.

.. _india/gstin_status:

Indian Check GSTIN Status
=========================

The :guilabel:`Indian - Check GST Number Status` allows you to verify the status of a
:abbr:`GSTIN (Goods and Services Tax Identification Number)` directly from Odoo.

To verify the status of a contact's GST number, access the customer's/vendor's form and click
:guilabel:`Check GSTIN Status` next to the :guilabel:`GSTIN` field.

To verify the status of a GST number entered on an invoice/bill, access the invoice/bill and click
the :icon:`fa-refresh` (:guilabel:`refresh`) button next to the :guilabel:`GST Status` field.

.. image:: india/gstin-status-invoice.png
   :alt: Check GSTIN status of an invoice

A notification is displayed to confirm the status update and the GSTIN status and verification date
are logged in the contact's chatter.

.. _india/gstr:

Indian GST Return filing
========================

.. _india/gstr_api:

Enable API access
-----------------

To file GST Returns in Odoo, you must first enable API access on the GST portal.

#. Log into the `GST portal <https://services.gst.gov.in/services/login>`_ by entering your
   :guilabel:`Username` and :guilabel:`Password`, and go to :guilabel:`My Profile` on your **profile
   menu**;

   .. image:: india/gst-portal-my-profile.png
      :alt: Click On the My Profile from profile

#. Select :guilabel:`Manage API Access`, and click :guilabel:`Yes` to enable API access;

   .. image:: india/gst-portal-api-yes.png
      :alt: Click Yes

.. note::
   It is recommended to set the :guilabel:`Duration` to :guilabel:`30 days` to avoid the need for
   frequent token reauthentication.

#. Doing so enables a :guilabel:`Duration` drop-down menu. Select the :guilabel:`Duration` of your
   preference, and click :guilabel:`Confirm`.

.. _india/gstr_configuration:

Indian GST Service In Odoo
--------------------------

Once you have enabled the :ref:`API access <india/gstr_api>` on the GST portal, :ref:`activate
<india/indian-configuration>` the :guilabel:`GST E-Filing & Matching Feature` to start using GST
Service. Then, in the :guilabel:`Registered Under GST` section, fill in the required :guilabel:`GST
Username`.

   .. image:: india/gst-setup.png
      :alt: Please enter your GST portal Username as Username

.. _india/gstr_workflow:

File-in GST Return
------------------

To file a GST return, make sure the :ref:`GST E-Filing & Matching Feature
<india/indian-configuration>` is enabled. Then, go to the Accounting dashboard and click
:guilabel:`Tax Returns` on the :guilabel:`Tax Returns` journal. In the
:guilabel:`Accounting Periods` window, fill in the following fields.

- :guilabel:`Opening Date`: Starting date from which tax return periods are created.
- :guilabel:`Fiscal Year End`: End date of the fiscal year (e.g., :guilabel:`31 March`).
- :guilabel:`GSTIN Periodicity`: Frequency of return filing (e.g., :guilabel:`Monthly`).

.. tip::
   Alternatively, go to :menuselection:`Accounting --> Reporting --> Tax Report`, click
   :icon:`fa-book` :guilabel:`Report:` and select :guilabel:`GSTR-1 (IN)`. Then, click
   :guilabel:`Returns` to file the return.

.. note::
   To reconcile vendor bills with GST portal data, go to
   :menuselection:`Accounting --> Reporting --> Tax Report`, click :icon:`fa-book`
   :guilabel:`Report:` and select :guilabel:`GSTR-2B`, and click :guilabel:`Reconcile`.

.. _india/gstr-1:

Filing GSTR-1 tax return
~~~~~~~~~~~~~~~~~~~~~~~~

To file a GSTR-1 tax return, follow these steps:

#. Click the suitable :guilabel:`GSTR-1` report for the desired period to open the filing view.

   .. image:: india/gst-gstr-1-file.png
      :alt: GSTR-1 filing view

   .. note::
      It is recommended to file the return **five days before the filing date** to avoid any
      penalties.

#. Odoo automatically performs validation checks before submission to ensure compliance with GST
   portal requirements that must be addressed before filing.

   .. note::
      The following types of validation issues can be raised:

      - :guilabel:`Apply Appropriate Tax`: :guilabel:`IGST` is not applicable for intra-state
        transactions.
      - :guilabel:`Wrong CGST/SGST on Inter-State Transactions`: :guilabel:`CGST/SGST` cannot be
        applied on inter-state transactions.
      - :guilabel:`Fiscal Year Reversed Move`: Credit Notes for invoices issued in a given financial
        year should not be included in GSTR-1 after **November 30th**; remove tax from these lines.
      - :guilabel:`Invalid HSN Codes`:
        - For products (non-services), HSN codes must not begin with `99`.
        - For services, HSN codes must begin with `99`.
      - :guilabel:`Missing HSN Codes`: Some product lines do not have HSN codes for journal
        items.
      - :guilabel:`Invalid UQC Codes`: The Unit Quantity Code (UQC) must comply with Indian GST
        standards.
      - :guilabel:`Missing Document Summary`: Document summary lines are mandatory for GSTR-1. This
        check is always marked as :guilabel:`Anomaly` initially. After reviewing the summary by
        clicking the relevant check, it changes to :guilabel:`Reviewed`.
      - :guilabel:`Missing E-Invoice`: Some invoices are not linked to an e-invoice.
      - :guilabel:`Unlinked Unregistered Credit Notes`: Credit Notes have been issued without
        referencing an invoice.

   Validation checks have four stages:

   - :guilabel:`To Review`: Check requires review.
   - :guilabel:`Reviewed`: Check has been reviewed.
   - :guilabel:`Supervised`: Check is supervised, and a supervisor is assigned.
   - :guilabel:`Anomaly`: Check has failed.

   Click on any individual check to view and resolve the corresponding issue.

   .. tip::
      A tax return can only be validated when all checks are in the :guilabel:`Reviewed` or
      :guilabel:`Supervised` stage.

   After reviewing the checks, click :guilabel:`Validate`. The :guilabel:`Review` stage appears in
   green then.

#. Click :guilabel:`GSTR-1 (IN)` to review the report.

#. Click :guilabel:`Submit`, and click :guilabel:`Push Data` in the
   :guilabel:`Submission Instructions` window to send the report to the GST portal.

   During this step, GST portal credentials must be verified. As the data is being sent, the
   :guilabel:`Send` stage in the progress bar appears orange. Once the GST portal confirms receipt,
   the stage turns green. If an error occurs, the :guilabel:`Send` stage changes to red.

   .. note::
      Click the :icon:`fa-ellipsis-v` :guilabel:`(ellipsis)` icon on the relevant :guilabel:`GSTR-1`
      line to display additional options:

      - :guilabel:`Generate XLSX`: Download the GSTR-1 report as an XLSX file.
      - :guilabel:`Reset`: Clear the current state and revert the return to the initial stage.

#. Click :guilabel:`Check Status` to retrieve the current status from the GST portal.
   Once the confirmation is received, the :guilabel:`Review` stage in the progress bar turns green.
   Then, click :guilabel:`Mark as Filed` to finalize and submit the return as filed.

   .. important::
      Once a return is marked as **Filed**, it cannot be reset or filed again.

.. _india/gstr-2b:

Receive GSTR-2B tax reconciliation
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

#. Select the relevant :guilabel:`GSTR-2B` report for the desired period that needs to be
   reconciled.

#. In the validation checks view, click :guilabel:`Fetch E-Invoice` to retrieve vendor e-invoice
   data for the reconciliation period. The check is initially marked as :guilabel:`Anomaly` and
   changes to :guilabel:`Reviewed` after fetching. Then, click :guilabel:`Validate` to confirm and
   mark the :guilabel:`Review` stage as green.

   .. important::
      The :guilabel:`Fetch E-Invoice` check only turns green if the e-invoice data is fetched
      **two days after the end of the last month's reconciliation period**.

#. Click :guilabel:`Fetch GSTR-2B` to retrieve all invoices from the GST portal. Once the data is
   fetched, the :guilabel:`Fetch` stage in the progress bar turns green. To view the raw report
   data, click :guilabel:`GSTR-2B (IN)`.

#. The fetched invoices are automatically matched with the E-invoices. Click :guilabel:`View Bills`
   to see detailed matching results.

   .. note::
      The :guilabel:`Match` stage indicates the reconciliation status:

      - Orange: Partially matched (some bills require correction).
      - Green: Fully matched (all bills reconciled).

      In case of mismatches, correct the affected bills, then click the :icon:`fa-ellipsis-v`
      :guilabel:`(ellipsis)` icon to access additional options:

      - :guilabel:`Re-Match`: Re-run the matching process after making corrections.
      - :guilabel:`Reset`: Reset the reconciliation to the :guilabel:`Match` stage.

#. After all bills are fully matched, click the :icon:`fa-ellipsis-v` :guilabel:`(ellipsis)` icon
   and select :guilabel:`Mark as Complete`.
   The :guilabel:`Complete` stage in the progress bar turns green, finalizing the bill
   reconciliation.

.. _india/gstr_reports:

Tax reports
===========

.. _india/gstr-1_report:

GSTR-1 report
-------------

The :guilabel:`GSTR-1` report is divided into sections. It displays the :guilabel:`Base` amount,
:abbr:`CGST (Central Goods and Services Tax)`, :abbr:`SGST (State Goods and Service Tax)`,
:abbr:`IGST (Integrated Goods and Services Tax)`, and :guilabel:`CESS` for each section.

   .. image:: india/gst-gstr-1-report.png
      :alt: GSTR-1 Report

.. _india/gstr-2b_report:

GSTR-2B report
--------------

The :guilabel:`GSTR-2` report is divided into sections. It displays the :guilabel:`Base` amount,
:abbr:`CGST (Central Goods and Services Tax)`, :abbr:`SGST (State Goods and Service Tax)`,
:abbr:`IGST (Integrated Goods and Services Tax)`, and :guilabel:`CESS` for each section.

   .. image:: india/gst-gstr-2b-report.png
      :alt: GSTR-2B Report

.. _india/gstr-3b_report:

GSTR-3B report
--------------

The :guilabel:`GSTR-3B` report contains different sections:

- Details of inward and outward supply subject to a **reverse charge**;
- Eligible :abbr:`ITC (Income Tax Credit)`;
- Values of **exempt**, **Nil-rated**, and **non-GST** inward supply;
- Details of inter-state supplies made to **unregistered** persons.

   .. image:: india/gst-gstr-3b-report.png
      :alt: GSTR-3B Report

Profit and Loss (IN) report
---------------------------

This is a :guilabel:`Profit and Loss` report that displays the balances for **Opening Stock** and
**Closing Stock**. It helps users using Continental accounting to accurately determine the cost of
goods (i.e :guilabel:`Opening Stock` + purchases during the period - :guilabel:`Closing Stock`).

   .. image:: india/profit-and-loss-report.png
      :alt: Profit and Loss report

.. _india/tds-tcs-threshold:

TDS/TCS threshold alert
=======================

:abbr:`TDS (tax deducted at source)` and :abbr:`TCS (tax collected at source)` are tax provisions
under Indian law, triggered when transaction amounts exceed specified thresholds. This alert
notifies users when the value of invoices or bills surpasses these limits, prompting the application
of the appropriate TDS/TCS.

To configure Odoo to advise you on when to apply TDS/TCS, set the :guilabel:`TDS/TCS section`
field on the corresponding account in the chart of accounts. Odoo will display a banner suggesting
the TDS/TCS section under which tax might be applicable when recording an invoice or bill.

Configuration
-------------

#. Navigate to :menuselection:`Accounting --> Configuration --> Settings`
#. In the :guilabel:`Indian Integration` section, enable the :guilabel:`TDS` or :guilabel:`TCS`
   feature as required.
#. Navigate to :menuselection:`Accounting --> Configuration --> Chart of Accounts`.
#. Click :guilabel:`View` on the desired account, and set the :guilabel:`TDS/TCS Section` field.

.. note::
   The TDS/TCS sections are pre-configured with threshold limits. If you need to modify these
   limits, go to :menuselection:`Accounting --> Configuration --> Taxes`. In the :guilabel:`Advanced
   Options` tab, click on the  :icon:`fa-arrow-right` :guilabel:`(internal link)` icon of the
   :guilabel:`Section` field.

   .. image:: india/tds-tcs-section-modify.png
      :alt: TDS/TCS section modify

Applying TCS/TDS on invoices and bills
--------------------------------------

Based on the account used on the customer invoice or vendor bill, Odoo checks the TCS/TDS threshold
limit. If the limit specified in the :guilabel:`TCS/TDS Section` of the account is exceeded, Odoo
displays an alert that suggests applying the appropriate TCS/TDS. The alert will disappear once the
TCS/TDS is applied.

.. image:: india/tcs-warning.png
   :alt: TCS advice

**TCS** is directly applicable in the tax on the invoice lines. To apply **TDS**, click the
:guilabel:`TDS Entry` smart button on the vendor bill/payment. The popup window allows specifying
the TDS details. Confirm the entry to apply the TDS.

.. image:: india/tds-apply.png
   :alt: TDS application

In Odoo, the aggregate total is calculated for partners sharing the same PAN number, across all company branches.

.. example::

   .. list-table::
      :header-rows: 1
      :widths: 10 20 10 20 15

      * - **Branch**
        - **Customer**
        - **Invoice**
        - **Transaction Amount (₹)**
        - **PAN Number**
      * - IN - MH
        - XYZ Enterprise - GJ
        - Invoice 1
        - ₹50,000
        - ABCPX1234E
      * - IN - MH
        - XYZ Enterprise - GJ
        - Invoice 2
        - ₹30,000
        - ABCPX1234E
      * - IN - MH
        - XYZ Enterprise - MH
        - Invoice 3
        - ₹40,000
        - ABCPX1234E
      * - IN - DL
        - XYZ Enterprise - GJ
        - Invoice 4
        - ₹20,000
        - ABCPX1234E
      * - IN - GJ
        - XYZ Enterprise - MH
        - Invoice 5
        - ₹60,000
        - ABCPX1234E

   -  **Aggregate total** = 50,000 + 30,000 + 40,000 + 20,000 + 60,000 = ₹200,000
   -  The aggregate total for all customers (XYZ Enterprise - GJ, MH, DL) sharing the PAN number
      ABCPX1234E across all branches is ₹200,000.


==================================================
SECTION: indonesia.rst
PATH: applications/finance/fiscal_localizations/indonesia.rst
==================================================

=========
Indonesia
=========

.. _localizations/indonesia/modules:

Modules
=======

The following modules related to the Indonesian localization are available:

.. list-table::
   :widths: 25 25 50
   :header-rows: 1

   * - Name
     - Technical name
     - Description
   * - :guilabel:`Indonesian - Accounting`
     - `l10n_id`
     - This module includes the default fiscal localization package.
   * - :guilabel:`Indonesia E-faktur`
     - `l10n_id_efaktur`
     - This module includes the features required to export invoices as e-Faktur.
   * - :guilabel:`Indonesia E-faktur (Coretax)`
     - `l10n_id_efaktur_coretax`
     - This module facilitates the generation of XML files for the Coretax system.

.. _localizations/indonesia/configuration:

Configuration
=============

.. _localizations/indonesia/configuration-company:

Company
-------

Open the :guilabel:`Settings` app, go to the :doc:`Companies <../../general/companies>` section,
and click :ref:`Update Info <general/companies/company>`.
Ensure the :guilabel:`NPWP` field contains the **Tax Identification Number**, as an e-Faktur cannot
be generated from an invoice otherwise.

.. _localizations/indonesia/configuration-contacts:

Contacts
--------

To configure a partner for e-Faktur, go to their :doc:`contact <../../essentials/contacts>` form
and fill in the following Indonesian-specific fields:

* :guilabel:`Is PKP`: Check this box to allow e-Faktur generation for the partner.
* :guilabel:`NPWP`: Enter the partner's Tax Identification Number.
* :guilabel:`NIK`: If the partner does not have an :guilabel:`NPWP`, enter the :guilabel:`NIK` in
  the :guilabel:`Accounting` tab under :guilabel:`Indonesian taxes`.

.. _localizations/indonesia/configuration-products:

Products
--------

To set a product's E-Faktur product code, go to :menuselection:`Accounting --> Customers -->
Products` and access the desired product form. In the :guilabel:`Indonesian Localization` section,
select a code in the :guilabel:`E-Faktur Product code` field. By default, the code is set to
:guilabel:`000000 - Barang`.

.. image:: indonesia/efaktur_product.png
   :alt: Product with the E-Faktur Product Code.

.. note::
   :guilabel:`E-Faktur product codes` are pre-generated by Odoo and cannot be edited. Select a code
   from the available options.

.. _localizations/indonesia/configuration-uom-code:

E-Faktur UoM Code
~~~~~~~~~~~~~~~~~

.. tip::
   Go to :menuselection:`Inventory --> Configuration --> Settings` to make sure the
   :guilabel:`Units of Measure` option has been enabled.

To configure the :guilabel:`E-Faktur UoM code`, go to :menuselection:`Inventory --> Configuration
--> UoM Categories`. Open a category and select the appropriate :guilabel:`E-Faktur UoM Code` from
the options.

.. image:: indonesia/efaktur_uom.png
   :alt: E-Faktur UoM.


.. _localizations/indonesia/accounting:

Accounting
==========

.. _localizations/indonesia/e-invoicing:

E-invoicing
-----------

.. _localizations/indonesia/e-faktur-xml:

Generate an E-Faktur XML
~~~~~~~~~~~~~~~~~~~~~~~~

An e-Faktur can be created for an invoice if the customer's country is Indonesia and the
:guilabel:`Is PKP` checkbox is enabled on their  :ref:`contact
<localizations/indonesia/configuration-contacts>` form.

To generate an e-Faktur XML:

#. Go to :menuselection:`Accounting --> Customers --> Invoices` and :ref:`create an invoice
   <accounting/invoice/creation>`.

#. In the :guilabel:`Other Info` tab, under the :guilabel:`Electronic Tax` section, select a
   :guilabel:`Kode Transaksi` code.

   .. note::
      The :guilabel:`Kode Transaksi` codes are pre-generated by Odoo and cannot be edited.

#. After confirming the invoice, click the :icon:`fa-cog` :guilabel:`(Actions)` icon and select
   :guilabel:`Download e-faktur`.

The downloaded XML file can then be uploaded to the Coretax system. After the file is generated,
the :guilabel:`e-Faktur Document (Coretax)` field in the invoice's :guilabel:`Electronic Tax`
section is populated automatically.

   .. image:: indonesia/faktur_invoice_confirmed.png
      :alt: Invoice with E-Faktur Document.

   .. note::
      To create a batch XML file for several invoices, select them in the invoice list view and
      choose :guilabel:`Download e-faktur` from the :guilabel:`Actions` menu.

.. important::
   - The tax invoice number is generated by the Coretax system, not by Odoo.
   - Once an e-Faktur XML file has been downloaded, it cannot be changed. Any subsequent download
     will retrieve the original file.

.. _localizations/indonesia/qris:

QRIS QR code on invoices
========================

`QRIS <https://qris.online/homepage/>`_ is a digital payment system that allows customers to make
payments by scanning the QR code from their preferred e-wallet.

.. important::
    According to the `QRIS API documentation <https://qris.online/api-doc/create-invoice.php>`_,
    QRIS expires after 30 minutes. Due to this restriction, the QR code is not included in reports
    sent to customers and is only available on the customer portal.

.. _localizations/indonesia/qris-activate-qr-code:

Activate QR codes
-----------------

Go to :menuselection:`Accounting --> Configuration --> Settings`. Under the :guilabel:`Customer
Payments` section, activate the :guilabel:`QR Codes` feature.

.. _localizations/indonesia/qris-bank-account-config:

QRIS bank account configuration
-------------------------------

Go to :menuselection:`Contacts --> Configuration --> Bank Accounts` and select the bank account for
which you want to activate QRIS. Set the :guilabel:`QRIS API Key` and :guilabel:`QRIS Merchant ID`
based on the information provided by QRIS.

.. important::
   The account holder's country must be set to `Indonesia` on its contact form.

.. image:: indonesia/qris-setup.png
   :alt: QRIS bank account configuration

.. seealso::
   :doc:`../accounting/bank`

.. _localizations/indonesia/qris-bank-journal-configuration:

Bank journal configuration
--------------------------

Go to :menuselection:`Accounting --> Configuration --> Journals`, open the bank journal, then fill
out the :guilabel:`Account Number` and :guilabel:`Bank` under the :guilabel:`Journal Entries` tab.

.. image:: indonesia/journal-bank-config.png
    :alt: Bank journal configuration

.. _localizations/indonesia/qris-invoices:

Issue invoices with QRIS QR codes
---------------------------------

When creating a new invoice, open the :guilabel:`Other Info` tab and set the :guilabel:`Payment
QR-code` option to :guilabel:`QRIS`.

.. image:: indonesia/invoice-qris.png
   :alt: Select QRIS QR-code option

Ensure that the :guilabel:`Recipient Bank` is the one you configured, as Odoo uses this field to
generate the QRIS QR code.


==================================================
SECTION: italy.rst
PATH: applications/finance/fiscal_localizations/italy.rst
==================================================

=====
Italy
=====

.. _italy/modules:

Configuration
=============

:ref:`Install <general/install>` the following modules to get all the features of the Italian
localization:

.. list-table::
   :header-rows: 1
   :stub-columns: 1

   * - Name
     - Technical name
     - Description
   * - Italy - Accounting
     - `l10n_it`
     - Default :ref:`fiscal localization package <fiscal_localizations/packages>`
   * - Italy - E-invoicing
     - `l10n_it_edi`
     - E-invoice implementation
   * - Italy - E-invoicing (Withholding)
     - `l10n_it_edi_withholding`
     - E-invoice withholding
   * - Italy - Accounting Reports
     - `l10n_it_reports`
     - Country-specific reports
   * - Italy - Stock DDT
     - `l10n_it_stock_ddt`
     - Transport documents - Documento di Trasporto (DDT)

.. seealso::
   :doc:`Documentation on e-invoicing’s legality and compliance in Italy
   <../accounting/customer_invoices/electronic_invoicing/italy>`

Company information
-------------------

Configuring the company's information ensures your Accounting database is properly set up. To add
information, go to :menuselection:`Settings --> General Settings`, and in the :guilabel:`Companies`
section, click :guilabel:`Update info`. From here, fill out the fields:

- :guilabel:`Address`: the address of the company;
- :guilabel:`VAT`: VAT of the company;
- :guilabel:`Codice Fiscale`: the fiscal code of the company;
- :guilabel:`Tax System`: the tax system under which the company falls;

.. image:: italy/company.png
   :alt: Company information to be provided

Taxes configuration
-------------------

Many of the e-invoicing features are implemented using Odoo's tax system. As such, taxes must be
properly configured to generate invoices correctly and handle other billing use cases.

The **Italian** localization contains predefined **examples** of taxes for various purposes.

.. _italy/tax-exemption:

Tax exemption
~~~~~~~~~~~~~

The use of sale taxes that amount to **zero percent** (0%) is required by Italian authorities to
keep track of the exact :guilabel:`Tax Exemption Kind (Natura)` and :guilabel:`Law Reference` that
justify the exemption operated on an invoice line.

.. example::
   The export tax in the EU can be used as reference (`0% EU`, invoice label `00eu`). It can be
   found under :menuselection:`Accounting --> Configuration --> Taxes`. Exports are exempt from VAT,
   and therefore, they require :guilabel:`Exoneration` kind and :guilabel:`Law Reference` filled in.

.. image:: italy/tax-exemption.png
   :alt: Tax Exemption Settings

.. seealso::
   There are many :guilabel:`Tax Exemption Kind (Natura)` and :guilabel:`Law Reference` codes. Make
   sure you check the latest version available to get the latest information on:

   - `Italian authorities documentation <https://www.agenziaentrate.gov.it/portale/web/guest/aree-tematiche/fatturazione-elettronica>`_
   - `Official guide on Tax exemption <https://www.agenziaentrate.gov.it/portale/documents/20143/451259/Guida_compilazione-FE-Esterometro-V_1.9_2024-03-05.pdf/67fe4c2d-1174-e8de-f1ee-cea77b7f5203>`_

.. note::
   If you need to use a different kind of exoneration, go to :menuselection:`Accounting -->
   Configuration --> Taxes`, select a similar tax, then click on the cog icon and select
   :guilabel:`Duplicate`. In the :guilabel:`Advanced Options` tab, add the :guilabel:`Exoneration`
   and :guilabel:`Law Reference`. To confirm click on :guilabel:`Save`.

.. tip::
   **Rename** your taxes in the :guilabel:`Name` field according to their :guilabel:`Exoneration` to
   differentiate them easily.

.. _italy/reverse-charge:

Reverse charge
==============

The **reverse charge** mechanism is a VAT rule that shifts the liability to pay VAT from the
supplier to the customer. The customers pay the VAT *themselves* to the :abbr:`AdE (Agenzia delle
Entrate)` instead. There are different types:

- | :guilabel:`Internal Reverse Charge` (for domestic sales)
  | The VAT responsibility is shifted to the buyer for certain categories of products and services.
- | :guilabel:`External Reverse Charge` (for intra-EU sales)
  | VAT is due in the country of the delivery or in the country where the service is performed. When
    the buyer is itself an Italian business, then the EU offers a mechanism that allows the seller
    to transfer his responsibility to the buyer.

Invoices
--------

**Reverse-charged** customer invoices show no VAT amount, but the :abbr:`AdE (Agenzia delle
Entrate)` requires the seller to specify the :guilabel:`Tax Exemption` reason and the :guilabel:`Law
Reference` that enable the reverse-charge mechanism. Odoo provides a set of special 0% taxes that
can be assigned to each reverse-charged invoice lines, representing the most commonly used
configurations.

Vendor bills
------------

Italian companies subjected to Reverse Charge must send the information in the bill received to the
:abbr:`AdE (Agenzia delle Entrate)`.

.. note::
   Self-reported VAT XML files must be issued and sent to the :abbr:`AdE (Agenzia Delle Entrate)`
   for reverse charged bills.

When creating a vendor bill, **reverse charge** taxes are available to be added in the
:guilabel:`Taxes` field. You can check which taxes are available by going to
:menuselection:`Accounting --> Configuration --> Taxes`, you can see that the 10% Goods and 22%
Services taxes are activated, among others. Due to the automated configuration of the Italian fiscal
position, these are automatically activated in the tax list.

.. _italy/grids:

Tax grids
---------

The Italian localization has a specific :ref:`tax grid <accounting/tax-returns/tax-grids>` section
for **reverse charge** taxes. These tax grids are identifiable by the :ref:`VJ <italy/grids>` tag,
and can be found by going to :menuselection:`Accounting --> Reporting --> Audit Reports: Tax
Report`.

.. image:: italy/grids.png
   :alt: Reverse charge tax grid from the VJ section of the Tax Declaration

.. _italy/e-invoicing:

E-invoicing
===========

The :abbr:`SdI (Sistema di Interscambio)` is the :doc:`electronic invoicing
<../accounting/customer_invoices/electronic_invoicing>` system used in Italy. It enables the sending
and receiving of electronic invoices to and from customers. The documents must be in an XML
:abbr:`EDI (Electronic Data Interchange)` format called **FatturaPA** and formally validated by the
system before being delivered.

To be able to receive invoices and notifications, the :abbr:`SdI (Sistema di Interscambio)` service
must be notified that the user's files need to be sent to Odoo and processed on their behalf. To do
so, you must set up Odoo's :guilabel:`Destination Code` on the :abbr:`AdE (Agenzia Delle
Entrate)` portal.

#. Go to `Italian authorities portal <https://ivaservizi.agenziaentrate.gov.it/portale>`_ and
   authenticate;
#. Go to section :menuselection:`Fatture e Corrispettivi`;
#. Set the user as Legal Party for the VAT number you wish to configure the electronic address;
#. In :menuselection:`Servizi Disponibili --> Fatturazione Elettronica --> Registrazione
   dell’indirizzo telematico dove ricevere tutte le fatture elettroniche`, insert Odoo's
   :guilabel:`Destination Code` `K95IV18`, and confirm.

EDI Mode and authorization
--------------------------

Since the files are transmitted through Odoo's server before being sent to the :abbr:`SdI (Sistema
di Interscambio)` or received by your database, you need to authorize Odoo to process your files
from your database. To do so, go to :menuselection:`Accounting --> Configuration --> Settings -->
Electronic Document Invoicing`.

There are three modes available:

- | :guilabel:`Demo`
  | This mode simulates an environment in which invoices are sent to the government. In this mode,
    invoices need to be *manually* downloaded as XML files and uploaded to the :abbr:`AdE
    (Agenzia delle Entrate)`'s website.
- | :guilabel:`Test (experimental)`
  | This mode sends invoices to a non-production (i.e., test) service made available by the
    :abbr:`AdE (Agenzia delle Entrate)`. Saving this change directs all companies on the database to
    use this configuration.
- | :guilabel:`Official`
  | This is a production mode that sends your invoices directly to the :abbr:`AdE (Agenzia delle
    Entrate)`.

Once a mode is selected, you need to accept the **terms and conditions** by ticking :guilabel:`Allow
Odoo to process invoices`, and then :guilabel:`Save`. You can now record your transactions in Odoo
Accounting.

.. warning::
   Selecting either :guilabel:`Test (experimental)` or :guilabel:`Official` is **irreversible**.
   For example, once in :guilabel:`Official` mode, it is not possible to select :guilabel:`Test
   (experimental)` or :guilabel:`Demo`. We recommend creating a **separate database** for testing
   purposes only.

.. note::
   When in :guilabel:`Test (Experimental)` mode, all invoices sent *must* have a partner using one
   of the following fake :guilabel:`Destination Code` given by the :abbr:`AdE (Agenzia Delle
   Entrate)`: `0803HR0` - `N8MIMM9` - `X9XX79Z`. Any real production :guilabel:`Codice Destinario`
   of your customers will not be recognized as valid by the test service.

.. image:: italy/edi.png
   :alt: Electronic document invoicing settings

.. _italy/e-invoicing-process:

Process
-------

The submission of invoices to the :abbr:`SdI (Sistema di Interscambio)` for Italy is an electronic
process used for the mandatory transmission of tax documents in XML format between companies and the
:abbr:`AdE (Agenzia delle Entrate)` to reduce errors and verify the correctness of operations.

.. note::
   You can check the current status of an invoice by the :guilabel:`SdI State` field. The XML file
   is attached to the invoice.

.. image:: italy/edi-process.png
   :alt: EDI system architecture

XML Documents creation
~~~~~~~~~~~~~~~~~~~~~~

Odoo generates the required XML files as attachments to invoices in the `FatturaPA` format required
by the :abbr:`AdE (Agenzia delle Entrate)`. Once the invoices needed are selected, go to
:guilabel:`Action` and click on :guilabel:`Send and Print`.

.. image:: italy/edi-menu.png
   :alt: Send and Print menu

When the pop-up window opens there is a selection of actions that can be taken. :guilabel:`Generate
XML File` generates the attachments.

.. image:: italy/edi-send-and-print.png
   :alt: Send and Print dialog

The XML file as well as the PDF once can be found attached to the invoice.

.. image:: italy/edi-attachments.png
   :alt: EDI Attachments

Submission to SDI
~~~~~~~~~~~~~~~~~

The :guilabel:`Send to Tax Agency` option in the :guilabel:`Send and Print` dialog sends the
attachment to the :guilabel:`Proxy Server`, which gathers all requests and then forwards them via a
WebServices channel to the :abbr:`SdI (Sistema di Interscambio)`. Check the sending status of the
invoice through the :guilabel:`Check Sending` button at the top of the invoice's view.

Processing by SDI
~~~~~~~~~~~~~~~~~

The :abbr:`SdI (Sistema di Interscambio)` receives the document and verifies for any errors. At this
stage, the invoice is in the :guilabel:`SdI Processing` state, as shown on the invoice. The invoice
also gets assigned a :guilabel:`FatturaPA Transaction` number that is shown in the
:guilabel:`Electronic Invoicing` tab. The checks may take variable time, ranging from a few seconds
up to a day, depending on the queue of invoices sent throughout Italy.

.. image:: italy/edi-processing.png
   :alt: Check Sending button and Sdi Processing state

Acceptance
~~~~~~~~~~

If the document is valid, it is recorded and considered fiscally valid by the :abbr:`AdE (Agenzia
delle Entrate)`, which will proceed with archiving in :guilabel:`Substitute Storage (Conservazione
Sostitutiva)` if explicitly requested on the Agency's portal.

.. warning::
   Odoo does not offer the `Conservazione Sostitutiva
   <https://www.agid.gov.it/index.php/it/piattaforme/conservazione>`_ requirements. Other providers
   and :abbr:`AdE (Agenzia delle Entrate)` supply free and certified storage to meet the
   specifications requested by law.

The :abbr:`SdI (Sistema di Interscambio)` :guilabel:`Destination Code` attempts to forward the
invoice to the customer at the provided address, whether it is a `PEC` email address or a
:abbr:`SdI (Sistema di Interscambio)` :guilabel:`Destination Code` for their ERP's WebServices
channels. A maximum of 6 attempts are made every 12 hours, so even if unsuccessful, this process can
take up to three days. The invoice status is :guilabel:`Accepted by SDI, Forwarding to Partner`.

Possible Rejection
~~~~~~~~~~~~~~~~~~

The :abbr:`SdI (Sistema di Interscambio)` may find inaccuracies in the compilation, possibly even
formal ones. In this case, the invoice is in the :guilabel:`SDI Rejected` state. The :abbr:`SdI
(Sistema di Interscambio)`'s observations are inserted at the top of the Invoice tab. To resolve the
issue, it is sufficient to delete the attachments of the invoice, return the invoice to
:guilabel:`Draft`, and fix the errors. Once the invoice is ready, it can be resent.

.. note::
   To regenerate the XML, both the XML attachment and the PDF report must be deleted, so that they
   are then regenerated together. This ensures that both always contain the same data.

.. image:: italy/edi-rejected.png
   :alt: EDI Rejected State

Forwarding Completed
~~~~~~~~~~~~~~~~~~~~

The invoice has been delivered to the customer; however, you can still send a copy to the customer
in PDF via email or post. Its status is :guilabel:`Accepted by SDI, Delivered to Partner`.

If the :abbr:`SdI (Sistema di Interscambio)` cannot contact your customer, they may not be
registered on the :abbr:`AdE (Agenzia delle Entrate)` portal. In this case, just make sure to send
the invoice in PDF via email or by mail. The invoice is then in the :guilabel:`Accepted by SDI,
Partner Delivery Failed` state.

Tax Integration
---------------

When you receive a vendor bill, either from :abbr:`SdI (Sistema di Interscambio)`, from paper or
from an imported XML file, the Tax Agency might request that you send some tax information
integration back to the :abbr:`SdI (Sistema di Interscambio)`. It happens when a transaction that
was tax exempt becomes taxable for any reason.

.. example::
   Here is a non-exhaustive list:

   - | :ref:`italy/reverse-charge`
     | As a buyer, you have to pay taxes on what you buy and integrate tax information.
       :guilabel:`Reverse Charge` taxes.
   - | :ref:`italy/split-payment`
     | As a :abbr:`PA (Public Administration)` business buyer, you have to pay taxes and integrate
       tax information. Be sure that you replace the :guilabel:`0% Sale Taxes` on the vendor bill
       you received with the correct :guilabel:`Split Payment` taxes.
   - | :guilabel:`Self Consumption`
     | When, as a business owner, you use an asset that you bought for business for personal reasons
       instead, you have to pay those taxes you originally deducted as a business cost for it.

Odoo may detect that your vendor bill can be interpreted as a document of a type that needs tax
integration, as detailed in the :ref:`italy/document-types` section.

.. important::
   Be sure that you replace the :guilabel:`0% Sale Taxes` on the vendor bill you received with the
   ones you're supposed to pay to the :abbr:`AdE (Agenzia delle Entrate)`. A button then appears on
   the top of the single vendor bill form to send them.

   When clicking on the :guilabel:`Send Tax Integration` button, an XML file of the appropriate
   :guilabel:`Document Type` is generated, attached to the bill, and sent as for invoices.

   .. image:: italy/edi-tax-integration-button.png
      :alt: EDI Send Tax Integration button

.. _italy/document-types:

Document Types
--------------

The :abbr:`SdI (Sistema di Interscambio)` requires businesses to send customer invoices and other
documents through the :abbr:`EDI (Electronic Data Interchange)`.

The following :guilabel:`Document Type` codes all technically identify different business use cases.

TD01 - Invoices
~~~~~~~~~~~~~~~

This represents the standard **domestic** scenario for all invoices exchanged through the :abbr:`SdI
(Sistema di Interscambio)`. Any invoice that doesn't fall into one of the specific special cases
is categorized as a regular invoice, identified by the :guilabel:`Document Type` `TD01`.

TD02 - Down payments
~~~~~~~~~~~~~~~~~~~~

**Down payment** invoices are imported/exported with a different :guilabel:`Document Type` code
`TDO2` than regular invoices. Upon import of the invoice, a regular vendor bill is created.

Odoo exports transactions as `TD02` if the following conditions are met:

#. It is an invoice;
#. All invoice lines are related to down payment sales order lines.

TD04 - Credit notes
~~~~~~~~~~~~~~~~~~~

It is the standard scenario for all **credit notes** issued to **domestic** clients, when we need to
formally acknowledge that the seller is reducing or cancelling a previously issued invoice, for
example, in case of overbilling, incorrect items, or overpayment. Just like invoices, they must be
sent to the :abbr:`SdI (Sistema di Interscambio)`, their :guilabel:`Document Type` `TD04`

TD07, TD08, TD09 - Simplified Invoicing
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Simplified invoices (`TD07`), credit notes (`TD08`), and debit notes (`TD09`) can be used to certify
domestic transactions under 400 EUR (VAT included). Its status is the same as that of a regular
invoice, but with fewer information requirements.

For a simplified invoice to be established, it must include:

#. :guilabel:`Customer Invoice` reference: **unique** numbering sequence with **no gaps**;
#. :guilabel:`Invoice Date`: issue **date** of the invoice;
#. :guilabel:`Company Info`: the **seller**'s full credentials (VAT/TIN number, name, full address)
   under :menuselection:`General Settings --> Companies (section)`;
#. :guilabel:`VAT`: the **buyer**'s VAT/TIN number (on the partner form);
#. :guilabel:`Total`: the total **amount** (VAT included) of the invoice.

In the :abbr:`EDI (Electronic Data Interchange)`, Odoo exports invoices as simplified if:

#. It is a domestic transaction (i.e., the partner is from Italy);
#. Your company's **required fields** (:guilabel:`VAT Number` or :guilabel:`Codice Fiscale`,
   :guilabel:`Fiscal Regime`, and full **address**) are provided;
#. The partner's address is not fully specified (i.e., it misses the City or the ZipCode);
#. The total amount of VAT included is **less** than **400 EUR**.

.. note::
   The 400 EUR threshold was defined in `the decree of the 10th of May 2019 in the Gazzetta
   Ufficiale <https://www.gazzettaufficiale.it/eli/id/2019/05/24/19A03271/sg>`_. We advise you to
   check the current official value.

TD16 - Internal Reverse Charge
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Internal reverse charge transactions (see :ref:`italy/tax-exemption` and
:ref:`italy/reverse-charge`) are exported as `TD16` if the following conditions are met:

- It is a vendor bill;
- It has at least **one tax** on the invoice lines that targets one of these :ref:`tax grids
  <italy/grids>`: `VJ6`, `VJ7`, `VJ8`, `VJ12`, `VJ13`, `VJ14`, `VJ15`, `VJ16`, `VJ17`

TD17 - Buying services from abroad
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

When buying **services** from **EU** and **non-EU** countries, the foreign *seller* invoices a
service with a **VAT-excluded** price, as it is not taxable in Italy. The VAT is paid by the *buyer*
in Italy.

- Within the EU: the *buyer* integrates the invoice received with the **VAT information** due in
  Italy (i.e., **vendor bill tax integration**);
- Non-EU: the *buyer* sends themselves an invoice (i.e., **self-billing**).

Odoo exports a transaction as `TD17` if the following conditions are met:

- It is a vendor bill;
- It has at least **one tax** on the invoice lines that targets the tax grid :ref:`VJ3
  <italy/grids>`;
- All invoice lines either have :guilabel:`Services` as **products**, or a tax with the
  :guilabel:`Services` as **tax scope**.

TD18 - Buying goods from EU
~~~~~~~~~~~~~~~~~~~~~~~~~~~

Invoices issued within the EU follow a **standard format**, therefore only an integration of the
existing invoice is required.

Odoo exports a transaction as `TD18` if the following conditions are met:

- It is a vendor bill;
- The **partner** is from an **EU** country;
- It has at least one tax on the invoice lines that targets the tax grid :ref:`VJ9 <italy/grids>`;
- All invoice lines either have :guilabel:`Consumable` as **products**, or a tax with
  :guilabel:`Goods` as **tax scope**.

TD19 - Buying goods from VAT deposit
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Buying **goods** from a **foreign** vendor, but the **goods** are already in **Italy** in a **VAT
deposit**.

- From the EU: the *buyer* integrates the invoice received with the **VAT information** due in
  Italy (i.e., **vendor bill tax integration**);
- Non-EU: the *buyer* sends an invoice to *themselves* (i.e., **self-billing**).

Odoo exports a transaction as a `TD19` if the following conditions are met:

- It is a vendor bill;
- It has at least one tax on the invoice lines that targets the tax grid :ref:`VJ3 <italy/grids>`;
- All invoice lines either have :guilabel:`Consumables` as products, or a tax with
  :guilabel:`Goods` as **tax scope**.

TD24 - Deferred invoices
~~~~~~~~~~~~~~~~~~~~~~~~

The **deferred invoice** is an invoice that is **issued at a later time** than the sale of goods or
the provision of services. A **deferred invoice** has to be issued at the latest within the **15th
day** of the month following the delivery covered by the document.

It usually is a **summary invoice** containing a list of multiple sales of goods or services carried
out in the month. The business is allowed to **group** the sales into **one invoice**, generally
issued at the **end of the month** for accounting purposes. Deferred invoices are default for
**wholesalers** having recurrent clients.

If the goods are transported by a **carrier**, every delivery has an associated **Documento di
Transporto (DDT)**, or **Transport Document**. The deferred invoice **must** indicate the details of
all the **DDTs** information for better tracing.

.. note::
   E-invoicing of deferred invoices requires the `l10n_it_stock_ddt` :ref:`module <italy/modules>`.
   In this case, a dedicated :guilabel:`Document Type` `TD24` is used in the e-invoice.

Odoo exports transactions as `TD24` if the following conditions are met:

#. It is an invoice;
#. It is associated with deliveries whose **DDTs** have a **different** date than the issue date of
   the invoice.

TD28 - San Marino
~~~~~~~~~~~~~~~~~

Invoices
********

San Marino and Italy have special agreements on e-invoicing operations. As such, **invoices** follow
the regular **reverse charge** rules. You can use the proper :guilabel:`Document Type` depending on
the invoice type: `TD01`, `TD04`, `TD05`, `TD24`, `TD25`. Additional requirements are not enforced
by Odoo. However, the user is requested by the **State** to:

- Select a tax with the :guilabel:`Tax Exemption Kind` set to `N3.3`;
- Use the generic :abbr:`SdI (Sistema di Interscambio)` :guilabel:`Destination Code` `2R4GTO8`.

The invoice is then routed by a dedicated office in San Marino to the correct business.

Vendor Bills
************

When a **paper bill** is received from San Marino, any Italian company **must** submit that invoice
to the :abbr:`AdE (Agenzia delle Entrate)` by indicating the e-invoice's :guilabel:`Document Type`
field with the special value `TD28`.

Odoo exports a transaction as `TD28` if the following conditions are met:

#. It is a vendor bill;
#. It has at least one tax on the invoice lines that targets the tax grids :ref:`VJ <italy/grids>`;
#. The **country** of the partner is **San Marino**.

Public Administration Businesses (B2G)
======================================

:abbr:`PA (Public Administration)` businesses are subjected to more control than private businesses
as they handle public money coming from taxpayers. The :abbr:`EDI (Electronic Data Interchange)`
process adds some steps to the :ref:`regular one <italy/e-invoicing-process>`, as :abbr:`PA (Public
Administration)` businesses can **accept** or **refuse** invoices.

.. note::
   :abbr:`PA (Public Administration)` businesses have a 6-digit long :guilabel:`Destination Code`,
   also called :abbr:`CUU (Codice Univoco Ufficio)`, that is **mandatory**, **PEC** address cannot
   be used in this case.

.. seealso::
   `Complete list of businesses that belong to the Public Administration along with their
   Destination Code <https://www.agenziaentrate.gov.it/portale/web/guest/aree-tematiche/fatturazione-elettronica>`_

CIG, CUP, DatiOrdineAcquisto
----------------------------

To ensure the effective traceability of payments by public administrations, electronic invoices
issued to public administrations must contain:

- The :abbr:`CIG (Codice Identificativo Gara)`, except in cases of exclusion from traceability
  obligations provided by law n. 136 of August 13, 2010;
- The :abbr:`CUP (Codice Unico di Progetto)`, in case of invoices related to public works.

If the XML file requires it, the :abbr:`AdE (Agenzia Delle Entrate)` can *only* proceed payments of
electronic invoices when the XML file contains a :abbr:`CIG (Codice Identificativo Gara)` and
:abbr:`CUP (Codice Unico di Progetto)`.

.. note::
   The :abbr:`CUP (Codice Unico di Progetto)` and the :abbr:`CIG (Codice Identificativo Gara)` must
   be included in one of the `DatiOrdineAcquisto`, `DatiContratto`, `DatiConvenzione`,
   `DateRicezione`, or `DatiFattureCollegate` XML tags.

   These correspond to the elements named :guilabel:`CodiceCUP` and :guilabel:`CodiceCIG` of the
   electronic invoice XML file, whose table can be found on the government `website
   <http://www.fatturapa.gov.it/>`_.

.. _italy/split-payment:

Split Payment
-------------

The :guilabel:`Split Payment` mechanism behaves much like :ref:`italy/reverse-charge`.

.. example::
   When an Italian company bills a :abbr:`PA (Public Administration)` business - for example,
   cleaning services for a public building - the :abbr:`PA (Public Administration)` business
   self-reports the VAT to the Tax Agency themselves, and the vendor just has to select the
   appropriate tax with the right :guilabel:`Tax Exemption` for their invoice lines.

The specific :guilabel:`Scissione dei Pagamenti` fiscal position is available to deal with partners
belonging to the :abbr:`PA (Public Administration)`.

Process
-------

.. _italy/digital-signature:

Qualified electronic signature
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Invoices and bills intended for the :abbr:`PA (Public Administration)` must include a **qualified
electronic signature** when submitted through the :abbr:`SdI (Sistema di Interscambio)`. This
signature is automatically applied in the :abbr:`XAdES (XML Advanced Electronic Signature)` format
when the invoice's partner has a 6-digit long :guilabel:`Destination Code` (which indicates a
:abbr:`PA (Public Administration)` business).

.. note::
   When such an invoice is transmitted to the Tax Agency, the generated `.xml` file is signed on the
   Odoo servers, returned to the database, and attached to the invoice automatically.

Acceptance or Refusal
~~~~~~~~~~~~~~~~~~~~~

After receiving the invoice through the :abbr:`SdI (Sistema di Interscambio)`, the :abbr:`PA (Public
Administration)` business has 15 days to accept the invoice. If it does, then the process ends here.
If the :abbr:`PA (Public Administration)` business refuses the invoice, it is still considered valid
once it is accepted by the :abbr:`SdI (Sistema di Interscambio)`. You then have to issue a credit
note to compensate and send it to the :abbr:`SdI (Sistema di Interscambio)`.

Expired Terms
~~~~~~~~~~~~~

If the :abbr:`PA (Public Administration)` business doesn't reply within 15 days, you need to contact
the :abbr:`PA (Public Administration)` business directly, sending them both the invoice and the
received deadline notification by email. You can make an arrangement with them and manually set the
correct :guilabel:`SdI State` on your invoice.

Point of Sale fiscal printers
=============================

.. warning::
   Fiscal printers are distinct from :doc:`ePOS printers
   </applications/sales/point_of_sale/configuration/epos_printers>`. The IP address for a fiscal
   printer should not be entered in the ePOS IP address settings.

Fiscal regulations mandate using certified RT devices, such as RT printers or RT servers, to ensure
compliant sales receipts and secure communication with the Tax Authority. These devices
automatically transmit fiscal data daily. RT printers, designed for individual POS terminals, handle
transactions, print receipts, and report to the authorities, ensuring data integrity and compliance.

Simulation mode
---------------

.. warning::
   Since the simulation mode sends data to the authorities, it should only be enabled at the very
   start of the printer's configuration process. Once the printer is switched to the production
   mode, it cannot be reverted to the simulation mode.

To test the fiscal printer setup with Odoo, configure the fiscal printer in the simulation mode
as follows:

#. Make sure the fiscal printer is set to its default state: printer on, start-up cycle complete,
   and no transaction in progress.
#. Type `3333`.
#. Press :guilabel:`Chiave`. The screen displays :guilabel:`Scelta Funzione`.
#. Type `14`. The screen displays :guilabel:`Apprendimento`.
#. Type `62`. The screen displays :guilabel:`Simulazione`.
#. To turn the :guilabel:`no` into a :guilabel:`si`, press :guilabel:`X`.
#. To confirm, press :guilabel:`Contante`.
#. Press :guilabel:`Chiave`.

To configure the printer for production, repeat the steps above.

.. note::
   To test the printer configuration, the physical device must first be obtained and registered with
   the relevant authorities.

Setting up the printer to work with Odoo
----------------------------------------

Fiscal printers are meant to work only in the local network. This means the printer and the
device running :doc:`Odoo Point of Sale </applications/sales/point_of_sale>` must be connected to
the same network.

Fiscal printers are typically configured to use HTTP by default. To ensure compatibility with Odoo,
the settings must be updated to enable HTTPS support on the printer. This can be done using either
the EpsonFPWizard configuration software or the keyboard connected to the printer.

To set up the fiscal printer using the keyboard, follow these steps:

#. Make sure the fiscal printer is set to its default state: printer on, start-up cycle complete,
   and no transaction in progress.
#. Type `3333`.
#. Press :guilabel:`Chiave`. The screen displays :guilabel:`Scelta Funzione`.
#. Type `34`. The screen displays :guilabel:`Web Server`.
#. Press :guilabel:`Contante` 3 times until the screen displays :guilabel:`Web Server: SSL`.
#. To turn the value `0` into a `1`, press :guilabel:`X`.
#. To confirm, press :guilabel:`Contante` 3 times.
#. Press :guilabel:`Chiave`.

Then, log in to the printer with the device that runs :doc:`Odoo Point of Sale
</applications/sales/point_of_sale>` so it recognizes the printer's certificate.

To approve and install the printer's certificate, follow these steps:

#. Access the printer by opening a web browser and entering `https://<ip-of-your-printer>` in the
   address bar. A :guilabel:`Warning: Potential Security Risk Ahead` security message appears.
#. Click :guilabel:`Advanced` to show the certificate approval options.
#. Click :guilabel:`Proceed` to validate the certificate.

Then, to ensure :doc:`Odoo Point of Sale </applications/sales/point_of_sale>` is configured with the
fiscal printer, go to :menuselection:`Point of Sale --> Configuration --> Settings`. In the
:guilabel:`Connected Devices` section, add the IP address in the :guilabel:`Italian Fiscal Printer
IP address` and enable :guilabel:`Use HTTPS`.

Ri.Ba. (Ricevuta Bancaria)
==========================

:abbr:`Ri.Ba. (Ricevuta Bancaria)` is a payment method widely used in Italy where vendors request
payments through their bank, which forwards the request to the customer's own bank and takes
responsibility for the collection. This enables payment automation and reduces risks for the vendor.

The vendor generally uploads a fixed-format text file with the list of payments to the bank's web
portal.

.. note::
   - Ri.Ba. are exclusively for **domestic payments** in Italy. For recurring international
     payments, please use `SEPA Direct Debt (SDD) <../accounting/payments/batch_sdd>`_

Configuration
-------------

#. Check that the `l10n_it_riba` module is :ref:`installed <general/install>`.
#. Go to :menuselection:`Settings --> Users & Companies --> Companies` and select the company that
   will use Ri.Ba.
#. Fill out the required :guilabel:`SIA Code`.

   .. image:: italy/sia-code.png
      :alt: The company's SIA code

   .. note::
      The :guilabel:`SIA Code` identifies businesses within the Italian banking network and is used
      to receive money through specific payment methods. It consists of one letter and four digits
      (e.g., T1234) and can usually be found on the bank's portal or obtained by contacting the bank.

#. Ensure the Company's bank account has an Italian IBAN.

   .. seealso::
      How to configure :doc:`Bank Accounts <../accounting/bank>`

Accept Ri.Ba. for your invoices
-------------------------------

Payments of type :abbr:`Ri.Ba. (Ricevuta Bancaria)` can be registered from the :guilabel:`Invoices`
(:menuselection:`Accounting --> Customers --> Invoices`).

.. important::
   Make sure that your invoice involves a Partner that has a bank account with an Italian IBAN.

Then, all Payments must be grouped in a **Batch Payment**.

.. seealso::
   - :doc:`Batch Payments <../accounting/payments>`
   - :doc:`Create a Batch Payment <../accounting/payments/batch>`

Once you press the :guilabel:`Validate` button for the Batch Payment, the :abbr:`Ri.Ba. (Ricevuta
Bancaria)` file is generated and attached to the Batch Payment, so you can download it and upload it
through your bank's web portal.

.. image:: italy/riba-attachment.png
   :alt: The Ri.Ba. file attached


==================================================
SECTION: jordan.rst
PATH: applications/finance/fiscal_localizations/jordan.rst
==================================================

======
Jordan
======

.. _localizations_jordan/configuration/modules:

Modules
=======

The following modules are installed automatically with the Jordanian localization:

.. list-table::
   :header-rows: 1
   :widths: 25 25 50

   * - Name
     - Technical name
     - Description
   * - :guilabel:`Jordan - Accounting`
     - `l10n_jo`
     - Jordanian :ref:`fiscal localization package <fiscal_localizations/packages>`, complete with
       the Jordanian chart of accounts, taxes, tax report, and fiscal positions
   * - :guilabel:`Jordan E-Invoicing`
     - `l10n_jo_edi`
     - Integration module for JoFotara to support Jordanian e-invoicing requirements

.. note::
   In some cases, such as when upgrading to a version with additional modules, it is possible that
   modules may not be installed automatically. Any missing modules can be manually :ref:`installed
   <general/install>`.

.. seealso::
   :doc:`Jordan Payroll localization documentation <../../hr/payroll/payroll_localizations/jordan>`

.. _localizations/jordan/specifics:

Localization overview
=====================

The Jordanian localization package ensures compliance with Jordanian fiscal and accounting
regulations. It includes tools for managing taxes, fiscal positions, reporting, and a predefined
chart of accounts tailored to Jordan's standards.

The Jordanian localization package provides the following key features to ensure compliance with
local fiscal and accounting regulations:

- :doc:`../accounting/get_started/chart_of_accounts`: a predefined structure tailored to Jordanian
  accounting standards
- :ref:`localizations/jordan/taxes`: pre-configured tax rates, including standard VAT, zero-rated,
  and exempt options
- :doc:`../accounting/taxes/fiscal_positions`: automated tax adjustments based on customer or
  supplier registration status
- :ref:`localizations/jordan/tax-reporting`: detailed overview of your net tax liability
- :ref:`E-invoicing (JoFotara)<localizations/jordan/jofotara>`: integration for electronic invoicing
  in line with Jordanian government requirements

.. _localizations/jordan/taxes:

Taxes
-----

The following :doc:`taxes <../accounting/taxes>` are available by default with the Jordanian
localization package:

- standard sales tax (16%): applied to most goods and services within Jordan.
- exempt transactions: for sales and services not subject to VAT, such as financial services or
  healthcare.
- export tax (0%): zero-rated tax applied to goods and services exported outside Jordan.

.. _localizations/jordan/tax-reporting:

Tax reporting
-------------

The :doc:`VAT summary <../accounting/reporting/tax_returns>` provides a detailed breakdown of
taxable, zero-rated, and exempt transactions. Like other :doc:`financial reports
<../accounting/reporting>`, the VAT summary can be filtered by period, compared against other
periods, and exported in Excel and PDF formats, ensuring compliance with Jordanian tax laws.

.. _localizations/jordan/jofotara:

E-invoicing with JoFotara
=========================

E-invoicing with JoFotara is integrated with Odoo, ensuring compliance with Jordanian government's
technical and legal requirements for electronic invoicing. The JoFotara integration in Odoo directly
connects with the Jordanian e-invoicing platform, allowing companies to:

- generate compliant electronic invoices
- submit invoices in real time for validation
- track invoice statuses directly within Odoo

The integration requires first creating an account with JoFotara, then generating API credentials,
and finally entering those credentials in your Odoo database to link the two.

.. _manuals: https://istd.gov.jo/EN/List/Electronic_billing_User_Manual

`Government manuals <manuals_>`_ provide instructions for creating an account and generating the API
credentials.

.. _localizations/jordan/jofotara-configuration:

Configuration
-------------

.. _localizations/jordan/linking-jofotara:

Link Odoo to JoFotara
~~~~~~~~~~~~~~~~~~~~~

#. If you don't already have an account, create one by going to the `government manuals <manuals_>`_
   page and following the steps in the **Procedure Manual for Joining the Jordanian National
   Electronic Invoicing System**.
#. Generate API credentials (Activity Number, Secret Key, and Client ID) by going to the `government
   manuals <manuals_>`_ page and following the steps in **Procedure Manual for Linking to the
   Jordanian National Electronic Invoicing System**.
#. In your Odoo database, go to :menuselection:`Accounting --> Configuration --> Settings`. In the
   :guilabel:`Electronic Invoicing (Jordan)` section, enter the API credentials generated
   previously:

   - :guilabel:`Activity Number` (income source sequence)
   - :guilabel:`JoFotara Secret Key`
   - :guilabel:`JoFotara Client ID`

#. Enter the :guilabel:`Taxpayer type`:

   - :guilabel:`Unregistered in the sales tax`: for businesses not registered for sales tax. No tax
     on the invoice line is required.
   - :guilabel:`Registered in the sales tax`: for businesses registered under the standard sales tax
     system. One tax computed as a percentage is required per invoice line.
   - :guilabel:`Registered in the special sales tax`: for businesses subject to special sales tax
     regulations. One tax computed as a percentage and one fixed tax per invoice line are required
     per invoice.

#. Click :guilabel:`Save`.

.. tip::
   If the :guilabel:`Electronic Invoicing (Jordan)` section is missing from the
   :guilabel:`Settings`, make sure the :guilabel:`Jordan E-Invoicing` module is :ref:`installed
   <general/install>`.

.. _localizations/jordan/company-and-contacts:

Company and customers
~~~~~~~~~~~~~~~~~~~~~

The JoFotara invoicing workflow requires address information related to the company that sends the
invoices and the customers who receive them:

#. Go to :menuselection:`Settings --> Users & Companies --> Companies` and select the company that
   will use JoFotara.
#. Fill in the :guilabel:`Company Name`, :guilabel:`Tax ID` (TIN), and :guilabel:`Country`. If
   desired, fill in additional optional fields such as :guilabel:`Street`, :guilabel:`City`,
   :guilabel:`State`, and :guilabel:`ZIP`.

   .. important::
      - The :guilabel:`Country` must be set to :guilabel:`Jordan`.
      - The :guilabel:`Company Name` must match the name that is registered with the Income and
        Sales Tax Department (ISTD).
      - The company's :guilabel:`Currency` must be set to :guilabel:`JOD`.


#. Go to :menuselection:`Accounting --> Customers --> Customers`.
#. For each customer whose invoices will be sent to JoFotara, click on the customer to open the form
   view, and complete the :guilabel:`Country` and :guilabel:`Tax ID`. If desired, fill in additional
   optional fields such as :guilabel:`Street`, :guilabel:`City`, :guilabel:`State`, and
   :guilabel:`ZIP`.

.. _localizations/jordan/sending-invoices:

Sending invoices to JoFotara via Odoo
-------------------------------------

Once the company has been :ref:`linked with JoFotara <localizations/jordan/linking-jofotara>` and
the :ref:`company and customers have been properly configured
<localizations/jordan/company-and-contacts>`, invoices can be sent to JoFotara via Odoo:

#. Go to :menuselection:`Accounting --> Customers --> Invoices` and open a confirmed (posted)
   invoice.
#. Click :guilabel:`Send`.
#. In the :guilabel:`Send` window, select :guilabel:`JoFotara (Jordan EDI)` and click
   :guilabel:`Send`.

When an invoice is sent to JoFotara, Odoo does the following:

- generates the invoice in the required format (UBL 1.2)
- submits the invoice to JoFotara for validation
- receives the QR code from JoFotara on the invoice's PDF

.. tip::
   - Multiple invoices can be :ref:`sent at once <accounting/invoice/sending>` to JoFotara.
   - From the :guilabel:`Invoices` list view, filter the invoices by their
     :ref:`localizations/jordan/jofotara-state` to see the invoices that have either been sent or
     not been sent to JoFotara.
   - In the :icon:`oi-settings-adjust` (:guilabel:`adjust settings`) menu, add the
     :guilabel:`JoFotara State` and :guilabel:`JoFotara Error` fields to see the sending state and
     any errors in the list view, respectively.

.. important::
   There is an inherent difference in how values are approximated in Odoo and ISTD due to the
   differing system architectures. JOD values in Odoo are stored and approximated to three decimals,
   whereas ISTD expects values to have nine decimals. As a result, an insignificant difference is
   inevitable and arises between the values stores in Odoo and the values reported to ISTD, which
   can have an error margin of <0.001.

.. _localizations/jordan/jofotara-state:

JoFotara State
~~~~~~~~~~~~~~

The :guilabel:`JoFotara State` field in the :guilabel:`Other Info` tab of confirmed invoices
reflects the current state of the document in JoFotara. It can be changed manually to reflect the
actual state of the invoices in cases where a technical error or timeout prevents Odoo from updating
it automatically.

.. _localizations/jordan/qr-codes:

Validating QR codes (Sanad app)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

To validate the QR code received from JoFotara on the invoice, follow these steps:

#. Install the `Sanad app <https://www.sanad.gov.jo/Default/en>`_.
#. Navigate to :guilabel:`More`.
#. Click on :guilabel:`Validate document` and scan the QR code.
#. Review results.

.. _localizations/jordan/debit-credit:

Debit and credit notes
~~~~~~~~~~~~~~~~~~~~~~

To send a debit or credit note to JoFotara, first create the :ref:`debit
<accounting/credit_notes/issue-debit-note>` or :ref:`credit note
<accounting/credit_notes/issue-credit-note>`. In the :guilabel:`Send` window, click
:guilabel:`JoFotara (Jordan EDI)` to submit it for real-time validation. Upon successful validation,
the QR code from JoFotara is embedded in the debit or credit note PDF.

.. note::
   Ensure that the :guilabel:`Reason` for generating a debit/credit note aligns with ISTD
   regulations.

.. _localizations/jordan/discounts:

Discounts
~~~~~~~~~

JoFotara does not support negative quantities or negative prices on invoice lines. As a result,
global discount and fixed amount discount functionality are not supported.

Discounts must be applied **per invoice line as a percentage** instead of as a global discount or
fixed amount.

.. warning::
   Attempting to submit invoices to JoFotara with negative invoice lines will result in validation
   errors.

.. seealso::
   :ref:`Discount types <sales/discounts/discount-button>`


==================================================
SECTION: kenya.rst
PATH: applications/finance/fiscal_localizations/kenya.rst
==================================================

=====
Kenya
=====

.. _localization/kenya/configuration:

Configuration
=============

Install the 🇰🇪 **Kenyan** :ref:`fiscal localization package <fiscal_localizations/packages>` to get
all the features of the Kenyan localization.

eTIMS
=====

The `Kenya Revenue Authority (KRA) <https://www.kra.go.ke/>`_ has implemented the
`electronic Tax Invoice Management System (eTIMS) <https://www.kra.go.ke/online-services/etims>`_
for tax collection.

To submit documents through eTIMS, you must use an :abbr:`OSCU (Online Sales Control Unit)` that
integrates with the existing **Trader Invoicing System (TIS)**, such as the one provided by Odoo.
The OSCU is used to validate, encrypt, sign, transmit, and store tax invoices.

.. note::
   Make sure to :ref:`install <general/install>` the **Kenya eTIMS EDI** modules to use the OSCU
   device fully.

.. _kenya/initialization:

OSCU device initialization
--------------------------

The OSCU must be initialized before use. To do so, navigate to :menuselection:`Settings --> General
Settings`, click :guilabel:`Update Info` in the :guilabel:`Companies` section, and enter your
:guilabel:`Tax ID`.

To initialize the OSCU:

#. Go to :menuselection:`Settings --> General Settings` and scroll down to the :guilabel:`Kenya
   eTIMS Integration` section.
#. Set the :guilabel:`eTIMS Server Mode` to :guilabel:`Test` for the initialization.
#. Enter the :guilabel:`Serial Number` of the device and tick the two check boxes.
#. Click :guilabel:`Initialize OSCU`.

.. note::
   Three server modes are available:

   - :guilabel:`Demo`: Designed for demo purposes; it uses mock data and does not require an
     initialized OSCU;
   - :guilabel:`Test`: Used to test the connection to eTIMS;
   - :guilabel:`Production`: Used for live databases that are ready to send data.

.. Important::
   If your device has **already been initialized** (through another ERP, for example), enable the
   :doc:`../../general/developer_mode`. Then, in the :guilabel:`Kenya eTIMS Integration` section,
   enter the ID of the unit in the :guilabel:`Unit ID` field and the key obtained through a previous
   initialization in the :guilabel:`CMC Key` field. Click :guilabel:`Save` when done.

Once the **OSCU module** has been :ref:`initialized <kenya/initialization>`, an OSCU serial number
is generated for each company on that database with its **country** set to :guilabel:`Kenya`. The
serial number is generated based on the VAT number of the company (regardless of its validity). It
is a unique and sequential serial number starting with the prefix `ODOO` followed by the company's
**VAT number** and a sequence of numbers.

Registering on eTIMS
--------------------

Taxpayers *must* sign up and create an account on the `KRA portal <https://etims.kra.go.ke/basic/login/indexLogin>`_.
If you do not have an account yet:

#. Sign up, enter your **PIN**, and verify that all information is correct, including your phone
   number, email address, and postal address. Correct any errors on the `iTax page
   <https://itax.kra.go.ke/KRA-Portal/>`_.
#. An :abbr:`OTP (One-time Password)` is sent to the phone number provided. Unblock promotional
   messages if you do not receive it.
#. Upload the **business owner ID** *or* **director's ID** (as listed on iTax), along with the
   filled-out and signed **commitment form** .
#. On the **eTIMS dashboard**, click :guilabel:`Service request` at the top of the page. Select
   :guilabel:`OSCU` as the **eTIMS type**, enter `Odoo KE LTD` as the third-party integrator, and
   enter your company's OSCU serial number retrieved earlier.

.. note::
   Service request approvals are usually quick. If there's a delay, contact the eTIMS operation
   or KRA office.

.. admonition:: Commitment form

   - Part 1: Fill in the taxpayer's information.
   - Part 2: Fill in the business owner's *or* director's information.
   - Part 3: Fill in your unique serial number found in Odoo.
   - Part 4: Tick **OSCU**, enter Odoo KE LTD PIN `PO52112956W`, and enter the Odoo version you're
     using (17.0 or onwards).
   - Part 5: Check the mandatory boxes, enter a date, and sign.

eTIMS codes
-----------

Common standard codes are **automatically** fetched from the KRA eTIMS API servers every two days.
To fetch them manually, proceed as follows:

#. Enable the :doc:`../../general/developer_mode`.
#. Go to :menuselection:`Settings --> Technical --> Automation: Scheduled Actions` and search for
   :guilabel:`KE eTIMS: Fetch KRA standard codes`.
#. Click the action in the list, then click :guilabel:`Run Manually` to fetch the codes.

Go to :menuselection:`Accounting --> Configuration --> KE OSCU Codes` to view the complete list of
fetched OSCU codes.

.. image:: kenya/oscu-codes.png
   :alt: List of fetched OSCU codes.

.. _etims/unspsc:

UNSPSC codes
------------

The KRA needs UNSPSC codes for a product to be **registered**. UNSPSC codes are **automatically**
fetched from the KRA eTIMS API servers every day. To fetch them manually, proceed as follows:

#. Enable the :doc:`../../general/developer_mode`.
#. Go to :menuselection:`Settings --> Technical --> Automation: Scheduled Actions` and search for
   :guilabel:`KE eTIMS: Fetch UNSPSC codes from eTIMS`.
#. Click the action in the list, then click :guilabel:`Run Manually` to fetch the codes.

Go to the **product form**, and in the :guilabel:`Accounting` tab, click the :guilabel:`UNSPSC
Category` field to view the complete list of fetched UNSPSC codes.

Notices
-------

Notices are **automatically** fetched from the KRA eTIMS API servers every day. To fetch them
**manually**, proceed as follows:

#. Enable the :doc:`../../general/developer_mode`.
#. Go to :menuselection:`Settings --> Technical --> Automation: Scheduled Actions` and search for
   :guilabel:`KE eTIMS: Fetch KRA notices from eTIMS`.
#. Click the action in the list, then click :guilabel:`Run Manually` to fetch the notices.

Go to :menuselection:`Accounting --> Configuration --> KE OSCU Notices` to view the complete list of
fetched notices.

Multi-company
-------------

.. _kenya/branch:

.. seealso::
   :doc:`../../general/companies`

If you have :ref:`multiple companies <accounting/multi-company>`, you can centralize and manage them
all on a single Odoo database. The KRA identifies and differentiates the **parent** company from
its **subsidiaries** by using IDs. Furthermore, subsidiaries are classified as :ref:`branches
<general/companies/branches>` of the parent company.

To configure the company's ID, open the **Settings** app, click :guilabel:`Update Info` in the
:guilabel:`Companies` section, and search for the :guilabel:`eTIMS Branch Code` field. The **parent
company** has a branch ID equal to `00` in a multi-company environment. Companies that are *not* the
parent company have a branch ID other than `00` and are assigned an ID by the KRA.

To fetch the **branch ID** from the KRA for your non-parent companies, ensure the parent company has
a Kenyan :guilabel:`Tax ID` and the OSCU device has been :ref:`initialized <kenya/initialization>`.
Then, go to the :guilabel:`Branches` tab and click :guilabel:`Populate from KRA`.

.. note::
   - The KRA considers each **place of supply** as a separate branch (ID).
   - The **OSCU** device must be :ref:`initialized independently <kenya/initialization>` for each
     branch.

Contact branch ID
-----------------

To attribute a branch ID to a contact, access the contact form, go to the :guilabel:`Accounting`
tab, and enter the branch code in the :guilabel:`eTIMS Branch Code` field.

.. note::
   By default, contacts' branch IDs are set to `OO`.

KRA sequences
-------------

.. important::
   Odoo invoice sequences and KRA sequences are **different**.

In Odoo, invoice sequences depend on the **parent company**. Parent companies can see the invoices
of branches, but branches **cannot** see the parent company's invoices or those of other branches.

The KRA needs **independent** sequences per branch. Therefore, Odoo manages sequences individually
per branch.

.. example::
   If you have a parent company with two branches, the invoice sequence would be the following:

   - Creating an invoice on **branch 1**: INV/2024/00001;
   - Creating an invoice on **branch 2**: INV/2024/00002;
   - Creating an invoice on the **parent company**: INV/2024/00003.

   This is how Odoo manages sequences to be compliant with the KRA regulations:

   - Creating an invoice on **branch 1**: INV/2024/00001;
   - Creating an invoice on **branch 2**: INV/2024/00001;
   - Creating an invoice on the **parent company**: INV/2024/00001.

Insurance
=========

For **health service providers**, you can send insurance information about the parent and branch
companies and update it in eTIMS. To do so, go to :menuselection:`Accounting --> Configuration -->
Settings`, scroll to the :guilabel:`Kenya eTIMS Integration` section, and fill in the
:guilabel:`Code`, :guilabel:`Name`, and :guilabel:`Rate` fields. Click :guilabel:`Send Insurance
Details` when done.

.. _kenya/product-registration:

Product registration
====================

The KRA requires **products to be registered** first before conducting business operations (such as
stock movements, :abbr:`BOM (Bill of Materials)`, customer invoices, etc.). For a product to be
registered, the following fields must be defined on the product form:

- In the :guilabel:`General Information` tab: :guilabel:`Cost`.
- In the :guilabel:`Accounting` tab:

  - :guilabel:`Packaging Unit`;
  - :guilabel:`Packaging Quantity`;
  - :guilabel:`Origin Country`;
  - :guilabel:`eTIMS Product Type`;
  - :guilabel:`Insurance Applicable`;
  - :ref:`UNSPSC Category <etims/unspsc>`.

If the elements above are defined, the product is automatically registered while sending the
operation to the KRA. If not, you will be alerted by a yellow banner at the top of the screen
inviting you to check the missing elements.

.. image:: kenya/product-registration.png
   :alt: Product registration template.

Stock movements
===============

All **stock movements** must be sent to the KRA. They do not require an invoice if they are
internal operations or stock adjustments; therefore, Odoo automatically sends them if at least one
of the following conditions are met:

#. No contact is set for the move;
#. The contact is your parent company or a branch of the parent company.

If the stock moves are **external operations** (e.g., to contacts that are not part of the parent
company or its branches), the stock moves are automatically sent *after* the invoice is sent to
eTIMS.

.. note::
   - The stock move must be confirmed before sending the invoice to eTIMS.
   - The product(s) must be :ref:`registered <kenya/product-registration>` for the stock move to be
     sent to eTIMS. If the product has not been registered yet, a yellow banner will prompt the
     products' registration.

Purchases
=========

Odoo automatically fetches new vendor bills from eTIMS every day. You need to confirm the fetched
vendor bills and send the confirmation to the KRA. To confirm a vendor bill, it must be linked to
one or several confirmed purchase order line(s).

.. _kenya/purchases:

In the case of purchases (not customs imports), the steps to link purchase order lines with bills
are the following:

#. Go to :menuselection:`Accounting --> Vendors --> Bills`.
   The vendor bill is fetched from the KRA servers. The JSON file is available in the chatter of the
   vendor bill if needed.
#. Odoo looks at the :guilabel:`Tax ID` (PIN) of the vendor (partner);

   - If it is unknown, a new contact (partner) is created.
   - If it is known and the branch ID is the same, Odoo uses the known contact.

#. In the fetched bill from the KRA, select the :guilabel:`Product`. Each vendor bill *must* contain
   a product to be confirmed and sent to eTIMS later on.
#. Odoo checks existing purchase order lines matching the product(s) entered at the previous step
   and the partner (if any). Click the :guilabel:`Purchase Order Line` field, and select the correct
   related purchase order line(s) matching the product(s). The quantities on the bill *must* be the
   same as the received quantities indicated on the purchase order.

   If no existing purchase order line matches the lines of the fetched bill, click
   :guilabel:`Create Purchase Order` and create a purchase order based on the unmatched line(s).
   :guilabel:`Validate` the resulting stock move and :guilabel:`Confirm` the bill.

#. Set a method in the :guilabel:`eTIMS Payment Method` field..
#. Once all steps are completed, click :guilabel:`Send to eTIMS` to send the vendor bill. When the
   vendor bill has been confirmed on eTIMS, the **KRA invoice number** can be found in the
   :guilabel:`eTIMS Details` tab.

.. image:: kenya/purchase-order-lines.png
   :alt: Bill registration steps.

Invoicing
=========

.. note::
   The KRA does *not* accept sales if the product is not in stock.

This is the **advised sales flow** in Odoo when selling:

#. Create a **sales order**.
#. :guilabel:`Validate` the delivery.
#. :guilabel:`Confirm` the invoice.
#. Click :guilabel:`Send and print`, and then enable :guilabel:`Send to eTIMS`.
#. Click :guilabel:`Send & print` to send the invoice.

Once the invoice has been sent and signed by the KRA, the following information can be found on
it:

- **KRA invoice number**;
- Mandatory KRA invoice fields, such as **SCU information**, **date**, **SCU ID**, **receipt
  number**, **item count**, **internal date**, and **receipt signature**;
- The **KRA tax table**;
- A unique **KRA QR code** for the signed invoice.

Imports
=======

Customs import codes are **automatically** fetched from the KRA eTIMS API servers every day. To
fetch them manually, proceed as follows:

#. Enable the :doc:`../../general/developer_mode`.
#. Go to :menuselection:`Settings --> Technical --> Automation: Scheduled Actions` and search for
   :guilabel:`KE eTIMS: Receive Customs Imports from the OSCU`.
#. Click the action in the list, then click :guilabel:`Run Manually` to fetch the codes.

Go to :menuselection:`Accounting --> Vendors --> Customs Imports` to view the imported codes.

The following steps are required to send and have **customs imports** signed by the KRA:

#. Go to :menuselection:`Accounting --> Vendors --> Customs Imports`; The customs import is fetched
   automatically from the KRA.
#. Match the imported item with an existing registered product in the :guilabel:`Product` field (or
   create a product if no related product exists).
#. Set a vendor in the :guilabel:`Partner` field.
#. Based on the partner, match the imported item with its related purchase order (see
   :ref:`purchase steps <kenya/purchases>`). The stock must be correctly adjusted when the customs
   import is approved.

   If no related purchase order exists, create one and :guilabel:`Confirm` it. Then, confirm the
   delivery by clicking :guilabel:`Receive Products`, then :guilabel:`Validate` on the purchase
   order.

#. Click :guilabel:`Match and Approve` or :guilabel:`Match and Reject`, depending on the
   situation of the goods.

.. note::
   The JSON file received from the KRA is attached to the chatter of the customs import.

BOM
===

The KRA requires all BOMs to be sent to them. To send BOMs to eTIMS, the product and its components
*must* be :ref:`registered <kenya/product-registration>`. To access a product's BOM, click on the
product and then click the :guilabel:`Bill of Materials` smart button.

Make sure the :ref:`KRA's required fields <kenya/product-registration>` are filled in the
:guilabel:`KRA eTIMS details` section of the :guilabel:`Accounting` tab in the product form, and
click :guilabel:`Send to eTIMS`. The successful sending of the BOM is confirmed in the chatter,
where you can also find the sent information in an attached JSON file.

Credit notes
============

The KRA does not accept credit notes with quantities or prices higher than the initial invoice. When
creating a credit note, a KRA reason must be indicated: In the credit note form, go to the
:guilabel:`eTIMS Details` tab, select the :guilabel:`eTIMS Credit Note Reason`, and then select the
invoice number in the :guilabel:`Reversal of` field.


==================================================
SECTION: luxembourg.rst
PATH: applications/finance/fiscal_localizations/luxembourg.rst
==================================================

==========
Luxembourg
==========

.. _localizations/luxembourg/modules:

Modules
=======

The following modules are installed automatically with the Luxembourgish localization:

.. list-table::
   :header-rows: 1

   * - Name
     - Technical name
     - Description
   * - :guilabel:`Luxembourg - Accounting`
     - `l10n_lu`
     - Default :ref:`fiscal localization package <fiscal_localizations/packages>`
   * - :guilabel:`Luxembourg - Accounting Reports`
     - `l10n_lu_reports`
     - Country-specific reports

.. note::
   In some cases, such as when upgrading to a version with additional modules, it is possible that
   modules may not be installed automatically. Any missing modules can be manually :ref:`installed
   <general/install>`.

.. seealso::
   :doc:`Documentation on e-invoicing’s legality and compliance in Luxembourg
   <../accounting/customer_invoices/electronic_invoicing/luxembourg>`

.. _localizations/luxembourg/overview:

Localization overview
=====================

The Luxembourgish localization includes the following features:

- :doc:`../accounting/get_started/chart_of_accounts`: a predefined set of accounts that follows the
  current official accounting standards (PCN 2020)
- :ref:`localizations/luxembourg/taxes`: pre-configured tax rates, including standard (17%),
  reduced (14%, 8%, and 3%) and zero-rated VAT, intra-community, and zero-rated export taxes
- :doc:`../accounting/taxes/fiscal_positions`: automated account and tax adjustments based on
  customer or supplier
- :ref:`localizations/luxembourg/e-invoicing`: E-invoicing with Peppol
- :ref:`localizations/luxembourg/tax-reporting`: detailed overview of your VAT liability, and
  generation of monthly and annual VAT declarations in XML format to upload to the :abbr:`eCDF
  platform (plateforme électronique de Collecte des Données Financières)`
- :ref:`localizations/luxembourg/faia`: generation of audit files in the :abbr:`FAIA (Fichier
  d’Audit Informatisé AED)` (Luxembourgish SAF-T) format

.. _localizations/luxembourg/taxes:

Taxes
-----

The following :doc:`taxes <../accounting/taxes>` are available by default with the Luxembourgish
localization package:

- standard VAT (17%): applied to most goods and services within Luxembourg
- reduced VAT (14%, 8%, and 3%): applied to some goods and services within Luxembourg
- zero-rated VAT: applied to goods and services not subject to VAT
- intra-community VAT: applied to goods and services sold to or purchased from VAT-registered
  persons located in other EU countries
- export tax (0%): zero-rated tax applied to goods and services exported outside Luxembourg

.. _localizations/luxembourg/e-invoicing:

E-invoicing
-----------

Odoo users in Luxembourg can register on the :ref:`accounting/e-invoicing/peppol` network, which
allows exchanging e-invoices and credit notes with other participants on the network.

The e-invoice format in Luxembourg is **BIS Billing 3.0**.

.. important:: E-invoicing via Peppol is mandatory for all B2G transactions in Luxembourg.

.. _localizations/luxembourg/tax-reporting:

Tax reporting
=============

In Luxembourg, companies must submit a VAT declaration on a monthly, quarterly, or annual basis to
the tax office, depending on their turnover. Companies that submit a monthly or quarterly
declaration are also required to submit the annual declaration.

Both monthly/quarterly and annual VAT declarations can be exported as XML files to upload on the
:abbr:`eCDF platform (plateforme électronique de Collecte des Données Financières)`.

Monthly / quarterly declaration
-------------------------------

Go to :menuselection:`Accounting --> Reporting --> Tax Report`.

In the :icon:`fa-book` :guilabel:`Report` selector, select :guilabel:`Tax Report (LU)`.

In the :icon:`fa-calendar` (:guilabel:`Period`) selector, choose the month or quarter for which to
generate the declaration.

Check the amounts generated for all four sections of the report.

If you sold to customers under a VAT exemption for SMEs during the period, you need to manually
enter the value of such sales in the editable fields at section I, items 481 and 482. To find the
amounts for these items, you can use the :guilabel:`Partner Ledger` report:

- Go to :menuselection:`Accounting --> Reporting --> Partner Ledger`.
- In the :icon:`fa-calendar` (:guilabel:`Period`) selector, choose the appropriate month or
  quarter.
- In the :icon:`fa-user` (:guilabel:`Account`) selector, choose :guilabel:`Receivable`.
- In the :icon:`fa-folder-open` (:guilabel:`Partners`) selector, choose the partners that fall under
  the exemption.
- Copy the total :guilabel:`Balance` for those partners for the given period.

Once the declaration is correct, click the :icon:`fa-cog` (:guilabel:`action menu`) icon, then click
:guilabel:`XML` to export and download it in XML format. You can then submit the XML file on the
eCDF platform.

Annual declaration
------------------

.. _luxembourg/account-tag-configuration:

Account tag configuration
~~~~~~~~~~~~~~~~~~~~~~~~~

The following configuration allows values to be generated automatically for sections I and III, and
Appendix A of the report, based on journal entries that impact accounts associated with each report
line.

This requires using a different :doc:`account <../accounting/get_started/chart_of_accounts>` for
each type of operation subject to VAT, output and input VAT, and expense listed in those sections.

Assign the following account :ref:`tags <chart-of-account/tags>` to accounts you use for each type
of operation subject to VAT listed in the declaration, if applicable:

- `001 - Supply of inhouse manufactured goods`
- `002 - Supply of goods not manufactured inhouse`
- `003 - Net profit margin`
- `004 - Supply of services`
- `005 - Disposal of tangible and intangible capital assets`
- `008 - Application of goods for private use or for that of the staff`
- `009 - Application for the purpose of business of goods`
- `010 - Use of goods considered business assets`
- `011 - Supply of services carried out free of charge`
- `013 - IC supply of goods`
- `202 - IC supply of new means of transport`
- `203 - Supply of goods carried out abroad`

Assign the following account tags to the accounts you use for each type of output and input VAT, if
applicable:

- `077 - VAT on stock entries invoiced by other taxable persons`
- `081 - VAT on capital expenditures invoiced by other taxable persons`
- `085 - VAT on operational expenditures invoiced by other taxable persons`
- `078 - VAT on stock entries due in respect of IC acquisitions`
- `082 - VAT on capital expenditures due in respect of IC acquisitions`
- `086 - VAT on operational expenditures due in respect of IC acquisitions`
- `079 - VAT on stock entries of importations of goods`
- `083 - VAT on capital expenditures of importations of goods`
- `087 - VAT on operational expenditures of importations of goods`
- `404 - VAT on stock entries due under the reverse charge`
- `405 - VAT on capital expenditures due under the reverse charge`
- `406 - VAT on operational expenditures due under the reverse charge`

Assign the following account tags to the expense accounts you use for each type of expense, if
applicable:

- `188 - Appendix A - Expenses for other work carried out by third parties`
- `190 - Appendix A - Car expenses`
- `239 - Appendix A - Gross salaries`
- `244 - Appendix A - Gross wages`
- `247 - Appendix A - Occasional salaries`
- `250 - Appendix A - Compulsory social security contributions (employer's share)`
- `253 - Appendix A - Accident insurance`
- `260 - Appendix A - Staff travel and representation expenses`
- `269 - Appendix A - Accounting and bookkeeping fees`
- `283 - Appendix A - Employer's travel and representation expenses`
- `285 - Appendix A - Electricity`
- `289 - Appendix A - Gas`
- `293 - Appendix A - Employer's travel and representation expenses`
- `301 - Appendix A - Telecommunications`
- `305 - Appendix A - Renting/leasing of immovable property with application of VAT`
- `307 - Appendix A - Renting/leasing of immovable property with no application of VAT`
- `310 - Appendix A - Renting/leasing of permanently installed equipment and machinery`
- `316 - Appendix A - Property tax`
- `324 - Appendix A - Business tax`
- `326 - Appendix A - Interest paid for long-term debts`
- `327 - Appendix A - Interest paid for short-term debts`
- `328 - Appendix A - Other financial costs`
- `330 - Appendix A - Stock and business equipment insurance`
- `331 - Appendix A - Public and professional third party liability insurance`
- `332 - Appendix A - Office expenses`
- `336 - Appendix A - Fees and subscriptions paid to professional associations and learned societies`
- `337 - Appendix A - Papers and periodicals for business purposes`
- `343 - Appendix A - Shipping and transport expenses`
- `345 - Appendix A - Work clothes`
- `347 - Appendix A - Advertising and publicity`
- `349 - Appendix A - Packaging`
- `351 - Appendix A - Repair and maintenance of equipment and machinery`
- `353 - Appendix A - Other repairs`
- `355 - Appendix A - New acquisitions (tools and equipment) if their cost can be fully allocated to the year of acquisition or creation`
- `358 - Appendix A - Custom (value)`
- `361 - Appendix A - Total 'Appendix to Operational expenditures'`

Opening the declaration
~~~~~~~~~~~~~~~~~~~~~~~

Go to :menuselection:`Accounting --> Reporting --> Tax Report`.

In the :icon:`fa-book` :guilabel:`Report` selector, select :guilabel:`Annual VAT Declaration (LU)`.

In the :icon:`fa-calendar` (:guilabel:`Period`) selector, choose the fiscal year dates for which to
generate the declaration.

Completing the declaration
~~~~~~~~~~~~~~~~~~~~~~~~~~

The annual declaration contains five sections labelled I to V, seven appendices labelled A to G, and
an additional Appendix to Operational Expenditures.

Sections I, III, and Appendix A can be pre-populated automatically based on the :ref:`account tag
configuration <luxembourg/account-tag-configuration>`. After configuring the account tags,
:ref:`set the tax lock date <accounting/tax-returns/lock-date>` to the end of the fiscal year. This will
trigger the pre-computation of those values.

.. image:: luxembourg/annual-tax-report.png
   :alt: Odoo Accounting populates a Luxembourgish annual VAT declaration based on account tags.

Alternatively, the year's total VAT debit and credit can be manually distributed among the various
report lines in sections I and III. You can use the :icon:`fa-pencil` (:guilabel:`Edit`) icon to
manually enter the value for each report line.

Sections II and IV are automatically computed.

You then need to manually complete appendices B through G, as well as the Appendix to Operational
Expenditures, with any additional information to be reported.

Exporting the declaration
~~~~~~~~~~~~~~~~~~~~~~~~~

Once the declaration is complete and correct, click the :icon:`fa-cog` (:guilabel:`action menu`)
icon, then click :guilabel:`XML` to export and download it in XML format. You can then submit the
XML file on the eCDF platform.

.. seealso::
   - :doc:`../accounting/reporting/tax_returns`
   - `Tax office website - VAT declaration <https://guichet.public.lu/en/entreprises/fiscalite/impots-benefices/tva/declarations/declaration-tva.html>`_
   - `Platform for electronic gathering of financial data (eCDF) <http://www.ecdf.lu>`_

.. _localizations/luxembourg/faia:

FAIA audit file export
======================

:abbr:`FAIA (Fichier d’Audit Informatisé AED)` is the Luxembourgish version of the SAF-T format for
accounting data interchange. It allows exporting complete accounting data for a period from a
taxpayer's accounting system to the tax office.

Odoo can generate an XML file in the FAIA format that contains the entire accounting data for a
period.

To generate and download the FAIA file, open :menuselection:`Accounting --> Reporting --> General
Ledger`, choose the desired period, click the :icon:`fa-cog` (:guilabel:`action menu`) icon, and
click :guilabel:`Export FAIA`.


==================================================
SECTION: malaysia.rst
PATH: applications/finance/fiscal_localizations/malaysia.rst
==================================================

========
Malaysia
========

.. _MyTax: https://mytax.hasil.gov.my

.. _malaysia/configuration:

Configuration
=============

.. _malaysia/configuration/modules:

Modules installation
--------------------

:ref:`Install <general/install>` the following modules to get all the features of the Malaysian
localization:

.. list-table::
   :header-rows: 1

   * - Name
     - Technical name
     - Description
   * - :guilabel:`Malaysia - Accounting`
     - `l10n_my`
     - This module includes the default
       :ref:`fiscal localization package <fiscal_localizations/packages>`.
   * - :guilabel:`Malaysia - Accounting Reports`
     - `l10n_my_reports`
     - This module includes the accounting reports for Malaysia.
   * - :guilabel:`Malaysia - UBL PINT`
     - `l10n_my_ubl_pint`
     - This module includes the features required to export invoices in PINT format.
   * - :guilabel:`Malaysia - E-invoicing`
     - `l10n_my_edi`
     - This module includes the features required for integration with MyInvois under IRBM.

.. _malaysia/configuration/company:

Company information
-------------------

To configure your company information, go to the :guilabel:`Contacts` app, search for your company,
and select it. Then configure the following fields:

- :guilabel:`Name`
- :guilabel:`Address`, including the :guilabel:`City`, :guilabel:`State`, :guilabel:`Zip Code`,
  and :guilabel:`Country`.

   - In the :guilabel:`Street` field, enter the street name, number, and any additional address
     information.
   - In the :guilabel:`Street 2` field, enter the neighborhood.

- :guilabel:`Tax ID`: Tax identification number
- :guilabel:`SST`: Malaysian Sales and Service Tax Number, if applicable
- :guilabel:`TTx`: Malaysian Tourism Tax Number, if applicable
- :guilabel:`Phone`

E-invoicing integration with MyInvois
=====================================

The MyInvois Portal is a platform provided by the :abbr:`IRBM (Inland Revenue Board of Malaysia)`
that facilitates the implementation of e-invoices for Malaysian taxpayers.
Odoo supports integration with MyInvois to submit the invoices generated in Odoo.

.. note::
   The :guilabel:`Malaysia - E-invoicing module` must be installed to submit invoices to MyInvois.

.. _malaysia/myinvois/setup:

Set-up
------

.. _malaysia/myinvois/setup/registration:

MyInvois registration
~~~~~~~~~~~~~~~~~~~~~

To send electronic invoices to MyInvois, you first need to register and log in to the MyInvois
portal to grant Odoo the **right to invoice** as an intermediary for your company.

.. note::
   If this is the first time you log into the MyInvois portal, click :guilabel:`User Manual` on
   MyTax_ to learn more about the registration process. Both the **pre-production** (:dfn:`testing
   environment to try the functions before using the actual (production) environment`) and
   **production** (:dfn:`actual environment to submit e-invoices with accurate information`)
   environments are supported.

#. Log into MyTax_. Choose the :guilabel:`ID Type` and the corresponding
   :guilabel:`identification number` used to register for the digital certificate.
#. From the dashboard, click the :icon:`fa-angle-down` :guilabel:`(angle-down)` icon in the
   top-right corner and select :guilabel:`View Taxpayer Profile`.
#. In the :guilabel:`Representatives` section, click :guilabel:`Add Intermediary` in the top-right
   corner.

   .. image:: malaysia/myinvois-add-intermediary.png
      :alt: MyInvois add intermediary

#. Add `ODOO S.A.` as an intermediary using the following information:

   - :guilabel:`TIN`: `C57800417080`
   - :guilabel:`BRN`: `BE0477472701`
   - :guilabel:`Name`:

     - :guilabel:`Production`: `ODOO S.A.`
     - :guilabel:`Pre-production`: `OXXX_XXXXA.`

#. Grant the following permissions by clicking the :icon:`fa-toggle-on` :guilabel:`(toggle-on)`
   icon:

   - :guilabel:`Representation From`
   - :guilabel:`Document - Submit`
   - :guilabel:`Document - Cancel`
   - :guilabel:`Document - Request Rejection`

   .. note::
      - Access can be revoked in the future if needed.
      - Odoo, as an intermediary, does not store invoices sent on behalf of the client on the proxy
        server.

#. Click :guilabel:`Save`. The status for `ODOO S.A.` is then :guilabel:`Active`.

   .. image:: malaysia/myinvois-intermediary-active.png
      :alt: MyInvois status active

.. _malaysia/myinvois/setup/odoo:

Configuration in Odoo
~~~~~~~~~~~~~~~~~~~~~

.. _malaysia/myinvois/setup/odoo/einvoicing:

Company
*******

Open the Settings app, navigate to the :guilabel:`Companies` section, and click
:guilabel:`Update Info`. Make sure the :guilabel:`Tax ID` is entered and complete the following
fields in the :guilabel:`E-invoicing` section:

   - :guilabel:`Identification`: Select the :guilabel:`ID Type` and enter the associated
     :guilabel:`Identification number` used to register for the digital certificate.
   - :guilabel:`Ind. Classification`: Input the 5-digit numeric code that represents the nature and
     activity of the business.

Electronic invoicing
********************

Go to :menuselection:`Accounting --> Configuration --> Settings`. In the
:guilabel:`Malaysian Electronic Invoicing` section, select the relevant :guilabel:`MyInvois mode`
based on the environment used for the company's MyInvois registration.

Make sure to allow Odoo to process e-invoices by checking the box, then click :guilabel:`Register`.

.. note::
   To change the :abbr:`TIN (tax identification number)` reference, click :guilabel:`Unregister`,
   change the company's information and make sure the number registered on MyInvois matches, then
   :guilabel:`Register` again.

.. important::
   For taxpayers with a :abbr:`TIN (tax identification number)` starting with "IG" and a
   :abbr:`ROB (registration of business)` number, combine the TIN and ROB in the **TIN:ROB** format
   for the :guilabel:`Tax ID` field.

   To register, go to :menuselection:`Accounting --> Configuration --> Settings`, and in the
   :guilabel:`Malaysian Electronic Invoicing` section, click :guilabel:`Register`. Once the
   registration is complete, the **:ROB** can be removed from the :guilabel:`Tax ID`.

   Additionally, remember to log into `MyTax account <https://mytax.hasil.gov.my/>`_ and set the
   :guilabel:`Type of Role` as :guilabel:`Business Owner`.

.. _malaysia/myinvois/setup/odoo/company:

Contacts
********

Access the contact's form and fill in the following fields:

   - :guilabel:`Country`
   - :guilabel:`State`
   - :guilabel:`Phone`
   - :guilabel:`Tax ID`
   - :guilabel:`Identification`: the :guilabel:`ID Type` and the corresponding
     :guilabel:`Identification number` of the contact registered on MyTax.

.. _malaysia/myinvois/setup/odoo/product:

Products
********

All products to be included in e-invoices require a Malaysian classification code. To add it,
access the :guilabel:`Product` form and in the :guilabel:`General Information` tab, fill in the
:guilabel:`Malaysian classification code` field.

Malaysian tax type
******************

To configure a tax's :guilabel:`Malaysian Tax Type` field, go to :menuselection:`Accounting -->
Configuration --> Accounting --> Taxes` and open the relevant tax in the :guilabel:`Taxes` list
view.

When an invoice or bill includes a tax with the :guilabel:`Malaysian Tax Type` set to
**Tax Exempt**, a :guilabel:`Tax Exemption Reason` must be specified in the :guilabel:`MyInvois`
tab before the document is sent.

.. image:: malaysia/myinvois-tax-exemption-reason.png
      :alt: MyInvois tax exemption reason

.. _malaysia/myinvois/workflow:

Workflow
--------

.. _malaysia/myinvois/workflow/sending:

Send invoices to MyInvois
~~~~~~~~~~~~~~~~~~~~~~~~~

Invoices can be sent to MyInvois once they have been confirmed. To do so, click
:guilabel:`Send to MyInvois`.

Send bills to MyInvois
~~~~~~~~~~~~~~~~~~~~~~

Sending a bill to MyInvois is necessary when issuing an e-Invoice on behalf of a supplier. Once a
bill is confirmed, click :guilabel:`Send To MyInvois`.

.. note::
   - In `MyInvois <https://preprod.myinvois.hasil.gov.my/content>`_, these vendor bills are
     categorized as :guilabel:`Self-billed Invoice`.

   - If a :guilabel:`Bill Reference` field is empty, Odoo's vendor bill number is used as the
     MyInvois number. If a reference is entered in the :guilabel:`Bill Reference` field, that
     reference is used instead.

.. _malaysia/myinvois/workflow/sending/status:

MyInvois status
***************

The current MyInvois status of an invoice or bill is shown in the :guilabel:`MyInvois State` field
within the :guilabel:`MyInvois` tab.

 - :guilabel:`Validation in Progress`: the validation is being processed by MyInvois. A blue
   :guilabel:`Processing` banner is also displayed.
 - :guilabel:`Valid`: it is validated by MyInvois. The :guilabel:`Submission UID`,
   :guilabel:`MyInvois` and :guilabel:`Validation Time` are automatically updated with information
   from MyInvois.

.. note::
   Odoo :doc:`automatically checks and updates <../../sales/subscriptions/scheduled_actions>` the
   status every hour. To update it manually at any time, click :guilabel:`Update MyInvois Status`.

.. _malaysia/myinvois/workflow/cancellation:

Invoice cancellation
~~~~~~~~~~~~~~~~~~~~

Sent invoices can be canceled within 72 hours from :guilabel:`Validation time`. In this case, open
the invoice and click :guilabel:`Request Cancel`. In the :guilabel:`Cancel document` window,
include the cancellation :guilabel:`Reason`, then click :guilabel:`Update Invoice`. The
:guilabel:`MyInvois State` is updated to :guilabel:`cancelled`.

Send credit notes to MyInvois
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Before sending a credit note, the original invoice must be successfully submitted to MyInvois.
Otherwise, the credit note's :guilabel:`MyInvois State` is updated to :guilabel:`Invalid`.

While Odoo uses a single :guilabel:`credit note` document, MyInvois categorizes these into two
types: :guilabel:`credit note` and :guilabel:`refund note`, depending on how they are reconciled.

- :guilabel:`MyInvois Credit Note`: This is created when an Odoo credit note is reconciled with the
  original invoice.
- :guilabel:`MyInvois Refund Note`: This is created when an Odoo credit note is reconciled with a
  full payment instead of the original invoice.

.. note::
   If a credit note is reconciled with only a partial payment before being sent, it is still
   categorized as a :guilabel:`credit note` in MyInvois.

.. tip::
   To issue both a credit note and a refund note for the same original invoice:
    - Create two separate credit notes in Odoo from the original invoice.
    - For a MyInvois :guilabel:`Refund Note`: Register a payment before sending it.
    - For a MyInvois :guilabel:`Credit Note`: Do not register a payment before sending it.

.. note::
   The same logic applies to credit notes created from bills: if reconciled with a full payment,
   the credit note becomes a :guilabel:`Self-billed Refund Note`; otherwise, it becomes a
   :guilabel:`Self-billed Credit Note`.

Send debit notes to MyInvois
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

:ref:`Issue a debit note from an existing bill or invoice <accounting/credit_notes/issue-debit-note>`
and click :guilabel:`Send To MyInvois`. In MyInvois, it appears then as a :guilabel:`Debit Note` if
issued from an invoice or a :guilabel:`Self-billed Debit Note` from a vendor bill.

Access invoices via QR code
---------------------------

When a document is successfully submitted to MyInvois, a QR code is added to its PDF version.
Scanning this code links directly to the validated document in MyInvois.

To download the PDF from an invoice or bill:

#. Click the :icon:`fa-cog` :guilabel:`(gear)` icon
#. Select :guilabel:`Download`
#. Choose either :guilabel:`PDF` or :guilabel:`PDF without Payment`

.. image:: malaysia/myinvois-qr-code.png
   :alt: MyInvois QR code

.. _malaysia/employment-hero:

Employment Hero payroll
=======================

If your business is already up and running with :doc:`Employment Hero
<../../hr/payroll/payroll_localizations/employment_hero>`, you can use our connector as an
alternative payroll solution.

.. important::
   To :ref:`configure the Employment Hero API <employment_hero/configuration>` for **Malaysia**, use
   the following value as :guilabel:`Payroll URL`: `https://apimy.yourpayroll.io/`.


==================================================
SECTION: mexico.rst
PATH: applications/finance/fiscal_localizations/mexico.rst
==================================================

======
Mexico
======

.. |SAT| replace:: :abbr:`SAT (Servicio de Administración Tributaria)`
.. |DIOT| replace:: :abbr:`DIOT (Declaración Informativa de Operaciones con Terceros)`
.. |PAC| replace:: :abbr:`PAC (Proveedor Autorizado de Certificación / Authorized Certification
   Provider)`
.. |RFC| replace:: :abbr:`RFC (Registro Federal de Contribuyentes)`
.. |PPD| replace:: :abbr:`PPD (Pago en Parcialidades o Diferido/Payment in Installments or
   Deferred)`
.. |PUE| replace:: :abbr:`PUE (Pago en una Sola Exhibición/Payment in a Single Exhibition)`
.. |CFDI| replace:: :abbr:`CFDI (Comprobante Fiscal Digital por Internet)`
.. |IEPS| replace:: :abbr:`IEPS (Impuesto Especial sobre Producción y Servicios)`

.. _l10n/mx/modules:

Modules
=======

The following modules are automatically installed with the Mexican localization:

.. list-table::
   :header-rows: 1
   :widths: 25 25 50

   * - Name
     - Technical name
     - Description
   * - :guilabel:`Mexico - Accounting`
     - `l10n_mx`
     - The default :doc:`fiscal localization package <../fiscal_localizations>` adds accounting
       characteristics for the Mexican localization, such as: the most common taxes and the chart of
       accounts — based on `the SAT account grouping code
       <https://www.gob.mx/cms/uploads/attachment/file/151586/codigo_agrupador.pdf>`_.
   * - :guilabel:`EDI for Mexico`
     - `l10n_mx_edi`
     - Includes all the technical and functional requirements to generate and validate
       :doc:`electronics documents <../accounting/customer_invoices/electronic_invoicing>` — based
       on the technical documentation published by the |SAT|. This allows you to send invoices (with
       or without addendums) and payment complements to the government.
   * - :guilabel:`Odoo Mexican Localization Reports`
     - `l10n_mx_reports`
     - Adapts reports for Mexico's electronic accounting: chart of accounts, trial balance, and
       |DIOT|.
   * - :guilabel:`Mexico - Month 13 Trial Balance`
     - `l10n_mx_reports_closing`
     - Necessary to create the closing entry (also known as the *month 13 move*).
   * - :guilabel:`Odoo Mexican XML Polizas Export`
     - `l10n_mx_xml_polizas`
     - Allows the export of XML files of journal entries for a compulsory audit.

The following modules are optional. It's recommended to :ref:`install <general/install>` them *only*
if meeting a specific requirement for the business.

.. list-table::
   :header-rows: 1
   :widths: 25 25 50

   * - Name
     - Technical name
     - Description
   * - :guilabel:`EDI for Mexico (Advanced Features)`
     - `l10n_mx_edi_extended`
     - Adds the external trade complement to invoices (a legal requirement for selling products to
       foreign countries).
   * - :guilabel:`Mexico - Electronic Delivery Guide`
     - `l10n_mx_edi_stock`
     - Lets you create a *Carta Porte*: A bill of lading that proves to the government you are
       sending goods between A & B with a signed electronic document. It will also install the
       :doc:`Fleet <../../hr/fleet>` app.
   * - :guilabel:`Odoo Mexico Localization for Stock/Landing`
     - `l10n_mx_edi_landing`
     - Allows managing customs numbers related to landed costs in electronic documents.
   * - :guilabel:`CFDI 4.0 fields for sale orders`
     - `l10n_mx_edi_sale`
     - Adds extra fields to the :doc:`Sales <../../sales/sales>` module to comply with the Mexican
       Electronic Invoicing
   * - :guilabel:`Mexican Localization for the Point of Sale`
     - `l10n_mx_edi_pos`
     - Adds extra fields to the :doc:`Point of Sale <../../sales/point_of_sale>` module to comply
       with the Mexican Electronic Invoicing
   * - :guilabel:`Mexican Localization for eCommerce`
     - `l10n_mx_edi_website_sale`
     - Adds extra fields to the :doc:`eCommerce <../../websites/ecommerce>` module to comply with
       the Mexican electronic invoicing requirements

.. seealso::
   Payroll module information is available :doc:`here
   <../../hr/payroll/payroll_localizations/mexico>`.

.. _l10n/mx/video-tutorials:

Video tutorials
===============

Videos on the Mexican localization are also available. Basic workflows and most topics covered on
this page are also available in video format, please check out the following:

- `Odoo Smart Tutorial - Mexican localization
  <https://www.odoo.com/es/slides/smart-tutorial-localizacion-de-mexico-173>`_
- `Basic configurations and YouTube playlist
  <https://www.youtube.com/watch?v=TjWddMtQRfc&list=PL1-aSABtP6ACcwRzy_cdx-avDoNfSvooD&index=22>`_

.. _l10n/mx/overview:

Localization overview
=====================

The Odoo Mexican localization modules allow for the signing of electronic invoices, according to the
specifications of the |SAT| for `version 4.0 of the CFDI <http://omawww.sat.gob.mx/
tramitesyservicios/Paginas/documentos/Anexo_20_Guia_de_llenado_CFDI.pdf>`_, a legal requirement, as
of January 1, 2022. These modules also add relevant accounting reports including the |DIOT|, enable
foreign trade, and enable the creation of delivery guides.

.. note::
   In order to electronically sign any documents in Odoo, the Sign application must be installed.

.. seealso::

   - :doc:`Documentation on e-invoicing's legality and compliance in Mexico
     <../accounting/customer_invoices/electronic_invoicing/mexico>`
   - :doc:`Mexican Payroll signing and configurations
     <../../hr/payroll/payroll_localizations/mexico>`

.. _l10n/mx/requirements:

Requirements
------------

It is necessary to meet the following requirements before configuring the Mexican localization
modules in Odoo:

#. Be registered in the |SAT| with a valid |RFC|.
#. Have a `Certificado de Sello Digital / Digital Seal Certificate
   <https://www.gob.mx/sat/acciones-y-programas/ certificado-de-sello-digital>`_ (CSD).
#. Choose a |PAC|. Currently, Odoo works with the following |PAC|\s: `Solución Factible
   <https://solucionfactible.com/contenido/productos/timbrado/general#dos>`_, `Quadrum
   <https://cfdiquadrum.com.mx/odoo/>`_, and `SW Sapien - Smarter Web
   <https://info.sw.com.mx/sw-smarter-odoo>`_.

.. _l10n/mx/company:

Company
-------

After installing the correct modules, the next step is to verify that the company is configured with
the correct data. To do so, go to :menuselection:`Settings --> Users & Companies --> Companies`, and
select the company to configure.

Enter the full :guilabel:`Address` in the resulting form, including: :guilabel:`ZIP` code,
:guilabel:`State`, :guilabel:`Country`, and |RFC| (:guilabel:`Tax ID` number).

According to the requirements of the |CFDI| 4.0, the name of the main company contact **must** match
the business name registered in the |SAT|, without the legal entity abbreviation. This is the same
for the :guilabel:`ZIP` code.

.. important::
   From a legal point of view, Mexican companies **must** use the local currency (MXN). To use
   another currency, let MXN be the default currency and use a :doc:`pricelist
   <../../sales/sales/products_prices/prices/pricing>` instead.

Next, go to :menuselection:`Accounting --> Settings`, and scroll to the :guilabel:`MX Electronic
invoicing` section. Under :guilabel:`Service Tax Administration (SAT)`, select the :guilabel:`Fiscal
Regime` that applies to the company from the drop-down list, and click :guilabel:`Save`.

.. tip::
   In order to test the Mexican localization, configure the company with a real address within
   Mexico (including all fields). Add `EKU9003173C9` as the :guilabel:`Tax ID` and `ESCUELA KEMPER
   URGATE` as the :guilabel:`Company Name`. For the :guilabel:`Fiscal Regime`, use
   :guilabel:`General de Ley Personas Morales`.

Branches
--------

When using branches, all the invoicing information will be taken from the main company except for
the zip. Unless the |RFC| is set on the branch, then the information will be taken directly from the
branch.

Branches enable users to establish multiple brands within the same parent company. Additionally,
when different fiscal regimes are required for invoicing purposes, it is necessary to create a
branch for each regime. By default, the regime is inherited from the parent company. However, if the
regime is explicitly set on the branch, Odoo will adopt the regime applicable to that branch.

.. _l10n/mx/contacts:

Contacts
--------

.. note::
   :ref:`Install <general/install>` the **Contacts** application to access contact records.

To create a contact that can be invoiced, go to the :menuselection:`Contacts` app and click
:guilabel:`New`. Then, enter the contact name, full :guilabel:`Address` including the
:guilabel:`ZIP` code, :guilabel:`State`, :guilabel:`Country`, and |RFC| (:guilabel:`Tax ID`).

.. important::
   As with the company itself, all contacts must have their correct business name registered in the
   |SAT|. The :guilabel:`Fiscal Regime` must also be added in the :guilabel:`Sales & Purchase` tab.

.. warning::
   Having a |RFC| (:guilabel:`Tax ID`) set but no :guilabel:`Country` configured may result in
   incorrect invoices.

.. _l10n/mx/taxes:

Taxes
-----

In order to properly sign invoices, set the :ref:`Factor Type <l10n/mx/factor-type>` and :ref:`Tax
Object <l10n/mx/tax-object>` fields on sales taxes.

.. tip::
   RESICO ISR withholdings and some |IEPS| taxes are created automatically, but the feature is not
   active by default. To enable it, go to :menuselection:`Accounting --> Configuration --> Taxes`.

.. _l10n/mx/factor-type:

Factor type
~~~~~~~~~~~

Both the **Factor Type** and **SAT Tax Type** fields are pre-loaded in the default taxes.

For new taxes, set these fields in :menuselection:`Accounting --> Configuration --> Taxes` and click
:guilabel:`New`. Set the :guilabel:`Tax Type` to :guilabel:`Sales`. In the :guilabel:`Advanced
Options` tab, fill :guilabel:`SAT Tax Type` and :guilabel:`Factor Type` fields.

Odoo supports four groups of :guilabel:`SAT Tax Types`: :guilabel:`IVA`, :guilabel:`ISR`,
:guilabel:`IEPS`, and :guilabel:`Local Taxes`.

If the factor type is :guilabel:`Quota`, standard calculation methods cannot be used. Instead, set
the tax calculation computation to :guilabel:`Custom Formula`.

.. example::
   .. math::
      result = quantity * 6.455

   - *quantity* = the number of items in the transaction
   - *6.455* = the quota value (a fixed amount per unit)
   - Only per-unit quotas are supported, not quotas based on other factors

.. tip::
   Mexico manages two different kinds of 0% VAT to accommodate two scenarios:

   - For *0% VAT*, set the :guilabel:`Factor Type` to :guilabel:`Tasa`
   - For *VAT Exempt*, set the :guilabel:`Factor Type` to :guilabel:`Exento`

.. note::
   Local taxes are generated in a separate node in the XML file, these do not get validated by the
   |PAC|.

.. warning::
   Quotas and custom formulas require the :guilabel:`Define Taxes as Python Code` module. See
   :doc:`Taxes <../accounting/taxes>`.

.. _l10n/mx/tax-object:

Tax object
~~~~~~~~~~

One requirement of the CFDI 4.0 is that the resulting XML file handles the breakdown of taxes of the
operation in accordance with the regulation. There are eight different possible values that are
added in the XML file:

- `01`: No tax Object: This value is added automatically if the invoice line doesn't contain any
  taxes.
- `02`: Tax Object: This is the default configuration of any invoice line that contains taxes.
- `03`: Tax Object and doesn't require breakdown: This can only be added manually.
- `04`: Tax Object and doesn't have tax: This can only be added manually.
- `05`: Tax Object, VAT for PODEBI: This can only be added manually.
- `06`: VAT Object, No VAT forwarded: This object will be selected when there is an ISR withholding
  and no VAT tax.
- `07`: No VAT forwarded, |IEPS| breakdown: This object will be selected when there is an ISR
  withholding, |IEPS| tax and no VAT tax.
- `08`: No VAT forwarded, |IEPS| breakdown: This object can only be added manually.

.. warning::
   Using either 01, 03, 04, or 05 will remove the tax node from the XML file.

.. important::
   The :guilabel:`IEPS breakdown` status affects the behavior of the tax objects due to the missing
   |IEPS| when the breakdown does not happen.

.. _l10n/mx/local-taxes:

Local taxes
~~~~~~~~~~~

Local taxes (e.g., *ISH*, *Cedullar*) require a separate XML node and may not follow standard tax
logic.

When configuring a local tax, its name appears in the local tax complement. The rate is treated as a
withholding if negative, or carried forward if positive.

.. _l10n/mx/ieps-breakdown:

IEPS breakdown
~~~~~~~~~~~~~~

By default Odoo hides the |IEPS| in the invoices so that the subtotal on which the VAT is calculated
includes the amount of |IEPS|, this is to ensure that Fiscal Regimes that do not require it, do not
receive it.

It is possible to make the |IEPS| visible in the XML by selecting the :guilabel:`IEPS Breakdown`
checkbox inside each contact on the :guilabel:`Sales & Purchase` tab.

.. important::
   When using either :ref:`eCommerce invoicing <l10n/mx/ecommerce>` or the :ref:`Self invoicing
   portal <l10n/mx/pos/portal>`, the customer will have the option to decide whether or not to have
   the |IEPS| breakdown.

.. _l10n/mx/tax-config:

Other tax configurations
~~~~~~~~~~~~~~~~~~~~~~~~

The Mexican Localization uses :doc:`cash basis taxes <../../finance/accounting/taxes/cash_basis>`.
When registering a payment, Odoo carries out the movement of taxes from the *Cash Basis Transition
Account* to the account set in the :guilabel:`Definition` tab of the tax record set on the invoice
or bill line. For such movement, a tax base account is used: (:guilabel:`899.01.99 Base Imponible de
Impuestos en Base a Flujo de Efectivo`) in the journal entry when reclassifying taxes. **Do not
delete this account**.

.. _l10n/mx/products:

Withholdings
------------

By default, Odoo includes withholdings with special distributions to allocate VAT.

When registering an invoice, add the withholding and its corresponding VAT. Both must be included on
the vendor bill to ensure correct accounting. Using :doc:`fiscal positions
<../accounting/taxes/fiscal_positions>` is recommended so the cash-basis entry properly splits the
distribution.

.. example::
   For a lease vendor bill of `10000 MXN`, the `10.67%` lease withholding corresponds to a `16% VAT
   2/3 H`. Both taxes must be applied together to reflect the correct accounting.

.. image:: mexico/mx-withholdings-cash-basis.png
   :alt: Cash Basis entry with VAT split between paid and due.

.. note::
   Withholdings |CFDI| is not currently supported. Consult with an accountant the proper
   distribution.

Products
--------

To configure products, go to :menuselection:`Accounting --> Customers --> Products`.  Open an
existing product or click :guilabel:`New`. In the :guilabel:`Accounting` tab, set the
:guilabel:`UNSPSC Product Category`. Products and categories can be set manually, or through :doc:`a
bulk import <../../essentials/export_import_data>`.

.. note::
   All products need to have a |SAT| code associated with them in order to prevent validation
   errors.

.. _l10n/mx/e-invoicing-overview:

Electronic invoicing
--------------------

.. _l10n/mx/pac:

PAC credentials
~~~~~~~~~~~~~~~

After processing your `Private Key (CSD)
<https://www.sat.gob.mx/aplicacion/16660/genera-y-descarga-tus-archivos-a-traves-de-la-aplicacion-
certifica>`_ with the |SAT|, you **must** register directly with the :ref:`PAC
<l10n/mx/requirements>` of your choice before you start creating invoices from Odoo.

Once you've created your account with any of these providers, go to :menuselection:`Accounting -->
Configuration --> Settings` and navigate to the :guilabel:`MX Electronic invoicing` section. Under
the :guilabel:`Authorized Certification Provider (PAC)` section, enter the name of your |PAC| with
your credentials (:guilabel:`PAC username` and :guilabel:`PAC password`).

.. image:: mexico/mx-pac-account.png
   :alt: Configuring PAC credentials from the Accounting settings.

.. tip::
   To test the electronic invoicing without credentials, activate the :guilabel:`MX PAC test
   environment` checkbox, and select :guilabel:`Solucion Factible` as the :guilabel:`PAC`. It is not
   required to add a username or password for a test environment.

.. _l10n/mx/certifications:

.cer and .key certificates
~~~~~~~~~~~~~~~~~~~~~~~~~~

The `digital certificates of the company
<https://www.gob.mx/tramites/ficha/certificado-de-sello-digital/SAT139>`_ must be uploaded within
the :guilabel:`Certificates` section. To do so, navigate to :menuselection:`Settings --> General
Settings --> Certificates and Keys`.

Under :guilabel:`Manage your certificates`, click the :icon:`fa-right-arrow` :guilabel:`Keys` link
to access the :guilabel:`Keys` list view. Click :guilabel:`Create`, upload the digital
:guilabel:`Key file` (:file:`.key` file), add a :guilabel:`Name` to the key, and enter the
:guilabel:`Private key password`.

From :menuselection:`Settings --> General Settings --> Certificates and Keys`, select
:guilabel:`Certificates` to access the :guilabel:`Certificate` list view. Click :guilabel:`Create`,
upload the digital :guilabel:`Certificate` (:file:`.cer` file), add a :guilabel:`Name` to the
certificate, and select the :guilabel:`Private Key` created on the previous step from the drop-down
menu.

.. note::
   The :guilabel:`Certificate Password` and :guilabel:`Public Key` fields on :guilabel:`Certificate`
   records are optional.

.. tip::
   In order to test the electronic invoicing, the following |SAT| test certificates are provided:

   - :download:`Certificate <mexico/certificate.cer>`
   - :download:`Certificate Key <mexico/certificate.key>`
   - **Password**: ``12345678a``

Accounting
==========

.. _l10n/mx/e-invoicing:

Electronic invoicing
--------------------

The invoicing process in Odoo is based on `Annex 20
<http://omawww.sat.gob.mx/tramitesyservicios/Paginas/anexo_20.htm>`_ version 4.0 of electronic
invoicing of the |SAT|.

.. _l10n/mx/invoices:

Customer invoices
~~~~~~~~~~~~~~~~~

To start invoicing from Odoo, a customer invoice must be created using the :doc:`standard invoicing
flow <../accounting/customer_invoices>`.

While the document is in draft mode, changes can be made to it, some fields take values previously
set on the sale order or the contact.

The fields that need to be reviewed are:

- CFDI to public.
- Usage
- Payment Policy
- Payment Method (If Payment Policy is not set as |PPD|)

.. tip::
   :guilabel:`Usage`, :guilabel:`Payment Policy` and :guilabel:`Payment Method` can be previously
   set on a sale order and/or can be set on the contact for every invoice.

The payment policy is a selectable field on the invoice and can be manually set to the required
policy, however if no policy is selected, Odoo will compute an automatic policy based on the
following general rules:

The value will be set to |PUE| if the due date in which the payment is expected is within the
current month, in case the date is outside the current month, the policy will be set to |PPD|
instead.

.. warning::
   If the payment policy is not selected and |PPD| policy is expected, either select an invoice
   :guilabel:`Due Date` on a different month than the current one, or choose :guilabel:`Payment
   terms` that imply changing the due month (i.e., :guilabel:`30 Days`, or :guilabel:`15 Days`, as
   long as they fall on the next month).

After clicking on :guilabel:`Confirm` in the customer invoice, click on the :guilabel:`Send` button
to process the invoice with the government. Make sure that the :guilabel:`CFDI` checkbox is marked.

.. image:: mexico/mx-send-cfdi.png
   :alt: CFDI Checkbox

After receiving the signed document back from the government, the :guilabel:`Fiscal Folio` field
appears on the document, and the XML file appears both in the |CFDI| tab and attached in the
chatter.

If an email address is configured on the customer contact record, marking the :guilabel:`by Email`
and :guilabel:`CFDI` checkboxes sends both the XML and PDF files together.

To download the PDF file locally, click the :guilabel:`Print` button.

.. tip::
   When clicking :guilabel:`Update SAT`, the :guilabel:`SAT status` field on the invoice will
   confirm if the XML file is **Validated** in the |SAT|.

   On a testing environment, the message :guilabel:`Not Found` will always come up.

.. warning::
   If the partner does not contain the :guilabel:`Country` or :guilabel:`Zip` the invoicing is
   assumed as a |CFDI| to public and the invoicing will be addressed to the generic customer. If
   however, these fields are left empty and the user unticks the :guilabel:`CFDI to public`
   checkbox, a pop-up will appear blocking the operation.

.. _l10n/mx/credit-notes:

Credit notes
~~~~~~~~~~~~

While an invoice is a document type "I" (Ingreso), a credit note is a document type "E" (Egreso).

An addition to the :doc:`standard flow for credit notes
<../accounting/customer_invoices/credit_notes>` is that, as a requirement of the |SAT|, there has to
be a relation between a credit note and an invoice through the fiscal folio.

Because of this requirement, the field :guilabel:`CFDI Origin` adds this relation with a `01|`,
followed by the fiscal folio of the original :abbr:`UUID (universally unique identifier)`.

.. tip::
   For the :guilabel:`CFDI Origin` field to be automatically added, use the :guilabel:`Add Credit
   Note` button from the invoice, instead of creating it manually.

Generally credit notes reverse the main sales account defined in the journal, but it is also
possible to globally assign an account to all credit notes. To do so, go to
:menuselection:`Accounting --> Configuration --> Settings` and set the :guilabel:`Credit notes`
account under the :guilabel:`Default Accounts` section.

.. note::
   On the default configuration, the credit notes account is set as :guilabel:`402.01.01 Returns,
   discounts or bonuses over sales and/or services at the general rate`.

.. _l10n/mx/vendor-bills:

Vendor bills
~~~~~~~~~~~~

Vendor bills have to have a fiscal folio for reports and payments to work correctly, if the vendor
bill was created by the purchase app or added manually, just add the XML file of the invoice on the
chatter **As a log note** and the fiscal folio will be updated accordingly, keep in mind that the
bill **Must be in draft state** for the update to happen.

.. tip::
   When clicking :guilabel:`Update SAT`, the :guilabel:`SAT status` field on the invoice will
   confirm if the XML file is **Validated** by the |SAT|, this is also true for vendor bills.

.. seealso::
   :doc:`../accounting/vendor_bills`

.. _l10n/mx/payments:

Payments
~~~~~~~~

.. _l10n/mx/payment-policy:

Payment policy
**************

One addition of the Mexican localization is the :guilabel:`Payment Policy` field. `According to the
SAT documentation <https://www.sat.gob.mx/consultas/92764/comprobante-de-recepcion-de-pagos>`_,
there are two types of payments:

- :guilabel:`PUE` (Pago en una Sola Exhibición/Payment in a Single Exhibition)
- :guilabel:`PPD` (Pago en Parcialidades o Diferido/Payment in Installements or Deferred)

.. warning::
   Payment Complements are only generated if the policy of the invoice is set to |PPD|, please note
   that it is a requirement to set the :guilabel:`Payment Method` to something different than **99 -
   Por definir**.

.. image:: mexico/mx-pue-payment.png
   :alt: Example of an invoice with the PUE requirements.

If the invoice has a due date outside the current month, it will default to |PPD|.

.. image:: mexico/mx-ppd-payment.png
   :alt: Example of an invoice with the PPD requirements.

.. _l10n/mx/payment-flow:

Payment flow
************

In both cases, the payment process in Odoo :doc:`is the same <../accounting/payments>`, the main
difference being payments related to |PPD| invoices, by law, need to be sent to the government as a
document type "P" (Pago).

If a payment is related to a |PUE| invoice, it can be registered through the payment popup, and be
associated with the corresponding invoice. To do so, navigate to :menuselection:`Accounting -->
Customers --> Invoices`, and select an invoice. Then, click the :guilabel:`Pay` button to open the
payment popup, set the :guilabel:`Payment Way` and any other fields, and click :guilabel:`Create
Payment`.

.. seealso::
   - :doc:`../accounting/payments`
   - :doc:`../accounting/bank/reconciliation`

While this process is the same for PPD invoices, the addition of creating an :doc:`electronic
document <../accounting/customer_invoices/electronic_invoicing>` means some additional requirements
are needed to correctly send the document to the |SAT|.

From a legal perspective, PPD invoices **must** include the specific :guilabel:`Payment Way` that
the payment was received. Because of this, the :guilabel:`Payment Way` field **cannot** be set as
:guilabel:`To Define`, thus the field will become invisible when selecting it.

.. note::
   - If a bank account number is required, add it in the :guilabel:`Accounting` tab of a customer's
     contact record.
   - The exact configurations are in the `Anexo 20 of the SAT
     <http://omawww.sat.gob.mx/tramitesyservicios/Paginas/anexo_20.htm>`_. Usually, the
     :guilabel:`Bank Account` needs to be 10 or 18 digits for transfers, 16 for credit or debit
     cards.

If a fully-reconciled payment is related to an invoice with a :guilabel:`Fiscal Folio`, the
:guilabel:`Update Payments` appears. Click the :guilabel:`Update Payments` button to send the
**payment complement** XML file to the government automatically and display it in the |CFDI| tab in
both the invoice and the payment.

.. tip::
   While it is a bad fiscal practice, the |PUE| payments can also be sent to the government, however
   it is required to click :guilabel:`Force CFDI` in the :guilabel:`CFDI` tab for this.

Similar to an invoice or credit note, the PDF and XML can be sent to the final customer. To do so,
click the :icon:`fa-cog` :guilabel:`(gear)` icon to open the actions drop-down menu and select
:guilabel:`Send receipt by email` from the payment view.

Regardless of whether the payment was created with or without reconciliation, it is possible to
download the payment PDF from the :guilabel:`CFDI` tab on the invoice by clicking the
:guilabel:`print` button.

.. image:: mexico/mx-print-payment.png
   :alt: Example of the print button on the CFDI tab.

.. _l10n/mx/invoice-cancellations:

Invoice cancellations
~~~~~~~~~~~~~~~~~~~~~

It is possible to cancel the EDI documents sent to the |SAT|. According to the `Reforma Fiscal 2022
<https://www.sat.gob.mx/consultas/91447/nuevo-esquema-de-cancelacion>`_, since January 1st, 2022,
there are two requirements for this:

- All cancellation requests require a *cancellation reason*.
- After 24 hours from the invoice creation, the client must be asked to approve the cancellation. If
  there is no response within 72 hours, the cancellation is processed automatically.

Invoice cancellations are updated automatically on Odoo but can take some time, to check the status
of the cancellation just press the :guilabel:`Update SAT` button.

Invoice cancellations can be made for one of the following reasons:

- 01 - Invoice issued with errors (with related document)
- 02 - Invoice issued with errors (no replacement)
- 03 - The operation was not carried out
- 04 - Nominative operation related to the global invoice

To initiate a cancellation, go to :menuselection:`Accounting --> Customers --> Invoices`, select the
posted invoice to cancel, and click :guilabel:`Request Cancel`. Then, refer to the
:ref:`l10n/mx/01-invoice-cancellation` or :ref:`l10n/mx/02-03-04-invoice-cancellation` sections,
depending on the cancellation reason.

.. tip::
   Alternatively, request a cancellation from the :guilabel:`CFDI` tab by clicking
   :guilabel:`Cancel` on the line item.

.. note::
   - If a cancellation is requested on a locked period, the CFDI will be cancelled but not the
     accounting entry.
   - If the client rejects the cancellation, the invoice cancellation line item is removed from the
     :guilabel:`CFDI` tab.

.. _l10n/mx/01-invoice-cancellation:

Cancellation reason 01
**********************

#. In the :guilabel:`Request CFDI Cancellation` pop-up window, select :guilabel:`01 - Invoice issued
   with errors (with related document)` from the :guilabel:`Reason` field and click
   :guilabel:`Create Replacement Invoice` to create a new draft invoice. This new draft invoice
   replaces the previous invoice, along with the related |CFDI|.
#. :guilabel:`Confirm` the draft and :guilabel:`Send & Print` the invoice.
#. Return to the initial invoice (i.e., the invoice from which you first requested the
   cancellation). Notice the :guilabel:`Substituted By` field appears with a reference to the new
   replacement invoice.
#. Click :guilabel:`Request Cancel`. In the :guilabel:`Request CFDI Cancellation` pop-up window, the
   :guilabel:`01 - Invoice issued with errors (with related document)` option is automatically
   selected in the :guilabel:`Reason` field.
#. Click :guilabel:`Confirm`.

The invoice cancellation is then generated with a reason line item in the :guilabel:`CFDI` tab.

.. image:: mexico/mx-invoice-cancellation-reason-01.png
   :alt: Canceled invoice line item in the CFDI tab.

.. note::
   When using the :guilabel:`01 - Invoice issued with errors (with related document)` cancellation
   reason, the `04|` prefix appears in the :guilabel:`Fiscal Folio` field. This is an internal
   prefix used by Odoo to complete the cancellation and **does not** mean that the cancellation
   reason was :guilabel:`04 - Nominative operation related to the global invoice`.

.. _l10n/mx/02-03-04-invoice-cancellation:

Cancellation reasons 02, 03, and 04
***********************************

In the :guilabel:`Request CFDI Cancellation` pop-up window, select the desired cancellation
:guilabel:`Reason` and :guilabel:`Confirm` the cancellation.

Upon doing so, the invoice cancellation is generated with a reason line item in the :guilabel:`CFDI`
tab.

.. note::
   If the :guilabel:`SAT Status` goes back to **Validated** it could be due to one of these three
   reasons:

   - The invoice is labeled as *No Cancelable* in the `SAT Website <https://www.sat.gob.mx/home>`_.
     due to the fact that it has a valid related document: Either another invoice linked with the
     :guilabel:`CFDI Origin` field or a Payment Complement. If so, you need to cancel any other
     related document first.
   - The cancellation request is still being processed by the |SAT|. If so, wait a few minutes and
     try again.
   - The final customer needs to reject or accept the cancellation request in their `Buzón
     Tributario <http://omawww.sat.gob.mx/BuzonTributario/Paginas/servicios_disponibles.html>`_.
     This can take up to 72 hours and, in case that the cancellation requests gets rejected, you
     will need to repeat the process again.

.. seealso::
   `Tool to validate Mexican Electronic Documents (CFDI) status
   <https://verificacfdi.facturaelectronica.sat.gob.mx/>`_

For the cancellation reasons **02**, **03** and **04**, the :guilabel:`Create Replacement Invoice`
button is replaced by a :guilabel:`Confirm` button that requests the cancellation immediately.

Both the current :guilabel:`State` and :guilabel:`Cancellation Reason` can be found in the
:guilabel:`CFDI` tab.

.. image:: mexico/mx-invoice-cancellation-reason-tab.png
   :alt: Old invoice with CFDI Origin.

.. _l10n/mx/payment-cancellations:

Payment cancellations
*********************

To cancel :ref:`payment complements <l10n/mx/payment-flow>`, go to the :guilabel:`CFDI` tab of the
related invoice and click :guilabel:`Cancel` on the line of the payment complement.

Like with invoices, go to the payment and click :guilabel:`Update SAT` in order to change the
:guilabel:`SAT Status` and :guilabel:`Status` to :guilabel:`Cancelled`.

.. note::
   Just like invoices, when creating a new payment complement, it is possible to add the relation of
   the original document, by adding a `04|` plus the fiscal folio in the :guilabel:`CFDI Origin`
   field.

   This action cancels the invoice and marks the :guilabel:`Reason` as :guilabel:`01 - Invoice
   issued with errors (with related document)`.

.. _l10n/mx/special-use-cases:

Invoicing special use cases
~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. _l10n/mx/cfdi-origin:

CFDI relations
**************

Sometimes it is needed to relate the current document to previously signed CFDIs, to do so just fill
the :guilabel:`CFDI Origin` field on the invoice indicating a relation, there are 7 possible values:

- 01: Nota de crédito
- 02: Nota de débito de los documentos relacionados
- 03: Devolución de mercancía sobre facturas o traslados previos
- 04: Sustitución de los CFDI previos
- 05: Traslados de mercancias facturados previamente
- 06: Factura generada por los traslados previos
- 07: CFDI por aplicación de anticipo

.. tip::
   The format is: Origin Type|UUID1, UUID2, ...., UUIDn where more than one Origin Type can be
   added.

.. example::
   Here is an example with two relations:

   .. code-block:: none

      04|042FE739-7B45-4D64-B26D-360000876D83,
      07|A164BAF8-8016-428C-A422-D9BD2F68F6A0,CEAD9433-3B77-4270-85BF-AC2519587514

   - The first section has relation type **04** with **1 UUID**
   - The second section has relation type **07** with **2 UUIDs**

Additionally any combination is also visible on the signed PDF.

.. image:: mexico/mx-CFDI_3relations.png
   :alt: Example of the PDF with 3 relations.

.. _l10n/mx/multicurrency:

Multicurrency
*************

The :guilabel:`Main Currency` in Mexico is MXN. While this is mandatory for all Mexican companies,
it is possible to send and receive invoices (and payments) in different currencies. To enable the
use of :doc:`multicurrency <../accounting/get_started/multi_currency>`, navigate to the
:menuselection:`Accounting --> Configuration --> Currencies`, and set :guilabel:`[MX] Bank of
Mexico` as the :guilabel:`Service` in the :guilabel:`Automatic Currency Rates` section. Then, set
the :guilabel:`Interval` field to the frequency you wish to update the exchange rates.

This way, the XML file of the document will have the correct exchange rate, and the total amount, in
both the foreign currency and in MXN.

It is highly recommended to use separate :doc:`bank accounts for each currency
<../accounting/bank/foreign_currency>`.

.. note::
   The only currencies that automatically update their exchange rate daily are: USD, EUR, GBP, JPY
   and CNY.

.. _l10n/mx/discounts:

Discounts
*********

By law, electronic documents sent to the government cannot have negative lines, as this can trigger
errors. Therefore, when using :doc:`Gift Cards
<../../sales/sales/products_prices/ewallets_giftcards>` or :doc:`Loyalty Programs
<../../sales/sales/products_prices/loyalty_discount>`, the subsequent negative lines will be
translated in the XML as if they were regular :doc:`Discounts
<../../sales/sales/products_prices/prices/pricing/>`.

In order to set this up, navigate to :menuselection:`Sales --> Products --> Products` and create a
product `Discounts`, make sure that it has a valid :guilabel:`Tax` (usually :guilabel:`IVA` at
`16%`).

After this, create and sign the invoice via |CFDI|, and add the `Discounts` product at the bottom.
In the XML, Odoo will distribute the discount between the lines evenly, while any math differences
will be added in a rounding product.

.. tip::
   A `Discount` and `UNSPSC Product Category` for each product variant related to :guilabel:`Gift
   Cards` or :guilabel:`Loyalty Programs` have to be created.

.. _l10n/mx/down-payments:

Down payments
*************

A common practice in Mexico is the usage of :doc:`down payments
<../../sales/sales/invoicing/down_payment>`. It's usage primarily consists of cases where you
receive a payment for a good or service where either the product or the price (or both) has not been
fully determined.

The |SAT| allows two different ways to handle this process: both of them involve linking all
invoices to each other with the :guilabel:`CFDI Origin` field.

.. note::
   For this process, the :doc:`Sales <../../sales>` app must be installed.

.. seealso::
   `The official documentation for registration of down payments in Mexico
   <http://http://omawww.sat.gob.mx/tramitesyservicios/Paginas/documentos/GuiaAnexo311221.pdf>`_.

Configuration
^^^^^^^^^^^^^

First, navigate to :menuselection:`Sales --> Products --> Products` to create a product `Anticipo`
and configure it. The :guilabel:`Product Type` must be :guilabel:`Service`, and use the
:guilabel:`UNSPSC Category` :guilabel:`84111506 Servicios de facturación`.

Then, go to :menuselection:`Sales --> Settings --> Invoicing --> Down Payments`, and add the
*Anticipo* product as the default.

.. _l10n-mx/down-payment-method-a:

Method A
^^^^^^^^

This method consists of creating a down payment invoice, creating a invoice for the total amount,
and finally, creating a credit note for the total of the down payment.

First, create a sales order with the total amount, and create a down payment from it (either using a
percentage or fixed amount). Then, sign the document via CFDI, and register the payment.

When the time comes for the customer to get the final invoice, create it again from the same sales
order. In the :guilabel:`Create Invoice` popup, select :guilabel:`Regular Invoice`. Make sure to
delete the line that contains the product *Anticipo*.

.. tip::
   When using down payments with the Mexican localization, make sure that the :guilabel:`Invoicing
   Policy` of the products are :guilabel:`Ordered quantities`. Otherwise a customer credit note will
   be created.

Then, copy the :guilabel:`Fiscal Folio` from the down payment invoice, and paste it into the
:guilabel:`CDFI Origin` of the final invoice, adding the prefix `07|` before the value and sign the
document via |CFDI|.

Finally, create a credit note for the first invoice. Copy the :guilabel:`Fiscal Folio` from the
final invoice, and paste it in the :guilabel:`CFDI Origin` of the credit note, adding the prefix
`07|`. Then, sign the document via |CFDI|.

With this, all electronic documents are linked to each other. The final step is to fully pay the new
invoice. At the bottom of the new invoice, you can find the credit note in the
:guilabel:`Outstanding credits` - add it as payment. Finally, register the remaining amount with the
:guilabel:`Pay` popup.

In the sales order, all three documents should appear as "In Payment".

Method B
^^^^^^^^

Another, simpler way to fulfill |SAT| requirements involves creating only the down payment invoice,
and a second invoice for the remnant. This method involves the fact that negative lines are treated
as discounts.

For this, follow the same process as :ref:`Method A <l10n-mx/down-payment-method-a>`, up until the
creation of the final invoice. Do not delete the line that contains the *Anticipo* and instead
rename the other products :guilabel:`Description` to include the text `CFDI por remanente de un
anticipo`. Don't forget to add the :guilabel:`Fiscal Folio` of the down payment invoice in the
:guilabel:`CDFI Origin` of the final invoice, adding the prefix `07|`.

Finally, sign the final invoice via |CFDI|.

.. _l10n/mx/addendas-and-complements:

Addendas and complements
************************

Addendas and complements can be included in the XML. To add one, go to :menuselection:`Accounting
--> Configuration --> Addendas & Complementos (MX)` and :guilabel:`New` to enter the code to be
injected. Additional fields beyond standard Odoo may be required.

.. warning::
   This section might require technical knowledge and may risk adding technical debt; it is
   recommended to ask your account manager for the best technical advice.

Once the desired nodes are created, they can be selected on each contact to make them appear on
every invoice addressed to that contact. By default, all the selected nodes will be added
automatically on every invoice.

It is also possible to just select the nodes as needed on every invoice by selecting the
:guilabel:`Other info` tab and then selecting the desired nodes from :guilabel:`Addendas &
Complementos`

.. tip::
   It is possible to add more than one per contact or per invoice.

.. _l10n/mx/xml-reader:

XML reader
**********

In certain occasions, such as when you are creating invoices in another software or in the |SAT|
directly, you would want to upload the invoices in Odoo. The XML Reader allows you to retrieve the
data from an XML file. To do this, navigate to :menuselection:`Accounting --> Customers -->
Invoices` and, in the list view, click the :guilabel:`Upload` button to select any number of XML
files, and draft invoices will be automatically created. This can work also by dragging the files
from your computer and dropping them in the view.

The draft invoices will retrieve the :guilabel:`Customer information` (if it doesn't exist, new ones
will be created), the :guilabel:`Product Lines` (only if products with the same name already exist)
and will calculate all taxes and additional fields exclusive to the Mexican Localization. The import
information will appear in the chatter.

.. warning::
   Depending on where the invoice was created, XML files could have different values from the total
   calculated in Odoo. **Always** double-check any document uploaded this way.

:guilabel:`Customer Invoices` created this way will be able to create **payment complements** and to
be canceled at any time. If you use the :guilabel:`Print` button, the PDF document will have all the
corresponding information.

This can be done for :guilabel:`Vendor Bills` too.

.. tip::
   To retrieve the :guilabel:`Fiscal Folio`, drag and drop XML files as a log note in the chatter
   for previously created draft invoices.

.. _l10n/mx/cfdi:

CFDI to public
**************

The Mexican government requires that any goods or services that are sold must be backed up by an
invoice. If the customer does not require an invoice or has no |RFC|, a *CFDI to Public* has to be
created also known as a "nominative" invoice.

A contact must be created and it must have a particular name.

If  the :guilabel:`CFDI to Public` checkbox in either a sales order or an invoice is checked, the
final XML will override the data in the invoice contact and will add the following characteristics:

- |RFC|: **XAXX010101000** if it is a national customer or **XEXX010101000** if it is a foreign
  customer
- :guilabel:`ZIP` code: The same code of the company
- :guilabel:`Usage`: S01 - Without Fiscal Effects

.. image:: mexico/mx-cfdi-to-public.png
   :alt: CFDI to Public Checkbox

If the final customer doesn't share any details, create a generic :guilabel:`Customer`. The name
cannot be `PUBLICO EN GENERAL` or an error will be triggered (it can be, for example, `CLIENTE
FINAL`).

.. warning::
   By default sending the invoice is not allowed if the partner does not have either the *Country*
   or *Zip code* set, however this is not required if the :guilabel:`CFDI to public` checkbox is
   active.

.. seealso::
   `Regla 2.7.1.21 Expedición de comprobantes en operaciones con el público en general
   <https://www.sat.gob.mx/articulo/90959/regla-2.7.1.21>`_.

.. _l10n/mx/global-invoice:

Global invoice
**************

If by the end of a certain period of time (that can vary from daily to bimonthly, depending of your
company's legal needs and preferences) and the customer still has sales that weren't marked as
regular invoices or individual *CFDI to Public* invoices, the |SAT| allows for the creation of a
single invoice that can contain all operations, known as a *global invoice*.

.. note::
   For this process, the :doc:`Sales <../../sales/sales>` app must be installed.

.. seealso::
   `Guía de llenado del CFDI global
   <http://omawww.sat.gob.mx/tramitesyservicios/Paginas/documentos/GuiallenadoCFDIglobal311221.pdf>`_

Sales flow
^^^^^^^^^^

First, it is necessary to create a special :guilabel:`Journal` created in :menuselection:`Accounting
--> Configuration --> Journals` with the purpose of keeping a separate sequence.

Then, make sure that all the sales orders that need to be signed have the following configurations:

- :guilabel:`CFDI to Public` checkbox enabled
- :guilabel:`Invoice Status` marked as :guilabel:`To Invoice`

After this, go to :menuselection:`Sales --> To Invoice --> Orders to Invoice`, select all relevant
sales orders and press :guilabel:`Create Invoices`. Make sure to disable the :guilabel:`Consolidated
Billing` checkbox and click :guilabel:`Create Draft Invoice`.

Odoo will redirect to a list of invoices. Select all of them and in the :icon:`fa-gear`
:guilabel:`Actions` drop-down menu select :guilabel:`Post entries`. Select all posted invoices again
and go back to the  :icon:`fa-gear` :guilabel:`Actions` drop-down menu to select :guilabel:`Create
Global Invoice`.

In the wizard, select the :guilabel:`Periodicity` indicated by a professional accountant and press
:guilabel:`Create`. All invoices should be signed under the same XML file, with the same
:guilabel:`Fiscal Folio`.

.. tip::
   - Click :guilabel:`Show` in the :guilabel:`CFDI` tab to display a list with all related invoices.
   - Click :guilabel:`Cancel` in the :guilabel:`CFDI` tab to cancel the global invoice in both the
     |SAT| and Odoo.

.. note::
   Global invoices created this way won't have a **PDF** in them as their information is already
   within Odoo and is not to be seen by a customer.

.. _l10n/mx/reporting:

Electronic accounting (reporting)
---------------------------------

For Mexico, `Electronic Accounting
<https://www.sat.gob.mx/aplicacion/42150/envia-tu-contabilidad-electronica>`_ refers to the
obligation to keep accounting records and entries through electronic means, and to enter accounting
information on a monthly basis, through the |SAT| website.

It consists of three main XML files:

#. The updated list of the chart of accounts that is currently in use
#. A monthly trial balance, plus a closing entry report, also known as: *Trial Balance Month 13*
#. An export of the journal entries in the general ledger (optional except in the case of a
   compulsory audit)

The resulting XML files follow the requirements of the `Anexo Técnico de Contabilidad Electrónica
1.3 <https://www.gob.mx/cms/uploads/attachment/file/151135/Anexo24_05012015.pdf>`_.

In addition to this, it is possible to generate the `DIOT
<https://www.sat.gob.mx/declaracion/74295/presenta-tu-declaracion-informativa-de-operaciones-con-
terceros-(diot)->`_: a report of vendors' journal entries that involve IVA taxes that can be
exported in a TXT file.

.. note::
  In order to use these reports, the following modules must be installed:

  - :guilabel:`Odoo Mexican Localization Reports` `l10n_mx_reports`
  - :guilabel:`Mexico - Month 13 Trial Balance` `l10n_mx_reports_closing`
  - :guilabel:`Odoo Mexican XML Polizas Export` `l10n_mx_xml_polizas`

The *chart of accounts* and the *Trial Balance Month 13* reports can be found in
:menuselection:`Accounting --> Reporting --> Trial Balance`. The *DIOT* report can be found in
:menuselection:`Accounting --> Reporting --> Tax Report`.

.. important::
   The specific characteristics and obligations of the reports that you send might change according
   to your fiscal regime. Always contact your accountant before sending any documents to the
   government.

.. _l10n_mx/chart-of-accounts:

Chart of accounts
~~~~~~~~~~~~~~~~~

The :doc:`chart of accounts <../accounting/get_started/chart_of_accounts>` in Mexico follows a
specific pattern based on |SAT|'s' `Código agrupador de cuentas
<http://omawww.sat.gob.mx/fichas_tematicas/buzon_tributario/Documents/codigo_agrupador.pdf>`_.

It is possible to create any account, as long as it respects |SAT|'s encoding group: the pattern is
`NNN.YY.ZZ` or `NNN.YY.ZZZ`.

.. example::
   Some examples are `102.01.99` or `401.01.001`.

When a new account is created in :menuselection:`Accounting --> Configuration --> Chart of
Accounts`, with the |SAT| encoding group pattern, the correct grouping code appears in
:guilabel:`Tags`, and the account appears in the *COA* report.

Once all accounts are created, make sure the correct :guilabel:`Tags` are added as these mark the
nature of the account.

.. note::
   It is not advised use any pattern that ends a section with a 0 (such as `100.01.01`, `301.00.003`
   or `604.77.00`). This triggers errors in the report. By default Odoo will mark the accounts as
   yellow if the numbering will cause issue later on, this is to prevent reports from providing
   inaccurate data.

Once everything is set up, go to :menuselection:`Accounting --> Reporting --> Trial Balance`, and
click the :guilabel:`COA SAT (XML)` button to generate an XML file containing all of the accounts.
This XML file is ready to upload to the |SAT| website.

.. _l10n/mx/trial-balance:

Trial balance
~~~~~~~~~~~~~

The trial balance reports the initial balance, credit, and total balance of your accounts, provided
that you added their correct :ref:`encoding group <l10n_mx/chart-of-accounts>`.

To generate an XML file of the trial balance, go to :menuselection:`Accounting --> Reporting -->
Trial Balance`, select the date, and click the :icon:`fa-cog` :guilabel:`(action menu)`, then select
:guilabel:`SAT (XML)`.

.. image:: mexico/mx-reports-trial-balance.png
   :alt: Trial balance report.

.. note::
   Odoo does not generate the *Balanza de Comprobación Complementaria*.

.. _l10n/mx/month-13:

Month 13
********

An additional report is the *Month 13*: a closing balance sheet that shows any adjustments or
movements made in the accounting to close the year.

To generate this XML document, navigate to :menuselection:`Accounting --> Accounting --> Journal
Entries`, and create a new document. Here, add all amounts to modify, and balance the debit and/or
credit of each one.

After this is done, go to the :guilabel:`Other Info` tab and check the :guilabel:`Month 13 Closing`
field. If needed, go to :menuselection:`Accounting --> Reporting --> Trial Balance` and select the
date :guilabel:`Month 13`, where it is possible to see the the total amount of the year, plus all
the additions of the journal entry. To generate the XML file, click the :icon:`fa-cog`
:guilabel:`(action menu)`, then select :guilabel:`SAT (XML)`.

.. _l10n/mx/general-ledger:

General ledger
~~~~~~~~~~~~~~

By law, all transactions in Mexico must be recorded digitally. Since Odoo automatically creates all
the underlying journal entries of all invoices and payments, simply exporting the general ledger
complies with |SAT|'s audits and/or tax refunds.

.. tip::
   The report can be filtered by period or by journal, depending on the need.

To create the XML, go to :menuselection:`Accounting --> Reporting --> General Ledger`, click
:icon:`fa-cog` :guilabel:`(action menu)`, then click :guilabel:`XML (Polizas)`. Then, select among
four :guilabel:`Export` types:

- :guilabel:`Tax audit`
- :guilabel:`Audit certification`
- :guilabel:`Return of goods`
- :guilabel:`Compensation`

For :guilabel:`Tax audit` or :guilabel:`Audit certification`, add the :guilabel:`Order Number`
provided by the |SAT|. For :guilabel:`Return of goods` or :guilabel:`Compensation`, add the
:guilabel:`Process Number`, also provided by the |SAT|.

.. note::
   To see this report without sending it, use `ABC6987654/99` for the :guilabel:`Order Number` or
   `AB123451234512` for the :guilabel:`Process Number`.

.. _l10n/mx/diot:

DIOT report
~~~~~~~~~~~

The DIOT (Declaración Informativa de Operaciones con Terceros / *Informative Declaration of
Operations with Third Parties*) is an additional obligation with the |SAT|, where the current status
of creditable and non-creditable payments, withholdings, import taxes, and refunds of VAT from your
vendor bills are provided to the |SAT|.

.. note::
   Since July 2025 the new 2025 version of the report is available.

Unlike other reports, the |DIOT| is uploaded to a website provided by the |SAT| that contains the
A-29 form. In Odoo, you can download the records of your transactions as a TXT file that can be
uploaded to the form, avoiding direct capture of this data.

The transactions file contains the total amount of the payments registered in vendor bills, broken
down into the corresponding types of IVA. The :guilabel:`VAT`, :guilabel:`Country` and
:guilabel:`Type of operation` fields are mandatory for all vendors.

To download the |DIOT| report as a TXT file, go to :menuselection:`Accounting --> Reports --> Tax
Return`. Select the desired month, click :icon:`fa-cog` :guilabel:`(action menu)`, and select
:guilabel:`DIOT (TXT)`.

In case new taxes are created on the database, there are two types of tags, the tags containing
**tax** must go into the tax distribution and the ones with the base name go on the base of the tax.
All lines of a VAT tax **must** containing at least one tax grid.

.. image:: mexico/mx-reports-diot.png
   :alt: DIOT (TXT) download button.

.. important::
   It is required to fill in the :guilabel:`Type of Operation` field in the :guilabel:`Accounting`
   tab of each vendor to prevent validation errors. Make sure that foreign customers have their
   :guilabel:`Country` set.

   .. image:: mexico/mx-reports-diot-contact.png
      :alt: DIOT information on a vendor contact.

   Selecting :guilabel:`87 - Global Operations` will cause the final TXT file to merge all vendors
   that are part of the global operations under one generic VAT: *XAXX010101000*.

.. _l10n/mx/external-trade:

External trade
--------------

The external trade is a complement to a regular invoice that adds certain values in both the XML and
PDF, to invoices with a foreign customer according to `SAT regulations
<http://omawww.sat.gob.mx/tramitesyservicios/Paginas/complemento_comercio_exterior.htm>`_, such as:

- The specific address of the receiver and the sender
- The addition of a :guilabel:`Tariff Fraction` that identifies the type of product
- The correct :doc:`../accounting/customer_invoices/incoterms` (International Commercial Terms)
- And more, such as the *certificate of origin* and *special units of measure*

This allows the correct identification of exporters and importers, in addition to expanding the
description of the merchandise sold.

Since January 1, 2018, external trade is a requirement for taxpayers who carry export operations of
type A1. While the current CFDI is 4.0, the external trade is currently on version 2.0.

.. note::
   In order to use this feature, the :guilabel:`EDI for Mexico (Advanced Features)`
   `l10n_mx_edi_extended` module must be installed.

.. important::
   Before installing, make sure your business needs to use this feature. Consult your accountant
   first, if needed, before installing any modules.

   The :guilabel:`CFDI to public` checkbox must be ticked when creating foreign invoices.

Configuration
~~~~~~~~~~~~~

Contacts
********

To configure your company contact for external trade, navigate to :menuselection:`Accounting -->
Customers --> Customers`, remove the default :guilabel:`Customer Invoices` filter, and select your
:guilabel:`Company` name. While the CFDI 4.0 requirements require adding a valid :guilabel:`ZIP`
code in the company contact record, the external trade complement adds the requirement that the
:guilabel:`City` and the :guilabel:`State` must also be valid. All three fields must coincide with
the `Official SAT Catalog for Carta Porte
<http://omawww.sat.gob.mx/tramitesyservicios/Paginas/catalogos_emision_cfdi_complemento_ce.htm>`_,
or it will produce an error.

.. warning::
   Add the :guilabel:`City` and :guilabel:`State` in the company's *contact record*, not in the
   company record itself.

On the contact record, the optional fields :guilabel:`Locality` and :guilabel:`Colony Code` can also
be filled. These two fields also have to coincide with the data in the |SAT|.

To configure the contact data for a foreign receiving client, navigate to :menuselection:`Accounting
--> Customers --> Customers`, and select the foreign client's contact. The contact must have the
following fields completed to avoid errors:

#. The entire company :guilabel:`Address`, including a valid :guilabel:`ZIP` code and the foreign
   :guilabel:`Country`.
#. The foreign :guilabel:`RFC` (tax identification number), in the correct format (for example:
   Colombia `123456789-1`)
#. In the :guilabel:`Sales & Purchase` tab, to activate the :guilabel:`Needs external trade?`
   checkbox.

.. note::
   In the resulting XML and PDF files, the :guilabel:`VAT` is automatically replaced by the generic
   VAT for abroad transactions: `XEXX010101000`.

Products
********

All products involved with external trade have four additional fields that are required, two of
which are exclusive to external trade.

#. The :guilabel:`Reference` of the product must be set in the :guilabel:`General Information` tab.
#. The :guilabel:`Weight` of the product in the :guilabel:`Inventory` tab must be more than `0`.
#. The `correct  <https://www.ventanillaunica.gob.mx/vucem/Clasificador.html>`_ :guilabel:`Tariff
   Fraction` of the product must be set in the :guilabel:`Accounting` tab for external trade.
#. The :guilabel:`UMT Aduana` in the :guilabel:`Accounting` tab must be set and correspond to the
   :guilabel:`Tariff Fraction` for external trade.

.. image:: mexico/mx-external-trade-product.png
   :alt: Required external trade product fields.

.. tip::
   - If the UoM code of the :guilabel:`Tariff Fraction` is `01`, the correct :guilabel:`UMT Aduana`
     is `kg`.
   - If the UoM code of the :guilabel:`Tariff Fraction` is `06`, the correct :guilabel:`UMT Aduana`
     is `Units`.

Invoicing flow
~~~~~~~~~~~~~~

Before creating an invoice, it is important to take into account that external trade invoices
require converting product prices into a foreign currency such as USD. Therefore,
:doc:`multicurrency <../accounting/get_started/multi_currency>` **must** be enabled with the foreign
currency activated in the :guilabel:`Currencies` section. The correct :guilabel:`Service` to run is
:guilabel:`[MX] Bank of Mexico`. To convert product prices, create a :doc:`pricelist
<../../sales/sales/products_prices/prices/pricing>` in the foreign currency.

Then, with the correct exchange rate set up in :menuselection:`Accounting --> Settings -->
Currency`, set the :guilabel:`Incoterm` and the optional :guilabel:`Certificate Source` fields in
the invoice's :guilabel:`Other Info` tab.

.. tip::
   While not mandatory, the information will be more complete if :guilabel:`CFDI to public` is also
   active.

Finally, confirm the invoice with the same process as a regular invoice, and click the
:guilabel:`Send` button to sign it via CFDI.

.. _l10n/mx/pos:

Point of sale
=============

The :doc:`Point of sale <../../sales/point_of_sale>` adaptation of the Mexican Localization enables
the creation of invoices that comply with the |SAT| requirements directly in the **POS session**,
with the added benefit of creating receipt tickets that allow *self-invoicing* in a special portal
and creating global invoices.

.. _l10n/mx/pos/flow:

Point of sale flow
------------------

On top of the standard :doc:`Point of Sale configuration <../../sales/point_of_sale/configuration>`,
the Mexican localization requires each payment method to be configured with a correct
:guilabel:`Payment Way` as well as a :guilabel:`Re-invoicing account` to handle the accounting for
invoices with the invoicing portal.

.. tip::
   By default, Odoo creates pre-configured payment methods for cash, credit card, and debit card and
   assigns the :guilabel:`402.04.01 Re-invoicing` account as default for re-invoicing.

While selling on the **Point of Sale**, click the :guilabel:`Customer` button to either create or
select a customer. Here it is possible to review customer invoicing information (such as the |RFC|
or :guilabel:`Fiscal Regime`) and even modify it directly inside the session.

After selecting a customer, tick the :icon:`fa-file-text-o` :guilabel:`Invoice` checkbox. This opens
a menu to select the :guilabel:`Usage` and to define if it is an invoice to the public. Click
confirm, select the payment method, and then click validate to complete the order. The PDF is then
downloaded and it is possible to send the invoice via mail to the final customer alongside the
receipt.

.. tip::
   To create invoices from orders, go to the :guilabel:`Orders` menu, select the order, click
   :guilabel:`Load Order`, and tick the :icon:`fa-file-text-o` :guilabel:`Invoice` checkbox. This
   opens the same menu for the :guilabel:`Usage` and :guilabel:`CFDI to Public`.

.. image:: mexico/mx-pos.png
   :alt: Invoice Configuration for Point of Sale.

To sign a credit note automatically, tick the :icon:`fa-file-text-o` :guilabel:`Invoice` checkbox
when processing a :ref:`refund <pos/refund>`.

.. note::
   Credit notes for returned products will contain the relation type :guilabel:`03 - Devolución de
   mercancía sobre facturas o traslados previos`.

.. important::
   - In the Mexican localization, positive and negative lines in a **POS** session cannot be mixed.

   - If a |SAT| validation error occurs customer will get a :doc:`Pro-Forma invoice
     <../../sales/sales/invoicing/proforma>` instead.

.. _l10n/mx/pos/portal:

Self-invoicing portal
---------------------

If the final customer is not sure if they want to have their invoice generated at the exact moment
of the sale, it is possible to give them the option of creating a receipt with either a QR code or a
URL. To do so, follow these steps:

#. Go to :menuselection:`Point of Sale --> Configuration`.
#. Select the :guilabel:`Point of Sale`.
#. Scroll to the :guilabel:`Bills & Receipts` section.
#. Enable :guilabel:`Self-service invoicing`.
#. Set the :guilabel:`Print` field to :guilabel:`QR code`, :guilabel:`URL`, or :guilabel:`QR code +
   URL`.

Customers who scan this QR code or follow the URL will access to a menu where they can add their
fiscal information, including the *Usage* and *Fiscal Regime* once they enter the five digit code
that is also provided on the receipt.

On the journal entries of the session, the previously selected **Re-invoicing account** will be used
to handle reversals of the sales entries when invoices are requested as well as be used as a sales
account for the new invoices.

.. seealso::
   :doc:`../../sales/point_of_sale/receipts_invoices`

.. _l10n/mx/pos/global-invoice:

Global invoice
--------------

As with regular sales orders, global invoices can also be created from a POS session.

For this, make sure not to select a customer or the invoice option in the payment menu and go to
:menuselection:`Point of Sale --> Orders --> Orders`. There, select all the orders to invoice, click
:icon:`fa-cog` :guilabel:`Actions` and select :guilabel:`Create Global Invoice`.

Like with sales orders, choose the correct :guilabel:`Periodicity` and press :guilabel:`Create`.

This attaches an XML file to each of the selected orders. The XML files can be downloaded by going
to the :guilabel:`CFDI` tab. If needed, it is possible to cancel the invoice from the same tab.

If eventually any of the orders that are part of the global invoice need to be addressed to a
customer, it is still possible to send an invoice by entering a new POS session, clicking the
:icon:`fa-bars` :guilabel:`(drop-down menu)`, then click :guilabel:`Orders`. Change the
:guilabel:`All active orders` filter to :guilabel:`Paid`, select the order, and click the
:icon:`fa-file-text-o` :guilabel:`Invoice` button.

.. note::
   Global invoices, just as regular invoices, can only be grouped by physical address. That is
   determined by the address set on the POS invoice journal, so when attempting to invoice two
   addresses a warning will come up to warn the user of the error.

.. _l10n/mx/ecommerce:

eCommerce
=========

The eCommerce adaptation of the Mexican Localization provides and extra step to create invoices that
comply with the |SAT| requirements on :doc:`eCommerce  <../../websites/ecommerce>` by retrieving the
customer data after the **Checkout** and even allowing for the signature of **automatic invoices**
after the payment is processed, as well as sending customers the files via email and granting them
access to retrieve their PDF file from their own customer portal.

.. _l10n/mx/ecommerce/flow:

eCommerce flow
--------------

During the regular checkout process, a new :guilabel:`Invoicing Info` step appears, where it is
possible to request an invoice or not. If :guilabel:`No` is selected, a **CFDI to Public** is
created,. If :guilabel:`Yes` is selected, the :guilabel:`RFC`, :guilabel:`Fiscal Regime`, and
:guilabel:`Usage` are required in order to get all information in the sales order, where its status
will change to :guilabel:`To Invoice`.

Additionally the customer can decide whether or not to request :ref:`IEPS Breakdown
<l10n/mx/ieps-breakdown>`.

.. important::
   Make sure to add a :guilabel:`UNSPSC code` to the :ref:`shipping product
   <ecommerce/checkout/delivery>`.

If the :guilabel:`Automatic Invoicing` is enabled in :menuselection:`Settings --> Website -->
Invoicing`, the electronic document will be signed automatically.

.. _l10n/mx/sales:

Sales
=====

The **Sales** app contains fields that make invoicing easier, while the fields themselves do not
change the sales behavior, they are directly copied when creating an invoice.

The copied fields are:

- Payment Way
- Payment Policy
- CFDI to public
- Usage

Additionally, it is possible to get a preview of the invoice for validation purposes with the
customer by installing the :doc:`pro-forma module <../../sales/sales/invoicing/proforma>`. This
module adds the mentioned fields to the sale order as well as:

- Product code
- Unit code
- Fiscal regime

.. _l10n/mx/subscriptions:

Subscriptions
=============

While handling subscriptions, all the sales fields are used to create the recurrent invoices. These
are automatically signed and sent via email with the PDF and XML attached with no additional manual
actions required.

.. important::
   All invoices generated by the subscription app will always be automatically signed with no
   exceptions.

.. _l10n/mx/inventory:

Inventory
=========

.. _l10n/mx/inventory/customs:

Customs numbers
---------------

A *customs declaration* (Pedimento Aduanero) is a fiscal document that certifies that all
contributions to the fiscal entity (the |SAT|) have been paid for, including the import/export of
goods.

According to the `Annex 20 <http://omawww.sat.gob.mx/tramitesyservicios/Paginas/anexo_20.htm>`_ of
CFDI 4.0, in documents where the invoiced goods come from a first-hand import operation, the
:guilabel:`Customs Number` field needs to be added to all lines of products involved with the
operation, as does the date of the document.

.. note::
   To do so, the :guilabel:`Odoo Mexico Localization for Stock/Landing` `l10n_mx_edi_landing` module
   must be installed, in addition to the :doc:`Inventory <../../inventory_and_mrp/inventory>`,
   :doc:`Purchase <../../inventory_and_mrp/purchase>`, and :doc:`Sales <../../sales/sales>` apps.

.. important::
   Do not confuse this feature with external trade. The customs numbers are directly related to
   importing goods, while the external trade complement is related to exporting. Consult your
   accountant first if this feature is needed before doing any modifications.

Configuration
~~~~~~~~~~~~~

In order to track the correct customs number for a specific invoice, Odoo uses :doc:`landed costs
<../../inventory_and_mrp/inventory/inventory_valuation/landed_costs>`. Go to
:menuselection:`Inventory --> Configuration --> Settings`, and in the :guilabel:`Valuation` section,
make sure that :guilabel:`Landed Costs` is activated.

.. Tip::
   It is recommended to add a :guilabel:`Default Journal` to automatically fill the mandatory
   :guilabel:`Journal` field on landed costs even though landed costs that only add customs numbers
   without adding :guilabel:`Additional Costs` do not create journal entries.

Configure the **goods-type** products that hold the customs numbers. To do so, create the products
and complete these three requirements:

- :guilabel:`Tracking` **must** be set to either :guilabel:`By Lots` or :guilabel:`By Unique Serial
  Number` but **not** :guilabel:`By Quantity`.
- :guilabel:`Invoicing Policy` **must** be set to :guilabel:`Delivered quantities`.
- :doc:`Valuation by lots/serial numbers
  <../../inventory_and_mrp/inventory/inventory_valuation/valuation_by_lots>` **must** be enabled.

This will make the field :guilabel:`Customs invoicing` available on the :guilabel:`Accounting` tab.
Enable the field to use customs numbers with this product.

It is important to make sure the product has a :guilabel:`Product Category` and has the following
configuration:

- :guilabel:`Costing Method`: Either :guilabel:`FIFO` or :guilabel:`AVCO`
- :guilabel:`Inventory Valuation`: Either :guilabel:`Periodic` or :guilabel:`Perpetual`

.. note::
   The feature works regardless of whether the :doc:`inventory valuation
   <../../inventory_and_mrp/inventory/inventory_valuation/cheat_sheet>` is set to either
   :guilabel:`Periodic (at closing)` or :guilabel:`Perpetual (at invoicing)`.

.. image:: mexico/mx-landing-configuration.png
   :alt: Storable products general configuration.

.. image:: mexico/mx-landing-configuration-category.png
   :alt: Storable product category configuration.

Purchase and sales flow
~~~~~~~~~~~~~~~~~~~~~~~

After configuring the product, follow the standard :doc:`purchase flow
<../../inventory_and_mrp/purchase>`.

Create a purchase order from :menuselection:`Purchase --> Orders --> Purchase Order`. Then, confirm
the order to display a :guilabel:`Receipt` smart button. Click on the :guilabel:`Receipt` smart
button, add the lots or serial numbers and :guilabel:`Validate`.

Go to :menuselection:`Inventory --> Operations --> Landed Costs`, and create a new record. In the
:guilabel:`Transfer`, add the receipt that was just validated, and add the :guilabel:`Customs
number`.

.. tip::
   While it is possible to add costs related to the customs number at this stage of the process, it
   is highly recommended to create a landed cost from a vendor bill from your customs agent. Learn
   more about :doc:`Landed Costs here
   <../../inventory_and_mrp/inventory/inventory_valuation/landed_costs>`.

.. warning::
   The :guilabel:`Customs number` field is not editable once it is set, and cannot be repeated,
   however it is possible to fix the number on the lot or serial number later by selecting a
   different landed cost.

.. image:: mexico/mx-landing-inventory.png
   :alt: Customs number on a landed costs Inventory record.

The customs number assigned to a specific lot or serial number can be found on the its registry on
:menuselection:`Inventory --> Products --> Lots/Serial Numbers`. The :guilabel:`L10N Mx Edi Landed
Cost` field can be edited at any time to fix any mistakes that could have occurred when registering
the landed cost. Editing the :guilabel:`L10N Mx Edi Landed Cost` field automatically updates the
:guilabel:`Customs number` and the name of the lot or serial number.

Next, create a sales order and confirm it. Click on the :guilabel:`Delivery` smart button that
appears, and carefully review the assigned lots/serial numbers to make sure they are the desired
values, after that :guilabel:`Validate` the delivery order.

Finally, :ref:`create an invoice from the sales order <accounting/inv-process/so>`, and confirm it.
The invoice lines are created according to the distribution of the delivery order, in cases where
more than one customs number were selected, Odoo will split the invoice lines by quantity and
customs numbers.

.. image:: mexico/mx-landing-invoice.png
   :alt: Customs number on confirmed sales order product.

.. _l10n/mx/inventory/delivery-guide:

Delivery guide
--------------

A `Carta Porte <https://www.sat.gob.mx/portal/public/tramites/complemento-carta-porte>`_ is a bill
of lading: a document that states the type, quantity, and destination of goods being carried.

On July 17th, 2024, version 3.1 of this |CFDI| was implemented for all transportation providers,
intermediaries, and owners of goods. Odoo is able to generate a document type "T" (Traslado), which,
unlike other documents, is created in a delivery order instead of an invoice or payment.

Odoo can create XML and PDF files with (or without) ground transport, and can process materials that
are treated as *Dangerous Hazards*.

In order to print the PDF, the delivery order must be signed by the government and then it can be
printed using the :guilabel:`Print Carta Porte` button on the delivery order.

.. tip::
   The PDF file contains a QR code to verify the CCP code for the authorities.

In order to transport goods between warehouses, the logistic route must contain a **Delivery** type
of operation.

.. seealso::
   :doc:`Inter-warehouse replenishment
   <../../inventory_and_mrp/inventory/warehouses_storage/replenishment/resupply_warehouses>`

.. note::
   In order to use this feature, the :guilabel:`Mexico - Electronic Delivery Guide`
   `l10n_mx_edi_stock` module must be installed.

   Additionally, it is necessary to have the :doc:`Inventory <../../inventory_and_mrp/inventory>`
   and :doc:`Sales <../../sales/sales>` apps installed.

.. important::
   Odoo does not support Carta Porte type document type "I" (Ingreso), air, train or marine
   transport.

   Consult your accountant first if this feature is needed before doing any modifications.

Configuration
~~~~~~~~~~~~~

Odoo manages two different types of CFDI type "T". Both can be created from either :doc:`incoming
shipments or delivery orders
<../../inventory_and_mrp/inventory/shipping_receiving/daily_operations>`.

- :guilabel:`No Federal Highways` is used when the :guilabel:`Distance to Destination` is `less than
  30 km
  <http://omawww.sat.gob.mx/cartaporte/Paginas/documentos/PreguntasFrecuentes_Autotransporte.pdf>`_.
- :guilabel:`Federal Transport` is used when the :guilabel:`Distance to Destination` exceeds 30 km.

For No Federal Highways, no other configuration is required beyond the standard requirements of
regular invoicing (the |RFC| of the customer, the UNSPSC code, etc.).

For *Federal Transport*, several configurations have to be added to contacts, vehicle setups, and
products. Those configurations are then included in the XML and PDF files.

Contacts and vehicles
*********************

Like the external trade feature, the :guilabel:`Address` in both the company and the final customer
must be complete. The :guilabel:`ZIP` code, :guilabel:`City`, and :guilabel:`State` must coincide
with the `Official SAT Catalog for Carta Porte
<http://omawww.sat.gob.mx/tramitesyservicios/Paginas/catalogos_emision_cfdi_complemento_ce.htm>`_.

.. tip::
   The :guilabel:`Locality` field is optional for both addresses.

.. important::
   The origin address used for the delivery guide is set in :menuselection:`Inventory -->
   Configuration --> Warehouses`. While this is set as the company address by default, you can
   change it to your correct warehouse address.

This feature requires the use of :doc:`Fleet <../../hr/fleet/new_vehicle>` to manage vehicles. The
vehicle setup is managed directly on the vehicle, and all the required fields are only visible after
checking the :guilabel:`L10N Mx Is Freight Vehicle` field.

Checking the :guilabel:`L10N Mx Is Freight Vehicle` field displays the :guilabel:`MX Parameters` tab
where the mandatory fields are required to create a correct delivery guide. Additionally the vehicle
**must** contain a :guilabel:`License Plate`, a :guilabel:`Model Year`, and a :guilabel:`Driver`.

.. tip::
   The :guilabel:`Vehicle Plate Number` and :guilabel:`Number Plate` fields must contain between 5
   and 7 characters.

The main driver of the vehicle is set directly on the :guilabel:`Driver` field, and it is possible
to add more vehicle operators in the :guilabel:`Intermediaries` section. The only mandatory fields
for driver contacts are the :guilabel:`VAT` and :guilabel:`Operator License`.

.. image:: mexico/mx-delivery-guide-vehicle.png
   :alt: Delivery guide vehicle configuration.

.. tip::
   If the vehicle is rented or more intermediaries are required, it is possible to add them in the
   :guilabel:`Intermediaries` field.

Products
********

Similar to regular invoicing, all products must have a :guilabel:`UNSPSC category`. In addition to
this, there are two extra configurations for products involved in delivery guides:

- The :guilabel:`Product Type` must be set as :guilabel:`Storable Product` for stock movements to be
  created.
- In the :guilabel:`Inventory` tab, the :guilabel:`Weight` field must be more than `0`.

.. warning::
   Creating a delivery guide of a product with the :guilabel:`Weight` set to `0` will trigger an
   error. As the :guilabel:`Weight` is immediately stored in the delivery order, it is then
   necessary to return the products and recreate the delivery order (and delivery guide) with the
   correct values.

Sales and inventory flow
~~~~~~~~~~~~~~~~~~~~~~~~

To create a delivery guide, first create and confirm a sales order from :menuselection:`Sales -->
Sales Order`. Click the :guilabel:`Delivery` smart button that is generated, and
:guilabel:`Validate` the transfer.

After the status is set to :guilabel:`Done`, you can edit the transfer, and select the
:guilabel:`Transport Type` in the :guilabel:`Additional Info` tab.

If using the :guilabel:`No Federal Highways` :guilabel:`Transport Type`, save the transfer, and then
click :guilabel:`Generate Delivery Guide`. The resulting XML can be found in the chatter.

.. note::
   Other than the :guilabel:`UNSPSC` on all products, delivery guides that use :guilabel:`No Federal
   Highways` do not require any special configuration to be sent to the government, as they are a
   type "T" CFDI with no delivery guide complement.

If using the :guilabel:`Federal Transport` :guilabel:`Transport Type`, the :guilabel:`Vehicle Setup`
is displayed to be selected.
The :guilabel:`Gross vehicle weight` is taken from the :guilabel:`Vehicle setup` configuration where
it is possible to add additional :guilabel:`Extra weight` to account for the drivers and luggage.

.. note::
   Odoo will calculate the :guilabel:`Gross vehicle weight` with the following formula:

   .. math::
      Gross vehicle weight = Vehicle weight + (Weight + Extra Weight) / 1000

Every delivery requires a value in :guilabel:`Distance to Destination (KM)` greater than `0`.
Finally, enter the :guilabel:`Delivery Date` and click :guilabel:`Generate Delivery Guide`.

.. note::
   By default the :guilabel:`Scheduled Date` is filled and represents the time at which the shipment
   leaves the warehouse and the :guilabel:`Delivery Date` is the time that the shipment is expected
   to arrive at its destination. These values are declared in both the XML and PDF.

Dangerous hazards
*****************

Certain values in the :guilabel:`UNSPSC Category` are considered in the `official SAT catalog
<http://omawww.sat.gob.mx/tramitesyservicios/Paginas/complemento_carta_porte.htm>`_ as *dangerous
hazards*. These categories need additional considerations when creating a delivery guide with
:guilabel:`Federal Transport`.

First, select the product from :menuselection:`Inventory --> Products --> Products`. Then, in the
:guilabel:`Accounting` tab, fill the :guilabel:`Hazardous Material Designation Code` and
:guilabel:`Hazardous Packaging` fields with the correct code from the |SAT| catalog.

.. image:: mexico/mx-delivery-guide-hazards-designation.png
   :alt: Delivery guide hazardous material product required fields.

.. important::
   There exists the possibility that a :guilabel:`UNSPSC Category` may or may not be a dangerous
   hazard (for example *01010101*). If it is not dangerous, enter `0` in the :guilabel:`Hazardous
   Material Designation Code` field.

In :guilabel:`MX Parameters`, complete the :guilabel:`Environment
Insurer` and :guilabel:`Environment Insurance Policy` as well. After this, continue with the regular
process to create a delivery guide.

Imports and Exports
*******************

If your Carta Porte is for international operations (for exports), some additional fields need to be
taken into account.

First, make sure that all relevant :guilabel:`Products` have the following configuration:

- :guilabel:`UNSPSC Category` cannot be :guilabel:`01010101 Does not exist in the catalog`.
- :guilabel:`Tariff Fraction` and :guilabel:`UMT Aduana` must be set, similar to the :ref:`external
  trade <l10n/mx/external-trade>` flow.
- :guilabel:`Material Type` must be set.

Then, when creating a :guilabel:`Delivery Guide` from a delivery or receipt, fill the following
fields:

- :guilabel:`Customs Regimes`
- :guilabel:`Customs Document Type`
- :guilabel:`Customs Document Identification`

Then, when creating a :guilabel:`Delivery Guide` for a receipt where the :guilabel:`Customs Document
Type` is :guilabel:`Customs number`, two new fields appear: :guilabel:`Customs Number` and
:guilabel:`Importer`.

.. tip::
   The field :guilabel:`Customs Number` should follow the pattern `xx xx xxxx xxxxxxx`. For example,
   `15 48 3009 0001235` with **Two** spaces between text.


==================================================
SECTION: netherlands.rst
PATH: applications/finance/fiscal_localizations/netherlands.rst
==================================================

===========
Netherlands
===========

.. seealso::
   :doc:`Documentation on e-invoicing’s legality and compliance in the Netherlands
   <../accounting/customer_invoices/electronic_invoicing/netherlands>`

XAF Export
==========

With the Dutch accounting localization installed, you will be able to
export all your accounting entries in XAF format. For this, you have to
go in :menuselection:`Accounting --> Reporting --> General Ledger`, you
define the entries you want to export using the filters (period, journals, ...)
and then you click on the button **EXPORT (XAF)**.

Dutch Accounting Reports
========================

If you install the Dutch accounting localization, you will have access
to some reports that are specific to the Netherlands such as :

-  Profit & Loss
-  Tax Report (Aangifte omzetbelasting)
-  Intrastat Report (ICP)


==================================================
SECTION: new_zealand.rst
PATH: applications/finance/fiscal_localizations/new_zealand.rst
==================================================

===========
New Zealand
===========

.. _localizations/new_zealand/modules:

Modules
=======

The following modules related to the New Zealand localization are available:

.. list-table::
   :widths: 25 25 50
   :header-rows: 1

   * - Name
     - Technical name
     - Description
   * - :guilabel:`New Zealand - Accounting`
     - `l10n_nz`
     - Installed by default when the accounting fiscal localization package is set to New Zealand.
       This module also installs the remittance advice report module.
   * - :guilabel:`Employment Hero NZ Payroll`
     - `l10n_employment_hero`
     - This module synchronizes all pay runs from Employment Hero with Odoo's journal entries.
   * - :guilabel:`EFT Batch Payment`
     - `l10n_nz_eft`
     - This module allows businesses to streamline bulk payments like payroll and vendor payments.
       Each bank has its specific format for these transactions.

.. note::
   The localization’s core modules are installed automatically with the localization. The rest can
   be manually :doc:`installed </applications/general/apps_modules>`.

.. _localizations/new_zealand/loc-specifics:

Localization overview
=====================

- :doc:`../accounting/get_started/chart_of_accounts`: a predefined structure tailored to New
  Zealand accounting standards
- :doc:`../accounting/taxes/fiscal_positions`: automated tax adjustments based on customer or
  supplier registration status
- :ref:`localizations/new_zealand/taxes-gst`
- :ref:`localizations/new_zealand/reporting`

.. _localizations/new_zealand/taxes-gst:

Taxes and GST
-------------

The default taxes impact the
:doc:`GST report<../../../applications/finance/accounting/reporting/tax_returns>`, which can be
accessed through :menuselection:`Accounting --> Reporting --> Tax Return`

The standard **Goods and Service Tax** (GST) rate is 15%, but different rates and exemptions exist
for specific categories of goods and services.

.. seealso::
   :doc:`GST report<../../../applications/finance/accounting/reporting/tax_returns>`

.. _localizations/new_zealand/tax-mapping:

Tax mapping
~~~~~~~~~~~

Within the New Zealand localization package, tax names encompass the tax rate as an integral part
of their naming convention.

.. seealso::
   :doc:`Taxes documentation <../../../applications/finance/accounting/taxes>`

These are the taxes in Odoo.

.. list-table::
   :widths: 25 25 25 25
   :header-rows: 1

   * - GST name
     - Description
     - Label on invoices
     - GST Type
   * - 15%
     - Sale (15%)
     - GST Sales (15%)
     - Sales
   * - 15%
     - Purch (15%)
     - GST Purchases (15%)
     - Purchases
   * - 0% EX
     - Zero/Export (0%) Sale
     - Zero Rated (Export) Sales
     - Sales
   * - 0% F
     - Zero/Import (0%) Purch
     - GST Free Purchases
     - Purchases
   * - 0% TPS
     - Purch (Imports Taxable)
     - Purchase (Taxable Imports) - Tax Paid Separately
     - Purchases
   * - 100% ONLY
     - GST Only - Imports
     - GST Only on Imports
     - Purchases

.. _localizations/new_zealand/reporting:

Reporting
---------

.. _localizations/new_zealand/gst-report:

GST report
~~~~~~~~~~

The **Goods and Services Tax (GST) report** is a critical tax reporting requirement for businesses
registered for GST. The GST return is used to report and remit GST to the **Inland Revenue
Department (IRD)**.

.. image:: new_zealand/GST_report.png
   :alt: GST Report.

The base and tax amounts are collected from the **GST**, which is pre-configured in Odoo to align
with GST Return requirements (Boxes 1-15). The **GST** can also be manually configured for special
use cases, such as specific GST treatments (e.g., zero-rating for exported agricultural goods).
Once the **GST** setup for each account is complete, Odoo automatically categorizes journal items
into the appropriate boxes. This ensures the **GST** return is accurate and fully reflects the
business's financial activities.

.. seealso::
   :doc:`Taxes documentation <../../../applications/finance/accounting/taxes>`

.. _localizations/new_zealand/gst-closing:

Closing the GST report
**********************

The :ref:`tax return periodicity <accounting/tax-returns/periodicity>` must be set up before
submitting the :ref:`tax return <accounting/tax-returns/report>` (**GST report**) to the **IRD**.

.. seealso::
   :doc:`Year-end closing documentation
   <../../../applications/finance/accounting/reporting/year_end>`

Before closing the entry for the first time, enable the :doc:`developer mode
<../../../applications/general/developer_mode>` and go to :menuselection:`Accounting -->
Configuration --> Tax Groups` to set the default **GST payable account** and **GST receivable
account**.

Once the **GST payable** and **GST receivable** accounts are set up, the **Tax Return** report
generates an accurate journal closing entry automatically, balancing the GST balance with the GST
clearing account.

The balance between **GST receivable** and **payable** is set against the tax clearing account
defined on the tax group. The amount to be paid to or received from **IRD** can then be reconciled
with a bank transaction.

.. important::
   The **GST** report is not submitted directly to the **IRD**. Instead, Odoo
   automatically calculates the required values for each section, providing options to audit
   and review the data for a clearer understanding of its history. Businesses can then
   submit these values to the `IRD portal <https://myir.ird.govt.nz/_/>`_.

.. _localizations/new_zealand/remittance-advice:

Remittance advice
~~~~~~~~~~~~~~~~~

A remittance advice is a document used as proof of payment to a business. To access it, go to
:menuselection:`Accounting --> Vendors --> Payments` and select the payment(s). Then click
:icon:`fa-print` :guilabel:`Print` and select :guilabel:`Payment Receipt`.

.. image:: new_zealand/remitance_advice_new.png
   :alt: Remittance Advice.

.. _localizations/new_zealand/accounting:

Accounting
==========

.. _localizations/new_zealand/e-invoicing:

E-invoicing
-----------

Odoo allows :ref:`electronic invoicing <accounting/e-invoicing/configuration>` settings to be
configured per contact.

.. image:: new_zealand/peppol_contact_new.png
   :alt: Peppol Contact.

.. important::
   Validating an invoice or credit note for a contact on the PEPPOL network will download a
   compliant XML file that can be manually uploaded to the PEPPOL network. Odoo is currently in the
   process of becoming an access point for the ANZ region.

.. seealso::
   `PEPPOL requirements <https://peppol.org/learn-more/country-profiles/new-zealand/>`_

.. _localizations/new_zealand/eft-batch-payments:

EFT batch payments
------------------

An :abbr:`EFT (electronic funds transfer)` batch file is a digital format used to facilitate bulk
payment processing for businesses. It allows companies to consolidate multiple inbound and outbound
payments into a single electronic file. This process is commonly used by businesses handling
multiple payments at once, such as payroll or payments to multiple suppliers.

.. _localizations/new_zealand/eft-configuration:

Configuration
~~~~~~~~~~~~~

.. _localizations/new_zealand/eft-settings:

 #. :ref:`Install <general/install>` the :guilabel:`EFT Batch Payment` module (`l10n_nz_eft`).
 #. Go to :menuselection:`Accounting --> Configuration --> Settings`. In the
    :guilabel:`Customer Payments` section, enable :guilabel:`Batch Payments`.

.. seealso::
   :doc:`../../../applications/finance/accounting/payments/batch`

.. _localizations/new_zealand/eft-bank-journal:

Bank journal
************

Go to :menuselection:`Accounting --> Configuration --> Journals` to configure the bank **journal**.
In the :guilabel:`Journal Entries` tab, enter the :guilabel:`Account Number` and click
:guilabel:`Create and edit...`. In the :guilabel:`Create Account Number` window, fill in the
:guilabel:`Bank` and enable :guilabel:`Send Money` to set the bank account as trusted. The
:guilabel:`Currency` field is optional.

.. _localizations/new_zealand/eft-contacts:

Contacts' bank accounts
***********************

To add banking information for a contact, navigate to
:menuselection:`Accounting --> Customers --> Customers`,
:menuselection:`Accounting --> Vendors --> Vendors`, or access the contact directly through the
**Contacts** app. Select the relevant contact, then open the :guilabel:`Accounting` tab. Under the
:guilabel:`Bank Accounts` section, click :guilabel:`Add a line` to enter the required details.

- :guilabel:`Account Number`
- :guilabel:`Bank`
- :guilabel:`Account Holder` (it will automatically be selected for that contact)
- :guilabel:`Send Money` must be **enabled**.

.. _localizations/new_zealand/eft-generate:

Generate an EFT file
~~~~~~~~~~~~~~~~~~~~

Go to :menuselection:`Accounting --> Customers --> Invoices`
or :menuselection:`Accounting --> Vendors --> Bills`. Select the invoices/bills to be paid from the
list and click :guilabel:`Pay`. In the :guilabel:`Payment Method` field, select
:guilabel:`New Zealand EFT` and click :guilabel:`Create Payment`.

.. note::
   The :guilabel:`Group Payment` checkbox is optional. This option appears only if there are
   multiple invoices or bills from the same contact.

In the payments window, the required EFT information for each payment, such as
:guilabel:`Particulars` and :guilabel:`Analysis Code`, can be entered as needed.

.. note::
   The same payment information can be found under :menuselection:`Accounting --> Customers -->
   Payments` or :menuselection:`Accounting --> Vendors --> Payments`.

Then, return to the **payments** list view, select the payments needing to be batched, and click
:guilabel:`Create Batch`.

In the **batch payment** window, fill in the following fields:

- :guilabel:`EFT file format`
- :guilabel:`Payment Reference`
- :guilabel:`Payment Particulars`

.. image:: new_zealand/batch_payment_view.png
   :alt: Batch Payement.

Then, click :guilabel:`Validate`. Odoo will generate the EFT file in the chatter. Click on the file
to preview or download it.

.. important::
   Each bank has its specific format requirements for EFT batch payments. Make sure to choose the
   correct EFT file format. Some banks may also require the completion of additional fields, such
   as :guilabel:`Direct Debit Information` and :guilabel:`Dishonour Account`.

.. seealso::
   :doc:`Batch paments by bank deposit documentation
   <../../../applications/finance/accounting/payments/batch>`

.. _localizations/new_zealand/XXXXXX:

Industry-specific features
==========================

.. _localizations/new_zealand/starshipit:

Starshipit shipping
-------------------

`Starshipit <https://starshipit.com/>`_ is a shipping service operator that facilitates the
integration of Australasian shipping couriers with Odoo.

.. seealso::
   - `Starshipit webinar recording <https://www.youtube.com/watch?v=TcDWnoYLXWg>`_
   - :doc:`Starshipit shipping <../../../applications/inventory_and_mrp/inventory/shipping_receiving/setup_configuration/starshipit_shipping>`

.. _localizations/new_zealand/buynow-paylater:

Buy Now, Pay Later solutions
----------------------------

**Buy Now, Pay Later** solutions are popular payment methods for e-shops. Some of these solutions
are available via the `Stripe <https://stripe.com/au/payments/payment-methods>`_ and
`AsiaPay payment <https://www.asiapay.com.au/payment.html#option>`_ providers.

.. seealso::
   - :doc:`AsiaPay Payment Provider documentation <../../../applications/finance/payment_providers/asiapay>`
   - :doc:`Stripe Payment Provider documentation <../../../applications/finance/payment_providers/stripe>`

.. _localizations/new_zealand/pos-terminals:

Point of Sale terminals
-----------------------

To have a direct connection between Odoo and a PoS terminal, a :doc:`Stripe terminal
<../../../applications/sales/point_of_sale/payment_methods/terminals/stripe>` is needed. Odoo
supports the **EFTPOS** payment solution.

.. note::
   A Stripe payment terminal is not needed to use Odoo as the main POS system. The only drawback
   of not using Stripe is that cashiers must manually enter the final payment amount on the
   terminal.

.. seealso::
   - :doc:`Stripe Payment Provider documentation <../../../applications/finance/payment_providers/stripe>`
   - `Stripe.com Dashboard <https://dashboard.stripe.com/login?redirect=%2Fdashboard>`_
   - `Stripe.com Docs: Terminal <https://docs.stripe.com/terminal>`_

.. _new-zealand/payroll:

Payroll
=======

.. _new-zealand/employment-hero:

Employment Hero integration
---------------------------

If your business is already up and running with `Employment Hero <https://employmenthero.com/>`_,
the connector can be used as an alternative payroll solution.

The Employment Hero module automatically synchronises payslip accounting entries (e.g., expenses,
social charges, liabilities, taxes) from **Employment Hero** to Odoo. Payroll administration is
still done in **Employment Hero**; only the **journal entries** are recorded in Odoo.

.. important::
   To :ref:`configure the Employment Hero API <employment_hero/configuration>` for **New Zealand**,
   use the following value as :guilabel:`Payroll URL`: `https://api.nzpayroll.co.nz/`.


==================================================
SECTION: oman.rst
PATH: applications/finance/fiscal_localizations/oman.rst
==================================================

====
Oman
====

.. _localizations/oman/modules:

Modules
=======

The following modules related to the Omani localization are available:

.. list-table::
   :header-rows: 1
   :widths: 25 25 50

   * - Name
     - Technical name
     - Description
   * - :guilabel:`Oman - Accounting`
     - `l10n_om`
     - Omani :ref:`fiscal localization package <fiscal_localizations/packages>`, complete with the
       local chart of accounts, taxes, tax report, and fiscal positions.
   * - :guilabel:`Oman - Accounting Reports`
     - `l10n_om_reports`
     - Accounting reports for Oman.

.. note::
   The module automatically installs core configurations. A manual :doc:`update
   </applications/general/apps_modules>` may be required for missing elements or updates.

.. _localizations/oman/loc-review:

Localization overview
=====================

The Omani localization package provides the necessary accounting setup for companies operating in
Oman, including a pre-configured chart of accounts, taxes, fiscal positions, and a standard tax
report format. It ensures alignment with Oman VAT regulations and Royal Decree requirements.

The Omani localization package provides the following key features to ensure compliance with local
fiscal and accounting regulations:

- :ref:`Chart of Accounts <localizations/oman/chart-of-accounts>`: based on Omani standards, with
  mapped account groups and default account mappings.
- :ref:`Taxes <localizations/oman/taxes>`: standard 5% VAT, zero-rated domestic as well as exports,
  exempt, imports, and reverse charge taxes.
- :doc:`Fiscal Positions <../accounting/taxes/fiscal_positions>`: automated tax adjustments based
  on customer or supplier registration status.
- :ref:`Tax Report <localizations/oman/tax-report>`: structured according to the Oman VAT return
  format, as issued by the Tax Authority.

.. _localizations/oman/chart-of-accounts:

Chart of accounts
-----------------

The Omani :doc:`chart of accounts <../accounting/get_started/chart_of_accounts>` is based on the
local rules and regulations. This includes pre-configured account groups and mapped default
accounts. Use the :ref:`predefined structure <chart-of-account/create>` or create new accounts, as
needed.

.. note::
   Accounts are grouped under relevant categories such as assets, liabilities, income, and expenses
   in line with local standards.

.. _localizations/oman/taxes:

Taxes
-----

The following :doc:`Taxes <../accounting/taxes>`, included in the Omani VAT system, are available by
default with the Omani localization package:

- Standard Rate 5%: Applies to the sale of most goods and services within Oman.
- Zero-Rated Supplies (0%): Applies to essential supplies where the seller can still reclaim input
  VAT.
- Exports (0%): Applies to the supply of goods and services that are exported outside Oman.
- Exempt Supplies: Applies to supplies that are not subject to VAT, and for which the supplier
  cannot reclaim input VAT on related purchases.
- Reverse Charge Mechanism (RCM): Applies to taxable businesses in Oman receiving services or goods
  from non-resident suppliers not registered for VAT in Oman.
- Import VAT (5%): Applies to the importation of most goods into Oman, charged at the customs
  point of entry.

.. _localizations/oman/tax-report:

Tax report
----------

The :ref:`VAT return <accounting/tax-returns/report>` provides a consolidated overview of the
taxable sales and purchases, VAT collected and paid, and the total amount owed or refundable for the
reporting period.

.. important::
   - The tax return aligns with official declarations required by `Oman's Tax Authority
     <https://tms.taxoman.gov.om/portal/web/taxportal/home>`_.
   - `VAT Taxpayer Guide
     <https://tms.taxoman.gov.om/portal/documents/20126/1414820/VAT+Taxpayer+Guide+-+VAT+Return+Filing.pdf/fae31d0c-e7e7-0014-9f28-a4c506b36614?t=1733169613409>`_.


==================================================
SECTION: peru.rst
PATH: applications/finance/fiscal_localizations/peru.rst
==================================================

====
Peru
====

.. |SUNAT| replace:: :abbr:`SUNAT (Superintendencia Nacional de Aduanas y de Administración
   Tributaria)`
.. |GRE| replace:: :abbr:`GRE (Guía de Remisión Electrónica)`
.. |RUS| replace:: :abbr:`RUS (Régimen Único Simplificado)`
.. |EDI| replace:: :abbr:`EDI (Electronic Data Interchange)`
.. |PLE| replace:: :abbr:`PLE (Programa de Libros Electrónico)`

Modules
=======

:ref:`Install <general/install>` the following modules to utilize all the current features of the
Peruvian localization.

.. list-table::
   :header-rows: 1

   * - Name
     - Technical name
     - Description
   * - :guilabel:`Peru - Accounting`
     - `l10n_pe`
     - Adds accounting features for the Peruvian localization, which represent the minimal
       configuration required for a company to operate in Peru and under the SUNAT regulations and
       guidelines. The main elements included in this module are the chart of accounts, taxes,
       document types.
   * - :guilabel:`Peru - E-invoicing`
     - `l10n_pe_edi`
     - Includes all technical and functional requirements to generate and receive electronic
       invoices online based on the SUNAT regulations.
   * - :guilabel:`Peru - Accounting Reports`
     - `l10n_pe_reports`
     - Includes the following financial reports:

       - 1st set of main financial reports:

         - Registro de Ventas e Ingresos (RVIE) - 14.4
         - Registro de Compras Electrónico (RCE) - 8.4
         - Registro de Compras Electrónico - Información de Operaciones con Sujetos no Domiciliados
           (RCE) - 8.5

       - 2nd set of financial reports:

         - PLE 5.1 General Journal
         - PLE 5.3 Chart of Accounts
         - PLE 6.1 General Ledger

       - 3rd set of financial reports:

         - PLE 1.1 Libro de Caja
         - PLE 1.2 Libro de Bancos

   * - :guilabel:`Peruvian - Electronic Delivery Note`
     - `l10n_pe_edi_stock`
     - Adds the delivery guide (Guía de Remisión), which is needed as proof that you are sending
       goods between A and B. It is only when a delivery order is validated that the delivery guide
       can be created.
   * - :guilabel:`Peru - Stock Reports`
     - `l10n_pe_reports_stock`
     - Enables the :ref:`PLE reports <peru/reports-ple>` for permanent inventory record in physical
       units and permanent valued inventory records.
   * - :guilabel:`Peruvian eCommerce`
     - `l10n_pe_website_sale`
     - Enables the identification type in eCommerce checkout forms and the ability to generate
       electronic invoices.
   * - :guilabel:`Peruvian - Point of Sale with PE Doc`
     - `l10n_pe_pos`
     - Enables contact fiscal information to be editable from a PoS Session to generate electronic
       invoices and refunds.

.. note::
   - Odoo automatically installs the appropriate package for the company according to the country
     selected at the creation of the database.
   - The *Peruvian - Electronic Delivery Guide* module depends on the *Inventory* application to be
     installed.

.. seealso::
   - `App Tour - Localización de Peru <https://youtu.be/Ic3mGovkf8Y>`_
   - `Smart Tutorial - Localización de Peru (videos for workflows and configurations)
     <https://www.odoo.com/slides/smart-tutorial-localizacion-de-peru-133>`_
   - :doc:`Documentation on e-invoicing's legality and compliance in Peru
     <../accounting/customer_invoices/electronic_invoicing/peru>`

Configuration
=============

Install the Peruvian localization modules
-----------------------------------------

Go to *Apps* and search for Peru, then click Install in the module Peru EDI. This module has a
dependency with *Peru - Accounting*. In case this last one is not installed, Odoo installs it
automatically within EDI.

.. image:: peru/peru-modules.png
   :alt: The "Module" filter is set on "Peru"

.. note::
   When you install a database from scratch selecting Peru as country, Odoo automatically
   installs the base module: Peru - Accounting.

Configure your company
~~~~~~~~~~~~~~~~~~~~~~

In addition to the basic information in the Company, we need to set Peru as the Country, this is
essential for the Electronic Invoice to work properly. The field **Address Type Code** represents
the establishment code assigned by the SUNAT when companies register their RUC (Unique Contributor
Registration):

.. image:: peru/peru-company.png
   :alt: Company data for Peru including RUC and Address type code.

.. tip::
   In case the Address type code is unknown,  you can set it as the default value: 0000. Be aware
   that if an incorrect value is entered, the Electronic invoice validation might have errors.

.. note::
   The NIF should be set following the RUC format.

Chart of Account
~~~~~~~~~~~~~~~~

The chart of accounts is installed by default as part of the set of data included in the
localization module, the accounts are mapped automatically in:

- Taxes
- Default Account Payable.
- Default Account Receivable

The chart of accounts for Peru is based on the most updated version of the :abbr:`PCGE (Plan
Contable General Empresarial)`, which is grouped in several categories and is compatible with NIIF
accounting.

.. _peru-accounting-settings:

Accounting Settings
-------------------

Once the modules are installed and the basic information of your company is set, you need to
configure the elements required for Electronic Invoice. For this, go to :menuselection:`Accounting
--> Settings --> Peruvian Localization`.

Basic Concepts
~~~~~~~~~~~~~~

Here are some terms that are essential on the Peruvian localization:

- **EDI**: Electronic Data Interchange, which in this refers to the Electronic Invoice.
- **SUNAT**: is the organization that enforces customs and taxation in Peru.
- **OSE**: Electronic Service Operator, `OSE SUNAT's definition
  <https://cpe.sunat.gob.pe/aliados/ose#:~:text=El%20Operador%20de%20Servicios%20Electr%C3%B3nicos%20(OSE)%20es%20qui%C3%A9n%20se%20encarga,otro%20documento%20que%20se%20emita>`_.
- **CDR**: Receipt certificate (Constancia de Recepción).
- **SOL Credentials**: Sunat Operaciones en Línea. User and password are provided by the SUNAT and
  grant access to Online Operations systems.

Signature Provider
~~~~~~~~~~~~~~~~~~

As part of  the requirements for Electronic Invoice in Peru, your company needs to select a
Signature Provider that will take care of the document signing process and manage the SUNAT
validation response. Odoo offers three options:

#. IAP (Odoo In-App Purchase)
#. Digiflow
#. SUNAT

Please refer to the sections below to check the details and considerations for each option.

IAP (Odoo In-App Purchase)
**************************

This is the default and the suggested option, considering the digital ceritificate is included as
part of the service.

.. image:: peru/peru-IAP.png
   :alt: IAP option as signature providers.

What is the IAP?
^^^^^^^^^^^^^^^^

This is a signature service offered directly by Odoo, the service takes care of the next process:

#. Provides the Electronic invoice Certificate, so you do not need to acquire one by yourself.
#. Send the document to the OSE, in this case, Digiflow.
#. Receive the OSE validation and CDR.

How does it work?
^^^^^^^^^^^^^^^^^

The service requires Credits in order to process your electronic documents. Odoo provides 1000
credits for free in new databases. After these credits are consumed, you need to buy a Credit
Package.

+---------+-----+
| Credits | EUR |
+=========+=====+
| 1000    | 22  |
+---------+-----+
| 5000    | 110 |
+---------+-----+
| 10,000  | 220 |
+---------+-----+
| 20,000  | 440 |
+---------+-----+

The credits are consumed per each document that is sent to the OSE.

.. important::
   If you have a validation error and the document needs to be sent one more time, one additional
   credit will be charged. Therefore, it is paramount that you verify all information is correct
   before sending your document to the OSE.

What do you need to do?
^^^^^^^^^^^^^^^^^^^^^^^

- In Odoo, once your enterprise contract is activated and you start working in Production, you
  need to buy credits once the first 1000 are consumed.
- As Digiflow is the OSE used in the IAP, you need to affiliate it as the official OSE for your
  company on the SUNAT website. This is a simple process. For more information, please check
  `OSE Affiliation guide
  <https://drive.google.com/file/d/1BkrMTZIiJyi5XI0lGMi3rbMzHddOL1pa/view?usp=sharing>`_.
- Register Digiflow as the authorized PSE, please check
  `PSE Affiliation guide
  <https://drive.google.com/file/d/1QZoqWvtQERpS0pqp6LcKmw7EBlm9EroU/view?usp=sharing>`_.

Digiflow
********

This option can be used as an alternative, instead of using the IAP services you can send your
document validation directly to Digiflow. In this case you need to consider:

- Buy your own digital Certificate: For more detail regarding the official vendor list, and the
  process to acquire it, please refer to `SUNAT Digital Ceritifcates
  <https://cpe.sunat.gob.pe/informacion_general/certificados_digitales/>`_.
- Sign a service agreement directly with `Digiflow <https://www.digiflow.pe/>`_.
- Provide your SOL credentials.

.. image:: peru/peru-Digiflow.png
   :alt: Digiflow.

SUNAT
*****

In case your company wants to sign directly with the SUNAT, it is possible to select this option
in your configuration. In this case you need to consider:
- Get the SUNAT Certification process accepted.

- Buy your own digital Certificate: For more detail regarding the official vendor list, and the
  process to acquire it, please refer to `SUNAT Digital Ceritifcates
  <https://cpe.sunat.gob.pe/informacion_general/certificados_digitales/>`_.

- Provide you SOL credentials.

.. important::
   When using direct connection with the SUNAT, the SOL User must be set with the Company RUT + User
   Id. Example: ``20121888549JOHNSMITH``

Testing environment
~~~~~~~~~~~~~~~~~~~

Odoo provides a testing environment that can be activated before your company goes into production.

When using the testing environment and the IAP signature, you don’t need to buy testing credits
for your transactions as all of them are validated by default.

.. tip::
   By default the databases are set to work on production, make sure to enable the testing mode
   if needed.

Certificate
~~~~~~~~~~~

In case you don’t use Odoo IAP, in order to generate the electronic invoice signature, a digital
certificate with the extension ``.pfx`` is required. Proceed to this section and load your file and
password.

.. image:: peru/peru-Certificate.png
   :alt: EDI Certificate wizard.

Multicurrency
~~~~~~~~~~~~~

The official currency exchange rate in Peru is provided by the SUNAT. Odoo can connect directly to
its services and get the currency rate either automatically or manually.

.. image:: peru/l10n-pe-banksync-sunat.png
   :alt: SUNAT displayed in Multicurrency Service option.

Please refer to the next section in our documentation for more information about
:doc:`multicurrencies <../accounting/get_started/multi_currency>`.

.. _peru-master_data:

Configure Master data
---------------------

Taxes
~~~~~

As part of the localization module the taxes are created automatically with their related
financial account and electronic invoice configuration.

.. image:: peru/peru-taxes.png
   :alt: List of default taxes.

EDI Configuration
*****************

As part of the taxes configuration, there are three new fields required for electronic invoice,
the taxes created by default have this data included, but in case you create new taxes make
sure you fill in the fields:

.. image:: peru/peru-taxes-edi.png
   :alt: Taxes EDI data for Peru.

Fiscal Positions
~~~~~~~~~~~~~~~~

There are two main fiscal positions included by default when you install the Peruvian localization.

**Extranjero - Exportación**: Set this fiscal position on customers for Exportation transactions.

**Local Peru**: Set this fiscal position on local customers.

Document Types
~~~~~~~~~~~~~~

In some Latin American countries, including Peru, some accounting transactions like invoices and
vendor bills are classified by document types, defined by the government fiscal authorities, in
this case by the SUNAT.

Each document type can have a unique sequence per journal where it is assigned. As part of the
localization, the Document Type includes the country on which the document is applicable;the data
is created automatically when the localization module is installed.

The information required for the document types is included by default so the user does not need
to fill anything on this view:

.. image:: peru/peru-document-type.png
   :alt: Document Type list.

.. warning::
   Currently the documents supported on customer invoices are: Invoice, Boleta, Debit Note and
   Credit Note.

Journals
~~~~~~~~

When creating Sales Journals, the following information must be filled, in addition to the standard
fields on the Journals:

Use Documents
*************

This field is used to define if the journal uses Document Types. It is only applicable to
Purchase and Sales journals, which are the ones that can be related to the different set of
document types available in Peru. By default, all the sales journals created use documents.

Electronic Data Interchange
***************************

This section indicates which EDI workflow is used in the invoice, for Peru we must select
“Peru UBL 2.1”.

.. image:: peru/peru-journal-edi.png
   :alt: Journal EDI field.

.. warning::
   By default, the value Factur-X (FR) is always displayed, make sure you can uncheck it manually.

Partner
~~~~~~~

Identification Type and VAT
***************************

As part of the Peruvian localization, the identification types defined by the SUNAT are now
available on the Partner form, this information is essential for most transactions either on
the sender company and in the customer, make sure you fill in this information in your records.

.. image:: peru/peru-id-type.png
   :alt: Partner identification type.

Product
~~~~~~~

Additional to the basic information in your products, for the Peruvian localization, the UNSPC
Code on the product is a required value to be configured.

.. image:: peru/peru-unspc-code.png
   :alt: UNSPC Code on products.

Usage and testing
=================

Customer invoice
----------------

EDI Elements
~~~~~~~~~~~~

Once you have configured your master data, the invoices can be created from your sales order or
manually. Additional to the basic invoice information described on :doc:`our page about the
invoicing process <../accounting/customer_invoices/overview>`, there are a couple of
fields required as part of the Peru EDI:

- **Document type**: The default value is “Factura Electronica” but  you can manually change the
  document type if needed and select Boleta for example.

  .. image:: peru/peru-invoice-document-type.png
     :alt: Invoice document type field on invoices.

- **Operation type**: This value is required for Electronic Invoice and indicates the transaction
  type, the default value is “Internal Sale” but another value can be selected manually when needed,
  for example Export of Goods.

  .. image:: peru/peru-operation-type.png
     :alt: Invoice operation type field on invoices.

- **EDI Affectation Reason**: In the invoice lines, additional to the Tax there is a field “EDI
  Affectation Reason” that determines the tax scope based on the SUNAT list that is displayed.
  All the taxes loaded by default are associated with a default EDI affection reason, if needed
  you can manually select another one when creating the invoice.

  .. image:: peru/peru-tax-affectation-reason.png
     :alt: Tax affectation reason in invoice line.

Invoice validation
~~~~~~~~~~~~~~~~~~

Once you check all the information in your invoice is correct, you can proceed to validate it. This
action registers the account move and triggers the Electronic invoice workflow to send it to the
OSE and the SUNAT. The following message is displayed at the top of the invoice:

.. image:: peru/peru-posted-invoice.png
   :alt: Sending of EDI Invoice in blue.

Asynchronous means that the document is not sent automatically after the invoice has been posted.

.. _peru-electronic-invoice-status:

Electronic Invoice Status
*************************

**To be Sent**: Indicates the document is ready to be sent to the OSE, this can be
done either automatically by Odoo with a *cron* that runs every hour, or the user can send it
immediately by clicking on the button “Sent now”.

.. image:: peru/peru-sent-manual.png
   :alt: Send EDI manually.

**Sent**: Indicates the document was sent to the OSE and was successfully validated. As part of
the validation a ZIP file is downloaded and a message is logged in the chatter indicating the
correct Government validation.

.. image:: peru/peru-invoice-sent.png
   :alt: Message on chatter when the invoice is valid.

In case there is a validation error the Electronic Invoice status remains in “To be sent” so the
corrections can be made and the invoice can be sent again.

.. warning::
   One credit is consumed each time that you send a document for validation, in this sense if an
   error is detected on an invoice and you send it one more time, two credits are consumed in
   total.

Common Errors
~~~~~~~~~~~~~

There are multiple reasons behind a rejection from the OSE or the SUNAT, when this happens Odoo
sends a message at the top of the invoice indicating the error details and in the most common
cases a hint to fix the issue.

If a validation error is received, you have two options:

- In case the error is related to master data on the partner, customer or taxes, you can simply
  apply the change on the record (example customer identification type) and once it is done click
  on the Retry button.
- If the error is related to some data recorded on the invoice directly (Operation type, missing
  data on the invoice lines), the correct solution is to reset the invoice to Draft, apply the
  changes, and then send the invoice again to the SUNAT for another validation.

  .. image:: peru/peru-errors.png
     :alt: List of common errors on invoices.

For more detail please refert to `Common errors in SUNAT
<https://www.nubefact.com/codigos-error-sunat/>`_.

Invoice PDF Report
~~~~~~~~~~~~~~~~~~

After the invoice is accepted and validated by the SUNAT, the invoice PDF report can be printed.
The report includes a QR code, indicating the invoice is a valid fiscal document.

.. image:: peru/peru-PDF.png
   :alt: Invoice PDF report.

IAP Credits
~~~~~~~~~~~

Odoo’s Electronic IAP offers 1000 credits for free, after these credits are consumed in your
production database, your company must buy new credits in order to process your transactions.

Once you run out of credits a red label is displayed at the top of the invoice indicating that
additional credits are required, you can easily buy them by accessing the link provided in
the message.

.. image:: peru/peru-credits-IAP.png
   :alt: Buying credits in the IAP.

In the IAP service includes packages with different pricing based on the number of credits.
The price list in the IAP is always displayed in EUR.

Special Use cases
~~~~~~~~~~~~~~~~~

Cancellation process
********************

Some scenarios require an invoice cancellation, for example, when an invoice was created by mistake.
If the invoice was already sent and validated by the SUNAT, the correct way to proceed is by
clicking on the button Request Cancellation:

.. image:: peru/peru-cancellation.png
   :alt: Request invoice cancellation button.

In order to cancel an invoice, please provide a cancellation Reason.

Electronic Invoice Status
^^^^^^^^^^^^^^^^^^^^^^^^^

**To Cancel**:  Indicates the cancellation request is ready to be sent to the OSE, this can be done
either automatically by Odoo with a *cron* that runs every hour, or the user can send it
immediately by clicking on the button “Send now”. Once it is sent, a cancellation ticket is
created, as a result the next message and CDR File are logged in the chatter:

.. image:: peru/peru-cancellation-cdr.png
   :alt: Cancellation CDR sent by the SUNAT.

**Cancelled**: Indicates the cancellation request was sent to the OSE and was successfully
validated. As part of the validation a ZIP file is downloaded and a message is logged in the
chatter indicating the correct Government validation.

.. image:: peru/peru-cancelled.png
   :alt: Invoice after cancellation.

.. warning::
   One credit is consumed on each cancellation request.

Export invoices
***************

When creating exportation invoices, take into account the next considerations:

- The Identification type on your customer must be Foreign ID.
- Operation type in your invoice must be an Exportation one.
- The taxes included in the invoice lines should be EXP taxes.

.. image:: peru/peru-exp-invoice.png
   :alt: Exportation invoices main data.

Advance Payments
****************

#. Create the advance payment Invoice and apply its related payment.
#. Create the final invoice without considering the advance payment.
#. Create a credit note for the Final invoice with the advance payment amount.
#. Reconcile the Credit note with the final invoice.
#. The remaining balance on the final invoice should be paid with a regular payment transaction.

Detraction Invoices
*******************

When creating invoices that is subject to Detractions, take into account the next considerations:

#. All the products included in the invoice must have these fields configured:

   .. image:: peru/peru-detraction.png
      :alt: Detraction fields on products.

#. Operation type in your invoice must be ``1001``

   .. image:: peru/peru-detraction-invoice.png
      :alt: Detraction code on invoices.

Credit Notes
------------

When a correction or refund is needed over a validated invoice, a credit note must be generated,
for this just click on the button “Add Credit Note”, a part of the Peruvian localization you need
to prove a Credit Reason selecting one of the options in the list.

.. image:: peru/peru-credit-note.png
   :alt: Add Credit Note from invoice.

.. tip::
   When creating your first credit Note, select the Credit Method: Partial Refund, this allows you
   to define the credit note sequence.

By default the Credit Note is set in the document type:

.. image:: peru/peru-credit-note-document.png
   :alt: Credit Note document type.

To finish the workflow please follow the instructions on :doc:`our page about Credit Notes
<../accounting/customer_invoices/credit_notes>`.

.. note::
   The EDI workflow for the Credit notes works in the same way as the invoices.

Debit Notes
-----------

As part of the Peruvian localization, besides creating credit notes from an existing document
you can also create debit Notes. For this just use the button “Add Debit Note”.

By default the Debit Note is set in the document type.

.. _peru-edg:

Electronic delivery guide 2.0
-----------------------------

The *Guía de Remisión Electrónica* (GRE) is an electronic document generated by the shipper to
support the transportation or transfer of goods from one place to another, such as a warehouse or
establishment. In Odoo, there are several configuration steps needed before you can successfully use
this feature.

The use of the *guía de remisión electrónica* electronic document is mandatory and required by
|SUNAT| for taxpayers who need to transfer their products, except those under the *Single Simplified
Regime* (régimen único simplificado or RUS).

Delivery guide types
~~~~~~~~~~~~~~~~~~~~

Sender
******

The *Sender* delivery guide type is issued when a sale is made, a service is rendered (including
processing), goods are assigned for use, or goods are transferred between premises of the same
company and others.

This delivery guide is issued by the owner of the goods (i.e., the sender) at the beginning of the
shipment. The sender delivery guide is supported in Odoo.

.. seealso::
   `SUNAT guía de remisión <https://www.gob.pe/7899-guia-de-remision>`_

Carrier
*******

The *Carrier* delivery guide type justifies the transportation service the driver (or carrier)
performs.

This delivery guide is issued by the carrier and must be issued to each shipper when the shipment
goes through public transport.

.. important::
   The carrier delivery guide is **not** supported in Odoo.

.. seealso::
   `SUNAT guía de remisión transportista
   <https://tefacturo.pe/blog/sunat/guia-de-remision-electronica/guia-de-remision-transportista/>`_

Transportation types
~~~~~~~~~~~~~~~~~~~~

Private
*******

The *Private* transportation type option is used when the owner transfers goods using their own
vehicles. In this case, a sender's delivery guide must be issued.

Public
******

The *Public* transportation type option is used when an external carrier moves the goods. In
this case, two delivery guides must be issued: the sender's delivery guide and the carrier's
delivery guide.

Direct submission to SUNAT
~~~~~~~~~~~~~~~~~~~~~~~~~~

The creation of the |GRE| delivery guide in Odoo **must** be sent directly to the |SUNAT|,
regardless of the electronic document provider: IAP, Digiflow, or |SUNAT|.

Required information
~~~~~~~~~~~~~~~~~~~~

Version 2.0 of the electronic delivery guide requires additional information on the general
configuration, vehicles, contacts, and products. In the general configuration, it is necessary to
add new credentials that you can retrieve from the |SUNAT| portal.

Cancellations
~~~~~~~~~~~~~

**Both** the sender and the carrier can cancel the electronic waybill as long as the following
conditions are met:

- The shipment has not been initiated.
- If the shipment has been initiated, the receiver **must** be changed before reaching the final
  destination.

.. important::
   The |SUNAT| no longer uses the term "Anula", but now uses the term "Dar de baja" for
   cancellations.

Testing
~~~~~~~

The |SUNAT| does not support a test environment. This means that any delivery guides that were
generated by mistake **will** be sent to the |SUNAT|.

If, by mistake, the waybill was created in this environment, it is necessary to delete it from the
|SUNAT| portal.

Configuration
~~~~~~~~~~~~~

.. important::
   - Electronic sender's |GRE| is currently the only supported type of waybill in Odoo.
   - The delivery guide is dependent on the Odoo *Inventory* app, the :guilabel:`l10n_pe_edi` and
     :guilabel:`l10n_pe` modules.
   - A second user **must** be added for the creation of electronic documents.

After following the steps to configure the :ref:`electronic invoicing <peru-accounting-settings>`
and the :ref:`master data <peru-master_data>`, :ref:`install <general/install>` the
:guilabel:`Peruvian - Electronic Delivery Note 2.0` module (`l10n_pe_edi_stock_20`).

Next, you need to retrieve the *client ID* and *client secret* from |SUNAT|. To do so, follow the
`manual de servicios web plataforma nueva GRE
<https://cpe.sunat.gob.pe/sites/default/files/inline-files/Manual_Servicios_GRE%20%281%29.pdf>`_.

.. note::
   In the |SUNAT| portal, it is important to have the correct access rights enabled, as they may
   differ from the user set for electronic invoicing.

These credentials should be used to configure the delivery guide general settings from
:menuselection:`Inventory --> Configuration --> Settings`, and scroll down to the :guilabel:`Peru
Delivery Guide` section.

Configure the following :guilabel:`Sunat Delivery Guide API` fields:

- :guilabel:`Guide Client ID`: the unique API *client ID* generated in the |SUNAT| portal
- :guilabel:`Guide Client Secret`: the unique API *client secret* generated in the |SUNAT| portal
- :guilabel:`Guide SOL User`: the RUC Number + SOL username
- :guilabel:`Guide SOL Password`: the SOL user password

.. image:: peru/gre-fields-example.png
   :alt: Example for the SUNAT Delivery Guide API section configuration.

.. note::
   It is required to follow the format `RUC + UsuarioSol` (e.g., `20557912879SOLUSER`) for the
   :guilabel:`Guide SOL User` field, depending on the user selected when generating the |GRE| API
   credentials in the |SUNAT| portal.

Operator
********

The *operator* is the vehicle's driver in cases where the delivery guide is through *private*
transport.

To create a new operator, navigate to :menuselection:`Contacts --> Create` and fill out the contact
information.

First, select :guilabel:`Individual` as the :guilabel:`Company Type`. Then, add the
:guilabel:`Operator License` in the :guilabel:`Accounting` tab of the contact form.

For the customer address, make sure the following fields are complete:

- :guilabel:`District`
- :guilabel:`Tax ID` (:guilabel:`DNI`/:guilabel:`RUC`)
- :guilabel:`Tax ID Number`

.. image:: peru/operator-configuration.png
   :alt: Individual type operator configurations in the Contact form.

Carrier
*******

The *carrier* is used when the delivery guide is through *public* transport.

To create a new carrier, navigate to :menuselection:`Contacts --> Create` and fill out the contact
information.

First, select :guilabel:`Company` as the :guilabel:`Company Type`. Then, add the :guilabel:`MTC
Registration Number`, :guilabel:`Authorization Issuing Entity`, and the :guilabel:`Authorization
Number`.

For the company address, make sure the following fields are complete:

- :guilabel:`District`
- :guilabel:`Tax ID` (:guilabel:`DNI`/:guilabel:`RUC`)
- :guilabel:`Tax ID Number`

.. image:: peru/company-operator-configuration.png
   :alt: Company type operator configurations in the Contact form.

Vehicles
********

To configure the available vehicles, navigate to :menuselection:`Inventory --> Configuration -->
Vehicles` and fill in the vehicle form with the information needed for the vehicle:

- :guilabel:`Vehicle Name`
- :guilabel:`License Plate`
- :guilabel:`Is M1 or L?`
- :guilabel:`Special Authorization Issuing Entity`
- :guilabel:`Authorization Number`
- :guilabel:`Default Operator`
- :guilabel:`Company`

.. important::
   It is important to check the :guilabel:`Is M1 or L?` checkbox if the vehicle has fewer than four
   wheels or fewer than eight seats.

.. image:: peru/vehicle-not-m1-or-l-pe.png
   :alt: Vehicle not selected as an M1 or L type with extra fields shown.

Products
********

To configure the available products, navigate to :menuselection:`Inventory --> Products` and open
the product to be configured.

Make sure that the applicable information in the product form is fully configured. The
:guilabel:`Partida Arancelaria` (Tariff Item) field needs to be completed.

Generating a GRE
~~~~~~~~~~~~~~~~

Once the delivery from inventory is created during the sales workflow, make sure you complete the
|GRE| fields on the top-right section of the transfer form for the fields:

- :guilabel:`Transport Type`
- :guilabel:`Reason for Transfer`
- :guilabel:`Departure start date`

It is also required to complete the :guilabel:`Vehicle` and :guilabel:`Operator` fields under the
:guilabel:`Guia de Remision PE` tab.

The delivery transfer has to be marked as *Done* for the :guilabel:`Generar Guia de Remision` button
to appear on the left menu of the transfer form.

.. image:: peru/generate-gre-transferview.png
   :alt: Generar Guia de Remision button on a transfer form in the Done stage.

Once the transfer form is correctly validated by |SUNAT|, the generated XML file becomes available
in the chatter. You can now print the delivery slip that shows the transfer details and the QR
code validated by |SUNAT|.

.. image:: peru/gre-delivery-slip.png
   :alt: Transfer details and QR code on generated delivery slip.

Common errors
~~~~~~~~~~~~~

- `Diferente prefijo para productos (T001 en algunos, T002 en otros)`

  At the moment, Odoo does not support the automation of prefixes for products. This can be done
  manually for each product output. This can also be done for non-storable products. However, keep
  in mind that there will be no traceability.
- `2325 - GrossWeightMeasure - El dato no cumple con el formato establecido "Hace falta el campo"
  "Peso"" en el producto`

  This error occurs when the weight on the product is set as `0.00`. To fix this, you need to cancel
  the waybill and recreate it. Make sure that you fix the weight on the product before creating the
  new waybill, or it will result in the same error.
- `JSONDecodeError: Expecting value: line 1 column 1 (char 0) when creating a Delivery Guide`

  This error is typically generated due to SOL user issues. Verify the user's connection with the
  |SUNAT|; the SOL user must be established with the company RUT + user ID. For example
  `2012188549JOHNSMITH`.
- `El número de documento relacionado al traslado de mercancía no cumple con el formato establecido:
  error: documento relacionado`

  The *Related Document Type* and *Related Document Number* fields only apply to invoices and
  receipts.
- `400 Client error: Bad Request for URL`

  This error is not solvable from Odoo; it is advised you reach out to the |SUNAT| and verify the
  user. It may be necessary to create a new user.

- `Invalid content was found starting with element 'cac:BuyerCustomerParty'`

  This error occurs when the transfer reason is set as *other*. Please select another option.
  Following to the official documentation of the |SUNAT|'s waybill guide, the transfer reasons *03
  (sale with shipment to third party)* or *12 (others)* does not work in Odoo, since you should not
  have an empty or blank customer.
- `Duda cliente: consumo de créditos IAP al usar GRE 2.0`

  For live clients using IAP, no credit is consumed (in theory) because it does not go through the
  OSE, i.e., these documents are directly sent to the |SUNAT|.
- `Errores con formato credenciales GRE 2.0 (traceback error)`

  Odoo currently throws an error with a traceback instead of a message that the credentials are not
  correctly configured in the database. If this occurs on your database, please verify your
  credentials.

eCommerce electronic invoicing
------------------------------

First, :ref:`install <general/install>` the **Peruvian eCommerce** (`l10n_pe_website_sale`) module.

The **Peruvian eCommerce** module enables the features and configurations to:

- allow clients to create online accounts for **eCommerce** purposes;
- support required fiscal fields in the **eCommerce** application;
- receive payments for sales orders online;
- generate electronic documents from the **eCommerce** application.

.. note::
   The **Peruvian eCommerce** module is dependent on the previous installation of the
   **Invoicing** or **Accounting** app, as well as the **Website** app.

.. _peru-ecommerce-configuration:

Configuration
~~~~~~~~~~~~~

After configuring the Peruvian :ref:`electronic invoicing <peru-accounting-settings>` flow, complete
the following configurations for the **eCommerce** flow:

- :ref:`Client account registration <ecommerce/customer_accounts/checkout-access>`;
- :ref:`Automatic invoice <handling/legal>`;
- :doc:`../../websites/ecommerce/products`: Set the :guilabel:`Invoicing Policy` to
  :guilabel:`Ordered quantities` and define the desired :guilabel:`Customer taxes`.
- :doc:`../payment_providers`;
- :doc:`../../websites/ecommerce/shipping`: For each shipping method, set
  the :guilabel:`Provider` field to :guilabel:`Fixed Price`. Then, set a :guilabel:`Fixed Price`
  amount greater than `0.00` (not zero), as the shipping method price is added to the invoice line.

.. note::
   - `Mercado Pago <https://www.mercadopago.com/>`_ is an online payment provider supported in Odoo
     that covers several countries, currencies, and payment methods in Latin America.
   - Make sure to define a :guilabel:`Sales Price` on the :guilabel:`Delivery Product` of the
     shipping method to prevent errors when validating the invoice with |SUNAT|.
   - To offer free delivery, manually remove the :guilabel:`Delivery Product`, or at least use
     `$0.01` (one cent) for the invoice to be validated with SUNAT.

.. seealso::
   :doc:`Set up the Mercado Pago payment provider. <../payment_providers/mercado_pago>`

Invoicing flow for eCommerce
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Once the :ref:`configurations <peru-ecommerce-configuration>` are all set, fiscal input fields will
be available during the checkout process for signed-in customers.

When customers enter their fiscal data at checkout and complete a successful purchase, the invoice
is generated with the corresponding |EDI| elements. The document type (Boleta/Factura) is selected
based on their tax ID (RUC/DNI). The invoice must then :ref:`be sent to the OSE and the SUNAT
<peru-electronic-invoice-status>`. By default, all published invoices are sent once a day through
a scheduled action, but you can also send each invoice manually if needed.

Once the invoice is validated with |SUNAT|, customers can download the .zip file with the CDR, XML,
and PDF files directly from the customer portal by clicking the :guilabel:`Download` button.

Reports
=======

.. _peru/reports-ple:

Permanent inventory reports: |PLE| 12.1 and |PLE| 13.1
------------------------------------------------------

Odoo can produce two permanent inventory reports as `.txt` files for Peruvian accounting: |PLE| 12.1
and |PLE| 13.1. All inventory transactions made need to be reported.

- |PLE| 12.1 **only tracks inventory in physical units**, focusing on the inflow and outflow of
  goods for effective management and planning.

- |PLE| 13.1 tracks **both physical quantities and monetary values of inventory**, providing a
  comprehensive view for tax and management purposes.

Both reports must be maintained semi-annually (January-June and July-December), with monthly
transaction details reported within these periods. The submission deadlines are October 1st for the
first semester and April 1st for the second semester, in accordance with the *Resolución de
Superintendencia N° 169-2015*.

Configuration
~~~~~~~~~~~~~

Before generating the |PLE| 12.1 or |PLE| 13.1 reports, make sure the :guilabel:`Peru - Stock
Reports` (`l10n_pe_reports_stock`) module is installed, then update the fields for:

- :ref:`Products <peru/reports-ple-products>`
- :ref:`Warehouses <peru/reports-ple-warehouses>`
- :ref:`Inventory transfers <peru/reports-ple-transfers>`

.. _peru/reports-ple-products:

Products
********

Several configurations related to the product or product category are necessary for |PLE| reporting:

- **Type of existence**: For all products needing |PLE| reporting, go to the product record's
  :guilabel:`Accounting` tab and select the :guilabel:`Type of Existence` according to |SUNAT|'s
  table 5 for inventory reporting.

- **Automatic inventory valuation**: For storable goods (:dfn:`products with tracked inventory`),
  use :doc:`automatic inventory valuation
  <../../inventory_and_mrp/inventory/inventory_valuation/cheat_sheet>`. Once automatic inventory
  valuation is enabled, this valuation method can be enabled for a product's product category.

- **Costing method:** Storable goods must use a :doc:`costing method
  <../../inventory_and_mrp/inventory/inventory_valuation/cheat_sheet>`
  **other** than :guilabel:`Standard Price`, as the journal entries generated from stock moves are
  used to populate the |PLE| reports.

.. _peru/reports-ple-warehouses:

Warehouses
**********

When :doc:`setting up a warehouse
<../../inventory_and_mrp/inventory/warehouses_storage/inventory_management/warehouses>`, the
:guilabel:`Annex Establishment Code` field must be filled. This code acts as a unique ID for each
warehouse and should only be a numeric combination, containing between 4 to 7 digits.

.. _peru/reports-ple-transfers:

Inventory transfers
*******************

Transferring inventory is a key process captured in the |PLE| 12.1 and |PLE| 13.1 reports.
:doc:`Inventory transfers <../../inventory_and_mrp/inventory/shipping_receiving/daily_operations>`
include both incoming and outgoing shipments.

When validating an inventory transfer (either on a warehouse receipt or delivery order), select the
:guilabel:`Type of Operation (PE)` performed according to |SUNAT|'s table 12 for permanent inventory
reporting.

Generate a .txt file for permanent inventory Kardex reports
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

|PLE| 12.1 and 13.1 come as two separate books. The books need to be downloaded in `.txt` file
format from Odoo, and then they should be submitted to the |SUNAT| |PLE| software.

On the :ref:`Inventory Valuation Report <inventory/product_management/valuation-report>`, click
the :guilabel:`PLE Reports` button. Then, select the :guilabel:`Period` and choose a report to
export: either the :guilabel:`PLE 12.1` or :guilabel:`PLE 13.1`. Odoo generates a `.txt` file
for the chosen report.

.. image:: peru/l10n-ple-export-button.png
   :alt: Export Buttons selection

.. note::
   Only a download of the report in `.txt` format is available. There is no preview or visualization
   available within Odoo.


==================================================
SECTION: philippines.rst
PATH: applications/finance/fiscal_localizations/philippines.rst
==================================================

===========
Philippines
===========

Configuration
=============

:ref:`Install <general/install>` the :guilabel:`🇵🇭 Philippines` :ref:`fiscal localization package
<fiscal_localizations/packages>` to get all the default accounting features of the Philippine
localization, such as a chart of accounts, taxes, and reports. These provide a base template to get
started with using Philippine accounting.

.. note::
  - When creating a new database and selecting the `Philippines` as a country, the fiscal
    localization module **Philippines - Accounting** is automatically installed.
  - If the module is installed in an existing company, the **chart of accounts** and **taxes** will
    *not* be replaced if there are already posted journal entries.

Chart of accounts and taxes
---------------------------

A minimum configuration default chart of accounts is installed, and the following types of taxes are
installed and linked to the relevant account:

- Sales and Purchase VAT 12%
- Sales and Purchase VAT Exempt
- Sales and Purchase VAT Zero-Rated
- Sales and Purchase Withholding

For the withholding taxes (:menuselection:`Accounting --> Configuration --> Taxes`), there is an
additional :guilabel:`Philippines ATC` field under the :guilabel:`Philippines` tab.

.. image:: philippines/philippines-atc-code.png
  :alt: Philippines ATC code field set on taxes.

.. note::
  Taxes' ATC codes are used for the :ref:`BIR 2307 <localizations/philippines/report-BIR1207>`,
  :ref:`SAWT and QAP reports <localizations/philippines/report-QAP-SAWT>`. If a tax is created
  manually, its ATC code must be added.

Contacts
--------

When a company or an individual (not belonging to a company) contact is located in the Philippines,
fill in the :guilabel:`Tax ID` field with their `Taxpayer Identification Number (TIN)`.

For individuals not belonging to a company, identify them by using the following additional fields:

- :guilabel:`First Name`
- :guilabel:`Middle Name`
- :guilabel:`Last Name`

.. note::
  For both :guilabel:`Company` and :guilabel:`Individual`, the TIN should follow the
  `NNN-NNN-NNN-NNNNN` format. The branch code should follow the last digits of the TIN, or else it
  can be left as `00000`.

Reports
=======

.. _localizations/philippines/report-BIR1207:

BIR 2307 report
---------------

**BIR 2307** reports, also known as `Certificate of Creditable Tax Withheld at Source
<https://www.bir.gov.ph/bir-forms?tab=Certificates&idTag=BIR2307&datasetCode=3381&label=2307&type=TAB%20LINK>`_,
can be generated for purchase orders and vendor payments with the applicable withholding taxes.

To generate a BIR 2307 report, select one or multiple vendor bills from the list view, and click
:menuselection:`Action --> Download BIR 2307 XLS`.

.. image:: philippines/philippines-multi-bill.png
  :alt: Multiple vendor bills selected with action to "Download BIR 2307 XLS".

.. tip::
  The same action can be performed on a vendor bill from the form view.

In the pop-up that opens, review the selection and click :guilabel:`Generate`.

.. image:: philippines/philippines-generate.png
  :alt: Pop up menu to generate BIR 2307 XLS file.

This generates the `Form_2307.xls` file that lists all the vendor bill lines with the applicable
withholding tax.

The process above can also be used for a *single* vendor :doc:`payment <../accounting/payments>` if
it is linked to one or more :doc:`vendor bills <../accounting/payments>` with applied withholding
taxes.

.. note::
  - If no withholding tax is applied, then the XLS file will not generate records for those vendor
    bill lines.
  - When grouping payments for multiple bills, Odoo splits the payments based on the contact. From
    a payment, clicking :menuselection:`Action --> Download BIR 2307 XLS` generates a report that
    only includes vendor bills related to that contact.

.. important::
  Odoo cannot generate the BIR 2307 PDF report or DAT files directly. The generated
  :file:`Form_2307.xls` file can be exported to an *external* tool to convert it to BIR DAT or PDF
  format.

SLSP report
-----------

To access the :abbr:`SLSP (Summary List of Sales and Purchases)` report, go to
:menuselection:`Accounting --> Reporting --> Summary List of Sales and Purchases`.

Click the buttons at the top to display the desired report:

- | :guilabel:`Sales` for the :abbr:`SLS (Summary List of Sales)` report.
  | All customer invoices with the associated sales taxes applied are shown in this report.
- | :guilabel:`Purchases` for the :abbr:`SLP (Summary List of Purchases)` report.
  | All vendor bills with the associated purchase taxes applied are shown in this report.

.. image:: philippines/slsp.png
  :alt: SLSP Report

By default, both reports exclude journal entries containing partners without a TIN number set and
those with importation taxes set. To view or hide them, click :guilabel:`Options:` and select the
required filter:

- :guilabel:`Including Partners Without TIN`
- :guilabel:`Including Importations`

To export the :abbr:`SLSP (Summary List of Sales and Purchases)` report, click :guilabel:`Export
SLSP`.

.. important::
  Odoo cannot generate the DAT files directly. The :guilabel:`Export SLSP` and :guilabel:`XLSX`
  buttons are used to export an XLSX file, which can be processed using an *external* tool to
  convert it to the DAT format.

2550Q tax report
----------------

The tax report report is accessible by navigating to :menuselection:`Accounting --> Reporting -->
Statement Reports --> Tax Report --> 2550Q(PH)`. The form is based on the latest *2550Q
(Quarterly Value-Added Tax Return)* Jan. 2023 version.

.. image:: philippines/2550Q.png
  :alt: 2550Q Tax Report

.. tip::
  Most lines in the tax report are automatically computed based on the taxes. For more accurate
  reporting and filing of the tax report, manual journal entries can also be mapped to the tax
  report through preconfigured **Tax Grids** for each tax report line.

.. important::
  Odoo cannot generate the 2550Q BIR formatted PDF report directly. It should be used as a
  reference when externally filing the form manually or online.

.. _localizations/philippines/report-QAP-SAWT:

QAP & SAWT reports
------------------

To access the :abbr:`QAP (Quarterly Alphalist of Payees)` and :abbr:`SAWT (Summary Alphalist of
Withholding Tax)` reports, go to :menuselection:`Accounting --> Reporting --> Tax Return`, click
the :icon:`fa-book` :guilabel:`Report:` button, and select :guilabel:`SAWT & QAP (PH)`.

Click the buttons at the top to display the desired report:

- | :guilabel:`SAWT` for the :abbr:`SAWT (Summary Alphalist of Withholding Tax)` report.
  | All customer invoices with the associated sales witholding taxes applied are shown in this
   report.
- | :guilabel:`QAP` for the :abbr:`QAP (Quarterly Alphalist of Payees)` report.
  | All vendor bills with the associated purchase witholding taxes applied are shown in this report.

.. image:: philippines/philippines-sawt.png
  :alt: SAWT & QAP Report

To export the :abbr:`SAWT (Summary Alphalist of Withholding Tax)` and :abbr:`QAP (Quarterly
Alphalist of Payees)` reports in XLSX format, click :guilabel:`Export SAWT & QAP`.

.. important::
  Odoo cannot generate the DAT files directly. The :guilabel:`Export SAWT & QAP` and
  :guilabel:`XLSX` buttons are used to export an XLSX file, which can be processed using an
  *external* tool to convert it to the DAT format.

Check printing
==============

The Philippine check print layout follows the latest :abbr:`PCHC (Philippine Clearing House
Corporation)` standardized format. To enable check printing, go to :menuselection:`Accounting -->
Configuration --> Settings`, enable :guilabel:`Checks` and set the :guilabel:`Check Layout` to
`Print Check - PH`.

Checks are printed using the :doc:`standard workflow <../accounting/payments/pay_checks>`.


==================================================
SECTION: romania.rst
PATH: applications/finance/fiscal_localizations/romania.rst
==================================================

=======
Romania
=======

Configuration
=============

:ref:`Install <general/install>` the following modules to get all the features of the Romanian
localization.

.. list-table::
   :header-rows: 1

   * - Name
     - Technical name
     - Description
   * - :guilabel:`Romania - Accounting`
     - `l10n_ro`
     - Default :ref:`fiscal localization package <fiscal_localizations/packages>`.
   * - :guilabel:`Romanian SAF-T Export`
     - `l10n_ro_saft`
     - Module to generate the **D.406 declaration** in the SAF-T format.

.. image:: romania/romania-modules.png
   :alt: Modules for the Romanian localization

.. seealso::
   :doc:`Documentation on e-invoicing’s legality and compliance in Romania
   <../accounting/customer_invoices/electronic_invoicing/romania>`

D.406 declaration
=================

Starting January 1, 2023, companies registered for tax purposes in Romania must report their
accounting data to the Romanian Tax Agency monthly or quarterly in the D.406 declaration.

Odoo provides all you need to export the data of this declaration in the SAF-T XML format, which you
can validate and sign using the software provided by the Romanian Tax Agency.

.. note::
   Currently, Odoo only supports the generation of the monthly/quarterly D.406 declaration
   (containing journal entries, invoices, vendor bills, and payments). The yearly declaration
   (including assets) and the on-demand declaration (including inventory) are not yet supported.

Configuration
-------------

Company
~~~~~~~

- Under :guilabel:`Settings --> General Settings`, in the **Companies** section, click
  :guilabel:`Update Info` and fill in the company's :guilabel:`Country`, :guilabel:`City`, and
  :guilabel:`Telephone Number`.
- Provide your company's :abbr:`CUI (Codul Unic de Inregistrare)` number or :abbr:`CIF (*Codul de
  identificare fiscală*)` number (for foreign companies) in the :guilabel:`Company ID` field,
  without the `RO` prefix (e.g., `18547290`).
- If your company is **registered** for VAT in Romania, fill in the :guilabel:`Tax ID` field number,
  including the `RO` prefix (e.g., `RO18547290`). If the company is **not** registered for
  VAT in Romania, you **must not** fill in the :guilabel:`Tax ID` field.
- Open the **Contacts** app and search for your company. Open your company's profile, and in the
  :guilabel:`Accounting` tab, click :guilabel:`Add a line` and add your **bank account number** if
  not informed already. Make sure the profile is set as :guilabel:`Company` above the **name**.

  - You must have at least one **contact person** linked to your company in the **Contacts** app.
    If no **contact person** is linked, create a new one by clicking :guilabel:`New`, set it
    as :guilabel:`Individual`, and select your company in the :guilabel:`Company name` field.

Chart of accounts
~~~~~~~~~~~~~~~~~

To generate a file receivable by the Romanian Tax Agency, the chart of accounts must not deviate
from an official chart of accounts, such as:

- the chart of accounts for commercial companies (*PlanConturiBalSocCom*), which is installed
  by default when creating a company with the Romanian localization or;
- the chart of accounts for companies following `IFRS <https://www.ifrs.org/>`_ (*PlanConturiIFRS*).

Under :guilabel:`Settings --> Accounting`, in the **Romanian localization** section, set the
:guilabel:`Tax Accounting Basis` to reflect the accounting regulations and Chart of Accounts used
by the company.

.. seealso::
   :doc:`../accounting/get_started/chart_of_accounts`

Customer and supplier
~~~~~~~~~~~~~~~~~~~~~

Fill in the :guilabel:`Country`, :guilabel:`City`, and :guilabel:`Zip Code` of each partner that
appears in your invoices, vendor bills, or payments through the **Contacts** app.

For partners that are companies, you must fill in the VAT number (including the country  prefix) in
the :guilabel:`Tax ID` field. If the partner is a company based in Romania, you may instead fill in
the CUI number (without the 'RO' prefix) in the :guilabel:`Company ID` field.

Tax
~~~

You must indicate the :guilabel:`Romanian SAF-T Tax Type` (3-digit number) and :guilabel:`Romanian
SAF-T Tax Code` (6-digit number) on each of the taxes you use. This is already done for the taxes
that exist by default in Odoo. To do so, go to :menuselection:`Accounting --> Configuration -->
Taxes`, select the tax you wish to modify, click the :guilabel:`Advanced Options` tab, and fill in
the **tax type** and **tax code** fields.

.. note::
   The **tax type** and **tax code** are codes defined by the Romanian Tax Agency for the **D.406
   declaration**. These can be found in the Excel spreadsheet published as guidance for completing
   the declaration, which you can find on the `website of the Romanian Tax Agency <https://www.anaf.ro/anaf/internet/ANAF/despre_anaf/strategii_anaf/proiecte_digitalizare/saf_t/>`_.

.. seealso::
   :doc:`../accounting/taxes`

Product
~~~~~~~

For some types of goods transactions, the :guilabel:`Intrastat Code` (Cod NC) must be configured
on the product, as it is required by Romanian law:

- import / export transactions;
- acquisitions / supplies of food products subjected to reduced VAT rate;
- intra-community movements subjected to intrastat reporting;
- acquisitions / supplies subjected to local reversed VAT charge (depending on Cod NC); and
- transactions with excisable products for which excise duties are determined based on the Cod NC.

If the Intrastat Code is not specified on a non-service product, the default code '0' will be used.

To configure the :guilabel:`Intrastat Codes`, go to
:menuselection:`Accounting --> Customers --> Products`, select a product, and in the
:guilabel:`Accounting` tab, set a :guilabel:`Commodity Code`.

.. seealso::
   :doc:`../accounting/reporting/intrastat`

Vendor bill
~~~~~~~~~~~

You must check the :guilabel:`Is self-invoice (RO)?` checkbox in the :guilabel:`Other Info` tab for
any vendor bill that is a self-invoice (i.e. a vendor bill that you issued yourself in the absence
of an invoice document received from a supplier).

Generating the declaration
--------------------------

Exporting your data
~~~~~~~~~~~~~~~~~~~

To export the XML for the D.406 declaration, go to :menuselection:`Accounting --> Reports -->
General Ledger` and click on :guilabel:`SAF-T`.

.. image:: romania/romania-saft-button.png
   :align: center
   :alt: Click on the 'SAF-T' button to export the D.406 XML declaration.

You can then validate and sign the XML file using the Romanian Tax Agency's validation software,
*DUKIntegrator*.

Signing the report
~~~~~~~~~~~~~~~~~~

Download and install the *DUKIntegrator* validation software found on the `website of the Romanian
Tax Agency <https://www.anaf.ro/anaf/internet/ANAF/despre_anaf/strategii_anaf/proiecte_digitalizare/saf_t/>`_.

Once you have generated the XML, open 'DUKIntegrator' and select the file you have just generated.

Click on :guilabel:`Validare + creare PDF` to create an **unsigned** PDF containing your report, or
:guilabel:`Validare + creare PDF semnat` to create a **signed** PDF containing your report.

.. image:: romania/romania-dukintegrator.png
   :align: center
   :alt: The DUKIntegrator validation software.

If the *DUKIntegrator* validator detects errors or inconsistencies in your data, it generates a file
that explains the errors. In this case, you need to correct those inconsistencies in your data
before you can submit the report to the Romanian Tax Agency.


==================================================
SECTION: saudi_arabia.rst
PATH: applications/finance/fiscal_localizations/saudi_arabia.rst
==================================================

============
Saudi Arabia
============

.. _localizations/saudi-arabia/modules:

Modules
=======

The following modules related to the Saudi Arabian localization are available:

.. list-table::
   :header-rows: 1
   :stub-columns: 1

   * - Name
     - Technical name
     - Description
   * - Saudi Arabia - Accounting
     - `l10n_sa`
     - Default :ref:`fiscal localization package <fiscal_localizations/packages>` for Saudi Arabia
       with Phase 1 QR code support.
   * - Saudi Arabia - Accounting Reports
     - `l10n_sa_reports`
     - Accounting reports for Saudi Arabia
   * - Saudi Arabia - E-invoicing
     - `l10n_sa_edi`
     - Enables ZATCA Phase 2 API integration for e-invoicing compliance.
   * - Saudi Arabia - E-invoicing (Simplified)
     - `l10n_sa_edi_pos`
     - Enables e-invoicing through PoS.
   * - Saudi Arabia - Point of Sale
     - `l10n_sa_pos`
     - Adds compliance fields and behavior for PoS invoices.
   * - Saudi Arabia - Withholding Tax
     - `l10n_sa_withholding_tax`
     - Forces the installation of the Withholding Tax on Payment module.

.. note::
   The localization's core modules are installed automatically with the localization. The rest can
   be manually :doc:`installed </applications/general/apps_modules>`.

.. seealso::
   :doc:`Saudi Arabia Payroll localization documentation <../../hr/payroll/payroll_localizations/saudi_arabia>`

.. _localizations/saudi-arabia/loc-review:

Localization overview
=====================

The Saudi Arabian localization package ensures compliance with Saudi Arabian fiscal and accounting
regulations. It includes tools for managing taxes, fiscal positions, reporting, and a predefined
chart of accounts tailored to Saudi Arabia's standards.

The Saudi Arabian localization package provides the following key features to ensure compliance with
local fiscal and accounting regulations:

- :doc:`../accounting/get_started/chart_of_accounts`: a predefined structure aligned with Saudi
  Arabian regulations
- :ref:`localizations/saudi-arabia/taxes`: preconfigured tax rates, including standard 15% VAT,
  zero-rated, and exempt options
- :doc:`../accounting/taxes/fiscal_positions`: automated tax adjustments based on customer or
  supplier registration status
- :ref:`Withholding taxes <localizations/saudi-arabia/withholding-taxes>`: predefined withholding
  tax rules for applicable service categories
- :ref:`localizations/saudi-arabia/tax-reporting`: automated tax reports
- :ref:`E-invoicing (ZATCA) <localizations/saudi-arabia/zatca>`: integration for electronic
  invoicing in line with Saudi Arabian government requirements

.. _localizations/saudi-arabia/taxes:

Taxes
-----

The Saudi Arabian localization includes preconfigured sales, purchase, and withholding :doc:`taxes
<../accounting/taxes>`:

- | Standard VAT (15%): The prevailing rate applied to the majority of goods and services supplied
    within the Kingdom.
  | The supplier charges 15% VAT on the sale (Output VAT) and is generally entitled to deduct the
    VAT paid on its business purchases (Input VAT).

  .. example::
     Most commercial sales, retail goods, telecommunication services, non-exempt private education,
     and non-exempt private healthcare.

- | Zero-rated VAT (0%): These are taxable supplies where the rate of tax applied is 0%.
  | The supplier charges no VAT on the sale, but, critically, is fully entitled to recover the input
    VAT paid on costs related to making those supplies.

  .. example::
     - Exports: Supplies of goods and services to a non-:abbr:`GCC (Gulf Cooperation Council)`
       resident or for consumption outside the Kingdom.
     - International transport: Services for the international transport of passengers and goods,
       and related services.
     - Specific goods: Supplies of qualifying medicines and qualifying medical equipment, as
       specified by ZATCA/Ministry of Health.
     - Residential property: First supply of a new residential building/property to a Saudi citizen,
       up to a value of SAR 1,000,000 (subject to specific conditions).
     - Investment metals: Qualifying gold, silver, and platinum of 99% purity or higher (supplied
       for investment).

- | Exempt transactions: These transactions fall outside the scope of VAT, meaning they are not
    subject to the tax.
  | The supplier does not charge any VAT on the sale and is not entitled to recover the input VAT
    paid on costs related to making these supplies (resulting in an unrecoverable cost).

  .. example::
     - Financial services: interest on loans, provision of credit, operations of
       current/deposit/savings accounts, issuance or transfer of money or securities, and life
       insurance.
     - Real estate: bare rental (leasing) of residential property.

- | Import VAT: VAT is levied on goods brought into the Kingdom from a non-:abbr:`GCC (Gulf
    Cooperation Council)` country.
  | VAT is typically calculated at the standard rate (15%) and is paid to the Customs Authority at
    the point of importation.

.. important::
   When assigning :doc:`discounts <../../sales/sales/products_prices/prices/discounts>` to invoices,
   assign a 15% tax on the line containing a global discount to comply with ZATCA rules.

Reverse charge mechanism (RCM)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- Description: Mechanism that shifts the responsibility for accounting for VAT from the non-resident
  supplier to the resident recipient of the goods or services.
- Mechanism: The VAT-registered recipient must calculate and account for the VAT (as both output VAT
  and input VAT) in their :ref:`VAT return <accounting/tax-returns/vat-report>`. This typically
  results in a net zero effect on the VAT return, provided the input tax is fully deductible.
- Application: Primarily used for B2B supplies of services from a non-resident supplier to a
  VAT-registered business in Saudi Arabia.

.. _localizations/saudi-arabia/withholding-taxes:

Withholding taxes
-----------------

There are two available methods for calculating withholding tax: gross and deducted.

- Gross withholding: This is the primary configuration, where the withholding amount is calculated
  in addition to the bill total. For example, if the total bill is entered as 115 SAR, the system
  calculates the base plus Withholding Tax (WHT) without reducing the payment amount.
- Deducted withholding: It reduces the payable amount by the withholding amount directly, meaning
  the total payment reflects the deduction upfront. This affects how the accounting entries and
  payable lines are booked, as seen in the comparison screenshots provided.

.. note::
   Deducted withholding taxes are not enabled by default. To activate it, go to Accounting -->
   Configuration --> Taxes and enable the relevant withholding tax.

The following Withholding Tax (WHT) configurations are preloaded and available for use:

- 5% Withholding Tax: Applied on payments for rent, dividends, technical and consulting services,
  air and maritime freight, as well as interest, insurance, and reinsurance premiums.
- 15% Withholding Tax: Applies to royalties and other general service payments made to
  non-residents.
- 20% Withholding Tax: Reserved for management fees and specific high-value service payments.

.. _localizations/saudi-arabia/tax-reporting:

Tax reporting
-------------

The :ref:`VAT and Withholding Return <accounting/tax-returns/vat-report>` provide a detailed
breakdown of taxable, zero-rated, exempt, and withholding transactions. Like other financial
reports, the :guilabel:`VAT` and :guilabel:`Withholding Return` can be filtered by period, compared
against other periods, and exported in Excel and PDF formats, ensuring compliance with Saudi Arabia
tax laws.

.. _localizations/saudi-arabia/company-contacts:

Company and contacts
====================

To ensure proper integration with :ref:`ZATCA <localizations/saudi-arabia/zatca>`, the following
fields are required on the :ref:`company record <general/companies/company>`:

- :guilabel:`Company Name` (must match exactly VAT certificate)
- All relevant :guilabel:`Address` fields, including the :guilabel:`District`, :guilabel:`Building
  Number`, and :guilabel:`Plot Identification`
- :guilabel:`Identification Scheme`

  - :guilabel:`Tax Identification Number`
  - :guilabel:`Commercial Registration Number`
  - :guilabel:`Momra License`
  - :guilabel:`MLSD License`
  - :guilabel:`700 Number`
  - :guilabel:`Sagia License`

- :guilabel:`VAT Number`
- :guilabel:`Currency` must be set to :guilabel:`SAR`.

.. important::
   All fields must be completed accurately to avoid rejection during :ref:`ZATCA onboarding
   <localizations/saudi-arabia/zatca>`.

.. note::
   The same configuration applies to all relevant :doc:`contact <../../essentials/contacts>` forms.

.. _localizations/saudi-arabia/branches:

Branches configuration
----------------------

Set up your company :ref:`branches <general/branches>` in compliance with :ref:`ZATCA rules
<localizations/saudi-arabia/company-contacts>`.

.. important::
   On the branch contact form, enter the same :guilabel:`VAT Number` as the parent company and enter
   the branch :guilabel:`Commercial Registration Number (CRN)` in the :guilabel:`Identification
   Scheme` field.

.. note::
   Either use the parent company’s sales journal to follow a centralized billing system model, or
   onboard a new branch-specific journal to set up a multi-threaded system with parallel invoice
   processing.

.. _localizations/saudi-arabia/invoicing-language:

Invoicing language
==================

Invoices can be issued in different languages to meet regional or customer-specific requirements at
two levels:

- Customer level: To assign a preferred language to a customer, go to :menuselection:`Accounting -->
  Customers --> Customers` or :menuselection:`Point of Sale --> Orders --> Customers`, and open the
  relevant customer form.  In the :guilabel:`Language` field, update the language. All documents are
  then automatically generated in the selected language for that customer.

  .. important::
     Saudi Arabia's VAT regulations require :guilabel:`Tax Invoices` and :guilabel:`Simplified Tax
     Invoices` (along with corresponding credit notes or debit notes) to be in Arabic, mandatorily.
     Invoices can be bilingual, including English.

- Company level: To add Arabic as a secondary language to meet Saudi Arabia VAT regulations:

  - For :guilabel:`Tax Invoices`: Go to :menuselection:`Accounting --> Configuration --> Settings`,
    in the :guilabel:`Fiscal Localization` section.
  - For Point of Sale receipts: Go to :menuselection:`Point of Sale --> Configuration --> Settings`,
    and navigate to the :guilabel:`Bills & Receipts` section.

  Then, enable the :guilabel:`Gulf Cooperation Council Format` option, and :guilabel:`Save`.

.. _localizations/saudi-arabia/zatca:

Electronic invoicing with ZATCA
===============================

The ZATCA e-invoicing system is designed to streamline and digitize the invoicing process for
businesses operating in Saudi Arabia.

ZATCA Phase 2 employs a clearance e-invoicing model for Business-to-Business (B2B) transactions.
Conversely, for Business-to-Consumer (B2C) transactions, Odoo generates a QR code and
subsequently reports these transactions to the Fatoora reporting endpoint.

In a B2B scenario, a :guilabel:`Tax Invoice` is issued, whereas in a B2C scenario, a
:guilabel:`Simplified Tax Invoice` is generated.

.. seealso::
   `ZATCA e-invoicing page <https://zatca.gov.sa/en/E-Invoicing/Pages/default.aspx>`_

.. _localizations/saudi-arabia/step-by-step:

Step-by-step process
--------------------

When onboarding to ZATCA (Phase 2), there are three modes:

- :ref:`Sandbox <localizations/saudi-arabia/sandbox>`: Common pre-configured testing environment;
  use it to simulate integration functionality out of the box.
- :ref:`Simulation (Pre-Production) <localizations/saudi-arabia/simulation>`: User-specific testing
  environment; use it to simulate your unique integration.
- :ref:`Production <localizations/saudi-arabia/production>`: Live environment

.. _localizations/saudi-arabia/sandbox:

Sandbox
~~~~~~~

.. Tip::
   Use VAT Number 399999999900003 on your company setup for sandbox testing.

#. | Set the database
   | Go to :menuselection:`Accounting --> Configuration --> Settings` and, in the :guilabel:`Saudi
     Arabia Electronic Invoicing` section, ensure the :guilabel:`ZATCA API mode` is set to
     :guilabel:`Sandbox`.

#. | Company information verification
   | Make sure all :ref:`company <localizations/saudi-arabia/company-contacts>` information is
     complete.

#. Onboard sales journals

   - Go to :menuselection:`Accounting --> Configuration --> Journals`.
   - Open the :guilabel:`Sales` journal.
   - Under the ZATCA tab, click :icon:`fa-refresh` :guilabel:`Onboard`.
   - In the :guilabel:`Enter the OTP` window, the 6-digit :guilabel:`OTP` is pre-populated. Click
     :guilabel:`Confirm`.

#. Invoice testing

   - :ref:`Create <accounting/invoice/creation>` and :ref:`confirm
     <accounting/invoice/confirmation>` customer invoices.
   - Once the invoice is confirmed, a blue banner appears; click :guilabel:`Process now`.
   - Ensure the :ref:`response from the API <localizations/saudi-arabia/invoice-submission>` is
     :guilabel:`Action Successful`. If not, review the API response displayed in the chatter and
     take the appropriate actions.

.. _localizations/saudi-arabia/simulation:

Simulation (Pre-Production)
~~~~~~~~~~~~~~~~~~~~~~~~~~~

#. Set the database

   - Duplicate your Live/Production database.
   - Go to :menuselection:`Accounting --> Configuration --> Settings` and, in the :guilabel:`Saudi
     Arabia Electronic Invoicing` section, ensure the :guilabel:`ZATCA API mode` is set to
     :guilabel:`Simulation (Pre-Production)`.

#. | Company information verification
   | Make sure all :ref:`company <localizations/saudi-arabia/company-contacts>` information is
     complete.

#. Onboard sales journals

   - Go to :menuselection:`Accounting --> Configuration --> Journals`.
   - Open the :guilabel:`Sales` journal.
   - Under the ZATCA tab, click :icon:`fa-refresh` :guilabel:`Onboard`.
   - In the :guilabel:`Enter the OTP` window, enter the 6-digit :guilabel:`OTP` retrieved from the
     Fatoora Simulation Portal under the Testing Environment. Then click :guilabel:`Confirm`.

#. Invoice testing

   - :ref:`Create <accounting/invoice/creation>` and :ref:`confirm
     <accounting/invoice/confirmation>` customer invoices.
   - Once the invoice is confirmed, a blue banner appears; click :guilabel:`Process now`.
   - Ensure the :ref:`response from the API <localizations/saudi-arabia/invoice-submission>` is
     :guilabel:`Action Successful`. If not, review the API response displayed in the chatter and
     take the appropriate actions.

.. note::
   :guilabel:`Simulation (Pre-Production)` mode invoices are not legally valid.

.. _localizations/saudi-arabia/production:

Production
~~~~~~~~~~

#. | In your Live/Production database
   | Go to :menuselection:`Accounting --> Configuration --> Settings` and, in the :guilabel:`Saudi
     Arabia Electronic Invoicing` section, ensure the :guilabel:`ZATCA API mode` is set to
     :guilabel:`Production`.

#. | Company information verification
   | Make sure all :ref:`company <localizations/saudi-arabia/company-contacts>` information is
     complete.

#. Onboard sales journals

   - Go to :menuselection:`Accounting --> Configuration --> Journals`.
   - Open the :guilabel:`Sales` journal.
   - Under the ZATCA tab, click :icon:`fa-refresh` :guilabel:`Onboard`.
   - In the :guilabel:`Enter the OTP` window, enter the 6-digit :guilabel:`OTP` retrieved from the
     Fatoora Portal under the Production Environment. Then click :guilabel:`Confirm`.

#. Invoice synchronization

   - :ref:`Create <accounting/invoice/creation>` and :ref:`confirm
     <accounting/invoice/confirmation>` customer invoices.
   - Once the invoice is confirmed, a blue banner appears; click :guilabel:`Process now`.
   - Ensure the :ref:`response from the API <localizations/saudi-arabia/invoice-submission>` is
     :guilabel:`Action Successful`. If not, review the API response displayed in the chatter and
     take the appropriate actions.

.. note::
   Each :guilabel:`Sales` journal must be onboarded separately.

If a sales journal is no longer needed as a ZATCA solution unit, make sure to revoke it in your
Fatoora portal. To do so, click :guilabel:`View List of Solutions And Devices`, select the relevant
solution and device under :guilabel:`Revoke CSID`, then click :guilabel:`Revoke` and
:guilabel:`Confirm`.

.. warning::
   - Once the API mode is switched to :guilabel:`Production` and an invoice is submitted to ZATCA,
     it cannot be changed back to :guilabel:`Sandbox` or :guilabel:`Simulation (Pre-Production)`.
   - OTP’s generated from either the Fatoora Simulation or Production portal expire after 60 minutes
     and need to be regenerated.

.. _localizations/saudi-arabia/invoice-submission:

Invoice submission to ZATCA
---------------------------

After submitting the invoice to ZATCA, a structured response message is returned by the API in the
chatter.

.. example::
   [202] BR-KSA-F-13 : [BR-KSA-F-13] - Please recheck Other Seller/Buyer ID (BT-29 or BT-46) as it
   contains an invalid value.

Common codes that can be received:

.. list-table::
   :header-rows: 1

   * - Code
     - Action
   * - :guilabel:`200 – Action Successful`
     - No action required.
   * - :guilabel:`202 – Action Successful (with Warnings)`
     - - Share the warnings with the solution provider to correct them as soon as possible.
       - Warnings are temporarily accepted but may become rejections in the future.
       - Frequent warnings may trigger investigation, education, or auditing by ZATCA.
   * - :guilabel:`303 – Clearance Switched Off`
     - Submit the invoice through the reporting flow instead of clearance.
   * - :guilabel:`400 – Action Failed (Rejected)`
     - Review the detailed error message, correct the issue, and resubmit.
   * - :guilabel:`401 – Unauthorized`
     - - Check the authentication certificate and secret key.
       - Correct the credentials and resubmit.
   * - :guilabel:`413 – Payload Too Large (Invoice Not Received)`
     - Reduce the invoice payload size and resend.
   * - :guilabel:`429 – Too Many Requests (Invoice Not Received)`
     - Resend the invoice.
   * - :guilabel:`500 – Internal Server Error (Invoice Not Received)`
     - Resend the invoice.
   * - :guilabel:`503 – Service Unavailable (Invoice Not Received)`
     - Resend the invoice.
   * - :guilabel:`504 – Request Timed Out (Invoice Not Received)`
     - Resend the invoice.

The color of the message displayed in the chatter after an invoice is confirmed and submitted
indicates the following information:

- Green: invoice successfully accepted - The invoice is fully compliant and has been successfully
  validated by ZATCA.
- Yellow: invoice accepted with warnings - The invoice is legally valid but was accepted with a
  warning. The issue should be reviewed and corrected for future submissions.
- Red: invoice was rejected - The invoice was not accepted by ZATCA and is not legally valid. It
  must be corrected and resubmitted.

If the invoice is rejected, an error message is displayed in the invoice’s chatter. Correct the
underlying issue described in the message description in the invoice or company settings. Then, to
resubmit the invoice, click :guilabel:`Retry`.

.. important::
   - Invoices rejected by ZATCA remain in a :guilabel:`Rejected` state and are not considered
     legally valid.
   - In case of any incidents, technical errors, or emergency matters that prevent the generation of
     e-invoices/e-receipts, notify `ZATCA <https://zatca.gov.sa/en/E-Invoicing/FailureNotifications/Pages/VerifyTaxpayer.aspx>`_.
     Once the issue has been resolved, contact ZATCA again using the same communication channel. For
     specific failure scenarios, refer to the steps outlined in `ZATCA's guidelines (page 45)
     <https://zatca.gov.sa/en/E-Invoicing/Introduction/Guidelines/Documents/E-Invoicing_Detailed__Guideline.pdf>`_.

.. _localizations/saudi-arabia/qr-code-verification:

QR code verification
--------------------

To verify the QR Code on the invoice, scan it using the official `ZATCA app
<https://zatca.gov.sa/en/AboutUs/ZATCAApps/Pages/default.aspx>`_.

Once in the app, click :guilabel:`Services`. In the :guilabel:`E-Invoice Validation` section, click
:guilabel:`Start Service`. Then, begin scanning the invoices' QR codes.

.. note::
   - The QR verification output does not display a currency symbol. The invoice amount is always
     shown as a plain numeric value, irrespective of the currency used.
   - An invoice with a related contact (e.g., Invoicing Address) is sent to the clearance API (B2B).


.. _localizations/saudi-arabia/debit-and-credit-notes:

Debit and credit notes
----------------------

To create a :ref:`credit <accounting/credit_notes/issue-credit-note>` or :ref:`debit
<accounting/credit_notes/issue-debit-note>` note, include a ZATCA-approved reason from the
:guilabel:`ZATCA Reason` field in the :guilabel:`Credit`/:guilabel:`Debit` window, as required by
ZATCA regulations:

- Cancellation or suspension of the supplies after their occurrence, either wholly or partially.
- Essential change or amendment in the supply that results in a change to the VAT due.
- Amendment of the supply value that was pre-agreed between the supplier and the consumer.
- Goods or services refund.
- Change in the seller’s or buyer’s information.

.. tip::
   The :guilabel:`ZATCA Reason` field is also available in the credit/debit note :guilabel:`Other
   Info` tab.

.. note::
   Whenever the credit/debit note is unrelated/independent, fill in the sequential number of the
   original invoice(s) that the credit/debit note is related to in the :guilabel:`Customer
   Reference` field.

.. _localizations/saudi-arabia/advance-payments:

Down payments (advance payments)
--------------------------------

Handle :doc:`down payments (advance payments) <../../sales/sales/invoicing/invoicing_policy>` in
compliance with `ZATCA’s guidelines
<https://zatca.gov.sa/en/E-Invoicing/Introduction/Guidelines/Documents/E-Invoicing_Detailed__Guideline.pdf>`_.

.. _localizations/saudi-arabia/retention:

Retention
---------

Retention is an amount temporarily held by the customer, defined by the commercial contract, to
ensure the quality and completion of the work. It is usually a percentage of the invoice value
(e.g., 5-10%) and serves as security against future defects; it is ultimately paid back to the
contractor once the warranty period expires.

For ZATCA, the commonly applied rule is that VAT is calculated based on the full invoice amount,
even if the customer withholds a portion as retention. ZATCA advises taxpayers to first determine
the tax position, specifically whether the retention amount reduces the taxable amount or not. Tax
position depends on contractual terms.

The Odoo retention workflow ensures, through tax position, that the retention amount does not reduce
the taxable amount.

.. note::
   Any negative tax (e.g., -20%) configured with the :guilabel:`Is Retention` checkbox enabled has
   no impact on the UBL 2.1. It only applies when this retention tax is used in conjunction with a
   generic tax (e.g., 15%) on the invoice line and represents a percentage of that invoice line. For
   example, if a taxpayer wants to retain 20% of the invoiced goods, both the 15% tax and the -20%
   retention tax would be applied to the invoice line.

Within this same tax position, retention can also be applied at the invoice level as an separate
negative invoice line using a 0% (Not Subject to VAT) tax rate.

.. warning::
   - Using a negative tax with :guilabel:`Is Retention` enabled, along with a generic tax on the
     invoice line, usually indicates that VAT has been paid on the full taxable amount. Therefore,
     the final invoice for releasing the retention amount does not qualify as a :guilabel:`Tax
     Invoice` and should not be submitted to ZATCA.
   - The 0% (Not Subject to VAT) tax is already preconfigured according to ZATCA rules; do not
     modify it.

.. important::
   - When creating a new retention tax, create a :guilabel:`Retention` tax group and assign it to
     this newly created retention tax to comply with ZATCA rules.
   - To add the :guilabel:`Retention Amount` as a note on the invoice line, click :guilabel:`Add a
     note` to comply with ZATCA rules. For example - Retention Amount: `[retention amount] SAR`

.. _localizations/saudi-arabia/generated-documents:

Generated documents
-------------------

Once an invoice is submitted, a UBL 2.1 XML file is generated and sent to ZATCA API endpoints.
For auditability, this XML file is stored in the chatter. To display it, click the
:icon:`fa-paperclip` :guilabel:`(attachments)` icon.

Additionally, the invoice PDF generated when using :guilabel:`Send` is displayed in the chatter.
Both the XML and PDF files are permanently attached to the invoice and cannot be deleted to
ensure compliance with ZATCA regulations.

.. important::
   Successfully ZATCA-submitted invoices can only be reset to draft in :ref:`Sandbox
   <localizations/saudi-arabia/sandbox>` or :ref:`Simulation (Pre-Production)
   <localizations/saudi-arabia/simulation>` modes.

.. tip::
   To automatically generate a PDF/A-3 with the embedded UBL 2.1, click :guilabel:`Send`.

.. _localizations/saudi-arabia/pos:

Point of sale
=============

.. _localizations/saudi-arabia/pos-zatca-configuration:

ZATCA integration configuration
-------------------------------

.. note::
   Make sure the :guilabel:`Saudi Arabia - E-invoicing (Simplified) (l10n_sa_edi_pos)` module is
   :ref:`installed <general/install>`.

PoS orders must be properly reported in compliance with ZATCA Phase 2. To do so, follow these steps:

- Onboard the :guilabel:`Invoices` default journal in the :ref:`PoS settings
  <configuration/settings>`:

  - Go to :menuselection:`Point of Sale --> Configuration --> Settings`. In the yellow banner,
    select the relevant :guilabel:`Point of Sale`, then navigate to the :guilabel:`Accounting`
    section.
  - In the :guilabel:`Default Journals` section, find the :guilabel:`Invoices` field and click the
    :icon:`oi-arrow-right` :guilabel:`(right arrow)` to open the default :guilabel:`Sales` journal.
  - Under the ZATCA tab, click :icon:`fa-refresh` :guilabel:`Onboard`.
  - In the :guilabel:`Enter the OTP` window, enter the 6-digit :guilabel:`OTP` retrieved from the
    Fatoora Portal under the Production Environment. Then click :guilabel:`Confirm`.

- :ref:`Assign a customer <pos/customers>` to the order before finalizing the transaction.

These steps ensure that each receipt is processed as a compliant e-invoice and reported to the ZATCA
portal in real time. Once the receipt is generated, the Phase 2 QR code automatically appears on
both the printed receipt and the PDF.


==================================================
SECTION: singapore.rst
PATH: applications/finance/fiscal_localizations/singapore.rst
==================================================

=========
Singapore
=========

Add PayNow QR codes to invoices
===============================

PayNow is a payment service platform that allows customers to make instant domestic payments to
individuals and merchants in Singapore dollars via online and mobile banking.

Activate QR codes
-----------------

Go to :menuselection:`Accounting --> Configuration --> Settings`. Under the :guilabel:`Customer
Payments` section, activate the :guilabel:`QR Codes` feature.

PayNow bank account configuration
---------------------------------

Go to :menuselection:`Contacts --> Configuration --> Bank Accounts` and select the bank account to
activate PayNow. Set the :guilabel:`Proxy Type` and fill in the :guilabel:`Proxy Value` field
depending on the chosen type.

.. important::
   - The account holder's country must be set to `Singapore` on its contact form.
   - The account holder's city is mandatory.
   - You could also include the invoice number in the QR code by checking the :guilabel:`Include
     Reference` checkbox.

.. image:: singapore/sg-paynow-bank-setting.png
   :alt: PayNow bank account configuration

.. seealso::
   :doc:`../accounting/bank`

Bank journal configuration
--------------------------

Go to :menuselection:`Accounting --> Configuration --> Journals`, open the bank journal, then fill
out the :guilabel:`Account Number` and :guilabel:`Bank` under the :guilabel:`Journal Entries` tab.

.. image:: singapore/sg-bank-account-journal-setting.png
   :alt: Bank Account's journal configuration

Issue invoices with PayNow QR codes
-----------------------------------

When creating a new invoice, open the :guilabel:`Other Info` tab and set the :guilabel:`Payment
QR-code` option to *EMV Merchant-Presented QR-code*.

.. image:: singapore/sg-qr-code-invoice-setting.png
   :alt: Select EMV Merchant-Presented QR-code option

Ensure that the :guilabel:`Recipient Bank` is the one you configured, as Odoo uses this field to
generate the PayNow QR code.

.. _singapore/employment-hero:

Employment Hero payroll
=======================

If your business is already up and running with :doc:`Employment Hero
<../../hr/payroll/payroll_localizations/employment_hero>`, you can use our connector as an
alternative payroll solution.

.. important::
   To :ref:`configure the Employment Hero API <employment_hero/configuration>` for **Singapore**,
   use the following value as :guilabel:`Payroll URL`: `HTTPS://apisg.yourpayroll.io/`.



==================================================
SECTION: spain.rst
PATH: applications/finance/fiscal_localizations/spain.rst
==================================================

=====
Spain
=====

Configuration
=============

Install the 🇪🇸 **Spanish** :doc:`fiscal localization package <../fiscal_localizations>` to get all
the default accounting features of the Spanish localization.

Three **Spanish** localizations exist, each with its own pre-configured **PGCE** charts of accounts:

- Spain - SMEs (2008);
- Spain - Complete (2008);
- Spain - Non-profit entities (2008).

To select the one to use, go to :menuselection:`Accounting --> Configuration --> Settings` and
select a package in the :guilabel:`Fiscal Localization` section.

.. warning::
   You can only change the accounting package as long as you have not created any accounting entry.

.. seealso::
   - :doc:`Documentation on e-invoicing’s legality and compliance in Spain
     <../accounting/customer_invoices/electronic_invoicing/spain>`
   - :doc:`Documentation on e-invoicing’s legality and compliance in the Basque Country
     <../accounting/customer_invoices/electronic_invoicing/basque_country>`

Chart of accounts
=================

You can reach the **Chart of Accounts** by going to :menuselection:`Accounting --> Configuration -->
Accounting: Chart of Accounts`.

.. tip::
    When you create a new Odoo Online database, **Spain - SMEs (2008)** is installed by default.

Taxes
=====

Default Spain-specific taxes are created automatically when the
:guilabel:`Spanish - Accounting (PGCE 2008) (l10n_es)` module is installed, and tax reports are
available when installing the module :guilabel:`Spain - Accounting (PGCE 2008) (l10n_es_reports)`.
Each tax impacts the Spain-specific **tax reports (Modelo)**, available by going to
:menuselection:`Accounting --> Reporting --> Statements Reports: Tax Report`.

Reports
=======

Here is the list of Spanish-specific statement reports available:

- Balance Sheet;
- Profit & Loss;
- EC Sales List;
- Tax Report (Modelo 111);
- Tax Report (Modelo 115);
- Tax Report (Modelo 130);
- Tax Report (Modelo 303);
- Tax Report (Modelo 347);
- Tax Report (Modelo 349);
- Tax Report (Modelo 390).

You can access Spain-specific tax reports by clicking on the **book** icon when on a report and
selecting its Spain-specific version: :guilabel:`(ES)`.

.. image:: spain/modelo-reports.png
   :alt: Spain-specific tax reports.

Modelo 130
----------

Change the percentage
~~~~~~~~~~~~~~~~~~~~~

If you wish to change the percentage computation of the box :guilabel:`[04]` under the :guilabel:`I`
section and/or of the box :guilabel:`[09]` under the :guilabel:`II` section:

#. Activate the :ref:`developer mode <developer-mode>`, go to :menuselection:`Accounting -->
   Reporting --> Tax Report`, and select the report :guilabel:`Tax report (Modelo 130)`.
#. Click the :icon:`fa-cogs` (:guilabel:`cogs`) icon to the right of :guilabel:`Report: Tax Report
   (Mod 130) (ES)`.
#. Click the box you wish to change, and in the pop-up window, click on the :guilabel:`percentage`
   line. In the new pop-up window, change the value in the :guilabel:`Formula` field to the
   percentage you wish to apply.
   Repeat this action if you wish to modify the other box as well.

Report agriculture activity
~~~~~~~~~~~~~~~~~~~~~~~~~~~

If you wish to have any amount input in the :guilabel:`II` section (from boxes :guilabel:`[08]` to
:guilabel:`[11]`), you must change the **industry** of the corresponding contact to
:guilabel:`Agriculture`:

#. Go to the contact form (:menuselection:`Accounting --> Customers --> Customers`
   or :menuselection:`Accounting --> Vendors --> Vendors`, for example), and select a contact.
#. In the :guilabel:`Sales & Purchase` tab, set the :guilabel:`Industry` field to
   :guilabel:`Agriculture`.

Repeat this operation for all contacts related to the **agriculture** industry.


.. _localizations/spain/veri-factu:

Veri*Factu
==========

.. note::
   Producers of Veri*Factu billing systems must self-certify their compliance with the regulations.
   :download:`Download Odoo's "declaración responsable"<spain/declaracion_responsable.pdf>`

**Veri*Factu** is an e-Invoicing system used by the Spanish Tax Agency. It is mandatory for most
taxpayers in Spain, except for those who use the SII system or are under a regional tax regime
(i.e., TicketBai).

Odoo allows :ref:`invoices <localizations/spain/veri-factu-invoices>` and Point of Sale :ref:`orders
<localizations/spain/veri-factu-orders>` to be automatically sent to the tax authorities.

.. _localizations/spain/veri-factu-configuration:

Configuration
-------------

To enable **Veri\*Factu**, follow these steps:

#. Open the Settings app to make sure your company's :guilabel:`Country` and :guilabel:`Tax ID` are
   correctly set in the :ref:`Companies <general/companies/company>` section.
#. :ref:`Install <general/install>` the :guilabel:`Spain - Veri*Factu (l10n_es_edi_verifactu)`
   module.
#. Go to :menuselection:`Accounting --> Configuration --> Settings`, scroll to the
   :guilabel:`Veri\*Factu` section, check the :guilabel:`Enable Veri*Factu` option, and click
   :icon:`oi-arrow-right` :guilabel:`Manage certificates` to add a certificate.
#. In the :guilabel:`Certificates for Veri\*Factu` list view, click :guilabel:`New`.
#. Click :guilabel:`Upload your file`, then select a certificate file and enter the
   :guilabel:`Password` needed to open the certificate (if there is one).

.. note::
   - At least one certificate has to be uploaded.
   - By default Veri*Factu is in testing mode. The data is sent to test servers
     and is not considered official. When official data can be sent to the production servers, go to
     the :guilabel:`Veri\*Factu` section in the :guilabel:`Settings` and disable :guilabel:`Test
     Environment`.

.. _localizations/spain/veri-factu-invoices:

Invoices
--------

Once an :doc:`invoice <../../finance/accounting/customer_invoices>` is confirmed, it can be
:ref:`sent <accounting/invoice/sending>`. In the :guilabel:`Send` window, the Veri*Factu option is
available if Veri*Factu has been enabled.

Click :guilabel:`Send` to generate a JSON file containing the invoice details. This file is stored
as a Veri*Factu document. In the :guilabel:`Veri*Factu` tab, all corresponding documents are
listed by their creation date and current status.

.. tip::
   To download a JSON file, click on its document in the :guilabel:`Veri*Factu` tab. Then, in
   the :guilabel:`Open: Veri*Factu Documents` window, click the link in the :guilabel:`JSON` field.

.. note::
   - The document should be sent to the :abbr:`AEAT (Agencia Estatal de Administración Tributaria)`
     immediately. However, it may be delayed due to mandatory waiting periods between submissions
     required by the :abbr:`AEAT (Agencia Estatal de Administración Tributaria)`. In such cases,
     the document is automatically sent the next time a scheduled action runs.
   - A Veri\*Factu **QR code** appears on the invoice PDF. Scan this code to verify that the invoice
     has been received and recognized by the :abbr:`AEAT (Agencia Estatal de Administración
     Tributaria)`.

.. _localizations/spain/veri-factu-orders:

Point of sale orders
--------------------

Once an order has been :ref:`paid <pos/sell>`, a JSON file containing the order details is
generated. This file is stored as a Veri*Factu document.

Go to :menuselection:`Point of Sale --> Orders --> Orders`. In the :guilabel:`Orders` list view,
select the relevant order. In the :guilabel:`Veri*Factu` tab, all the corresponding documents are
listed by their creation date and current status.

.. tip::
   To download a JSON file, click on its document in the :guilabel:`Veri*Factu` tab. Then, in
   the :guilabel:`Open: Veri*Factu Documents` window, click the link in the :guilabel:`JSON` field.

.. note::
   - The document should be sent to the :abbr:`AEAT (Agencia Estatal de Administración Tributaria)`
     immediately. However, it may be delayed due to mandatory waiting periods between submissions
     required by the :abbr:`AEAT (Agencia Estatal de Administración Tributaria)`. In such cases,
     the document is automatically sent the next time a scheduled action runs.

If an invoice is generated for an order during the payment process, the Veri*Factu document is
:ref:`created and sent for the invoice <localizations/spain/veri-factu-invoices>` instead.

.. note::
   A Veri\*Factu **QR code** appears on the order receipt, even if an invoice is created for the
   order. Scan this code to verify that the invoice has been received and recognized by the
   :abbr:`AEAT (Agencia Estatal de Administración Tributaria)`

TicketBAI
=========

`Ticket BAI <https://www.gipuzkoa.eus/es/web/ogasuna/ticketbai>`_ or **TBAI** is an e-Invoicing
system used by the Basque government and its three provincial councils (Álava, Biscay, and
Gipuzkoa).

Odoo supports the **TicketBAI (TBAI)** electronic invoicing format for all three regions of the
**Basque Country**. To enable **TicketBAI**, set your company's :guilabel:`Country` and
:guilabel:`Tax ID` under :menuselection:`Settings --> General Settings` in the :guilabel:`Companies`
section.

Then, :ref:`install <general/install>` the module :guilabel:`Spain -TicketBAI (l10n_es_edi_TBAI)`,
go to :menuselection:`Accounting --> Configuration --> Settings`, and select a **region** in the
:guilabel:`Spain Localization` section's :guilabel:`Tax Agency for TBAI` field.

Once a region is selected, click :guilabel:`Manage certificates (SII/TicketBAI)`, then click
:guilabel:`New`, upload the certificate, and enter the password provided by the tax agency.

.. warning::
   If you are testing certificates, enable :guilabel:`Test Mode` in the
   :guilabel:`Spain Localization` section, which can be found under :guilabel:`Accounting` in
   the **Settings** app.

Use case
--------

Once an invoice has been :doc:`created <../../finance/accounting/customer_invoices>` and confirmed,
a TicketBAI **banner** appears at the top.

.. image:: spain/ticketbai-invoice.png
   :alt: TicketBAI banner at the top of the invoice once sent.

Odoo sends invoices through TicketBAI automatically every **24 hours**. However, you can click
:guilabel:`Process now` to send the invoice immediately.

When the invoice is **sent**, the status of the field :guilabel:`Electronic Invoice` changes to
:guilabel:`Sent`, and the XML file can be found in the **chatter**. Under the
:guilabel:`EDI Documents` tab, you can see the traceability of other generated documents related to
the invoice (e.g., if the invoice should also be sent through the **SII**, it will appear here).

.. note::
   The TBAI **QR code** is displayed on the invoice PDF.

   .. image:: spain/qr-code.png
      :alt: QR code of the TicketBAI on the invoice.

FACe
====

`FACe <https://face.gob.es/en>`_ is the e-Invoicing platform used by the public administrations in
Spain to send electronic invoices.

Before configuring the :abbr:`FACe (General Entrance for Electronic Invoices)` system,
:ref:`install <general/install>` the :guilabel:`Spain - Facturae EDI (l10n_es_edi_facturae)` module
and other **Facturae EDI**-related modules.

To configure FACe, follow these steps:

#. Go to :menuselection:`Accounting --> Configuration --> Certificates`.
#. Click :guilabel:`New` to create a new certificate.
#. Complete the fields, including uploading the file of the :guilabel:`Certificate` provided by the
   tax agency and the provided :guilabel:`Certificate Password`.

.. note::
   If using the Invoicing app instead of Accounting, go to :menuselection:`Invoicing -->
   Configuration --> Certificates`.

Use case
--------

Once you have :doc:`created <../../finance/accounting/customer_invoices>` an invoice and confirmed
it, click :guilabel:`Send & Print`. Make sure :guilabel:`Generate Facturae edi file` is enabled, and
click :guilabel:`Send & Print` again. Once the invoice is sent, the generated XML file is available
in the **chatter**.

.. warning::
   The file is **NOT** automatically sent. You have to send it yourself manually.

.. tip::
   You can send **FACe** XML files in batch through `the governmental portal <https://www.facturae.gob.es/formato/Paginas/descarga-aplicacion-escritorio.aspx>`_.

Administrative centers
----------------------

In order for **FACe** to work with **administrative centers**, the invoice *must* include specific
data about the centers.

To add **administrative centers**, create a new **contact** to add to the **partner** company.
Select :guilabel:`FACe Center` as the **type**, assign one or more **role(s)** to that contact, and
:guilabel:`Save`. The **three** roles usually required are:

- Órgano gestor: :guilabel:`Receptor` (Receiver);
- Unidad tramitadora: :guilabel:`Pagador` (Payer);
- Oficina contable: :guilabel:`Fiscal` (Fiscal).

.. image:: spain/administrative-center.png
   :alt: Administrative center contact form for public entities.

.. tip::
   - If administrative centers need different :guilabel:`Codes` per role, you *must* create
     different centers for each role.
   - When an electronic invoice is created using a partner with **administrative centers**, *all*
     administrative centers are included in the invoice.
   - You can add one contact with multiple roles or multiple contacts with a different role each.


==================================================
SECTION: switzerland.rst
PATH: applications/finance/fiscal_localizations/switzerland.rst
==================================================

===========
Switzerland
===========

ISR (In-payment Slip with Reference number)
===========================================

The ISRs are payment slips used in Switzerland. You can print them
directly from Odoo. On the customer invoices, there is a new button
called *Print ISR*.

.. image:: switzerland/switzerland00.png
    :align: center

.. tip::
    The button *Print ISR* only appears there is well a bank account
    defined on the invoice. You can use CH6309000000250097798 as bank
    account number and 010391391 as CHF ISR reference.

.. image:: switzerland/switzerland01.png
    :align: center

Then you open a pdf with the ISR.

.. image:: switzerland/switzerland02.png
    :align: center

There exists two layouts for ISR: one with, and one without the bank
coordinates. To choose which one to use, there is an option to print the
bank information on the ISR. To activate it, go in
:menuselection:`Accounting --> Configuration --> Settings --> Customer Invoices`
and enable **Print bank on ISR**:

.. image:: switzerland/switzerland03.png
    :align: center

ISR reference on invoices
-------------------------

To ease the reconciliation process, you can add your ISR reference as **Payment Reference** on your
invoices.

To do so, you need to configure the Journal you usually use to issue invoices. Go to
:menuselection:`Accounting --> Configuration --> Journals`, open the Journal you want to modify (By
default, the Journal is named *Customer Invoices*), click en *Edit*, and open the *Advanced
Settings* tab. In the **Communication Standard** field, select *Switzerland*, and click on *Save*.

.. image:: switzerland/switzerland-isr-reference.png
   :align: center
   :alt: Configure your Journal to display your ISR as payment reference on your invoices in Odoo

Currency Rate Live Update
=========================

You can update automatically your currencies rates based on the Federal
Tax Administration from Switzerland. For this, go in
:menuselection:`Accounting --> Settings`, activate the multi-currencies setting and choose the service
you want.

.. image:: switzerland/switzerland04.png
    :align: center

Updated VAT for January 2018
============================

Starting from the 1st January 2018, new reduced VAT rates will be
applied in Switzerland. The normal 8.0% rate will switch to 7.7% and the
specific rate for the hotel sector will switch from 3.8% to 3.7%.

How to update your taxes in Odoo Enterprise (Odoo Online or On-premise)?
------------------------------------------------------------------------

If you have the V11.1 version, all the work is already been done, you
don't have to do anything.

If you have started on an earlier version, you first have to update the
module "Switzerland - Accounting Reports". For this, you go in
:menuselection:`Apps --> remove the filter "Apps" --> search for "Switzerland - Accounting Reports" --> open the module --> click on "upgrade"`.

.. image:: switzerland/switzerland05.png
    :align: center

Once it has been done, you can work on creating new taxes for the
updated rates.

.. tip::
    **Do not suppress or modify the existing taxes** (8.0% and 3.8%).
    You want to keep them since you may have to use both rates for a short
    period of time. Instead, remember to archive them once you have encoded
    all your 2017 transactions.

The creation of such taxes should be done in the following manner:

-  **Purchase taxes**: copy the origin tax, change its name, label on
   invoice, rate and tax group (effective from v10 only)

-  **Sale taxes**: copy the origin tax, change its name, label on
   invoice, rate and tax group (effective from v10 only). Since the
   vat report now shows the details for old and new rates, you
   should also set the tags accordingly to

   -  For 7.7% taxes: Switzerland VAT Form: grid 302 base, Switzerland
      VAT Form: grid 302 tax

   -  For 3.7% taxes: Switzerland VAT Form: grid 342 base, Switzerland
      VAT Form: grid 342 tax

You'll find below, as examples, the correct configuration for all taxes
included in Odoo by default

+-------------------------------------------------+------------+------------------------+--------------------------------------+-----------------+---------------------------------------------------------------------------+
| **Tax Name**                                    | **Rate**   | **Label on Invoice**   | **Tax Group (effective from V10)**   | **Tax Scope**   | **Tag**                                                                   |
+=================================================+============+========================+======================================+=================+===========================================================================+
| TVA 7.7% sur achat B&S (TN)                     | 7.7%       | 7.7% achat             | TVA 7.7%                             | Purchases       | Switzerland VAT Form: grid 400                                            |
+-------------------------------------------------+------------+------------------------+--------------------------------------+-----------------+---------------------------------------------------------------------------+
| TVA 7.7% sur achat B&S (Incl. TN)               | 7.7%       | 7.7% achat Incl.       | TVA 7.7%                             | Purchases       | Switzerland VAT Form: grid 400                                            |
+-------------------------------------------------+------------+------------------------+--------------------------------------+-----------------+---------------------------------------------------------------------------+
| TVA 7.7% sur invest. et autres ch. (TN)         | 7.7%       | 7.7% invest.           | TVA 7.7%                             | Purchases       | Switzerland VAT Form: grid 405                                            |
+-------------------------------------------------+------------+------------------------+--------------------------------------+-----------------+---------------------------------------------------------------------------+
| TVA 7.7% sur invest. et autres ch. (Incl. TN)   | 7.7%       | 7.7% invest. Incl.     | TVA 7.7%                             | Purchases       | Switzerland VAT Form: grid 405                                            |
+-------------------------------------------------+------------+------------------------+--------------------------------------+-----------------+---------------------------------------------------------------------------+
| TVA 3.7% sur achat B&S (TS)                     | 3.7%       | 3.7% achat             | TVA 3.7%                             | Purchases       | Switzerland VAT Form: grid 400                                            |
+-------------------------------------------------+------------+------------------------+--------------------------------------+-----------------+---------------------------------------------------------------------------+
| TVA 3.7% sur achat B&S (Incl. TS)               | 3.7%       | 3.7% achat Incl.       | TVA 3.7%                             | Purchases       | Switzerland VAT Form: grid 400                                            |
+-------------------------------------------------+------------+------------------------+--------------------------------------+-----------------+---------------------------------------------------------------------------+
| TVA 3.7% sur invest. et autres ch. (TS)         | 3.7%       | 3.7% invest            | TVA 3.7%                             | Purchases       | Switzerland VAT Form: grid 405                                            |
+-------------------------------------------------+------------+------------------------+--------------------------------------+-----------------+---------------------------------------------------------------------------+
| TVA 3.7% sur invest. et autres ch. (Incl. TS)   | 3.7%       | 3.7% invest Incl.      | TVA 3.7%                             | Purchases       | Switzerland VAT Form: grid 405                                            |
+-------------------------------------------------+------------+------------------------+--------------------------------------+-----------------+---------------------------------------------------------------------------+
| TVA due a 7.7% (TN)                             | 7.7%       | 7.7%                   | TVA 7.7%                             | Sales           | Switzerland VAT Form: grid 302 base, Switzerland VAT Form: grid 302 tax   |
+-------------------------------------------------+------------+------------------------+--------------------------------------+-----------------+---------------------------------------------------------------------------+
| TVA due à 7.7% (Incl. TN)                       | 7.7%       | 7.7% Incl.             | TVA 7.7%                             | Sales           | Switzerland VAT Form: grid 302 base, Switzerland VAT Form: grid 302 tax   |
+-------------------------------------------------+------------+------------------------+--------------------------------------+-----------------+---------------------------------------------------------------------------+
| TVA due à 3.7% (TS)                             | 3.7%       | 3.7%                   | TVA 3.7%                             | Sales           | Switzerland VAT Form: grid 342 base, Switzerland VAT Form: grid 342 tax   |
+-------------------------------------------------+------------+------------------------+--------------------------------------+-----------------+---------------------------------------------------------------------------+
| TVA due a 3.7% (Incl. TS)                       | 3.7%       | 3.7% Incl.             | TVA 3.7%                             | Sales           | Switzerland VAT Form: grid 342 base, Switzerland VAT Form: grid 342 tax   |
+-------------------------------------------------+------------+------------------------+--------------------------------------+-----------------+---------------------------------------------------------------------------+

If you have questions or remarks, please contact our support using
odoo.com/help.

.. tip::
    Don't forget to update your fiscal positions. If you have a version
    11.1 (or higher), there is nothing to do. Otherwise, you will also
    have to update your fiscal positions accordingly.


==================================================
SECTION: thailand.rst
PATH: applications/finance/fiscal_localizations/thailand.rst
==================================================

========
Thailand
========

Configuration
=============

:ref:`Install <general/install>` the :guilabel:`🇹🇭 Thailand` localization package to get all the
features of the Thai localization:

.. list-table::
   :header-rows: 1

   * - Name
     - Technical name
     - Description
   * - :guilabel:`Thailand - Accounting`
     - `l10n_th`
     - Default :ref:`fiscal localization package <fiscal_localizations/packages>`
   * - :guilabel:`Thailand - Accounting Reports`
     - `l10n_th_reports`
     - Country-specific accounting reports

.. image:: thailand/modules.png
   :alt: Thailand localization modules

Chart of accounts and taxes
===========================

Odoo's fiscal localization package for Thailand includes the following taxes:

- VAT 7%
- VAT-exempted
- Withholding tax
- Withholding income tax

Tax report
==========

Odoo allows users to generate Excel files to submit their VAT to the **Revenue Department** of
Thailand.

Sales and purchase tax report
-----------------------------

To generate a sales and purchase tax report, go to :menuselection:`Accounting --> Reporting --> Tax
Report`. Select a specific time or time range on the tax report, and click
:guilabel:`VAT-202-01 (xlsx)` for purchase tax and :guilabel:`VAT-202-02 (xlsx)` for sales tax.

.. image:: thailand/tax-report.png
   :alt: Thai purchase and sales taxes reports

Withholding PND tax report
--------------------------

PND report data displays the summarized amounts of the applicable **withholding corporate income
tax returns (domestic)** from vendor bills under the :guilabel:`PND53 (TH)` and
:guilabel:`PND3 (TH)` tax reports. It is installed by default with the Thai localization.

.. image:: thailand/pnd-report.png
   :alt: PND tax reports

.. note::
   Withholding corporate income tax returns (domestic) is the tax used in case the company has
   withheld the tax from “**Personal (PND3)**” or “**Corporate (PND53)**” services provided such as
   rental, hiring, transportation, insurance, management fee, consulting, etc.

The PND tax report allows users to generate a CSV file for bills to upload on the
`RDprep for Thailand e-Filling application <https://efiling.rd.go.th/rd-cms/>`_.

To generate a PND CSV file, go to :menuselection:`Accounting --> Reporting --> Tax Report`, select a
specific time or time range on the tax report, and click :guilabel:`PND3` or :guilabel:`PND53`.

This generates the :file:`Tax Report PND3.csv` and :file:`Tax Report PND53.csv` files that lists all
the vendor bill lines with the applicable withholding tax.

.. image:: thailand/pnd3-pnd53.png
   :alt: PND3 and PND53 CSV files

.. warning::
   Odoo cannot generate the PND or PDF report or **withholding tax certificate** directly. The
   generated :file:`Tax Report PND3.csv` and :file:`Tax Report PND53.csv` files must be exported
   to an external tool to convert them into a **withholding PND** report or a **PDF** file.

Tax invoice
===========

The **tax invoice PDF** report can be generated from Odoo through the **Invoicing** module. Users
have the  option to print PDF reports for normal invoices and tax invoices. To print out
**tax invoices**, users can click on :guilabel:`Print Invoices` in Odoo. Regular invoices can be
printed as **commercial invoices** by clicking on :menuselection:`Cog button (⚙️) --> Print -->
Commercial Invoice`.

.. image:: thailand/tax-invoice.png
   :alt: Commercial invoice printing

Headquarter/Branch number settings
----------------------------------

You can inform a company's **Headquarters** and **Branch number** in the **Contacts** app. Once
in the app, open the **contact form** of the company and under the :guilabel:`Sales & Purchase` tab:

- If the contact is identified as a branch, input the **Branch number** in the
  :guilabel:`Company ID` field.
- If the contact is a **Headquarters**, leave the :guilabel:`Company ID` field **blank**.

.. image:: thailand/contact.png
   :alt: Company Headquarter/Branch number

.. tip::
   This information is used in the **tax invoice** PDF report and PND **tax report** export.

PromptPay QR code on invoices
=============================

The **PromptPay QR code** is a QR code that can be added to invoices to allow customers to pay their
bills using the PromptPay-supported bank mobile application. The QR code is generated based on the
**invoice amount** and one of the following **merchant information**:

- Ewallet ID
- Merchant Tax ID
- Mobile Number

Activate QR codes
-----------------

Go to :menuselection:`Accounting --> Configuration --> Settings`. Under the :guilabel:`Customer
Payments` section, activate the :guilabel:`QR Codes` feature.

PromptPay QR bank account configuration
---------------------------------------

Go to :menuselection:`Contacts --> Configuration --> Bank Accounts` and select the bank account for
which you want to activate PromptPay QR. Set the :guilabel:`Proxy Type` and fill in the
:guilabel:`Proxy Value` field depending on the chosen type.

.. important::
   - The account holder's city is mandatory.
   - The :guilabel:`Include Reference` checkbox doesn't work for PromptPay QR codes.

.. image:: thailand/qr-promptpay-bank.png
   :alt: PromptPay bank account configuration

.. seealso::
   :doc:`../accounting/bank`

Bank journal configuration
--------------------------

Go to :menuselection:`Accounting --> Configuration --> Journals`, open the bank journal, then fill
in the :guilabel:`Account Number` and :guilabel:`Bank` under the :guilabel:`Journal Entries` tab.

.. image:: thailand/qr-bank-journal.png
   :alt: Bank Account's journal configuration

Issue invoices with PromptPay QR code
-------------------------------------

When creating a new invoice, open the :guilabel:`Other Info` tab and set the :guilabel:`Payment
QR-code` option to :guilabel:`EMV Merchant-Presented QR-code`.

.. image:: thailand/qr-code-invoice-emv.png
   :alt: Select EMV Merchant-Presented QR-code option

Ensure that the :guilabel:`Recipient Bank` is the one you configured, as Odoo uses this field to
generate the PromptPay QR code.


==================================================
SECTION: united_arab_emirates.rst
PATH: applications/finance/fiscal_localizations/united_arab_emirates.rst
==================================================

====================
United Arab Emirates
====================

.. _uae/installation:

Installation
============

:ref:`Install <general/install>` the following modules to get all the features of the **United Arab
Emirates** localization:

.. list-table::
   :header-rows: 1

   * - Name
     - Technical name
     - Description
   * - :guilabel:`United Arab Emirates - Accounting`
     - ``l10n_ae``
     - Default :doc:`fiscal localization package </applications/finance/fiscal_localizations>`.
       Includes all accounts, taxes, and reports.
   * - :guilabel:`U.A.E. - Payroll`
     - ``l10n_ae_hr_payroll``
     - Includes all rules, calculations, and salary structures.
   * - :guilabel:`U.A.E. - Payroll with Accounting`
     - ``l10n_ae_hr_payroll_account``
     - Includes all accounts related to the payroll module.
   * - :guilabel:`United Arab Emirates - Point of Sale`
     - ``l10n_ae_pos``
     - Includes the UAE-compliant POS receipt.

.. image:: united_arab_emirates/l10n-ae-modules.png
   :align: center
   :alt: Select the modules to install.

.. seealso::
   :doc:`United Arab Emirates Payroll localization documentation
   <../../hr/payroll/payroll_localizations/united_arab_emirates>`

Chart of accounts
=================

Go to :menuselection:`Accounting --> Configuration --> Chart of Accounts` to view all default
accounts available for the UAE localization package. You can filter by :guilabel:`Code` using the
numbers on the far left or by clicking on :menuselection:`Group By --> Account Type`. You can
:guilabel:`Enable`/:guilabel:`Disable` reconciliation or **configure** specific accounts according
to your needs.

.. important::
   - Always keep at least one **receivable account** and one **payable account** active.
   - It is also advised to **keep the accounts below active**, as they are used either as transitory
     accounts by Odoo or are specific to the **UAE localization package**.

     .. list-table::
        :header-rows: 1

        * - Code
          - Account Name
          - Type
        * - 102011
          - Accounts Receivable
          - Receivable
        * - 102012
          - Accounts Receivable (POS)
          - Receivable
        * - 201002
          - Payables
          - Payable
        * - 101004
          - Bank
          - Bank and Cash
        * - 105001
          - Cash
          - Bank and Cash
        * - 100001
          - Liquidity Transfer
          - Current Assets
        * - 101002
          - Outstanding Receipts
          - Current Assets
        * - 101003
          - Outstanding Payments
          - Current Assets
        * - 104041
          - VAT Input
          - Current Assets
        * - 100103
          - VAT Receivable
          - Non-current Assets
        * - 101001
          - Bank Suspense Account
          - Current Liabilities
        * - 201017
          - VAT Output
          - Current Liabilities
        * - 202001
          - End of Service Provision
          - Current Liabilities
        * - 202003
          - VAT Payable
          - Non-current Liabilities
        * - 999999
          - Undistributed Profits/Losses
          - Current Year Earnings
        * - 400003
          - Basic Salary
          - Expenses
        * - 400004
          - Housing Allowance
          - Expenses
        * - 400005
          - Transportation Allowance
          - Expenses
        * - 400008
          - End of Service Indemnity
          - Expenses

Taxes
=====

To access your taxes, go to :menuselection:`Accounting --> Configuration --> Taxes`.
Activate/deactivate, or :doc:`configure </applications/finance/accounting/taxes/>` the
taxes relevant to your business by clicking on them. Remember to only set tax accounts on the **5%**
tax group, as other groups do not need closing. To do so, enable the :doc:`developer mode
<../../general/developer_mode>` and go to :menuselection:`Configuration --> Tax Groups`. Then, set a
:guilabel:`Tax current account (payable)`, :guilabel:`Tax current account (receivable)`, and an
:guilabel:`Advance Tax payment account` for the **5%** group.

.. note::
   The :abbr:`RCM (Reverse Charge Mechanism)` is supported by Odoo.

.. image:: united_arab_emirates/uae-localization-taxes.png
   :align: center
   :alt: Preview of the UAE localization package's taxes.

Currency exchange rates
=======================

To update the currency exchange rates, go to :menuselection:`Accounting --> Configuration -->
Settings --> Currencies`. Click on the update button (:guilabel:`🗘`) found next to the
:guilabel:`Next Run` field.

To launch the update automatically at set intervals, change the :guilabel:`Interval` from
:guilabel:`Manually` to the desired frequency.

.. note::
   By default, the UAE Central Bank exchange rates web service is used. Several other providers are
   available under the :guilabel:`Service` field.

Salary rules
------------

To apply these rules to an employee's contract, go to :menuselection:`Payroll --> Contracts -->
Contracts` and select the employee's contract. In the :guilabel:`Salary Structure Type` field,
select :guilabel:`UAE Employee`.

.. image:: united_arab_emirates/uae-localization-salary-structure.png
   :align: center
   :alt: Select the Salary Structure Type to apply to the contract.

Under the :guilabel:`Salary Information` tab, you can find details such as the:

- :guilabel:`Wage`;
- :guilabel:`Housing Allowance`;
- :guilabel:`Transportation Allowance`;
- :guilabel:`Other Allowances`;
- :guilabel:`Number of Days`: used to calculate the :ref:`end of service provision
  <uae-end-of-service-provision>`.

.. note::
   - **Leave deductions** are calculated using a salary rule linked to the **unpaid leave** time-off
     type;
   - Any other deductions or reimbursements are made *manually* using other inputs;
   - **Overtimes** are added *manually* by going to :menuselection:`Work Entries --> Work Entries`;
   - **Salary attachments** are generated by going to :menuselection:`Contracts -->
     Salary Attachments`. Then, :guilabel:`Create` an attachment and select the :guilabel:`Employee`
     and the :guilabel:`Type (Attachment of Salary, Assignment of Salary, Child Support)`.

.. tip::
   To prevent a rule from appearing on a paycheck, go to :menuselection:`Payroll --> Configuration
   --> Rules`. Click on :guilabel:`UAE Employee Payroll Structure`, select the rule to hide, and
   uncheck :guilabel:`Appears on Payslip`.

.. _uae-end-of-service-provision:

End of service provision
------------------------

The provision is defined as the total monthly allowance *divided* by 30 and then *multiplied* by the
number of days set in the field :guilabel:`Number of days` at the bottom of a contract's form.

The provision is then calculated via a salary rule associated with two accounts: the **End Of
Service Indemnity (Expense account)** and the **End of Service Provision (Non-current Liabilities
account)**. The latter is used to pay off the **end of service amount** by settling it with the
**payables account**.

.. note::
   The end of service amount is calculated based on the gross salary and the start and end dates of
   the employee’s contract.

Invoices
--------

The UAE localization package allows the generation of invoices in English, Arabic, or both. The
localization also includes a line to display the **VAT amount** per line.


==================================================
SECTION: united_kingdom.rst
PATH: applications/finance/fiscal_localizations/united_kingdom.rst
==================================================

==============
United Kingdom
==============

.. _localization/united-kingdom/modules:

Configuration
=============

:ref:`Install <general/install>` the :guilabel:`UK - Accounting` and the :guilabel:`UK - Accounting
Reports` modules to get all the features of the UK localization.

.. list-table::
   :header-rows: 1

   * - Name
     - Technical name
     - Description
   * - :guilabel:`UK - Accounting`
     - `l10n_uk`
     -  - CT600-ready chart of accounts
        - VAT100-ready tax structure
        - Infologic UK counties listing
   * - :guilabel:`UK - Accounting Reports`
     - `l10n_uk_reports`
     -  - Accounting reports for the UK
        - Allows sending the tax report via the MTD-VAT API to HMRC.
   * - :guilabel:`UK BACS Payment Files`
     - `l10n_uk_bacs`
     - Allows generating :ref:`localization/united-kingdom/BACS-files` for bill and invoice payments
   * - :guilabel:`UK - Construction Industry Scheme`
     - `l10n_uk_reports_cis`
     -  - Allows sending the Monthly return to |HMRC|
        - CIS Deduction (GB) report for UK construction industry
   * - :guilabel:`UK - HMRC API`
     - `l10n_uk_hmrc`
     - Includes the |HMRC| basics.

.. note::
   - Only UK-based companies can submit reports to HMRC.
   - Installing the module :guilabel:`UK - Accounting Reports` installs all two modules at once.
   - The :guilabel:`UK - Construction Industry Scheme` module automatically includes the
     :guilabel:`UK - HMRC API` module during installation.

.. seealso::
   - `HM Revenue & Customs <https://www.gov.uk/government/organisations/hm-revenue-customs/>`_
   - `Overview of Making Tax Digital
     <https://www.gov.uk/government/publications/making-tax-digital/overview-of-making-tax-digital/>`_

.. _localization/united-kingdom/chart-of-account:

Chart of accounts
=================

The UK chart of accounts is included in the :guilabel:`UK - Accounting` module. Go to
:menuselection:`Accounting --> Configuration --> Accounting: Chart of Accounts` to access it.

Setup your :abbr:`CoA (chart of accounts)` by going to :menuselection:`Accounting --> Configuration
--> Settings --> Accounting Import section` and choose to :guilabel:`Review Manually` or
:guilabel:`Import (recommended)` your initial balances.

.. _localization/united-kingdom/taxes:

Taxes
=====

As part of the localization module, UK taxes are created automatically with their related financial
accounts and configuration.

Go to :menuselection:`Accounting --> Configuration --> Settings --> Taxes` to update the
:guilabel:`Default Taxes`, the :guilabel:`Tax Return Periodicity` or to :guilabel:`Configure your
tax accounts`.

To edit existing taxes or to :guilabel:`Create` a new tax, go to :menuselection:`Accounting -->
Configuration --> Accounting: Taxes`.

.. seealso::
   - :doc:`taxes <../accounting/taxes>`
   - Tutorial: `Tax report and return
     <https://www.odoo.com/slides/slide/tax-report-and-return-1719?fullscreen=1>`_.

.. _localization/united-kingdom/digital-tax:

Making Tax Digital (MTD)
------------------------

In the UK, all VAT-registered businesses have to follow the MTD rules by using software to submit
their VAT returns.

The **UK - Accounting Reports** module enables you to comply with the `HM Revenue & Customs
<https://www.gov.uk/government/organisations/hm-revenue-customs/>`_ requirements regarding
`Making Tax Digital
<https://www.gov.uk/government/publications/making-tax-digital/overview-of-making-tax-digital/>`_.

.. important::
   If your periodic submission is more than three months late, it is no longer possible to submit
   it through Odoo, as Odoo only retrieves open bonds from the last three months. Your submission
   has to be done manually by contacting HMRC.

.. _localization/united-kingdom/hmrc-registration:

Register your company to HMRC before the first submission
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Go to :menuselection:`Accounting --> Reporting --> Tax report` and click on
:guilabel:`Connect to HMRC`. Enter your company information on the HMRC platform. You only need to
do it once.

.. _localization/united-kingdom/periodic-hmrc-submission:

Periodic submission to HMRC
~~~~~~~~~~~~~~~~~~~~~~~~~~~

Import your obligations HMRC, filter on the period you want to submit, and send your tax report by
clicking :guilabel:`Send to HMRC`.

.. tip::
   You can use dummy credentials to demo the HMRC flow. To do so, activate the
   :ref:`developer mode <developer-mode>` and go to :menuselection:`General Settings -->
   Technical --> System Parameters`. From here, search for `l10n_uk_reports.hmrc_mode` and change
   the value line to `demo`. You can get such credentials from the `HMRC Developer Hub
   <https://developer.service.hmrc.gov.uk/api-test-user>`_.

.. _localization/united-kingdom/periodic-hmrc-submission-multi:

Periodic submission to HMRC for multi-company
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Only one company and one user can connect to HMRC simultaneously. If several UK-based companies are
on the same database, the user who submits the HMRC report must follow these instructions before
each submission:

#. Log into the company for which the submission has to be done.
#. Go to :guilabel:`General Settings`, and in the :guilabel:`Users` section, click
   :guilabel:`Manage Users`. Select the user who is connected to HMRC.
#. Go to the :guilabel:`UK HMRC Integration` tab and click :guilabel:`Reset Authentication
   Credentials` or :guilabel:`Remove Authentication Credentials` button.
#. :ref:`Register your company to HMRC <localization/united-kingdom/hmrc-registration>` and submit
   the company's tax report.
#. Repeat the steps for other companies' HMRC submissions.

.. note::
   During this process, the :guilabel:`Connect to HMRC` button no longer appears for other UK-based
   companies.

.. _localization/united-kingdom/BACS-files:

Bacs files
==========

:abbr:`Bacs (Bankers' Automated Clearing Services)` files are electronic files used in the UK to
process payments and transfers between bank accounts.

To enable the use of Bacs files, make sure the
:ref:`UK BACS Payment Files <localization/united-kingdom/modules>` module is installed, then:

#. Configure your Bacs Service User Number:

   #. Go to :menuselection:`Accounting --> Configuration --> Settings` and scroll down to the
      :guilabel:`Customer Payments` section.
   #. Enter your :guilabel:`Service User Number` under :guilabel:`BACS` and manually save.

#. Configure your **bank** journal:

   #. Go to :menuselection:`Accounting --> Configuration --> Journals` and select your **bank**
      journal.
   #. In the :guilabel:`Journal Entries` tab, configure the :guilabel:`Account Number` and
      :guilabel:`Bank` fields.
   #. In the :guilabel:`Incoming Payments` and :guilabel:`Outgoing Payments` tabs, make sure the
      :guilabel:`BACS Direct Debit` payment method is enabled.

#. Configure the contacts for whom you wish to use Bacs files: Access the contact form and, in
   the :guilabel:`Accounting` tab, click :guilabel:`Add a line` and fill in the
   :guilabel:`Account Number` and :guilabel:`Bank` fields.

.. _localization/united-kingdom/bill-payments:

Bill payments
-------------

To generate Bacs files for bill payments, set the :guilabel:`Payment Method` to
:guilabel:`BACS Direct Debit` when :doc:`registering vendor payments <../accounting/payments>`.

Then, create a vendor batch payment:

#. Go to :menuselection:`Accounting --> Vendors --> Batch Payments`, and click :guilabel:`New`.
#. Select the bank journal in the :guilabel:`Bank` field, set the :guilabel:`Payment Method` to
   :guilabel:`BACS Direct Credit`, and select a :guilabel:`BACS Processing Date`.
#. Optionally, you can also:

   - select a :guilabel:`BACS Expiry Date`;
   - enable :guilabel:`BACS Multi Mode` to process the payments on their individual date.

#. Click :guilabel:`Add a line`, select the payments you want to include, click :guilabel:`Select`,
   then :guilabel:`Validate`.

Once validated, the Bacs file is available in the chatter. You can also :guilabel:`Re-generate
Export File` if you need a new Bacs file for that batch payment.

.. image:: united_kingdom/bacs-files.png
   :alt: Vendor Batch Payment view with generated BACS file.

.. seealso::
   :doc:`../accounting/payments/batch`

.. _localization/united-kingdom/invoice-payments:

Invoice payments
----------------

Before generating Bacs files for invoice payments, you must first create a **BACS Direct Debit
Instruction**: Go to :menuselection:`Accounting --> Customers --> BACS Direct Debit Instructions`
and click :guilabel:`New`. Select a :guilabel:`Customer`, their :guilabel:`IBAN`, and the
:guilabel:`Journal` you wish to use.

To generate Bacs files for invoice payments, set the :guilabel:`Payment Method` to
:guilabel:`BACS Direct Debit` when :doc:`registering invoice payments <../accounting/payments>`.

.. tip::
   If you register the payment for an invoice linked to a subscription or via
   :menuselection:`Accounting --> Customers --> Payments`, you can select the :guilabel:`BACS
   Payment Type`:

   - :guilabel:`Direct debit-first collection of a series`;
   - :guilabel:`Direct debit single collection`;
   - :guilabel:`Direct debit repeating collection in a series`;
   - :guilabel:`Direct debit-final collection of a series`.

Then, create a customer batch payment:

#. Go to :menuselection:`Accounting --> Customers --> Batch Payments`, and click :guilabel:`New`.
#. Select the bank journal in the :guilabel:`Bank` field, set the :guilabel:`Payment Method` to
   :guilabel:`BACS Direct Credit`, and select a :guilabel:`BACS Processing Date`.
#. Optionally, you can also:

   - select a :guilabel:`BACS Expiry Date`;
   - enable :guilabel:`BACS Multi Mode` to process the payments on their individual date.

#. Click :guilabel:`Add a line`, select the payments you want to include, click :guilabel:`Select`,
   then :guilabel:`Validate`.

Once validated, the Bacs file is available in the chatter. You can also :guilabel:`Re-generate
Export File` if you need a new Bacs file for that batch payment.

.. _localization/united-kingdom/employment-hero:

Employment Hero payroll
=======================

If your business is already up and running with :doc:`Employment Hero
<../../hr/payroll/payroll_localizations/employment_hero>`, you can use our connector as an
alternative payroll solution.

.. important::
   To :ref:`configure the Employment Hero API <employment_hero/configuration>` for **United
   Kingdom**, use the following value as :guilabel:`Payroll URL`: `https://api.yourpayroll.co.uk/`.

.. _localization/united-kingdom/cis-deduction:

.. |HMRC| replace:: :abbr:`HMRC (HM Revenue and Customs)`
.. |CIS| replace:: :abbr:`CIS (Construction Industry Scheme)`

CIS deduction
=============

The Construction Industry Scheme deduction (CIS deduction) is a tax deduction system used in the UK
designed specifically for the construction industry. It requires contractors to deduct a percentage
of payments made to subcontractors and forward these deductions to HM Revenue and Customs (HMRC).
These deductions apply only to the labor portion of the payments and serve as advance payments
towards the subcontractor's tax and National Insurance contributions. Contractors are required to
register for the scheme, but subcontractors are not. However, subcontractors who are not registered
face higher payment deductions. Under the |CIS|, contractors must deduct 20% from payments to
registered subcontractors, while the deduction increases to 30% for unregistered ones.

.. seealso::

   - `Construction Industry Scheme (CIS) <https://www.gov.uk/what-is-the-construction-industry-scheme>`_
   - `Guidelines for CIS contractors
     <https://www.gov.uk/what-you-must-do-as-a-cis-contractor>`_
   - `Guidelines for CIS subcontractors
     <https://www.gov.uk/what-you-must-do-as-a-cis-subcontractor>`_

As a contractor, you are required to register with the |CIS| before hiring subcontractors and to
check whether each subcontractor is registered with the |CIS|. You must also maintain records of all
payments and deductions and submit monthly returns to HMRC, including the following details:

- information about the subcontractors
- records of payments made and any deductions applied
- a declaration confirming that the employment status of all subcontractors has been reviewed
- a declaration confirming that all subcontractors requiring verification have been verified

.. note::
   If no payments were made to subcontractors in the previous tax month, contractors must notify
   |HMRC| by the 19th of the month to avoid a penalty.

To submit Monthly Returns to |HMRC|, :ref:`install <general/install>` the
:ref:`UK - Construction Industry Scheme <localization/united-kingdom/modules>` module.

.. tip::
   To enable the :guilabel:`Test` mode and use test credentials, open the Settings app, activate the
   :ref:`developer mode <developer-mode>` and go to :menuselection:`Settings --> Technical -->
   System Parameters`. Search for `l10n_uk_hmrc.api_mode`, select it, and change the
   :guilabel:`Value` from `production` to `test`.

.. _localization/united-kingdom/cis-monthly-returns:

Monthly returns
---------------

Monthly returns only work for vendor bills and vendor refunds. To submit a complete return to
|HMRC|, several steps must be followed to report all payments made to subcontractors under the
scheme during the previous tax month:

- :ref:`localization/united-kingdom/cis-contractor-setup`
- :ref:`localization/united-kingdom/cis-subcontractor-setup`
- :ref:`localization/united-kingdom/cis-vendorbills`
- :ref:`localization/united-kingdom/cis-monthly-return-sending`

.. _localization/united-kingdom/cis-contractor-setup:

Contractor (company) setup
~~~~~~~~~~~~~~~~~~~~~~~~~~

To configure your company's |HMRC| information, go to the Settings app and, in the
:guilabel:`Companies` section, click :guilabel:`Update Info`. Open the :guilabel:`HMRC` tab and
configure the information in the :guilabel:`HMRC Credentials` and the :guilabel:`Contractor details`
sections. All fields are mandatory.

.. _localization/united-kingdom/cis-subcontractor-setup:

Subcontractor setup
~~~~~~~~~~~~~~~~~~~

Access the subcontractor's contact form and select the :guilabel:`Accounting` tab. In the
:guilabel:`HMRC Details` section, enable the :guilabel:`Construction Industry Scheme` option; the
|CIS|-related fields are displayed.

By default, the :guilabel:`Deduction rate` is set to 30%. To modify it, first enter the
:guilabel:`Verification Number` provided by |HMRC| when verifying the subcontractor's status, then
update the :guilabel:`Deduction Rate` accordingly.

.. note::
   The :guilabel:`Forename` and :guilabel:`Surname` fields are mandatory if the contact type is set
   to :guilabel:`Individual`.

.. _localization/united-kingdom/cis-vendorbills:

Vendor bills
~~~~~~~~~~~~

The appropriate |CIS| tax must be applied to **labor items** on vendor bills based on the
subcontractor's :guilabel:`Deduction Rate`: :guilabel:`0% CIS`, :guilabel:`20% CIS` or
:guilabel:`30% CIS`. To apply the rate, go to the :guilabel:`Invoice Lines` section of the vendor
bill and select the appropriate |CIS| tax rate in the :guilabel:`Taxes` column of the **labor**
items.

.. note::
   - The |CIS| tax rate is not necessary for material items on vendor bills.
   - A yellow banner appears at the top of the page if:

     - The :guilabel:`Construction Industry Scheme` option hasn't been enabled in the
       :ref:`subcontractor <localization/united-kingdom/cis-subcontractor-setup>`'s
       :guilabel:`Contact` form when creating a vendor bill.
     - The |CIS| tax used in the vendor bill does not match the expected |CIS| deduction rate for a
       :ref:`subcontractor <localization/united-kingdom/cis-subcontractor-setup>`.

.. _localization/united-kingdom/cis-monthly-return-sending:

Monthly returns sending
~~~~~~~~~~~~~~~~~~~~~~~

On the 6th of each month, Odoo sends a reminder email to submit a monthly return to |HMRC|. The
recipient email address is the one entered in the company :guilabel:`Email` field. To send monthly
returns to |HMRC|, go to :menuselection:`Accounting --> Reporting --> Tax Return` and follow these
steps:

#. Click :icon:`fa-book` :guilabel:`Report:` and select :guilabel:`CIS Deduction (GB)`.
#. In the :icon:`fa-calendar` :guilabel:`(calendar)` date selector, the :guilabel:`Tax Period` is
   automatically adjusted to match the |CIS| deduction period.
#. Click on :guilabel:`Send to HMRC` in the top-left corner.
#. In the :guilabel:`CIS monthly return` window, select the required options in the
   :guilabel:`Declaration` section:

   - :guilabel:`Employment Status`: To declare that the employment status of all subcontractors has
     been reviewed.
   - :guilabel:`Subcontractor Verification`: To declare that all submitted subcontractors requiring
     verification have been verified.
   - :guilabel:`Inactivity Indicator`: To declare temporary inactivity.

#. In the :guilabel:`Information correct declaration` section, confirm the information is true and
   complete by checking the box. Then, enter the :guilabel:`Password` used in the
   :guilabel:`HMRC Credentials` section during
   :ref:`contractor setup <localization/united-kingdom/cis-contractor-setup>`.
#. Click :guilabel:`Send` to prompt Odoo to request |HMRC| to initiate the transaction.

When |HMRC| replies to a transaction, Odoo automatically notifies the user who submitted it by
email. The email informs them that the response is available in the company's chatter with an
attached XML document for download. Both the electronic and paper versions of the |HMRC| receipt
should be retained. If an error is detected, a new submission is required to comply with |HMRC|
requirements.

.. note::
   - Transactions are updated daily. To manually update the |HMRC| request, click the :icon:`fa-cog`
     :guilabel:`(gear)` icon and select :guilabel:`Refresh HMRC request`.
   - |CIS| invoices are included in the :guilabel:`CIS Deduction (GB)` report but are not sent to
     |HMRC|.


==================================================
SECTION: united_states.rst
PATH: applications/finance/fiscal_localizations/united_states.rst
==================================================

=============
United States
=============

.. |GAAP| replace:: :abbr:`GAAP (Generally Acceptable Accounting Practices)`
.. |FASB| replace:: :abbr:`FASB (Financial Accounting Standards Board)`
.. |SEC| replace:: :abbr:`SEC (Securities and Exchange Commission)`
.. |COA| replace:: :abbr:`CoA (Chart of Accounts)`
.. |AR| replace:: :abbr:`AR (Accounts Receivable)`
.. |AP| replace:: :abbr:`AP (Accounts Payable)`
.. |CFS| replace:: :abbr:`CFS (Cash Flow Statement)`
.. |NACHA| replace:: :abbr:`NACHA (National Automated Clearing House Association)`
.. |ACH| replace:: :abbr:`ACH (Automated Clearing House)`

The Odoo fiscal localization package for the United States follows the Generally Acceptable
Accounting Principles (GAAP) accounting standards and rules used to prepare financial statements, as
outlined by the Financial Accounting Standards Board (FASB) and adopted by the Securities and
Exchange Commission (SEC).

.. seealso::
   - `Financial Accounting Standards Board (FASB) <https://asc.fasb.org/Home>`_
   - `Securities and Exchange Commission (SEC) <https://www.sec.gov/>`_

In addition, a series of videos on the subject of Accounting are available through Odoo's eLearning
platform. These videos cover how to start from scratch, set up configurations, complete common
workflows, and provide in-depth looks at some specific use cases, as well.

.. seealso::
   - `Odoo Tutorials: Accounting & Invoicing
     <https://www.odoo.com/slides/accounting-and-invoicing-19>`_
   - `Odoo SmartClass: Accounting <https://www.odoo.com/slides/smartclass-accounting-121>`_

Configuration
=============

Below are the available modules in Odoo for accounting use in the United States.

.. note::
   The modules listed below are either for reference only or are optional, as the core requirements
   to operate under the US fiscal localization in Odoo are already included under the default
   package that came installed during database initialization.

   Verify the default package is in use by navigating to :menuselection:`Accounting App -->
   Settings` and under the :guilabel:`Fiscal Localization` section at the top, look for the `Generic
   Chart Template` selection to be listed next to the :guilabel:`Package` field label. This chart
   template includes the necessary settings for the US localization for the Odoo **Accounting** app.

   .. image:: united_states/us-l10n-generic-chart-template.png
      :alt: The Generic Chart Template comes preconfigured for the US localization.

Modules installation
--------------------

:ref:`Install <general/install>` the following modules to get all the features of the United States
localization:

.. list-table::
   :header-rows: 1
   :widths: 25 25 50

   * - Name
     - Technical name
     - Description
   * - :guilabel:`United States - Accounting`
     - `l10n_us`
     - Base accounting module for United States localization.
   * - :ref:`US - Accounting Reports <l10n_us/reports>`
     - `l10n_us_reports`
     - Adds United States accounting reports.
   * - :guilabel:`US Checks Layout`
     - `l10n_us_check_printing`
     - Enables the printing of payments on pre-printed check paper. Supports the three most common
       check formats and will work out of the box with the linked checks from `checkdepot.net
       <https://checkdepot.net/collections/computer-checks/Odoo>`_.

       - `Check on top: Quicken / QuickBooks standard
         <https://checkdepot.net/collections/computer-checks/odoo+top-check>`_
       - `Check on middle: Peachtree standard
         <https://checkdepot.net/collections/computer-checks/odoo+middle-check>`_
       - `Check on bottom: ADP standard
         <https://checkdepot.net/collections/computer-checks/odoo+Bottom-Check>`_

   * - :ref:`NACHA Payments <l10n_us/nacha>`
     - `l10n_us_payment_nacha`
     - Export payments as NACHA files for use in the United States.
   * - :ref:`1099 Reporting <l10n_us/1099-report>`
     - `l10n_us_1099`
     - Export 1099 data for e-filing with a third party.
   * - :ref:`Avatax <l10n_us/taxes-avatax>`
     - `account_avatax`
     - Module for the :doc:`AvaTax integration <../accounting/taxes/avatax>` with Odoo.
   * - :ref:`United States - Payroll <l10n_us/payroll>`
     - `l10n_us_hr_payroll`
     - Includes the necessary rules for United States payroll, including:

       - Employee Details
       - Employee Contracts
       - Passport-based Contracts
       - Allowances/Deductions
       - Allow Configurations for Basic/Gross/Net Salary
       - Employee Payslip
       - Integration with Leaves Management

   * - :ref:`United States - Payroll with Accounting <l10n_us/payroll>`
     - `l10n_us_hr_payroll_account`
     - Contains the necessary accounting data for the United States payroll rules.
   * - :ref:`United States - Payroll - Export to ADP <l10n_us/adp>`
     - `l10n_us_hr_payroll_adp`
     - Export Work Entries to the ADP payroll software.

.. _l10n_us/coa:

Chart of accounts
=================

The :doc:`chart of accounts (COA) <../accounting/get_started/chart_of_accounts>` for the United
States localization, in Odoo, follows the standard |GAAP| structure, with accounts grouped into
seven main categories, with corresponding numeric values that prefix individual journal entries:

- **Receivable**: the balance of money (or credit) due to the business for goods or services
  delivered or used, but not yet paid for by customers. |AR| is indicated by the journal code
  labeled (or beginning) with :guilabel:`1`.
- **Payable**: the business's short-term obligations owed to its creditors or suppliers, which have
  not yet been paid. |AP| is indicated by the journal code labeled (or beginning) with
  :guilabel:`2`.
- **Equity**: the amount of money that is returned to a company's shareholders if all of the assets
  were liquidated and all of the company's debt was paid off in the case of liquidation. Equity is
  indicated by the journal code labeled (or beginning) with :guilabel:`3` or :guilabel:`9`.
- **Assets**: items listed on the balance sheet that contains economic value or have the ability to
  generate cash flows in the future, such as a piece of machinery, a financial security, or a
  patent. Assets are indicated by the journal code labeled (or beginning) with :guilabel:`1`.
- **Liability**: refers to a company's financial debts or obligations that arise during the course
  of business operations. Liabilities are indicated by the journal code labeled (or beginning) with
  :guilabel:`2`.
- **Income**: synonymous with *net income*, this is the profit a company retains after paying off
  all relevant expenses from sales revenue earned. Income is indicated by the journal code labeled
  (or beginning) with :guilabel:`4` or :guilabel:`6`.
- **Expenses**: the cost of operations that a company incurs to generate revenue. Expenses are
  indicated by the journal code labeled (or beginning) with a :guilabel:`6`.

.. tip::
   Predefined accounts are included in Odoo, as part of the |CoA| that is installed with the US
   localization package. The accounts listed below are preconfigured to perform certain operations
   within Odoo. It is recommended to **not** delete these accounts; however, if changes are needed,
   rename the accounts instead.

   .. list-table::
     :header-rows: 1
     :stub-columns: 1

     * - :guilabel:`Type`
       - :guilabel:`Account Name`
     * - :guilabel:`Current Assets`
       - | :guilabel:`Bank Suspense Account`
         | :guilabel:`Outstanding Receipts`
         | :guilabel:`Outstanding Payments`
         | :guilabel:`Liquidity Transfer`
         | :guilabel:`Stock Valuation`
         | :guilabel:`Stock Interim (Received)`
         | :guilabel:`Stock Interim (Delivered)`
         | :guilabel:`Cost of Production`
     * - :guilabel:`Income`
       - | :guilabel:`Foreign Exchange Gain`
         | :guilabel:`Cash Difference Gain`
         | :guilabel:`Cash Discount Gain`
     * - :guilabel:`Expenses`
       - | :guilabel:`Cash Discount Loss`
         | :guilabel:`Foreign Exchange Loss`
         | :guilabel:`Cash Difference Loss`
     * - :guilabel:`Current Year Earnings`
       - :guilabel:`Undistributed Profits/Losses`
     * - :guilabel:`Receivable`
       - :guilabel:`Account Receivable`
     * - :guilabel:`Payable`
       - :guilabel:`Account Payable`

.. seealso::
   - :doc:`../accounting/get_started/chart_of_accounts`
   - :doc:`../accounting/get_started/cheat_sheet`

View, edit, and sort accounts
-----------------------------

Access the *Chart of Accounts* dashboard in Odoo by navigating to :menuselection:`Accounting app -->
Configuration --> Accounting: Chart of Accounts`.

From the :guilabel:`Chart of Accounts` dashboard, create new accounts by clicking the
:guilabel:`New` button in the top-left corner of the dashboard and :ref:`filling in the
corresponding form <chart-of-account/create>`. Search and sort through existing accounts by using
specific :guilabel:`Filters` and :guilabel:`Group By` criteria, which are available in the search
drop-down menu.

To filter accounts by category, click the :icon:`fa-caret-down` :guilabel:`(dropdown)` icon to
access the drop-down menu and look under the :guilabel:`Filters` column for individual selections.
Clicking on a specific category will only show accounts that match that particular filter.

To view all the available account types, remove all of the filters in the search bar, and then click
the :icon:`fa-caret-down` :guilabel:`(dropdown)` icon to access the drop-down menu. From there,
select :guilabel:`Account Type` under the :guilabel:`Group By` column heading to list all of the
account types in the table.

.. image:: united_states/us-l10n-coa-account-types.png
   :alt: Chart of Accounts grouped by Account Type.

Besides structure, there are other key differences in the chart of accounts in the United States,
compared to other countries:

- **Specificity**: US |GAAP| often requires more detailed accounts compared to some other countries.
  This can include separate accounts for various types of revenue, expenses, and assets, providing
  more granular information in financial reports.
- **Regulatory Requirements**: In the United States, there are specific regulatory requirements set
  by bodies such as the |SEC| for publicly traded companies. These requirements may influence the
  structure and content of the |COA| to ensure compliance with reporting standards.
- **Industry Practices**: Certain industries in the United States may have unique accounting
  requirements or specialized |COA| structures. For example, financial institutions often have
  specific accounts related to loans, investments, and interest income.
- **Tax Considerations**: The |COA| may also reflect tax considerations, such as accounts for
  deductible expenses, deferred tax assets, and liabilities, to ensure compliance with tax laws and
  facilitate tax reporting.

These differences, ultimately, should be reflected in the |COA| structure itself, with the addition
of new accounts, as needed, in order to meet the demands of US accounting reporting requirements.

.. seealso::
   - :ref:`Create a new account <chart-of-account/create>`
   - :doc:`../../essentials/search`

.. _l10n_us/taxes:

Taxes
=====

In the United States, tax rates and what is considered taxable vary by jurisdiction. Default *sales*
and *purchase* taxes are created automatically when the Odoo **Accounting** app is installed. To
manage existing or configure additional taxes, navigate to :menuselection:`Accounting -->
Configuration --> Taxes`.

.. _l10n_us/taxes-avatax:

AvaTax
------

**Avalara AvaTax** is a cloud-based tax calculation and compliance software that integrates with
Odoo for several localizations. Integrating AvaTax with Odoo provides real-time and region-specific
tax calculations when items are sold, purchased, and invoiced in the database.

.. important::
   AvaTax is available for integration with databases/companies that have locations in the United
   States and Canada. Reference the :ref:`accounting/avatax/fiscal_country` documentation for more
   information.

.. seealso::
   Refer to the documentation articles below to integrate and configure an AvaTax account with an
   Odoo database:

   - :doc:`AvaTax integration <../accounting/taxes/avatax>`
   - :doc:`Avalara management portal <../accounting/taxes/avatax/avalara_portal>`
   - :doc:`Calculate taxes with AvaTax <../accounting/taxes/avatax/avatax_use>`
   - `US Tax Compliance: AvaTax elearning video
     <https://www.odoo.com/slides/slide/us-tax-compliance-avatax-2858?fullscreen=1>`_
   - Avalara's support documents: `About AvaTax
     <https://community.avalara.com/support/s/document-item?language=en_US&bundleId=dqa1657870670369_dqa1657870670369&topicId=About_AvaTax.html&_LANG=enus>`_

.. _l10n_us/reports:

Reports
=======

A number of :doc:`report selections <../accounting/reporting>` are readily available for the US
localization, under the :menuselection:`Accounting app --> Reporting` drop-down menu:

- :ref:`Balance Sheet <accounting/reporting/balance-sheet>`: a "snapshot" of a company's financial
  position at a specific point in time, which contains an overview of a company's assets,
  liabilities, and equity.
- :ref:`Profit & Loss <accounting/reporting/balance-sheet>`: otherwise known as a *P&L statement* or
  *income statement*, provides a summary of a company's revenues, expenses, and profits/losses over
  a given period of time.
- :ref:`Cash Flow Statement <l10n_us/cash-flow-statement>`: shows how much cash and cash equivalents
  a company has received and spent in a given period.
- :ref:`Executive Summary <accounting/reporting/executive-summary>`: an overview report that covers
  the key performance indicators of a company's financial position, such as revenue, profit, and
  debt.
- :ref:`Tax Report <accounting/reporting/tax-report>`: an official form filed for a tax authority
  that reports income, expenses, and other pertinent tax information. Tax reports allow taxpayers to
  calculate their tax liability, schedule tax payments, or request refunds for the overpayment of
  taxes. In Odoo, the tax report can be made monthly, every two months, quarterly, every 4 months,
  semi-annually, and annually.
- :guilabel:`Check Register`: a report that displays cash transactions (regardless of the journal)
  with their running balance after the transaction. Only visible with the *US - Accounting Reports*
  (`l10n_us_reports`) module installed.
- :ref:`1099 Report <l10n_us/1099-report>`: a CSV download of payments made to non-employees in a
  period to file electronically in a third-party service. Only visible with the *1099 Reporting*
  (`l10n_us_1099`) module installed.

.. _l10n_us/report-filters:

Depending on the type of report, certain filters are available at the top of the dashboard:

- a *date* filter, indicated by a :icon:`fa-calendar` :guilabel:`(calendar)` icon that precedes a
  date in *MM/DD/YYYY* format. Use this to select a specific date or date range for the report.
- a :icon:`fa-bar-chart` :guilabel:`Comparison` filter, to compare reporting periods against each
  other
- a *journal* filter, as indicated by a :icon:`fa-book` :guilabel:`(book)` icon and the default
  setting of :guilabel:`All Journals`. Use this filter to specify which journals should be included
  in the report.
- an *entries type* filter, as indicated by a :icon:`fa-filter` :guilabel:`(filter)` icon, with the
  default setting of :guilabel:`Posted Entries Only, Accrual Basis`. Use this filter to determine
  which type of journal entries should be included in the report (e.g. posted or draft), along with
  the type of accounting method (e.g. accrual or cash basis).

  - There are view options in this filter, as well, one that will :guilabel:`Hide lines at 0` for
    more relevant viewing, along with a :guilabel:`Split Horizontally` option to keep the report
    above the screen's fold, removing the need to scroll.

    .. image:: united_states/us-l1on-accounting-method-reporting-menu.png
       :alt: Accounting method filter menu for reports, covering accrual vs. cash basis methods.

- a *decimal* filter, that by default, includes figures with cents, as indicated by the
  :guilabel:`In .$` setting. Use the other options in the drop-down menu to change figures in the
  report to whole numbers (:guilabel:`In $`), thousands (:guilabel:`In K$`), or millions
  (:guilabel:`In M$`) formats.
- a report *customization* filter, indicated by the :icon:`fa-cogs` :guilabel:`(gears)` icon. Use
  this filter to customize the current report's sections and line items, or build new reports, as
  desired.

.. seealso::
   - :doc:`Accounting reporting <../accounting/reporting>`
   - :doc:`../../essentials/search`

.. _l10n_us/1099-report:

1099 report
-----------

The 1099 report, available by :ref:`installing <general/install>` the *1099 Reporting*
(`l10n_us_1099`) module, includes payments that are made to non-employees across a given reporting
period. Use the available CSV download from the report in Odoo to file 1099 payments electronically
via a third-party service.

To generate a 1099 report, navigate to :menuselection:`Accounting app --> Reporting --> Management:
1099 Report` to open a :guilabel:`1099 Report` wizard.

First, enter the date range of the transactions to report in the :guilabel:`Start Date` and
:guilabel:`End Date` fields.

Then, edit the journal items that appear on the wizard. Click :guilabel:`Add a line` to add any
items that are missing. Be sure to remove any items that should not be included in the report by
clicking :icon:`fa-times` :guilabel:`(delete)` on the row.

Finally, once all necessary items are included in the 1099 report, click on the :guilabel:`Generate`
button. Doing so downloads a CSV file that groups transactions by the partner that received the
payments.

.. _l10n_us/cash-flow-statement:

Cash flow statement
-------------------

Navigate to the *Cash Flow Statement* (CFS) dashboard by going to :menuselection:`Accounting app -->
Reporting --> Statement Reports: Cash Flow Statement`. From here, |CFS| reports can be generated
using the various :ref:`filters <l10n_us/report-filters>` that are available at the top of the
dashboard.

Odoo uses the *direct* cash flow method to compile cash flow statements, which measures actual cash
inflows and outflows from the company's operations, such as when cash is received from customers or
when cash payments are made to suppliers.

By default, an account labeled with any of the three default :guilabel:`Tags` on the
:guilabel:`Chart of Accounts` dashboard is included in the report, which includes:
:guilabel:`Operating Activities`, :guilabel:`Financing Activities`, and :guilabel:`Investing &
Extraordinary Activities`.

.. image:: united_states/us-l10n-cash-flow-statement-tags.png
   :alt: Examples of tagged accounts that are included in the Cash Flow Statement in Odoo.

Additionally, the cash flow statement in Odoo:

- is limited to the *Bank* and *Cash* journals to reflect money coming in or out; and
- also contains *Expenses* accounts, to show the counterpart transactions versus *Bank* or *Cash*
  journal entries, while excluding |AR| and |AP| activity.

.. example::
   Create a vendor bill for $100, as an operating expense (not |AP|). Doing so will **not** reflect
   a transaction on the cash flow statement. However, register a corresponding payment for $100, and
   the transaction **will** reflect on the cash flow statement as :guilabel:`Cash paid for operating
   activities`.

   .. image:: united_states/us-l10n-operating-expenses-example.png
      :alt: Example of a bill registered as an operating expense as part of a cash flow statement.

.. _l10n_us/cash-discount:

Cash discount
=============

Cash discounts can be configured from :menuselection:`Accounting app --> Payment Terms`. Each
payment term can be set up with a cash discount and reduced tax.

.. seealso::
   :doc:`../accounting/customer_invoices/cash_discounts`

.. _l10n_us/writing-checks:

Writing checks
==============

Using checks is still a common payment practice in the US. Be sure the *US Checks Layout*
(`l10n_us_check_printing`) module for the US localization is :ref:`installed <general/install>`.

To enable check printing from Odoo, navigate to :menuselection:`Accounting --> Configuration -->
Settings` and find the :guilabel:`Vendor Payments` section. From here, tick the :guilabel:`Checks`
checkbox to reveal several fields for check configuration.

Select a pre-printed or blank :guilabel:`Check Layout` from the drop-down menu:

- :guilabel:`Print Check (Top) - US`
- :guilabel:`Print Check (Middle) - US`
- :guilabel:`Print Check (Bottom) - US`
- :guilabel:`Print Blank Check (Top) - US`
- :guilabel:`Print Blank Check (Middle) - US`
- :guilabel:`Print Blank Check (Bottom) - US`

Next, choose whether or not to enable the :guilabel:`Multi-Pages Check Stub` checkbox.

Optionally set a :guilabel:`Check Top Margin` and :guilabel:`Check Left Margin`, if required.

Once all check configurations are complete, :guilabel:`Save` the settings.

.. tip::
   Pre-printed check formats (non-blank checks) require pre-printed paper from a third-party vendor.
   `Pre-printed checks from checkdepot.net <https://checkdepot.net/collections/odoo-checks>`_ are
   recommended.

.. important::

   Use one of the blank check formats to print the information of the check ad-hoc when needed. This
   requires the use of both :abbr:`MICR (Magnetic Ink Character Recognition)` ink or toner complying
   with the standards for check printing, as well as `check quality paper
   <https://checkdepot.net/collections/blank-check-paper/products/top-format-blank-check-paper-cdt164>`_.
   Other information, such as the company name, bank account, and check number, is printed when
   creating the blank check.

.. seealso::
   :doc:`../accounting/payments/pay_checks`

.. _l10n_us/payroll:

Payroll
=======

The **Payroll** app is responsible for calculating an employee's pay, taking into account all work,
vacation, and sick time, benefits, and deductions. The **Payroll** app pulls information from the
**Attendances**, **Timesheets**, **Time Off**, **Employees** and **Expenses** apps, to calculate the
worked hours and compensation for each employee.

When using an external payroll provider, such as *ADP*, it is necessary to export the various
payroll-related data, such as work entries, repayment of expenses, taxes, commissions, and any other
relevant data, so the data can be uploaded into the payroll provider, who then issues the actual
paychecks or directly deposits the funds into an employee's bank account.

In order to export the payroll data, the work entries must first be validated and correct. Refer to
the :doc:`work entries <../../hr/payroll/work_entries>` documentation for more information regarding
validating work entries.

Once work entries are validated, the information can be :ref:`exported to ADP <l10n_us/adp>`.

After payments have been issued to employees, payslips can be processed into batches, validated, and
posted to the corresponding accounting journals to keep all financial records in Odoo current.

Required information
--------------------

It is important to have the **Employees** app installed, and all employee information populated.
Several fields in both the :ref:`employee records <l10n_us/payroll-employee-records>`, as well as in
an :ref:`employee contracts <l10n_us/payroll-employee-contracts>`, are necessary to properly process
the employee's pay. Ensure the following fields are filled out in their respective places.

.. _l10n_us/payroll-employee-records:

Employee records
~~~~~~~~~~~~~~~~

In each employee record, there is various information the **Payroll** app requires to properly
process payslips, including various banking, tax, and work information.

Navigate to the :menuselection:`Employees app` and select an employee record to view the sections of
the employee form that directly affect *Payroll*:

- :guilabel:`Work Information` tab:

  - :guilabel:`Work Address`: indicates where the employee is located, including the state, which
    affects the tax calculations.
  - :guilabel:`Working Hours`: determines how pay is calculated, and determines if an employee earns
    overtime.

- :guilabel:`Private Information` tab:

  - :guilabel:`SSN No`: the last four digits of the employee's Social Security Number (SSN) appears
    on payslips.
  - :guilabel:`Bank Account Number`: the bank account associated with the NACHA payment file.

- :guilabel:`HR Settings` tab:

  - :guilabel:`Federal Tax Filing Status`: the tax status an employee uses for Payroll tax
    calculations, which can be different from their state status.
  - :guilabel:`State Tax Filing Status`: the tax status an employee uses for their state portion of
    the Payroll tax calculation.
  - :guilabel:`W-2 Form`: a US tax form indicating the summary of wages, taxes, and benefits paid to
    an employee during a tax period (typically one year).
  - :guilabel:`W-4 Form`: an IRS form that helps outline the amount of federal taxes to withhold for
    an employee, which is paid to the IRS by the company.

.. _l10n_us/payroll-employee-contracts:

Employee contracts
~~~~~~~~~~~~~~~~~~

Additionally, there is information that is found in an employee contract that also affects the
**Payroll** app.

Navigate to the :menuselection:`Employees app --> Employees --> Contracts` and select a contract
record to view the sections of a contract that directly affect *Payroll*:

- :guilabel:`General Information`:

  - :guilabel:`Salary Structure Type: United States: Employee`: defines when the employee is paid,
    their working schedule, and the work entry type.
  - :guilabel:`Work Entry source`: determines how work entries are calculated.

- :guilabel:`Salary Information` tab:

  - :guilabel:`SSN No`: the last four digits of the employee's Social Security Number (SSN) appears
    on payslips.
  - :guilabel:`Wage type`: determines how the employee is paid, wether a Fixed wage (salary) or
    Hourly wage.
  - :guilabel:`Schedule Pay`: defines how often the employee is paid, either :guilabel:`Annually`,
    :guilabel:`Semi-annually`, :guilabel:`Quarterly`, :guilabel:`Bi-monthly`, :guilabel:`Monthly`,
    :guilabel:`Semi-monthly`, :guilabel:`Bi-weekly`, :guilabel:`Weekly`, or :guilabel:`Daily`. In
    the US, Semi-monthly (24 payments a year) or bi-weekly (26 payments a year) are the most common.
  - :guilabel:`Wage, Yearly, and Monthly cost`: used to show the total cost of an employee. It is
    recommended to populate the :guilabel:`Yearly` wage first, as it auto-populates the other
    fields.
  - :guilabel:`Pre-tax benefits`: populate this section according to the employee's selections.
    Pre-tax benefits decrease the gross wage, which lowers the base amount that is taxed. These are
    displayed at the beginning of the payslip.
  - :guilabel:`Post-tax benefits`: these benefits are deductions made *after* taxes are calculated.
    These appear towards the end of the payslip before the net amount is displayed.

.. seealso::
   :doc:`Employees documentation <../../hr/employees/new_employee>`

.. _l10n_us/adp:

Export work entries to ADP
--------------------------

Requirements
~~~~~~~~~~~~

In order to create a report that can be uploaded to ADP, there are some initial configuration steps
that must be completed first.

First, ensure the *United States - Payroll - Export to ADP* (`l10n_us_hr_payroll_adp`) module is
:ref:`installed <general/install>`.

Then, the company **must** have an *ADP Code* entered in the company settings. To do so, navigate to
:menuselection:`Payroll app --> Configuration --> Settings`. Enter the :guilabel:`ADP Code` in the
:guilabel:`US Localization` section.

Next, work entry types **must** have the correct ADP code listed in the *External Code* field for
each work entry type that is being referenced.

Lastly, every employee **must** have an *ADP Code* entered on their employee form. To do so,
navigate to :menuselection:`Employees app`, select an employee record, and open the :guilabel:`HR
Settings` tab. Enter the :guilabel:`ADP Code` in the :guilabel:`ADP Information` section.

The :guilabel:`ADP Code` code is how ADP identifies that particular employee, and is typically a
six-digit number.

.. seealso::
   - :ref:`payroll/new-work-entry`
   - :doc:`../../hr/employees/new_employee`

Export data
~~~~~~~~~~~

Once :doc:`work entries <../../hr/payroll/work_entries>` have been verified, the information can be
exported to a CSV file, which can then be uploaded into ADP.

To export the data, navigate to :menuselection:`Payroll app --> Reporting --> United States: ADP
Export`, then click :guilabel:`New`. Next, enter the :guilabel:`Start Date` and :guilabel:`End Date`
for the work entries using the calendar pop-over.

Then, enter a :guilabel:`Batch ID` in the corresponding field. The recommendation for this field is
to enter the date in a `YY-MM-DD` format, followed by any other characters to distinguish that
specific batch, such as a department name, or any other defining characteristics for the batch.

Enter a :guilabel:`Batch Description` in the corresponding field. This should be short and
descriptive, but distinct from the :guilabel:`Batch Name`.

Ensure the correct company populates the :guilabel:`Company` field. Change the selected company with
the drop-down menu, if needed.

Lastly, add the employee's work entry information to the list. Click :guilabel:`Add a line` and an
:guilabel:`Add: Employee` pop-up window loads. The list can be :doc:`filtered
<../../essentials/search>` to find the employees to add to the list.

.. tip::
   Process the data export in multiple groups instead of in one large group that contains all
   employees. This helps to meaningfully differentiate the batches and makes processing more
   tenable, overall. The most common ways to group employees is by department, or by wage type
   (hourly or salaried).

Select the employees to add to the list by ticking the box to the left of their name. Once all
desired employees have been selected, click the :guilabel:`Select` button in the lower-left corner,
and the employees appear in the list.

To create the CSV file, click the :guilabel:`Generate` button in the top-left corner.

.. _l10n_us/ach-electronic-transfers:

ACH - electronic transfers
==========================

Automated Clearing House (ACH) payments are a modern way to transfer funds electronically between
bank accounts, replacing traditional paper-based methods. |ACH| payments are commonly used for
direct deposits, bill payments, and business transactions.

Receive ACH payments: payment provider integration
--------------------------------------------------

|ACH| payments are supported by *Authorize.net* and *Stripe* payment integrations in Odoo.

.. seealso::
   - :ref:`Setting up Authorize.net for ACH payments (Odoo) <authorize/ach_payments>`
   - `Authorize.net's ACH payment processing for small businesses documentation
     <https://www.authorize.net/resources/blog/2021/ach-payments-for-small-businesses.html>`_
   - :doc:`Setting up Stripe for ACH payments (Odoo) <../payment_providers/stripe>`
   - `Stripe's ACH Direct Debit documentation <https://docs.stripe.com/payments/ach-debit>`_

.. _l10n_us/nacha:

Send payments: NACHA files
--------------------------

Odoo can generate a National Automated Clearing House Association (NACHA) compatible |ACH| file to
send to a company's bank. For each individual *Bank* journal that the company wishes to pay vendors
with, a |NACHA| configuration section needs to be filled out on the Odoo database.

Configuration
~~~~~~~~~~~~~

First, navigate to the :menuselection:`Accounting app --> Configuration --> Journals`. Open the bank
journal and click into the :guilabel:`Outgoing Payments` tab.

.. image:: united_states/us-l10n-nacha-settings.png
   :alt: NACHA (National Automated Clearing House Association) configuration settings on Odoo.

.. note::
   The following |NACHA| configuration information is normally provided by the company's financial
   institution once they have been approved to send payments via their account.

Under the section labeled, :guilabel:`NACHA configuration` are the fields required to generate a
|NACHA| compatible |ACH| file to send to a company's bank. First, enter the routing number of the
financial institution in the field labeled, :guilabel:`Immediate Destination`. This information is
widely available on the Internet and generally varies by bank location. This number is usually
provided during the initial account setup.

Next, enter the registered name of the financial institution in the field called,
:guilabel:`Destination`. This information is provided by the bank or credit union.

Following the :guilabel:`Destination` field is the :guilabel:`Immediate Origin` field. Enter the
9-digit company ID or Employer Identification Number (EIN) into this field. This information is
provided by the financial institution.

Next, enter the :guilabel:`Company Identification` number, which is a 10-digit number made from
combining the 9-digit company ID or Employer Identification Number (EIN), along with an additional
number at the start of the sequence. This number is often a `1`. Check with the financial
institution should this first number differ to verify that it is correct, as this number is provided
for |ACH| approved accounts.

Enter the :guilabel:`Originating DFI Identification` number next, which should contain an assigned
8-digit number from the financial institution.

.. important::
   Enter the numerical values in this section *exactly* as the company's financial institution (e.g.
   bank or credit union) has provided them, otherwise risk failing a successful |NACHA|
   configuration in Odoo.

.. image:: united_states/us-l10n-nacha-dropdown.png
   :alt: NACHA settings with the standard entry class code drop-down menu highlighted.

Two options are available for the next field: :guilabel:`Standard Entry Class Code`. Select the
drop-down menu to the right of the field and pick either :guilabel:`Corporate Credit or Debit (CCD)`
or :guilabel:`Prearranged Payment and Deposit (PPD)`. Again, this information is provided by the
financial institution. By default :guilabel:`Corporate Credit or Debit (CCD)` is selected.

Finally, the last option is for :guilabel:`Generated Balanced Files`. Tick the checkbox to the right
of the field to enable :guilabel:`Generated Balanced Files`. Consult the company's accountant or
financial adviser to make an informed decision for this field.

Manually save the configuration by clicking the :icon:`fa-cloud-upload` :guilabel:`(cloud upload)`
icon, or navigate away from this screen to auto-save. The configuration is now complete.

.. _l10n_us/batch-payment:

Create batch payment
~~~~~~~~~~~~~~~~~~~~

Now, record each payment in Odoo using the |NACHA| payment method.

.. seealso::
   :ref:`Register Payments in Odoo <accounting/payments/from-invoice-bill>`

.. important::
   Be aware of the cut-off time for same-day payments. Either the file needs to have a future date
   associated with each payment or the file needs to be sent prior to the cut-off, if the dates
   included in it match today's date. Consult the financial institution for the exact cut-off time
   for their processing of same-day payments.

Once all the payments to be included in the |NACHA| |ACH| file have been made, a batch payment needs
to be made from the :icon:`fa-cog` :guilabel:`Action` menu.

To create the batch payments, access the payments page, by navigating to :menuselection:`Accounting
--> Vendors --> Payments`. Select all the payments that should be included in the |NACHA| |ACH|
file, by ticking the checkboxes to the far-left of the rows.

.. image:: united_states/us-l10n-create-batch-payments.png
   :alt: On the payments screen, the action menu is highlighted with create a batch payment
         selected.

.. important::
   All payments in the batch **must** share the same |NACHA| payment method.

Next, navigate to the batched payment (:menuselection:`Accounting --> Vendors --> Batch Payments`).
Click into the payment recently created and then click into the :guilabel:`Exported File` tab. The
generated file is listed with the :guilabel:`Generation Date`. Click the :icon:`fa-download`
:guilabel:`(download)` button to download the file.

.. image:: united_states/us-l10n-batch-file.png
   :alt: The exported file tab highlighted in the batch payment with the download circled.

If any adjustments need to be made, click the :guilabel:`Re-generate Export File` button to recreate
a new |NACHA| |ACH| file.

.. seealso::
   - :doc:`../accounting/payments/batch`
   - :doc:`Europe's direct debiting <../accounting/payments/batch_sdd>`

.. |API| replace:: :abbr:`API (Application Programming Interface)`

Pay by direct deposit
=====================

Direct deposit is an electronic fund transfer primarily used in the United States, in which money is
sent directly to a bank account without the use of a physical check or manual deposit. Odoo offers
direct deposit through an international money transfer service called `Wise.com
<https://wise.com/>`_.

Wise provides an |API|, invoicing tools, and business accounts. Businesses can send and receive
payments using Wise's cross-border payment technology without building everything from scratch.

This feature can be used to pay vendor bills.

Configuration
-------------

Wise configuration
~~~~~~~~~~~~~~~~~~

Wise configuration involves three main steps: creating a Wise account, linking a bank account to the
Wise account, and generating |API| tokens from the Wise account. These steps are detailed below:

1. Navigate to `Wise.com <https://wise.com/>`_ and click :guilabel:`Sign-Up` to create an account.
#. Select :guilabel:`Business Account` and finish providing company and personal user details to
   complete the sign-up process.

   i. Wise may require additional verification documents depending on the business type and country.
      This process can take 1–3 business days.

#. Navigate to the account settings by clicking the :guilabel:`Company Name` in the top-right corner
   of the dashboard.
#. Select :menuselection:`Payment Methods --> Connected bank accounts` and click :guilabel:`Connect
   Your Bank Account`.
#. Search for the bank and add the bank account information. This bank account will be configured in
   Odoo as well.

#. Go to the account settings by clicking the :guilabel:`Company Name` in the top-right corner of
   the dashboard.
#. Select :menuselection:`Integration and Tools --> API Tokens` and click :guilabel:`Add new token`.
#. Add a description and select :guilabel:`Full Access`, then click :guilabel:`Create Token`.
#. Find the token under :guilabel:`API tokens` and click :guilabel:`Reveal key`.
#. Copy the token to the clipboard.

Odoo configuration
~~~~~~~~~~~~~~~~~~

Odoo configuration involves four main steps: installing the Wise module, adding Wise |API|
credentials, adding the company bank account, and adding the vendor bank account. These steps are
detailed below:

1. In the Odoo database, :ref:`install <general/install>` the :guilabel:`United States - Direct
   Deposit` module.

   .. tip::
      To see the module in search results, remove the :doc:`Apps filter
      <../../general/apps_modules>` from the search bar.

#. Go to :menuselection:`Accounting app --> Configuration --> Settings` and scroll down to the
   :guilabel:`Vendor Payments` section.
#. In the setting for :guilabel:`U.S. Direct Deposit (via Wise)`, enter the :guilabel:`Wise API
   token` generated in Wise.

#. Click :icon:`fa-plug` :guilabel:`Connect to Wise` to ensure the connection is established between
   the Odoo database and the Wise account.

   .. image:: united_states/connect-to-wise.png
      :alt: Click the Connect to Wise button to ensure the connection is established between the
            Odoo database and the Wise account.

#. Create the company and vendor bank accounts:

   a. Go to the :guilabel:`Contacts` app and select the company/vendor's contact card.
   #. Switch to the :guilabel:`Accounting` tab and click on the :guilabel:`Bank accounts` field,
      then click :guilabel:`Create`.

      .. image:: united_states/create-bank-account.png
         :alt: Click the Bank accounts field, then click Create to enter the bank account details.

   #. Click  on the :guilabel:`Bank` field, then select the bank from the list, or click
      :guilabel:`Search more` if it's not visible. If the bank isn't listed, click :guilabel:`Create
      new` to fill out the bank details, then click :guilabel:`Save`.

      .. image:: united_states/bank-information.png
         :alt: Click the Bank accounts field, then select or create the bank.

   #. Finally, enter the company bank account information (linked in Wise) or vendor bank account
      information, and click :guilabel:`Save`.

      i. The :guilabel:`Bank accounts` field in the :guilabel:`Accounting` tab should now display
         the newly added bank account.

         .. image:: united_states/bank-account-information.png
            :alt: Enter the company/vendor bank account information, then click Save.

   #. Repeat these steps for the **vendor** bank account.

      .. important::
         To avoid errors when initiating payments to the vendor, ensure the following:

         - Verify the destination bank account with the vendor, then mark it as :doc:`Trusted
           <../accounting/payments/trusted_accounts>`.
         - Select the correct :guilabel:`Bank Account Type` (checking or savings).
         - Select the preferred :guilabel:`Direct Deposit Transfer Type` for the vendor/destination
           account. Pricing can be verified directly in Wise.
         - See `Wise US pricing <https://wise.com/us/pricing/business>`__ to calculate price by
           feature & transaction amount; for pricing in other countries, select the country at the
           top of the page.

.. note::
   Wise offers a `Sandbox environment <https://sandbox.transferwise.tech/login>`_ for testing
   features and integrations.

   Select the appropriate environment to ensure accurate results (*sandbox* for testing,
   *production* for real transactions).

Pay vendor bills with direct deposit
------------------------------------

After configuring direct deposit in both Wise and Odoo, vendor payments can be created individually
in the Odoo database, batched for transfer, and then paid in Wise.

1. :ref:`Create vendor bills <accounting/vendor_bills/creation>`.
#. :doc:`Pay the vendor bills <../accounting/payments>` using :guilabel:`U.S. Direct Deposit` as the
   :guilabel:`Payment Method` for the transaction.
#. :doc:`Create a batch payment <../accounting/payments/batch>`. Batch payments can include payments
   from multiple vendors.
#. Confirm the :guilabel:`Batch Type` is :guilabel:`Outbound`, and click :guilabel:`Initiate
   payment`. Odoo will redirect to Wise.

   i. Sign into the Wise account if needed, and see all the pending transactions.

#. Review the details and confirm the batch number is the same in Odoo and Wise.
#. Click :guilabel:`Pay for this batch` or :guilabel:`I've now paid` to pay for the entire batch.

.. note::
   If pop-ups are blocked in the browser settings, Odoo can't redirect to Wise. Instead, Odoo
   displays a message stating:

   `"A popup window has been blocked. You may need to change your browser settings to allow popup
   windows for this page."`

   The payment record is still created in Wise, and can be accessed by clicking :guilabel:`View
   Batch` on the batch payment.

Cancel a batch payment
----------------------

To cancel a batch payment, follow these steps:

1. Navigate to :menuselection:`Accounting --> Vendors --> Batch Payments`.
#. Select the batch payment to cancel, then click :guilabel:`View Batch`. Odoo will redirect to the
   batch in Wise. Sign into the Wise account if needed.
#. Click :guilabel:`Cancel batch` in Wise.

ISO 20022
=========

ISO 20022 is a global standard for sending financial information between banks and payment systems
using XML files. It can be thought of as a universal language for money messages.

This standard helps banks all over the world talk to each other in the same way, or *language*, so
information is transferred correctly, making sending and receiving money faster, clearer, and safer.

In Odoo, ISO 20022 files are generated from :ref:`batch payments <l10n_us/batch-payment>`.

Configurations
--------------

Before creating ISO 20022 records, several configurations must be made, including :ref:`general
settings <l10n_us/settings>`, contact information for the :ref:`company
<l10n_us/contact-info-company>`, and contact and banking information for all :ref:`recipients
<l10n_us/contact-info-recipient>`.

.. _l10n_us/settings:

Settings
~~~~~~~~

First, navigate to :menuselection:`Acounting app --> Configuration --> Settings`, scroll to the
:guilabel:`Customer Payment` section, and enable the :guilabel:`Batch Payments` option.

Then scroll to the :guilabel:`Vendor Payments` section and enable the :guilabel:`SEPA Credit
Transfer / ISO20022` option. Once Enabled, three fields appear: :guilabel:`Your Company`,
:guilabel:`Name Identification`, and :guilabel:`Issuer`. Enter the information for these fields. The
information entered is required by the bank to identify the account, and is added to the XML file.

Click :guilabel:`Save` after making changes.

.. image:: united_states/us-l10n-sepa-settings.png
   :alt: The settings configured for the ISO 20022 in the Accounting app settings page.

.. note::
   The :guilabel:`Name Identification` and :guilabel:`Issuer` information are typically provided by
   the bank.

.. _l10n_us/contact-info-company:

Company information
~~~~~~~~~~~~~~~~~~~

Ensure the company's address information is correct, as the XML files generated include the company
address. Navigate to the :menuselection:`Settings app --> Users & Companies --> Companies`, and
click on the desired company to open the company form. Ensure the :guilabel:`Address` fields are
fully configured in the :guilabel:`General Information` tab.

.. image:: united_states/us-l10n-company-address.png
   :alt: The company record with address information completed.

.. _l10n_us/contact-info-recipient:

Recipient information
~~~~~~~~~~~~~~~~~~~~~

The XML file generated contains the address and banking information for *all* recipients. Open the
**Contacts** app and ensure every contact record that receives payments, both persons and companies,
includes complete :guilabel:`Address` information in the top-half of the contact form.

.. image:: united_states/us-l10n-company-contact.png
   :alt: The contact record for a company with address information completed.

Next, click into the :guilabel:`Accounting` tab, and ensure at least one trusted bank account
populates the :guilabel:`Banks` field. If no bank is listed, add a :ref:`new bank account
<l10n_us/add-bank>`.

.. _l10n_us/add-bank:

Add a bank account
******************

To add a bank account on a contact record, open the **Contacts** app and click on the contact
record, and click into the :guilabel:`Accounting` tab. Click into the blank field next to
:guilabel:`Banks`, click :guilabel:`Create...`, and a :guilabel:`Create Banks` pop-up window loads.
Fill out the following fields on the form, then click :guilabel:`Save`:

- :guilabel:`Account Number`: Enter the bank account number.
- :guilabel:`ABA/Routing Number`: Enter the ABA or routing number for the account.
- :guilabel:`Account Holder`: Using the drop-down menu, select the owner of the bank account. The
  contact name (person or company) populates this field by default.
- :guilabel:`Bank`: Using the drop-down menu, select the bank for the account. If the bank does not
  appear in the list, add a new bank by clicking :guilabel:`Search more...` then click
  :guilabel:`New`, and fill out the :guilabel:`Create Bank` form.
- :guilabel:`Send Money`: Ensure this slider is set to :guilabel:`Trusted`. The slider and text
  appears green if the bank account is trusted. If this is **not** set to trusted, an error appears
  when attempting to make a payment to the contact.

.. image:: united_states/us-l10n-add-bank.png
   :alt: Bank information on the Create Banks form.

.. note::
   Trusted bank accounts appear in green in the :guilabel:`Accounting` tab.

   .. image:: united_states/us-l10n-trusted.png
      :alt: A trusted bank account on a contact form.

Bank journal settings
~~~~~~~~~~~~~~~~~~~~~

Ensure the ISO payment methods appear in the bank journal, and are configured correctly. Navigate to
:menuselection:`Accounting app --> Configurations --> Journals` and click on the journal
:guilabel:`Bank`. Click into the :guilabel:`Outgoing Payments` tab, and ensure that in the
:guilabel:`Payment Method` column, both `ISO20022` and `U.S. ISO20022` appear.

Next, ensure all entries listed have the :guilabel:`101404 Outstanding Payments` account selected in
the :guilabel:`Outstanding Payments accounts` column. This allows Odoo to create journal entries for
payments.

ISO20022 vs U.S. ISO20022
-------------------------

The U.S. ISO20022 is similar to the ISO standard, with some U.S.-specific rules and formatting.

.. example::
   The U.S. ISO20022 uses ABA routing numbers, which are specific to the U.S., while the generic
   ISO20022 uses IBAN numbers.

.. list-table::
   :header-rows: 1
   :stub-columns: 0

   * - Feature
     - Global ISO 20022
     - U.S. ISO 20022
   * - Developed by
     - ISO (global organization)
     - U.S. payment system operators (Fed, TCH, NACHA)
   * - Used for
     - Global & cross-border payments
     - Domestic U.S. payments
   * - Format
     - XML-based standard
     - XML (same base) with U.S. data rules
   * - Examples
     - SEPA Credit Transfer (Europe), SWIFT MX messages
     - Fedwire ISO 20022, CHIPS ISO 20022
   * - Differences
     - Global fields and formats
     - Trimmed or modified to fit U.S. needs (e.g., ABA routing numbers instead of IBANs)

.. tip::
   It is recommended to use the generic ISO20022 for *international* transfers, and use the U.S.
   ISO20022 for *domestic* transfers.

Workflow
--------

First, :ref:`create <accounting/vendor_bills/creation>` and :ref:`confirm
<accounting/vendor_bills/bill-confirmation>` a vendor bill. Then, click the :guilabel:`Pay` button,
and a :guilabel:`Pay` pop-up window loads. Using the drop-down menu, select :guilabel:`ISO20022` in
the :guilabel:`Payment Method` field, then click :guilabel:`Create Payment`.

.. image:: united_states/us-l10n-pay.png
   :alt: The Pay pop-up window configured for ISO20022.

A green :guilabel:`In Payment` banner now appears on the vendor bill. Next, navigate to
:menuselection:`Accounting --> Vendors --> Payments`, and tick the checkbox next to the payment that
was paid using ISO20022 file to select it. Click :guilabel:`Create Batch`, then click
:guilabel:`Validate` on the batch form. Once validated, the batch payment moves to the
:guilabel:`Sent` stage, and the U.S. ISO20022 XML file is created and added to the chatter. The XML
file can be downloaded and used to initiate a bank payment.

.. image:: united_states/us-l10n-batch.png
   :alt: A batch payment with the XML file in the chatter.

Once the XML file is created, the following steps occur **outside** of the Odoo database.

Log into the bank's online portal or payment system. Most banks that support ISO 20022 have a
special section for `file uploads` or `import payments`. Upload the XML ISO 20022 file created by
Odoo (ending in `.xml`) and upload it to the bank system.

The bank checks the XML file by reading the file and making sure all details (accounts, amounts,
etc.) are valid. The list of payments appears inside the file. Review and confirm the information,
then click `Approve` or `Submit`.

The bank processes each payment in the file and transfers the funds to the recipients.


==================================================
SECTION: uruguay.rst
PATH: applications/finance/fiscal_localizations/uruguay.rst
==================================================

=======
Uruguay
=======

.. |DGI| replace:: :abbr:`DGI (Dirección General Impositiva)`
.. |EDI| replace:: :abbr:`EDI (Electronic Data Interchange)`
.. |CAEs| replace:: :abbr:`CAEs (Constancia de Autorización de Emisión)`

.. _uruguay/intro:

Introduction
============

With the Uruguayan localization, you can generate electronic documents with its XML, fiscal folio,
electronic signature and connection to tax authority Dirección General Impositiva (DGI) through
Uruware.

The supported documents are:

- :guilabel:`e-Invoice`, :guilabel:`e-Invoice Credit Note`, :guilabel:`e-Invoice Debit Note`;
- :guilabel:`e-Ticket`, :guilabel:`e-Ticket Credit Note`, :guilabel:`e-Ticket Debit Note`;
- :guilabel:`Export e-Invoice`, :guilabel:`Export e-Invoice Credit Note`, :guilabel:`Export
  e-Invoice Debit Note`.

The localization requires an Uruware account, which enables users to generate electronic documents
within Odoo.

.. seealso::
   :doc:`Documentation on e-invoicing's legality and compliance in Uruguay
   <../accounting/customer_invoices/electronic_invoicing/uruguay>`

Glossary
--------

The following terms are used throughout the Uruguayan localization:

- **DGI**: *Dirección General Impositiva* is the government entity responsible for enforcing tax
  payments in Uruguay.
- **EDI**: *Electronic Data Interchange* refers to the sending of electronic documents.
- **Uruware**: is the third-party organization that facilitates the interchange of electronic
  documents between companies and the Uruguayan government.
- **CAE**: *Constancia de Autorización de Emisión* is a document requested from the tax authority's
  website to enable electronic invoice issuance.

Configuration
=============

Modules installation
--------------------

:ref:`Install <general/install>` the following modules to get all the features of the Uruguayan
localization:

.. list-table::
   :header-rows: 1
   :widths: 25 25 50

   * - Name
     - Technical name
     - Description
   * - :guilabel:`Uruguay - Accounting`
     - `l10n_uy`
     - The default :doc:`fiscal localization package <../fiscal_localizations>`. It adds accounting
       characteristics for the Uruguayan localization, which represent the minimum configuration
       required for a company to operate in Uruguay according to the guidelines set by the |DGI|.
       The module's installation automatically loads: chart of accounts, taxes, documents types, and
       tax supported types.
   * - :guilabel:`Uruguay Accounting EDI`
     - `l10n_uy_edi`
     - Includes all the technical and functional requirements to generate and validate
       :doc:`Electronics Documents <../accounting/customer_invoices/electronic_invoicing>`, based on
       the technical documentation published by the |DGI|. The authorized documents are :ref:`listed
       above <uruguay/intro>`.

.. note::
   Odoo automatically installs the base module **Uruguay - Accounting** when a database is installed
   with `Uruguay` selected as the country. However, to enable electronic invoicing, the **Uruguay
   Accounting EDI** (`l10n_uy_edi`) module needs to be manually :ref:`installed <general/install>`.

Company
-------

To configure your company information, open the **Settings** app, scroll down to the
:guilabel:`Companies` section, click :guilabel:`Update Info`, and configure the following:

- :guilabel:`Company Name`
- :guilabel:`Address`, including the :guilabel:`Street`, :guilabel:`City`, :guilabel:`State`,
  :guilabel:`ZIP`, and :guilabel:`Country`
- :guilabel:`Tax ID`: enter the identification number for the selected taxpayer type.
- :guilabel:`DGI Main Branch Code`: this is part of the XML when creating an electronic document. If
  this field is not set, all electronic documents will be rejected.

  To find the :guilabel:`DGI Main Branch Code`, follow these steps:

  #. From your `DGI account <https://servicios.dgi.gub.uy/serviciosenlinea>`_, go to
     :menuselection:`Servicios en línea DGI --> Registro único tributario --> Consulta de datos`.
  #. Select :menuselection:`Consulta de Datos Registrales --> Consulta de Datos de Entidades`.
  #. Open the generated PDF to get the *DGI Main Branch Code* from the :guilabel:`Domicilio Fiscal
     Número de Local` section.

After configuring the company in the database settings, navigate to :menuselection:`Contacts` and
search for your company to verify the following:

- the company type is set to :guilabel:`Company`.
- the :guilabel:`Identification Number` :guilabel:`Type` is :guilabel:`RUT / RUC`.

.. _l10n_uy/uruware-account:

Set up a Uruware account
------------------------

To set up a Uruware account, follow these steps:

#. Verify that you have a valid Odoo subscription.
#. Locate the Uruware credentials settings by navigating to the :menuselection:`Accounting -->
   Configuration --> Settings`.
#. Scroll down to the :guilabel:`Uruguayan Localization` section and select the environment
   (:guilabel:`Production` or :guilabel:`Testing`).
#. Click on :guilabel:`Create Uruware Account`.

Upon doing so, an email is sent to the address associated with your Odoo subscription with the
password to enter Uruware's portal and set up your account.

.. tip::
  - The email with the credentials is not immediate; it might take up to 48 hours for the account to
    be created.
  - The company's :guilabel:`Tax ID` needs to be set up to be able to create an Uruware account.
  - The password sent expires after 24 hours. In this case, reset it by using the *Forgot Password*
    link in Uruware's portal.

.. note::
   This action will create an account with Uruware with the following information:

   - Legal name (razón social)
   - RUT from the company
   - Username (the Odoo subscription email or `RUT`.odoo. For example: `213344556677.odoo`)
   - Odoo database link

   To ensure your account is created correctly, please add any missing information from above.

Once the account is created and you have received the email containing the credentials, configure
your accounts directly in the Uruware `testing portal <https://odootest.ucfe.com.uy/Gestion/>`_ or
`production portal <https://prod6109.ucfe.com.uy/Gestion/>`_:

Use the account credentials in the email to log in to the to the corresponding (`test
<https://odootest.ucfe.com.uy/Gestion/>`_ or `production <https://prod6109.ucfe.com.uy/Gestion/>`_)
portal.

In Uruware's portal, the following steps are needed to be able to issue invoices from Odoo:

#. Complete and correct the company's information.
#. Add your digital certificate.
#. Add your :abbr:`CAEs (Constancia de Autorización para Emisión)` for each document-type you plan
   to issue.
#. Configure the format of the PDF to be printed and sent to your customers.

.. important::
   Be sure to configure two accounts, one for testing and one for production. The certificate is
   needed in both environments, but :abbr:`CAEs (Constancia de Autorización para Emisión)` are only
   needed in production.

.. seealso::
   - `Odoo Tutorials: Uruguay Localization
     <https://www.odoo.com/slides/smart-tutorial-localizacion-de-uruguay-432>`_
   - `Odoo Help Forum: Uruguay
     <https://www.odoo.com/forum/help-1?search=l10n_uy>`_

Electronic invoice data
-----------------------

To configure the electronic invoice data, an environment and credentials need to be configured. To
do so, navigate to :menuselection:`Accounting --> Configuration --> Settings` and scroll down to the
:guilabel:`Uruguayan Localization` section.

First, select the :guilabel:`UCFE Web Services` environment:

- :guilabel:`Production`: for production databases. In this mode, electronic documents are sent to
  |DGI| through Uruware for their validation.
- :guilabel:`Testing`: for test databases. In this mode, the direct connection flows can be tested,
  with the files sent to the |DGI| testing environment through Uruware.
- :guilabel:`Demo`: files are created and accepted automatically in demo mode but are **not** sent
  to the |DGI|. For this reason, rejection errors will not appear in this mode. Every internal
  validation can be tested in demo mode. Avoid selecting this option in a production database.

.. note::
   Using :guilabel:`Demo` mode does not require a Uruware account.

Then, enter the :guilabel:`Uruware Data`:

- :guilabel:`Uruware WS Password`
- :guilabel:`Commerce Code`
- :guilabel:`Terminal Code`

.. image:: uruguay/electronic-invoice-data.png
   :alt: Required information for electronic invoice.

.. note::
   This data can be obtained from the Uruware portal after configuring the :ref:`Uruware account
   <l10n_uy/uruware-account>`.

   To get the :guilabel:`Uruware WS Password`, go to :menuselection:`Configuration --> Company -->
   Edit` and look for the :guilabel:`Validators and Additional Information` tab to find
   :guilabel:`WS Password`.

   To get the :guilabel:`Commerce Code`, go to :menuselection:`Configuration --> Branches`.

   To get the :guilabel:`Terminal Code`, go to :menuselection:`Configuration --> Issuing Points`.

Master data
-----------

Chart of accounts
~~~~~~~~~~~~~~~~~

The :doc:`chart of accounts <../accounting/get_started/chart_of_accounts>` is installed by default
as part of the set of data included in the localization module, the accounts are mapped
automatically in taxes, default accounts payable, and default accounts receivable.

Accounts can be added or deleted according to the company's needs.

.. seealso::
   :doc:`../accounting/get_started/chart_of_accounts`

Contacts
~~~~~~~~

To create a contact, navigate to :menuselection:`Contacts app` and select :guilabel:`New`. Then
enter the following information:

- :guilabel:`Company Name`
- :guilabel:`Address`:

  - :guilabel:`Street`: required to confirm an electronic invoice.
  - :guilabel:`City`
  - :guilabel:`State`
  - :guilabel:`ZIP`
  - :guilabel:`Country`: required to confirm an electronic invoice.

- :guilabel:`Identification Number`:

  - :guilabel:`Type`: select a identification type.
  - :guilabel:`Number`: required to confirm an electronic invoice.

Taxes
~~~~~

As part of the Uruguay localization module, taxes are automatically created with its configuration
and related financial accounts.

.. image:: uruguay/taxes.png
   :alt: Taxes for Uruguay.

Document types
~~~~~~~~~~~~~~

Some accounting transactions, like *customer invoices* and *vendor bills* are classified by document
types. These are defined by the government fiscal authorities, in this case by the |DGI|.

Each document type can have a unique sequence per journal where it is assigned. The data is created
automatically when the localization module is installed, and the information required for the
document types is included by default.

To review the document types included in the localization, navigate to :menuselection:`Accounting
--> Configuration --> Document Types`.

.. note::
   In Uruguay, |CAEs| **must** be uploaded in Uruware. Sequences (and PDFs) are received in Odoo
   from Uruware, based on their |CAEs|. |CAEs| are **only** used in production. When testing, only a
   range of sequences used in Uruware need to be set.

.. image:: uruguay/document-types.png
   :alt: Document types for Uruguay.

Sales journals
~~~~~~~~~~~~~~

To generate and confirm an electronic document that will be validated by |DGI|, the sales journal
needs to be configured with the following:

- :guilabel:`Invoicing Type`: by default :guilabel:`Electronic` option is set. This is necessary to
  send electronic documents via web service to the Uruguayan government through Uruware. The other
  option, :guilabel:`Manual`, is for open invoices previously stamped in another system, for
  example, in the |DGI|.
- :guilabel:`Use Documents?`: Activate this option if this journal will use documents from the list
  of document types in Odoo.

Workflows
=========

Once you have configured your database, you can create your documents.

Sales documents
---------------

Customer invoices
~~~~~~~~~~~~~~~~~

:doc:`Customer invoices <../accounting/customer_invoices>` are electronic documents that, when
validated, are sent to |DGI| via Uruware. These documents can be created from your sales order or
manually. They must contain the following data:

- :guilabel:`Customer`: type the customer's information.
- :guilabel:`Due date`: to compute if the invoice is due now or later (*contado* or *crédito*,
  respectively).
- :guilabel:`Journal`: select the electronic sales journal.
- :guilabel:`Document Type`: document type in this format, for example, `(111) e-Invoice`.
- :guilabel:`Products`: specify the product(s) with the correct taxes.

.. note::
   Every document type has a specific credit note and debit note (e.g., the document type
   :guilabel:`(111) e-Invoice` has an :guilabel:`(112) e-Invoice Credit Note`).

Customer credit note
~~~~~~~~~~~~~~~~~~~~

The :doc:`Customer credit note <../accounting/customer_invoices/credit_notes>` is an electronic
document that, when validated, is sent to |DGI| via Uruware. It is necessary to have a validated
(posted) invoice to register a credit note. On the invoice, click the :guilabel:`Credit note` button
to access the :guilabel:`Create credit note` form, then complete the following information:

- :guilabel:`Reason`: type the reason for the credit note.
- :guilabel:`Journal`: select the journal that has to be electronic and has the :guilabel:`Use
  Documents?` option active.
- :guilabel:`Document Type`: select the credit note document type.
- :guilabel:`Reversal Date`: type the date.

Customer debit note
~~~~~~~~~~~~~~~~~~~

The :doc:`Customer debit note <../accounting/customer_invoices/credit_notes>` is an electronic
document that, when validated, is sent to |DGI| via Uruware. It is necessary to have a validated
(posted) invoice to register a debit note. On the invoice, click the :icon:`fa-cog`
(:guilabel:`action menu`) icon, select the :guilabel:`Debit note` option to access the
:guilabel:`Create credit note` form, then complete the following information:

- :guilabel:`Reason`: Type the reason for the debit note.
- :guilabel:`Journal`: Select the journal that has to be electronic and has the :guilabel:`Use
  Documents?` option active.
- :guilabel:`Copy lines`: Tick the checkbox to copy the invoice lines to the debit note.
- :guilabel:`Debit note date`: Type the date.

.. note::
   Confirm the invoice to create it with an internal reference. To send the document to |DGI| via
   Uruware, click on :guilabel:`Send and Print` and select the checkbox :guilabel:`Create CFE`. The
   legal document sequence (number) is brought from Uruware once the document has been processed.
   Make sure you have |CAEs| available in Uruware.

.. note::
   The PDF of the validated document is pulled from Uruware following the specification by the
   Uruguayan government (DGI).

Addendas and disclosures
========================

*Addendas* and *disclosures* are additional notes and comments added to an electronic document that
can be mandatory or optional. To create a new addenda, go to :menuselection:`Accounting -->
Configuration --> Addendas and disclosures` and click :guilabel:`New`.

Enter the following information:

- :guilabel:`Name`: name of the addenda or mandatory disclosure.
- :guilabel:`Type`: Select the type of remark, this will add it to the specific section in the XML.
- :guilabel:`Is legend`: Select this box if the text is a mandatory disclosure, leave it blank if it
  is additional information.
- :guilabel:`Content`: Add the complete text of the addenda or disclosure.

Leyenda and additional information in product
---------------------------------------------

To add a *leyenda* or additional information to the product and XML, it is necessary to add the
preconfigured addenda and disclosure to the product in the invoice line. Add the *leyenda* in the
:guilabel:`Disclosure` field of the product specified in the line.

Leyenda and additional information
----------------------------------

To add a *leyenda* or additional information to the electronic invoice and XML, access the invoice,
go to the :guilabel:`Other Info` tab, and select the desired addenda in the :guilabel:`Addenda and
Disclosure` field. The addenda and disclosures added here will appear in the XML and visibly in the
PDF document.

This applies to the following types of *addendas*:

- Document
- Issuer
- Receiver
- Addendas

.. note::
   To add a temporary note to the electronic document, use the :guilabel:`Terms and Conditions`
   field. This information will be sent in the addenda of the invoice, but it won't be saved for
   future documents.


==================================================
SECTION: vietnam.rst
PATH: applications/finance/fiscal_localizations/vietnam.rst
==================================================

=======
Vietnam
=======

.. _SInvoice: https://www.sinvoice.vn/

.. _localizations/vietnam/modules:

Modules
=======

The following modules are installed automatically with the Vietnamese localization:

.. list-table::
    :header-rows: 1

    * - Name
      - Technical name
      - Description
    * - :guilabel:`Vietnam - Accounting`
      - `l10n_vn`
      - This module includes the default
        :ref:`fiscal localization package <fiscal_localizations/packages>`.
    * - :guilabel:`Vietnam - E-invoicing`
      - `l10n_vn_edi_viettel`
      - This module includes the features required for integration with :ref:`SInvoice
        <localizations/vietnam/sinvoice>`.

.. note::
   In some cases, such as when upgrading to a version with additional modules, it is possible that
   modules may not be installed automatically. Any missing modules can be manually :ref:`installed
   <general/install>`.

.. _localizations/vietnam/company:

Company
=======

To use all the features of this fiscal localization, the following fields are required on the
:doc:`company record </applications/general/companies>`:

- :guilabel:`Name`
- :guilabel:`Address`, including the :guilabel:`City`, :guilabel:`State`, :guilabel:`Zip Code`,
  and :guilabel:`Country`.

   - In the :guilabel:`Street` field, enter the street name, number, and any additional address
     information.
   - In the :guilabel:`Street 2` field, enter the neighborhood.

- :guilabel:`Tax ID`: tax identification number.

.. _localizations/vietnam/sinvoice:

E-invoicing with SInvoice
=========================

SInvoice_ is an e-invoice service platform provided by Viettel, one of the biggest e-invoice service
providers in Vietnam. Odoo supports integration with SInvoice to submit invoices generated in Odoo.

Configuration
-------------

SInvoice platform
~~~~~~~~~~~~~~~~~

To send electronic invoices to SInvoice, the following must be created on SInvoice_:

- :ref:`SInvoice account <localizations/vietname/sinvoice-registration>`
- :ref:`Invoice template <localizations/vietname/sinvoice-template>`
- :ref:`Invoice symbol <localizations/vietname/sinvoice-symbol>`
- :ref:`Invoice issuance notice <localizations/vietname/sinvoice-notice>`

.. _localizations/vietname/sinvoice-registration:

SInvoice registration
*********************

To create an account, go to SInvoice_ and register for the desired plan. Fill in the form that
opens to be contacted by SInvoice_ to create an account.

Once you have an account, log into SInvoice_ using your :guilabel:`Username` and
:guilabel:`Password`.

.. _localizations/vietname/sinvoice-template:

Invoice template creation
*************************

#. On the left side of the overview page, in the :guilabel:`Release management` menu, click
   :guilabel:`Create business information`.
#. In the :guilabel:`Update key information` step, fill in the following fields and other optional
   information if needed: :guilabel:`Unit name`, :guilabel:`Address`, :guilabel:`Contact person`,
   :guilabel:`Type of representative documents`.
#. Click :guilabel:`Update`.
#. In the :guilabel:`Look up digital certificate` step, click :guilabel:`Add new` to add a digital
   certificate.
#. Select the :guilabel:`Branch/Enterprise` and the :guilabel:`Type of digital certificate`, then
   fill in the required fields for each type:

     - :guilabel:`Supplier`: CloudCA
     - :guilabel:`Signer ID`: CloudCA
     - :guilabel:`Digital Certificate`: CloudCA
     - :guilabel:`How to download file`: HSM
     - :guilabel:`File Upload`: HSM, USB-TOKEN

#. Click :guilabel:`Generate key pair` to generate encryption keys for authentication, and
   :guilabel:`Save`.
#. In the :guilabel:`Manage invoice templates` step, add a new :guilabel:`Invoice template`.
#. Select the :guilabel:`Invoice type` and fill in the :guilabel:`Invoice template code`,
   :guilabel:`Invoice template name`, and other optional information if needed.
#. Click :guilabel:`Update`.

.. seealso::
   `SInvoice documentation on electronic invoice template creation
   <https://www.sinvoice.vn/2021/02/hdsd-tai-lieu-nghiep-vu-tao-mau-hoa-don-dien-tu.html?debug=1>`_

.. _localizations/vietname/sinvoice-symbol:

Invoice symbol creation
***********************

On the left side of the main screen, in the :guilabel:`Release management` menu, click
:guilabel:`Invoice symbol` and follow these steps:

#. Click :guilabel:`Add new` and select the :guilabel:`Invoice template`.
#. Set the :guilabel:`Status` to :guilabel:`Active` to activate the symbol and fill in the
   :guilabel:`Invoice symbol`.
#. Enable :guilabel:`Stop automatic sending to tax authorities` and :guilabel:`Default for built-in
   API` based on preference.
#. Click :guilabel:`Save`.

.. _localizations/vietname/sinvoice-notice:

Invoice issuance notice
***********************

On the left side of the main screen, in the :guilabel:`Release management` menu, click
:guilabel:`Create issuance notice` and follow these steps:

#. Click :guilabel:`Add new`, select the :guilabel:`Name of the business unit to issue an e-invoice`
   and the :guilabel:`Tax agency name`. Based on the business unit and tax agency selected, the
   :guilabel:`Tax code`, :guilabel:`Address`, :guilabel:`Phone number`, and :guilabel:`Separator
   used` are automatically filled and uneditable.
#. Click :guilabel:`Select the invoice type for issuance`, and then select and fill in the
   following information :

   - :guilabel:`Invoice type`: The invoice type on which to declare an issuance notice.
   - :guilabel:`Invoice template`: Select from the list of templates available based on the invoice
     type.
   - :guilabel:`Symbol`: Select from the list of symbols available based on the invoice type.
   - :guilabel:`Quantity`: Total number of invoices to issue for the selected type. Based on the
     type and template selected, this field is filled in automatically. It can be changed if needed.
   - :guilabel:`Start date of use`: The date from which the invoice template, range, and quantity
     are used for the issuance notice.

#. Click :guilabel:`Save` and select more invoice types if necessary by repeating the steps above.
   Click :guilabel:`Save` to finish drafting the notice.
#. Click :guilabel:`Send to tax authorities` for approval. Once approved, the notice's
   :guilabel:`Status` is changed to :guilabel:`Active`.

.. _localizations/vietnam/sinvoice-odoo:

Odoo database
~~~~~~~~~~~~~

Link Odoo to SInvoice
*********************

To connect Odoo with SInvoice, go to :menuselection:`Accounting --> Configuration --> Settings`.
In the :guilabel:`Vietnamese Integration` section, fill in your SInvoice :guilabel:`Username` and
:guilabel:`Password`. Add a :guilabel:`Default symbol` to generate a prefix for the invoice number
managed in SInvoice if needed.

Invoice template
****************

To create SInvoice templates, go to :menuselection:`Accounting --> Configuration --> Templates`.
Click :guilabel:`New` and add a :guilabel:`Template code` and a :guilabel:`Template Invoice Type`.
The :guilabel:`Template code` is the initial sequence of digits in the name assigned by SInvoice.
For example, if the invoice template is `1/001 - Hóa đơn GTGT - ND123`, the :guilabel:`Template
code` is `1/001`. The SInvoice templates in Odoo must match the ones in SInvoice.

To add :guilabel:`Invoice Symbols`, click :guilabel:`Add a new line`.

Sending invoices to SInvoice
----------------------------

Invoices can be sent to SInvoice once they have been confirmed. To do so, follow the
:ref:`invoice sending <accounting/invoice/sending>` steps. In the :guilabel:`Send` popup, enable
:guilabel:`Send to SInvoice` and click :guilabel:`Send & Print`.

Once the invoice has been successfully submitted to SInvoice, the :guilabel:`SInvoice Status` field
in the :guilabel:`SInvoice` tab of the invoice is updated to :guilabel:`Sent`. The
:guilabel:`SInvoice Number`, :guilabel:`Issue Date`, :guilabel:`Secret Code` and :guilabel:`eInvoice
Number` fields are also updated. The same information is available on SInvoice.

Replacement or adjustment invoices
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

A replacement invoice is issued to correct an invoice that has **yet to be tax declared**, whereas
an adjustment invoice is issued to correct one that has **already been tax declared**. Follow these
steps to issue a replacement or adjustment invoice:

#. Open the invoice and click :guilabel:`Credit Note`.
#. In the :guilabel:`Credit Note` popup, fill in the following fields:

   - :guilabel:`Reason displayed on Credit Note`
   - :guilabel:`Adjustment type`
   - :guilabel:`Agreement Name`
   - :guilabel:`Agreement Date`
   - :guilabel:`Journal`
   - :guilabel:`Reversal date`

#. Click :guilabel:`Reverse and Create Invoice` to issue a replacement invoice, or
   :guilabel:`Reverse` to issue an adjustment invoice.

The :guilabel:`SInvoice Status` in the :guilabel:`SInvoice` invoice tab is updated to
:guilabel:`Replaced` for a replacement invoice or :guilabel:`Adjusted` for an adjustment invoice.

Invoice cancellation
~~~~~~~~~~~~~~~~~~~~

If an invoice needs to be canceled, open the invoice and click :guilabel:`Request Cancel`. In the
:guilabel:`Invoice Cancellation` popup, enter the cancellation :guilabel:`Reason`,
:guilabel:`Agreement Name`, and :guilabel:`Agreement Date`, and click :guilabel:`Request
Cancellation`.

The :guilabel:`SInvoice Status` in the :guilabel:`SInvoice` invoice tab is updated to
:guilabel:`Canceled`.

.. _localizations/vietnam/qrcode:

QR banking codes
================

Vietnamese QR banking is a payment service platform that allows customers to make instant domestic
payments to individuals and merchants in Vietnamese dong via online and mobile banking.

Configuration
-------------

To activate QR banking codes, go to :menuselection:`Accounting --> Configuration --> Settings` and
enable :guilabel:`QR Codes` in the :guilabel:`Customer Payments` section.

Bank account
~~~~~~~~~~~~

To activate QR banking for a bank account, go to :menuselection:`Contacts --> Configuration -->
Bank Accounts` and select the bank account. Fill in the :guilabel:`Bank Identifier Code`,
:guilabel:`Proxy Type` (based on the information used to identify the :guilabel:`Merchant Account`,
such as the card number and bank account numbers), and :guilabel:`Proxy Value` fields.

Enable :guilabel:`Include Reference` to include the invoice number in the QR code.

.. important::
   - The account holder's country must be set to `Vietnam`, and their city must be specified on the
     contact form.
   - The :ref:`account number <accounting/journals/bank>` and bank must be set on the
     :guilabel:`Bank` journal.

.. seealso::
   :doc:`../accounting/bank`

Generating QR codes on invoices
-------------------------------

When creating a new invoice, open the :guilabel:`Other Info` tab and select :guilabel:`EMV
Merchant-Presented QR-code` in the :guilabel:`Payment QR-code` field.

.. note::
   Ensure the :guilabel:`Recipient Bank` is configured, as Odoo uses this field to generate QR
   codes.
